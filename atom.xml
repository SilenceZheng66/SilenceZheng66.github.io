<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SilenceZheng66-BLOG</title>
  
  <subtitle>silencezheng.top</subtitle>
  <link href="http://silencezheng.top/atom.xml" rel="self"/>
  
  <link href="http://silencezheng.top/"/>
  <updated>2024-03-10T10:58:59.995Z</updated>
  <id>http://silencezheng.top/</id>
  
  <author>
    <name>SilenceZheng66</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å›å½’é—®é¢˜æŒ‡æ ‡è®¡ç®—</title>
    <link href="http://silencezheng.top/2024/03/10/article127/"/>
    <id>http://silencezheng.top/2024/03/10/article127/</id>
    <published>2024-03-10T10:56:26.000Z</published>
    <updated>2024-03-10T10:58:59.995Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å›å½’é—®é¢˜æŒ‡æ ‡è®¡ç®—å…¥é—¨ã€‚<br><span id="more"></span></p><h1 id="RSE-Relative-Squared-Error"><a href="#RSE-Relative-Squared-Error" class="headerlink" title="RSE (Relative Squared Error)"></a><strong>RSE (Relative Squared Error)</strong></h1><p>ç›¸å¯¹å¹³æ–¹è¯¯å·®æ˜¯é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„å¹³æ–¹å·®ä¸å®é™…å€¼çš„å¹³æ–¹å·®çš„æ¯”ç‡ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">RSE = \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2}</script><p>å…¶ä¸­ï¼Œ$ y_i $ æ˜¯ç¬¬ $ i $ ä¸ªè§‚æµ‹å€¼ï¼Œ$ \hat{y}_i $ æ˜¯å¯¹åº”çš„é¢„æµ‹å€¼ï¼Œ$ \bar{y} $ æ˜¯è§‚æµ‹å€¼çš„å‡å€¼ï¼Œ$ n $ æ˜¯æ ·æœ¬æ•°é‡ã€‚</p><h1 id="RAE-Relative-Absolute-Error"><a href="#RAE-Relative-Absolute-Error" class="headerlink" title="RAE (Relative Absolute Error)"></a><strong>RAE (Relative Absolute Error)</strong></h1><p>ç›¸å¯¹ç»å¯¹è¯¯å·®æ˜¯é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„ç»å¯¹å·®ä¸å®é™…å€¼çš„ç»å¯¹å·®çš„æ¯”ç‡ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">RAE = \frac{\sum_{i=1}^{n} |y_i - \hat{y}_i|}{\sum_{i=1}^{n} |y_i - \bar{y}|}</script><h1 id="MSE-Mean-Squared-Error"><a href="#MSE-Mean-Squared-Error" class="headerlink" title="MSE (Mean Squared Error)"></a><strong>MSE (Mean Squared Error)</strong></h1><p>å‡æ–¹è¯¯å·®æ˜¯é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„å¹³æ–¹å·®çš„å¹³å‡å€¼ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">MSE = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2</script><h1 id="RMSE-Root-Mean-Squared-Error"><a href="#RMSE-Root-Mean-Squared-Error" class="headerlink" title="RMSE (Root Mean Squared Error)"></a><strong>RMSE (Root Mean Squared Error)</strong></h1><p>å‡æ–¹æ ¹è¯¯å·®æ˜¯å‡æ–¹è¯¯å·®çš„å¹³æ–¹æ ¹ï¼Œå®ƒæä¾›äº†é¢„æµ‹è¯¯å·®çš„æ ‡å‡†åŒ–åº¦é‡ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">RMSE = \sqrt{MSE}</script><h1 id="MAPE-Mean-Absolute-Percentage-Error"><a href="#MAPE-Mean-Absolute-Percentage-Error" class="headerlink" title="MAPE (Mean Absolute Percentage Error)"></a><strong>MAPE (Mean Absolute Percentage Error)</strong></h1><p>å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®æ˜¯é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®çš„å¹³å‡å€¼ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">MAPE = \frac{100}{n} \sum_{i=1}^{n} \left| \frac{y_i - \hat{y}_i}{y_i} \right|</script><h1 id="Correlation-Pearson-Correlation-Coefficient"><a href="#Correlation-Pearson-Correlation-Coefficient" class="headerlink" title="Correlation (Pearson Correlation Coefficient)"></a><strong>Correlation (Pearson Correlation Coefficient)</strong></h1><p>ç›¸å…³ç³»æ•°è¡¡é‡äº†é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„çº¿æ€§å…³ç³»å¼ºåº¦å’Œæ–¹å‘ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\text{Correlation} = \frac{\sum_{i=1}^{n} (y_i - \bar{y})(\hat{y}_i - \bar{\hat{y}})}{\sqrt{\sum_{i=1}^{n} (y_i - \bar{y})^2 \sum_{i=1}^{n} (\hat{y}_i - \bar{\hat{y}})^2}}</script><p>å…¶ä¸­ï¼Œ$ \bar{y} $ å’Œ $ \bar{\hat{y}} $ åˆ†åˆ«æ˜¯è§‚æµ‹å€¼å’Œé¢„æµ‹å€¼çš„å‡å€¼ã€‚</p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å›å½’é—®é¢˜æŒ‡æ ‡è®¡ç®—å…¥é—¨ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="http://silencezheng.top/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>VS Code æ’ä»¶å¼€å‘ä½“éªŒ</title>
    <link href="http://silencezheng.top/2024/02/08/article126/"/>
    <id>http://silencezheng.top/2024/02/08/article126/</id>
    <published>2024-02-07T18:40:36.000Z</published>
    <updated>2024-02-07T18:44:03.600Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>VS Codeæ˜¯æˆ‘çš„ä¸»åŠ›æ–‡å­—ç¼–è¾‘å™¨ï¼Œç›®å‰æˆ‘çš„æ‰€æœ‰åšå®¢ä¸è¯¾é¢˜è°ƒç ”å·¥ä½œéƒ½æ˜¯ä½¿ç”¨å®ƒè¿›è¡Œç¼–è¾‘çš„ã€‚Markdownæ ¼å¼ä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–‡æœ¬æ ¼å¼ï¼Œå®ƒè®©æˆ‘å¯ä»¥å¿«é€Ÿæ•´ç†æƒ³æ³•è€Œä»…ä»…è€ƒè™‘åŸºæœ¬çš„æ ¼å¼ã€‚</p><p>ä½†åœ¨åšè¯¾é¢˜è°ƒç ”æ—¶æˆ‘ä¹ æƒ¯ä½¿ç”¨<code>[n]</code>ä½œä¸ºå‚è€ƒæ–‡çŒ®åºå·ï¼ŒVS Codeä¸èƒ½å¯¹è¿™ç§åºå·è¿›è¡Œè‡ªåŠ¨é€’å¢å’Œé‡æ–°ç´¢å¼•ï¼Œäºæ˜¯æˆ‘æƒ³å¼€å‘ä¸€æ¬¾æ’ä»¶å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ’ä»¶çš„åå­—å°±å«<code>Reference Extension</code>å§ã€‚<br><span id="more"></span></p><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><p>0ã€æ›´æ–°npmã€cnpmï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvm install 18</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…cnpm</span></span><br><span class="line">npm install -g cnpm -registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p><p>1ã€å®‰è£… Yeoman å’Œ VS Code Extension Generatorï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g yo generator-code</span><br></pre></td></tr></table></figure></p><p>2ã€åˆ›å»ºä¸€ä¸ªæ–°çš„æ’ä»¶é¡¹ç›®<code>Reference Extension</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yo code</span><br><span class="line"></span><br><span class="line"><span class="comment"># ? What type of extension do you want to create? New Extension (TypeScript)</span></span><br><span class="line"><span class="comment"># ? What&#x27;s the name of your extension? Reference Extension</span></span><br><span class="line"><span class="comment"># ? What&#x27;s the identifier of your extension? reference-extension</span></span><br><span class="line"><span class="comment"># ? What&#x27;s the description of your extension? Literature Citation Extension</span></span><br><span class="line"><span class="comment"># ? Initialize a git repository? Yes</span></span><br><span class="line"><span class="comment"># ? Bundle the source code with webpack? Yes</span></span><br><span class="line"><span class="comment"># ? Which package manager to use? npm</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> reference-extension</span><br></pre></td></tr></table></figure></p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>ä¸»è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li><code>[n]</code>æ ¼å¼ç´¢å¼•å¢åŠ é¡¹æ—¶è‡ªåŠ¨é€’å¢ï¼ˆå®é™…åªå®ç°äº†ä¸€éƒ¨åˆ†ï¼‰ã€‚</li><li><code>[n]</code>æ ¼å¼ç´¢å¼•é‡æ–°ç´¢å¼•ï¼ŒåŒ…å«åˆ é™¤é¡¹ä¸å¢åŠ é¡¹ï¼ˆå®é™…åªå®ç°äº†ä¸€éƒ¨åˆ†ï¼‰ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ VSCode æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> vscode <span class="keyword">from</span> <span class="string">&#x27;vscode&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¿€æ´»æ’ä»¶çš„å…¥å£å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params">context: vscode.ExtensionContext</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ³¨å†Œå‘½ä»¤ï¼šè‡ªåŠ¨é€’å¢ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">let</span> disposableAutoIncrement = vscode.commands.registerTextEditorCommand(<span class="string">&#x27;rext.autoIncrement&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ´»åŠ¨çš„æ–‡æœ¬ç¼–è¾‘å™¨</span></span><br><span class="line">        <span class="keyword">const</span> editor = vscode.window.activeTextEditor;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (editor) &#123;</span><br><span class="line">            <span class="comment">// è·å–å½“å‰å…‰æ ‡ä½ç½®</span></span><br><span class="line">            <span class="keyword">const</span> currentPosition = editor.selection.active;</span><br><span class="line">            <span class="keyword">const</span> currentLine = currentPosition.line;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å½“å‰è¡Œçš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶åŒ¹é…æ˜¯å¦ä»¥ [n] æ ¼å¼ç»“å°¾</span></span><br><span class="line">            <span class="keyword">const</span> currentLineText = editor.document.lineAt(currentLine).text;</span><br><span class="line">            <span class="keyword">const</span> match = currentLineText.match(<span class="regexp">/\[(\d+)\]\s+(.*)/</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                <span class="comment">// è·å–åŒ¹é…åˆ°çš„æ•°å­—ï¼Œå¹¶è®¡ç®—ä¸‹ä¸€ä¸ªæ•°å­—</span></span><br><span class="line">                <span class="keyword">const</span> currentNumber = <span class="built_in">parseInt</span>(match[<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">const</span> nextNumber = currentNumber + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è‡ªå¢é€»è¾‘</span></span><br><span class="line">                editor.edit(<span class="function"><span class="params">editBuilder</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// TODOï¼š è¿™æ®µæœ‰é—®é¢˜ï¼Œè¦ä¿®æ”¹ï¼Œè€Œä¸”è¿˜æ˜¯æ²¡æœ‰åšåˆ°å›è½¦å‰è§¦å‘ã€‚</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> line = currentLine + <span class="number">1</span>; line &lt; editor.document.lineCount; line++) &#123;</span><br><span class="line">                        <span class="keyword">const</span> lineText = editor.document.lineAt(line).text;</span><br><span class="line">                        <span class="keyword">const</span> matchBelow = lineText.match(<span class="regexp">/\[(\d+)\]\s+(.*)/</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (matchBelow) &#123;</span><br><span class="line">                            <span class="keyword">const</span> currentNumberBelow = <span class="built_in">parseInt</span>(matchBelow[<span class="number">1</span>]);</span><br><span class="line">                            <span class="keyword">const</span> newIndexBelow = currentNumberBelow + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// æ›¿æ¢ä¸‹æ–¹æ–¹æ‹¬å·ä¸­çš„æ•°å­—</span></span><br><span class="line">                            <span class="keyword">const</span> startPosBelow = <span class="keyword">new</span> vscode.Position(line, <span class="number">0</span>);</span><br><span class="line">                            <span class="keyword">const</span> endPosBelow = <span class="keyword">new</span> vscode.Position(line, matchBelow[<span class="number">0</span>].length);</span><br><span class="line">                            editBuilder.replace(<span class="keyword">new</span> vscode.Range(startPosBelow, endPosBelow), <span class="string">`[<span class="subst">$&#123;newIndexBelow&#125;</span>] <span class="subst">$&#123;matchBelow[<span class="number">2</span>]&#125;</span>`</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// å¦‚æœä¸‹æ–¹æ²¡æœ‰ç¬¦åˆ [n] æ ¼å¼ç´¢å¼•çš„é¡¹ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">const</span> newPosition = <span class="keyword">new</span> vscode.Position(currentLine + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">                    editBuilder.insert(newPosition, <span class="string">`[<span class="subst">$&#123;nextNumber&#125;</span>] `</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œå‘½ä»¤ï¼šé‡æ–°ç´¢å¼•æ‰€æœ‰è¡Œçš„æ–¹æ‹¬å·</span></span><br><span class="line">    <span class="comment">// TODOï¼šå®é™…ä¸Šåªå®ç°äº†åˆ é™¤ä¸€ä¸ªç´¢å¼•æ—¶å°†ä¸‹æ–¹ç´¢å¼•éƒ½è‡ªåŠ¨å‡1</span></span><br><span class="line">    <span class="keyword">let</span> disposableReindex = vscode.commands.registerCommand(<span class="string">&#x27;rext.reindex&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ´»åŠ¨çš„æ–‡æœ¬ç¼–è¾‘å™¨</span></span><br><span class="line">        <span class="keyword">const</span> editor = vscode.window.activeTextEditor;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (editor) &#123;</span><br><span class="line">            <span class="comment">// è·å–å½“å‰è¡Œçš„è¡Œå·</span></span><br><span class="line">            <span class="keyword">const</span> currentLine = editor.selection.active.line;</span><br><span class="line">            <span class="keyword">const</span> startLine = currentLine;</span><br><span class="line">            <span class="keyword">const</span> endLine = editor.document.lineCount;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å®šä¹‰å½“å‰åˆ—è¡¨çš„ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">let</span> currentListIndex: <span class="built_in">number</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// TEMPï¼šåŒ¹é…ä¸€ä¸‹</span></span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> æŸ¥æ‰¾å½“å‰åˆ—è¡¨çš„ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">const</span> lineText = editor.document.lineAt(startLine).text;</span><br><span class="line">            <span class="keyword">const</span> match = lineText.match(<span class="regexp">/\[(\d+)\]\s+(.*)/</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                currentListIndex = <span class="built_in">parseInt</span>(match[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// TEMPï¼šè‡ªåŠ¨å‡1</span></span><br><span class="line">            <span class="keyword">if</span> (currentListIndex !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="comment">// TODOï¼šé‡æ–°ç´¢å¼•åˆ—è¡¨ä¸­çš„æ–¹æ‹¬å·æ•°å­—</span></span><br><span class="line">                editor.edit(<span class="function"><span class="params">editBuilder</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> line = startLine; line &lt; endLine; line++) &#123;</span><br><span class="line">                        <span class="keyword">const</span> lineText = editor.document.lineAt(line).text;</span><br><span class="line">                        <span class="keyword">const</span> match = lineText.match(<span class="regexp">/\[(\d+)\]\s+(.*)/</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                            <span class="comment">// è·å–å½“å‰æ–¹æ‹¬å·ä¸­çš„æ•°å­—å’Œæ–°ç´¢å¼•</span></span><br><span class="line">                            <span class="keyword">const</span> currentNumber = <span class="built_in">parseInt</span>(match[<span class="number">1</span>]);</span><br><span class="line">                            <span class="keyword">const</span> newIndex = currentNumber - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// å¦‚æœå½“å‰æ•°å­—ä¸ç­‰äºæ–°ç´¢å¼•ï¼Œæ›¿æ¢æ–¹æ‹¬å·ä¸­çš„æ•°å­—</span></span><br><span class="line">                            <span class="keyword">if</span> (currentNumber !== newIndex) &#123;</span><br><span class="line">                                <span class="keyword">const</span> startPos = <span class="keyword">new</span> vscode.Position(line, match.index!);</span><br><span class="line">                                <span class="keyword">const</span> endPos = <span class="keyword">new</span> vscode.Position(line, match.index! + match[<span class="number">0</span>].length);</span><br><span class="line">                                editBuilder.replace(<span class="keyword">new</span> vscode.Range(startPos, endPos), <span class="string">`[<span class="subst">$&#123;newIndex&#125;</span>] `</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬æ–‡æ¡£å†…å®¹å˜åŒ–äº‹ä»¶</span></span><br><span class="line">    vscode.workspace.onDidChangeTextDocument(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.document.languageId === <span class="string">&#x27;markdown&#x27;</span> &amp;&amp; event.document.fileName.endsWith(<span class="string">&#x27;.md&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> range = event.contentChanges[<span class="number">0</span>].range;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†å›è½¦é”®</span></span><br><span class="line">            <span class="keyword">if</span> (event.contentChanges[<span class="number">0</span>].text === <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">                vscode.commands.executeCommand(<span class="string">&#x27;rext.autoIncrement&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ£€æŸ¥æ˜¯å¦åˆ é™¤äº†æŸä¸€è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (event.contentChanges[<span class="number">0</span>].text === <span class="string">&#x27;&#x27;</span> &amp;&amp; range.start.line !== range.end.line) &#123;</span><br><span class="line">                vscode.commands.executeCommand(<span class="string">&#x27;rext.reindex&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å‘½ä»¤æ³¨å†Œåˆ°ä¸Šä¸‹æ–‡è®¢é˜…ä¸­ï¼Œç¡®ä¿æ’ä»¶åœ¨æ¿€æ´»æœŸé—´æœ‰æ•ˆ</span></span><br><span class="line">    context.subscriptions.push(disposableAutoIncrement, disposableReindex);</span><br><span class="line"></span><br><span class="line">    process.stdout.write(<span class="string">&#x27;Debugging message\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’ä»¶è¢«åœç”¨æ—¶è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deactivate</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä»£ç å†™çš„å¾ˆç³™ï¼Œåªå®ç°äº†éƒ¨åˆ†åŠŸèƒ½ï¼Œä½†æ˜¯ä¹Ÿç¡®å®æ²¡æ—¶é—´å»å­¦<code>markdown-it</code>çš„æ’ä»¶å®ç°äº†ï¼Œä»¥åå†å»å®ç°å§ï¼ˆæ­£å¸¸æ¥è¯´æˆ‘è¦å®ç°çš„ä¸œè¥¿é€šè¿‡<code>markdown-it</code>è‡ªå®šä¹‰æ’ä»¶æ’å…¥çš„å½¢å¼å®ç°æ›´æ–¹ä¾¿â€¦åœ¨æ’ä»¶ä¸Šå†™æ’ä»¶ğŸ˜‚ï¼‰ã€‚</p><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>é¡¹ç›®F5è¿›è¡Œè°ƒè¯•ï¼Œåˆ›å»ºä¸€ä¸ªMarkdownæ–‡ä»¶ï¼Œå†™å…¥å¯¹åº”æƒ…æ™¯å†…å®¹ï¼Œåˆ«å¿˜äº†åœ¨<code>package.json</code>ä¸­è®¾ç½®è§¦å‘æ¡ä»¶ã€‚</p><h1 id="æ‰“åŒ…å‘å¸ƒ"><a href="#æ‰“åŒ…å‘å¸ƒ" class="headerlink" title="æ‰“åŒ…å‘å¸ƒ"></a>æ‰“åŒ…å‘å¸ƒ</h1><p>è¦æƒ³å‘å¸ƒæ’ä»¶åˆ°å¸‚åœºï¼Œéœ€è¦åˆ›å»ºåœ¨Azure DevOpsä¸Šåˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰ç»„ç»‡åˆ™éœ€è¦å…ˆåˆ›å»ºç»„ç»‡ã€‚å¯ä»¥ç”¨GitHubè´¦æˆ·ç™»é™†Azure DevOpsåˆ›å»ºç»„ç»‡ï¼Œæ¯”å¦‚<code>dev.azure.com/SilenceZheng66</code>ã€‚</p><p>ç„¶ååˆ›å»ºé¡¹ç›®ï¼Œåœ¨é¡¹ç›®ä¸­åˆ›å»ºPATï¼ˆPersonal Access Tokensï¼‰å¹¶è®°ä½å®ƒã€‚ä¸‹é¢éœ€è¦åœ¨<a href="https://marketplace.visualstudio.com/manage/createpublisher">Visual Studio Marketplace</a>åˆ›å»ºä¸€ä¸ªpublisherï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå¿…é¡»ä½¿ç”¨åˆšæ‰åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œçš„å¾®è½¯è´¦å·ï¼Œè¿™é‡Œçš„publisheréœ€è¦å’Œpackage.jsoné‡Œçš„publisherå­—æ®µä¸€è‡´ã€‚</p><p>å‡†å¤‡å°±ç»ªåï¼Œä¸‹è½½<code>vsce</code>ï¼Œç”¨æ¥æ‰“åŒ…/å‘å¸ƒ/ç®¡ç†æ’ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g vsce</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘å¸ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•</span></span><br><span class="line">vsce login SilenceZheng66</span><br><span class="line"><span class="comment"># å‘å¸ƒ</span></span><br><span class="line">vsce publish --no-dependencies</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨webpackæ‰“åŒ…æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cnpm i --save-dev webpack webpack-cli ts-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># package.json è„šæœ¬å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;vscode:prepublish&quot;</span>: <span class="string">&quot;webpack --mode production&quot;</span>,</span><br><span class="line"><span class="string">&quot;compile&quot;</span>: <span class="string">&quot;webpack --mode none&quot;</span>,</span><br><span class="line"><span class="string">&quot;watch&quot;</span>: <span class="string">&quot;webpack --mode none --watch&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p>[1] <a href="https://rackar.github.io/vscode-ext-doccn/get-started/your-first-extension.html">https://rackar.github.io/vscode-ext-doccn/get-started/your-first-extension.html</a><br>[2] <a href="https://github.com/yzhang-gh/vscode-markdown">https://github.com/yzhang-gh/vscode-markdown</a><br>[3] <a href="https://juejin.cn/post/7327570230775201826">https://juejin.cn/post/7327570230775201826</a><br>[4] <a href="https://zhuanlan.zhihu.com/p/459554765">https://zhuanlan.zhihu.com/p/459554765</a><br>[5] <a href="https://juejin.cn/post/6844903921555603470">https://juejin.cn/post/6844903921555603470</a><br>[6] <a href="https://markdown-it.github.io">https://markdown-it.github.io</a><br>[7] <a href="https://juejin.cn/post/7076649162653040647">https://juejin.cn/post/7076649162653040647</a></p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;VS Codeæ˜¯æˆ‘çš„ä¸»åŠ›æ–‡å­—ç¼–è¾‘å™¨ï¼Œç›®å‰æˆ‘çš„æ‰€æœ‰åšå®¢ä¸è¯¾é¢˜è°ƒç ”å·¥ä½œéƒ½æ˜¯ä½¿ç”¨å®ƒè¿›è¡Œç¼–è¾‘çš„ã€‚Markdownæ ¼å¼ä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–‡æœ¬æ ¼å¼ï¼Œå®ƒè®©æˆ‘å¯ä»¥å¿«é€Ÿæ•´ç†æƒ³æ³•è€Œä»…ä»…è€ƒè™‘åŸºæœ¬çš„æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨åšè¯¾é¢˜è°ƒç ”æ—¶æˆ‘ä¹ æƒ¯ä½¿ç”¨&lt;code&gt;[n]&lt;/code&gt;ä½œä¸ºå‚è€ƒæ–‡çŒ®åºå·ï¼ŒVS Codeä¸èƒ½å¯¹è¿™ç§åºå·è¿›è¡Œè‡ªåŠ¨é€’å¢å’Œé‡æ–°ç´¢å¼•ï¼Œäºæ˜¯æˆ‘æƒ³å¼€å‘ä¸€æ¬¾æ’ä»¶å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ’ä»¶çš„åå­—å°±å«&lt;code&gt;Reference Extension&lt;/code&gt;å§ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="VSCode" scheme="http://silencezheng.top/tags/VSCode/"/>
    
  </entry>
  
  <entry>
    <title>SpELä½¿ç”¨å…¥é—¨</title>
    <link href="http://silencezheng.top/2023/12/30/article125/"/>
    <id>http://silencezheng.top/2023/12/30/article125/</id>
    <published>2023-12-29T17:00:25.000Z</published>
    <updated>2023-12-29T17:02:59.158Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>SpELå³Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ï¼Œå®ƒèƒ½åœ¨è¿è¡Œæ—¶æ„å»ºå¤æ‚è¡¨è¾¾å¼ã€å­˜å–å¯¹è±¡å›¾å±æ€§ã€å¯¹è±¡æ–¹æ³•è°ƒç”¨ç­‰ç­‰ï¼Œå¹¶ä¸”èƒ½ä¸SpringåŠŸèƒ½å®Œç¾æ•´åˆã€‚</p><p>SpELæ˜¯å•ç‹¬æ¨¡å—ï¼ˆ<code>org.springframework.expression</code>ï¼‰ï¼Œåªä¾èµ–äºcoreæ¨¡å—ï¼Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚<br><span id="more"></span></p><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><p>é¦–å…ˆä»ä¸€ä¸ªç®€å•çš„â€œliteral string expressionâ€ä¾‹å­å¼•å…¥ï¼Œæ‰€è°“â€œliteral stringâ€å°±æ˜¯æŒ‡ä»£ç ä¸­ç›´æ¥ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼ˆèµ·ç åœ¨Javaä¸‹æ˜¯è¿™æ ·ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;&quot;</span>);</span><br><span class="line">String message = (String) exp.getValue();</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†è§£æå™¨<code>ExpressionParser</code>ï¼Œè´Ÿè´£è§£æè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œè¡¨è¾¾å¼å­—ç¬¦ä¸²æ˜¯ç”±å‘¨å›´çš„å•å¼•å·è¡¨ç¤ºçš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚è€Œåè§£æè¡¨è¾¾å¼ï¼Œ<code>Expression</code>æ¥å£è´Ÿè´£è¯„ä¼°æ‰€å®šä¹‰çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ã€‚æœ€åå¯¹è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œè·å–ä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™ä¸€æµç¨‹å¯ä»¥æ€»ç»“SpELåœ¨æ±‚è¡¨è¾¾å¼å€¼æ—¶çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºè§£æå™¨</li><li>è§£æè¡¨è¾¾å¼</li><li>æ„é€ ä¸Šä¸‹æ–‡</li><li>è¡¨è¾¾å¼æ±‚å€¼</li></ol><p>å…¶ä¸­ç¬¬ä¸‰æ­¥æ„é€ ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªå¯é€‰æ­¥éª¤ï¼Œå½“éœ€è¦å‡†å¤‡ä¸Šä¸‹æ–‡å˜é‡æ—¶ä¼šä½¿ç”¨ã€‚</p><p>PSï¼šåœ¨è°ƒç”¨ <code>parser.parseExpression</code> å’Œ <code>exp.getValue</code> æ—¶ï¼Œå¯èƒ½åˆ†åˆ«æŠ›å‡ºä¸¤ä¸ªå¼‚å¸¸ï¼š<code>ParseException</code> å’Œ <code>EvaluationException</code>ã€‚<br>PPSï¼šEvaluateå¯ä»¥ç†è§£ä¸ºâ€œæ±‚å€¼â€æˆ–â€œè®¡ç®—â€ã€‚</p><h2 id="ä¸€äº›åŠŸèƒ½"><a href="#ä¸€äº›åŠŸèƒ½" class="headerlink" title="ä¸€äº›åŠŸèƒ½"></a>ä¸€äº›åŠŸèƒ½</h2><p>SpELæ”¯æŒå¤šç§åŠŸèƒ½ï¼Œå¦‚è°ƒç”¨æ–¹æ³•ã€è®¿é—®å±æ€§å’Œè°ƒç”¨æ„é€ å‡½æ•°ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªä¾‹å­å¿«é€Ÿè¿‡ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨concatæ–¹æ³•</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.concat(&#x27;!&#x27;)&quot;</span>);</span><br><span class="line">String message = (String) exp.getValue();  <span class="comment">// Hello World!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å±æ€§ï¼Œinvokes &#x27;getBytes()&#x27;</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.bytes&quot;</span>);</span><br><span class="line"><span class="keyword">byte</span>[] bytes = (<span class="keyword">byte</span>[]) exp.getValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®åµŒå¥—å±æ€§ï¼Œinvokes &#x27;getBytes().length&#x27;</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;.bytes.length&quot;</span>); </span><br><span class="line"><span class="keyword">int</span> length = (Integer) exp.getValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;new String(&#x27;hello world&#x27;).toUpperCase()&quot;</span>);</span><br><span class="line">String message = exp.getValue(String.class); <span class="comment">// HELLO WORLD</span></span><br></pre></td></tr></table></figure><h2 id="æ›´å¸¸è§çš„ç”¨æ³•"><a href="#æ›´å¸¸è§çš„ç”¨æ³•" class="headerlink" title="æ›´å¸¸è§çš„ç”¨æ³•"></a>æ›´å¸¸è§çš„ç”¨æ³•</h2><p>SpELæ›´å¸¸è§çš„ç”¨æ³•æ˜¯æä¾›ä¸€ä¸ªè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œé’ˆå¯¹ç‰¹å®šå¯¹è±¡å®ä¾‹ï¼ˆç§°ä¸ºæ ¹å¯¹è±¡ï¼‰è¿›è¡Œæ±‚å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå¹¶è®¾ç½®ä¸€ä¸ªæ—¥å†å¯¹è±¡</span></span><br><span class="line">GregorianCalendar c = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">c.set(<span class="number">1856</span>, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°å‚æ•°åˆ†åˆ«ä¸ºname, birthday, nationality</span></span><br><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"></span><br><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">&quot;name&quot;</span>); <span class="comment">// å°†&quot;name&quot;è§£æä¸ºè¡¨è¾¾å¼</span></span><br><span class="line">String name = (String) exp.getValue(tesla);</span><br><span class="line"><span class="comment">// name == &quot;Nikola Tesla&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å…¨éƒ¨è¯­æ³•"><a href="#å…¨éƒ¨è¯­æ³•" class="headerlink" title="å…¨éƒ¨è¯­æ³•"></a>å…¨éƒ¨è¯­æ³•</h2><p>å…³äºå¦‚ä½•ç¼–å†™æ­£ç¡®çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥å‚è§ <a href="https://docs.spring.io/spring-framework/reference/core/expressions/language-ref.html">https://docs.spring.io/spring-framework/reference/core/expressions/language-ref.html</a></p><h1 id="EvaluationContextï¼ˆæ±‚å€¼ä¸Šä¸‹æ–‡ï¼‰"><a href="#EvaluationContextï¼ˆæ±‚å€¼ä¸Šä¸‹æ–‡ï¼‰" class="headerlink" title="EvaluationContextï¼ˆæ±‚å€¼ä¸Šä¸‹æ–‡ï¼‰"></a>EvaluationContextï¼ˆæ±‚å€¼ä¸Šä¸‹æ–‡ï¼‰</h1><p><code>EvaluationContext</code>æ¥å£ç”¨äºè®¡ç®—è¡¨è¾¾å¼ï¼Œä»¥è§£æå±æ€§ã€æ–¹æ³•æˆ–å­—æ®µï¼Œå¹¶å¸®åŠ©æ‰§è¡Œç±»å‹è½¬æ¢ã€‚Spring æä¾›äº†ä¸¤ç§å®ç°ï¼š</p><ul><li><p><code>SimpleEvaluationContext</code>ï¼šè¯¥æ¥å£å…¬å¼€äº†åŸºæœ¬ SpEL åŠŸèƒ½å’Œé…ç½®é€‰é¡¹çš„å­é›†ï¼Œé€‚ç”¨äºä¸éœ€è¦å®Œæ•´ SpEL è¯­è¨€è¯­æ³•ä¸”åº”å—åˆ°æœ‰æ„ä¹‰é™åˆ¶çš„è¡¨è¾¾å¼ç±»åˆ«ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®ç»‘å®šè¡¨è¾¾å¼å’ŒåŸºäºå±æ€§çš„è¿‡æ»¤å™¨ã€‚</p></li><li><p><code>StandardEvaluationContext</code>ï¼šæä¾›å…¨å¥— SpEL åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ï¼Œå¯ä»¥ç”¨å®ƒæ¥æŒ‡å®šé»˜è®¤æ ¹å¯¹è±¡ï¼Œå¹¶é…ç½®æ‰€æœ‰å¯ç”¨çš„æ±‚å€¼ç›¸å…³ç­–ç•¥ã€‚</p></li></ul><p><code>SimpleEvaluationContext</code> åªæ”¯æŒ SpEL è¯­æ³•çš„ä¸€ä¸ªå­é›†ã€‚å®ƒä¸åŒ…æ‹¬ Java ç±»å‹å¼•ç”¨ã€æ„é€ å‡½æ•°å’Œ Bean å¼•ç”¨ã€‚å®ƒè¿˜è¦æ±‚ä½¿ç”¨è€…æ˜ç¡®é€‰æ‹©å¯¹è¡¨è¾¾å¼ä¸­å±æ€§å’Œæ–¹æ³•çš„æ”¯æŒçº§åˆ«ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>create()</code>é™æ€å·¥å‚æ–¹æ³•åªèƒ½å¯¹å±æ€§è¿›è¡Œè¯»å–è®¿é—®ã€‚ç”¨æˆ·è¿˜å¯ä»¥è·å–ä¸€ä¸ªæ„å»ºå™¨æ¥é…ç½®æ‰€éœ€çš„ç‰¹å®šæ”¯æŒçº§åˆ«ï¼Œé’ˆå¯¹ä»¥ä¸‹ä¸€ç§æˆ–å‡ ç§ç»„åˆï¼š</p><ul><li>Custom PropertyAccessor only (no reflection)</li><li>Data binding properties for read-only access</li><li>Data binding properties for read and write</li></ul><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpEL ä½¿ç”¨ Spring core ä¸­çš„è½¬æ¢æœåŠ¡ï¼ˆorg.springframework.core.convert.ConversionServiceï¼‰ã€‚è¯¥è½¬æ¢æœåŠ¡ä¸ºå¸¸è§è½¬æ¢æä¾›äº†è®¸å¤šå†…ç½®è½¬æ¢å™¨ï¼Œä½†ä¹Ÿå…·æœ‰å®Œå…¨å¯æ‰©å±•æ€§ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨ç±»å‹é—´æ·»åŠ è‡ªå®šä¹‰è½¬æ¢ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…·æœ‰æ³›å‹æ„ŸçŸ¥åŠŸèƒ½ã€‚è¿™æ„å‘³ç€ï¼Œå½“æ‚¨åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ³›å‹ç±»å‹æ—¶ï¼ŒSpEL ä¼šå°è¯•è¿›è¡Œè½¬æ¢ï¼Œä»¥ä¿æŒé‡åˆ°çš„ä»»ä½•å¯¹è±¡çš„ç±»å‹æ­£ç¡®æ€§ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½¿ç”¨ <code>setValue()</code> è¿›è¡Œèµ‹å€¼æ˜¯ä¸ºäº†è®¾ç½® List å±æ€§ã€‚è¯¥å±æ€§çš„ç±»å‹å®é™…ä¸Šæ˜¯ <code>List&lt;Boolean&gt;</code>ã€‚SpELä¼šè¯†åˆ«åˆ°åœ¨å°†åˆ—è¡¨å…ƒç´ æ”¾å…¥å…¶ä¸­ä¹‹å‰ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Simple</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Simple simple = <span class="keyword">new</span> Simple();</span><br><span class="line">simple.booleanList.add(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;false&quot; is passed in here as a String. SpEL and the conversion service</span></span><br><span class="line"><span class="comment">// will recognize that it needs to be a Boolean and convert it accordingly.</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;booleanList[0]&quot;</span>).setValue(context, simple, <span class="string">&quot;false&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b is false</span></span><br><span class="line">Boolean b = simple.booleanList.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h1 id="è§£æå™¨é…ç½®"><a href="#è§£æå™¨é…ç½®" class="headerlink" title="è§£æå™¨é…ç½®"></a>è§£æå™¨é…ç½®</h1><p>å¯ä»¥ä½¿ç”¨è§£æå™¨é…ç½®å¯¹è±¡ï¼ˆorg.springframework.expression.spel.SpelParserConfigurationï¼‰æ¥é…ç½® SpEL è¡¨è¾¾å¼è§£æå™¨ï¼Œè¯¥é…ç½®å¯¹è±¡å¯æ§åˆ¶æŸäº›è¡¨è¾¾å¼ç»„ä»¶çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œåœ¨å¯¹æ•°ç»„æˆ–é›†åˆè¿›è¡Œç´¢å¼•æ—¶ï¼ŒæŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ä¸ºç©ºï¼ŒSpEL ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥å…ƒç´ ã€‚è¿™åœ¨ä½¿ç”¨ç”±ä¸€è¿ä¸²å±æ€§å¼•ç”¨ç»„æˆçš„è¡¨è¾¾å¼æ—¶éå¸¸æœ‰ç”¨ã€‚å¦‚æœç”¨æˆ·å¯¹æ•°ç»„æˆ–åˆ—è¡¨è¿›è¡Œç´¢å¼•ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè¶…å‡ºæ•°ç»„æˆ–åˆ—è¡¨å½“å‰å¤§å°çš„ç´¢å¼•ï¼ŒSpEL å¯ä»¥è‡ªåŠ¨å¢é•¿æ•°ç»„æˆ–åˆ—è¡¨ä»¥å®¹çº³è¯¥ç´¢å¼•ã€‚ä¸ºäº†åœ¨æŒ‡å®šçš„ç´¢å¼•å¤„æ·»åŠ å…ƒç´ ï¼ŒSpEL å°†å°è¯•ä½¿ç”¨å…ƒç´ ç±»å‹çš„é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå…ƒç´ ï¼Œç„¶åå†è®¾ç½®æŒ‡å®šçš„å€¼ã€‚å¦‚æœå…ƒç´ ç±»å‹æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™ä¼šå°†ç©ºå€¼æ·»åŠ åˆ°æ•°ç»„æˆ–åˆ—è¡¨ä¸­ã€‚å¦‚æœæ²¡æœ‰è½¬æ¢å™¨ï¼ˆå†…ç½®æˆ–è‡ªå®šä¹‰çš„ï¼‰çŸ¥é“å¦‚ä½•è®¾ç½®å€¼ï¼Œç©ºå€¼å°†ä¿ç•™åœ¨æ•°ç»„æˆ–åˆ—è¡¨çš„æŒ‡å®šç´¢å¼•å¤„ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•è‡ªåŠ¨å¢é•¿åˆ—è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turn on:</span></span><br><span class="line"><span class="comment">// - auto null reference initialization</span></span><br><span class="line"><span class="comment">// - auto collection growing</span></span><br><span class="line">SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);</span><br><span class="line"></span><br><span class="line">Expression expression = parser.parseExpression(<span class="string">&quot;list[3]&quot;</span>);</span><br><span class="line"></span><br><span class="line">Demo demo = <span class="keyword">new</span> Demo();</span><br><span class="line"></span><br><span class="line">Object o = expression.getValue(demo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// demo.list will now be a real collection of 4 entries</span></span><br><span class="line"><span class="comment">// Each entry is a new empty String</span></span><br></pre></td></tr></table></figure><h1 id="è¡¨è¾¾å¼ç¼–è¯‘ï¼ˆæå‡æ±‚å€¼é€Ÿåº¦ï¼‰"><a href="#è¡¨è¾¾å¼ç¼–è¯‘ï¼ˆæå‡æ±‚å€¼é€Ÿåº¦ï¼‰" class="headerlink" title="è¡¨è¾¾å¼ç¼–è¯‘ï¼ˆæå‡æ±‚å€¼é€Ÿåº¦ï¼‰"></a>è¡¨è¾¾å¼ç¼–è¯‘ï¼ˆæå‡æ±‚å€¼é€Ÿåº¦ï¼‰</h1><p>Spring Framework 4.1 åŒ…å«ä¸€ä¸ªåŸºæœ¬çš„è¡¨è¾¾å¼ç¼–è¯‘å™¨ã€‚è¡¨è¾¾å¼é€šå¸¸æ˜¯<strong>è§£é‡Šå‹</strong>çš„ï¼Œè¿™åœ¨æ±‚å€¼è¿‡ç¨‹ä¸­æä¾›äº†å¾ˆå¤§çš„åŠ¨æ€çµæ´»æ€§ï¼Œä½†æ— æ³•æä¾›æœ€ä½³æ€§èƒ½ã€‚å¯¹äºå¶å°”ä½¿ç”¨è¡¨è¾¾å¼çš„æƒ…å†µï¼Œè¿™å¹¶æ— å¤§ç¢ï¼Œä½†å½“å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ Spring Integrationï¼‰ä½¿ç”¨è¡¨è¾¾å¼æ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šå˜å¾—éå¸¸é‡è¦ï¼Œè€Œä¸”å¯¹åŠ¨æ€æ€§ä¹Ÿæ²¡æœ‰çœŸæ­£çš„éœ€æ±‚ã€‚</p><p>SpEL ç¼–è¯‘å™¨æ—¨åœ¨æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚åœ¨è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ª Java ç±»ï¼Œåœ¨è¿è¡Œæ—¶ä½“ç°è¡¨è¾¾å¼çš„è¡Œä¸ºï¼Œå¹¶ä½¿ç”¨è¯¥ç±»å®ç°æ›´å¿«çš„è¡¨è¾¾å¼æ±‚å€¼ã€‚ç”±äºç¼ºä¹å›´ç»•è¡¨è¾¾å¼çš„ç±»å‹ï¼Œç¼–è¯‘å™¨åœ¨æ‰§è¡Œç¼–è¯‘æ—¶ä¼šä½¿ç”¨åœ¨è¡¨è¾¾å¼çš„è§£é‡Šæ±‚å€¼è¿‡ç¨‹ä¸­æ”¶é›†åˆ°çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨å¹¶ä¸èƒ½çº¯ç²¹ä»è¡¨è¾¾å¼ä¸­çŸ¥é“å±æ€§å¼•ç”¨çš„ç±»å‹ï¼Œä½†åœ¨ç¬¬ä¸€æ¬¡è§£é‡Šæ±‚å€¼æ—¶ï¼Œç¼–è¯‘å™¨å°±èƒ½çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆç±»å‹ã€‚å½“ç„¶ï¼Œå¦‚æœå„ç§è¡¨è¾¾å¼å…ƒç´ çš„ç±»å‹éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ ¹æ®è¿™äº›æ´¾ç”Ÿä¿¡æ¯è¿›è¡Œç¼–è¯‘å°±ä¼šå¸¦æ¥éº»çƒ¦ã€‚å› æ­¤ï¼Œç¼–è¯‘æœ€é€‚åˆç±»å‹ä¿¡æ¯ä¸ä¼šåœ¨é‡å¤æ±‚å€¼æ—¶å‘ç”Ÿå˜åŒ–çš„è¡¨è¾¾å¼ã€‚</p><p>ä¾‹å¦‚å¯¹äºåŸºæœ¬è¡¨è¾¾å¼<code>someArray[0].someProperty.someOtherProperty &lt; 0.1</code>æ¥è¯´ï¼Œç”±äºæ¶‰åŠæ•°ç»„è®¿é—®ã€ä¸€äº›å±æ€§å»å¼•ç”¨å’Œæ•°å€¼æ“ä½œï¼Œå› æ­¤æ€§èƒ½æå‡éå¸¸æ˜æ˜¾ã€‚åœ¨ä¸€ä¸ªè¿­ä»£ 50000 æ¬¡çš„å¾®å‹åŸºå‡†è¿è¡Œç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨è§£é‡Šå™¨æ±‚å€¼éœ€è¦ 75 æ¯«ç§’ï¼Œè€Œä½¿ç”¨è¯¥è¡¨è¾¾å¼çš„ç¼–è¯‘ç‰ˆæœ¬ä»…éœ€ 3 æ¯«ç§’ã€‚</p><h2 id="ç¼–è¯‘å™¨é…ç½®"><a href="#ç¼–è¯‘å™¨é…ç½®" class="headerlink" title="ç¼–è¯‘å™¨é…ç½®"></a>ç¼–è¯‘å™¨é…ç½®</h2><p>ç¼–è¯‘å™¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§ä¸åŒçš„æ–¹å¼å¼€å¯å®ƒã€‚</p><ol><li>é€šè¿‡ä½¿ç”¨è§£æå™¨é…ç½®è¿‡ç¨‹æ‰“å¼€</li><li>åœ¨å°†SpELåµŒå…¥åˆ°å…¶ä»–ç»„ä»¶ä¸­æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Springå±æ€§æ¥æ‰“å¼€</li></ol><p>ç¼–è¯‘å™¨å¯ä»¥åœ¨ä¸‰ç§æ¨¡å¼ä¸‹è¿è¡Œï¼Œè¿™äº›æ¨¡å¼åœ¨ org.springframework.expression.spel.SpelCompilerMode æšä¸¾ä¸­ï¼š</p><ul><li><code>OFF</code> (é»˜è®¤)ï¼šç¼–è¯‘å™¨å…³é—­ã€‚</li><li><code>IMMEDIATE</code>ï¼šåœ¨ç«‹å³æ¨¡å¼ä¸‹ï¼Œè¡¨è¾¾å¼ä¼šå°½å¿«ç¼–è¯‘ã€‚é€šå¸¸æ˜¯åœ¨ç¬¬ä¸€æ¬¡è§£é‡Šæ±‚å€¼ä¹‹åã€‚å¦‚æœç¼–è¯‘è¡¨è¾¾å¼å¤±è´¥ï¼ˆé€šå¸¸æ˜¯ç”±äºç±»å‹æ”¹å˜ï¼‰ï¼Œè¡¨è¾¾å¼æ±‚å€¼çš„è°ƒç”¨è€…å°†æ”¶åˆ°å¼‚å¸¸ã€‚</li><li><code>MIXED</code>ï¼šåœ¨æ··åˆæ¨¡å¼ä¸‹ï¼Œè¡¨è¾¾å¼ä¼šéšç€æ—¶é—´çš„æ¨ç§»åœ¨è§£é‡Šæ¨¡å¼å’Œç¼–è¯‘æ¨¡å¼ä¹‹é—´é»˜é»˜åˆ‡æ¢ã€‚ç»è¿‡ä¸€å®šæ¬¡æ•°çš„è§£é‡Šè¿è¡Œåï¼Œå®ƒä»¬ä¼šåˆ‡æ¢åˆ°ç¼–è¯‘å½¢å¼ï¼Œå¦‚æœç¼–è¯‘å½¢å¼å‡ºäº†é—®é¢˜ï¼ˆå¦‚å‰é¢æ‰€è¿°çš„ç±»å‹æ”¹å˜ï¼‰ï¼Œè¡¨è¾¾å¼ä¼šè‡ªåŠ¨å†æ¬¡åˆ‡æ¢å›è§£é‡Šå½¢å¼ã€‚ä¹‹åï¼Œå®ƒå¯èƒ½ä¼šç”Ÿæˆå¦ä¸€ä¸ªç¼–è¯‘å½¢å¼å¹¶åˆ‡æ¢åˆ°å®ƒã€‚åŸºæœ¬ä¸Šï¼Œç”¨æˆ·åœ¨ <code>IMMEDIATE</code> æ¨¡å¼ä¸‹è·å¾—çš„å¼‚å¸¸ä¼šåœ¨å†…éƒ¨å¤„ç†ã€‚</li></ul><p><code>IMMEDIATE</code> æ¨¡å¼ä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œæ˜¯å› ä¸º <code>MIXED</code> æ¨¡å¼å¯èƒ½ä¼šç»™æœ‰å‰¯ä½œç”¨çš„è¡¨è¾¾å¼é€ æˆé—®é¢˜ã€‚å¦‚æœä¸€ä¸ªç¼–è¯‘è¡¨è¾¾å¼åœ¨éƒ¨åˆ†æˆåŠŸåå´©æºƒï¼Œé‚£ä¹ˆå®ƒå¯èƒ½å·²ç»æ‰§è¡Œäº†å½±å“ç³»ç»ŸçŠ¶æ€çš„æ“ä½œã€‚å¦‚æœå‘ç”Ÿäº†è¿™ç§æƒ…å†µï¼Œè°ƒç”¨è€…å¯èƒ½ä¸å¸Œæœ›å®ƒåœ¨è§£é‡Šæ¨¡å¼ä¸‹é™é»˜åœ°é‡æ–°è¿è¡Œï¼Œå› ä¸ºè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†å¯èƒ½ä¼šè¿è¡Œä¸¤æ¬¡ã€‚</p><p>é€‰æ‹©æ¨¡å¼åï¼Œä½¿ç”¨ <code>SpelParserConfiguration</code> é…ç½®è§£æå™¨ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(SpelCompilerMode.IMMEDIATE,</span><br><span class="line"><span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line">SpelExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);</span><br><span class="line"></span><br><span class="line">Expression expr = parser.parseExpression(<span class="string">&quot;payload&quot;</span>);</span><br><span class="line"></span><br><span class="line">MyMessage message = <span class="keyword">new</span> MyMessage();</span><br><span class="line"></span><br><span class="line">Object payload = expr.getValue(message);</span><br></pre></td></tr></table></figure><p>åœ¨æŒ‡å®šç¼–è¯‘å™¨æ¨¡å¼æ—¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆå…è®¸ä¼ é€’ç©ºå€¼ï¼‰ã€‚ç¼–è¯‘åçš„è¡¨è¾¾å¼å°†å®šä¹‰åœ¨ä¸€ä¸ªå­ç±»åŠ è½½å™¨ä¸­ï¼Œè¯¥ç±»åŠ è½½å™¨å°†æ ¹æ®æ‰€æä¾›çš„ä»»ä½•ç±»å‹åˆ›å»ºã€‚é‡è¦çš„æ˜¯ï¼Œå¦‚æœæŒ‡å®šäº†ç±»åŠ è½½å™¨ï¼Œè¦ç¡®ä¿å®ƒèƒ½çœ‹åˆ°è¡¨è¾¾å¼æ±‚å€¼è¿‡ç¨‹ä¸­æ¶‰åŠçš„æ‰€æœ‰ç±»å‹ã€‚å¦‚æœæœªæŒ‡å®šç±»åŠ è½½å™¨ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤ç±»åŠ è½½å™¨ï¼ˆé€šå¸¸æ˜¯è¡¨è¾¾å¼æ±‚å€¼è¿‡ç¨‹ä¸­è¿è¡Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼‰ã€‚</p><p>é…ç½®ç¼–è¯‘å™¨çš„ç¬¬äºŒç§æ–¹æ³•é€‚ç”¨äº SpEL åµŒå…¥å…¶ä»–ç»„ä»¶çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½æ— æ³•é€šè¿‡é…ç½®å¯¹è±¡è¿›è¡Œé…ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ JVM ç³»ç»Ÿå±æ€§ï¼ˆæˆ– SpringProperties æœºåˆ¶ï¼‰å°† <code>spring.expression.compiler.mode</code> å±æ€§è®¾ç½®ä¸º<code>SpelCompilerMode</code>æšä¸¾å€¼ã€‚</p><h2 id="ç¼–è¯‘å™¨çš„å±€é™æ€§"><a href="#ç¼–è¯‘å™¨çš„å±€é™æ€§" class="headerlink" title="ç¼–è¯‘å™¨çš„å±€é™æ€§"></a>ç¼–è¯‘å™¨çš„å±€é™æ€§</h2><p>è‡ª Spring Framework 4.1 ä»¥æ¥ï¼ŒåŸºæœ¬çš„ç¼–è¯‘æ¡†æ¶å·²ç»åˆ°ä½ã€‚ä¸è¿‡ï¼Œè¯¥æ¡†æ¶è¿˜ä¸æ”¯æŒç¼–è¯‘æ‰€æœ‰ç±»å‹çš„è¡¨è¾¾å¼ã€‚æœ€åˆçš„é‡ç‚¹æ˜¯å¯èƒ½åœ¨æ€§èƒ½å…³é”®å‹ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„å¸¸è§è¡¨è¾¾å¼ã€‚ä»¥ä¸‹å‡ ç§è¡¨è¾¾å¼æš‚æ—¶æ— æ³•ç¼–è¯‘ï¼š</p><ul><li>æ¶‰åŠèµ‹å€¼çš„è¡¨è¾¾å¼</li><li>ä¾èµ–è½¬æ¢æœåŠ¡çš„è¡¨è¾¾å¼</li><li>ä½¿ç”¨è‡ªå®šä¹‰è§£æå™¨æˆ–è®¿é—®å™¨çš„è¡¨è¾¾å¼</li><li>ä½¿ç”¨é€‰æ‹©æˆ–æŠ•å½±çš„è¡¨è¾¾å¼</li></ul><h1 id="ä½¿ç”¨SpELå®šä¹‰Bean"><a href="#ä½¿ç”¨SpELå®šä¹‰Bean" class="headerlink" title="ä½¿ç”¨SpELå®šä¹‰Bean"></a>ä½¿ç”¨SpELå®šä¹‰Bean</h1><p>ç”¨æˆ·å¯ä»¥åœ¨åŸºäºXMLæˆ–æ³¨è§£çš„é…ç½®å…ƒæ•°æ®ä¸­ä½¿ç”¨SpELè¡¨è¾¾å¼æ¥å®šä¹‰<code>BeanDefinition</code>å®ä¾‹ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå®šä¹‰è¡¨è¾¾å¼çš„è¯­æ³•å½¢å¼ä¸º<code>#&#123; &lt;expression string&gt; &#125;</code>ã€‚è¿™é‡Œå¿½ç•¥XMLé…ç½®æ–¹å¼ï¼Œç”¨çš„ä¸å¤šäº†ã€‚</p><h2 id="åŸºäºæ³¨è§£çš„é…ç½®"><a href="#åŸºäºæ³¨è§£çš„é…ç½®" class="headerlink" title="åŸºäºæ³¨è§£çš„é…ç½®"></a>åŸºäºæ³¨è§£çš„é…ç½®</h2><p>è¦æŒ‡å®šé»˜è®¤å€¼ï¼Œå¯åœ¨å­—æ®µã€æ–¹æ³•ã€æ–¹æ³•æˆ–æ„é€ å‡½æ•°å‚æ•°ä¸Šæ·»åŠ <code>@Value</code>æ³¨è§£ã€‚</p><p>1ã€è®¾ç½®ä¸€ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldValueTestBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span> <span class="comment">// è¯»å–çš„æ˜¯æœåŠ¡éƒ¨ç½²æœºå™¨çš„region</span></span><br><span class="line"><span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(String defaultLocale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>2ã€æ³¨å…¥å±æ€§setæ–¹æ³•é»˜è®¤å€¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyValueTestBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(String defaultLocale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå½“Springå®¹å™¨åˆ›å»º <code>PropertyValueTestBean</code> å¯¹è±¡æ—¶ï¼Œå®ƒå°†è°ƒç”¨ <code>setDefaultLocale</code> æ–¹æ³•å¹¶ä¼ å…¥ç³»ç»Ÿå±æ€§ä¸­ â€˜user.regionâ€™ å¯¹åº”çš„å€¼ï¼Œä»è€Œè®¾ç½® <code>defaultLocale</code> æˆå‘˜å˜é‡çš„å€¼ã€‚</p><p>3ã€<code>@Autowired</code>å’Œæ„é€ å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Case1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"><span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(MovieFinder movieFinder,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span> String defaultLocale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line"><span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Case2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;user.country&#x27;]&#125;&quot;)</span> String defaultLocale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line"><span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="æ›´å¤šåŠŸèƒ½"><a href="#æ›´å¤šåŠŸèƒ½" class="headerlink" title="æ›´å¤šåŠŸèƒ½"></a>æ›´å¤šåŠŸèƒ½</h1><p>ä¸€äº›å€¼å¾—å…³æ³¨çš„åŠŸèƒ½â€¦</p><h2 id="ClassTypeè¡¨è¾¾å¼"><a href="#ClassTypeè¡¨è¾¾å¼" class="headerlink" title="ClassTypeè¡¨è¾¾å¼"></a>ClassTypeè¡¨è¾¾å¼</h2><p>ä½¿ç”¨<code>T(Type)</code>æ¥è¡¨ç¤º<code>java.lang.Class</code>å®ä¾‹ï¼Œ<code>Type</code>å¿…é¡»æ˜¯ç±»å…¨é™å®šåï¼ˆ<code>java.lang</code>åŒ…ä¸‹çš„ç±»é™¤å¤–ï¼‰ã€‚ä½¿ç”¨ClassTypeè¡¨è¾¾å¼è¿˜å¯ä»¥è®¿é—®ç±»é™æ€æ–¹æ³•åŠç±»é™æ€å­—æ®µã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ClassTypeè¡¨è¾¾å¼å’Œå¦‚ä½•è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java.langåŒ…å†…çš„ä¸éœ€è¦ä½¿ç”¨å…¨é™å®šå</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;T(String)&quot;</span>).getValue(Class.class);</span><br><span class="line"><span class="comment">// ç±»é™æ€å­—æ®µè®¿é—®</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;T(Integer).MAX_VALUE&quot;</span>).getValue(<span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// ç±»é™æ€æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;#&#123;T(java.lang.Math).random() * 100.0&#125;&quot;</span>, ParserContext.TEMPLATE_EXPRESSION).getValue(Double.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡ä»¶åˆ¤æ–­ï¼š</span></span><br><span class="line"><span class="comment">// ç®—æ•°è¿ç®—è¡¨è¾¾å¼</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;1 + 1&quot;</span>).getValue(Integer.class);</span><br><span class="line"><span class="comment">// å…³ç³»è¡¨è¾¾å¼</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;2==2&quot;</span>).getValue(Boolean.class);</span><br><span class="line"><span class="comment">// é€»è¾‘è¡¨è¾¾å¼</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;2&gt;1 and (NOT true or NOT false)&quot;</span>).getValue(<span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// instanceofè¡¨è¾¾å¼</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;&#x27;xyz&#x27; instanceof T(Integer)&quot;</span>).getValue(Boolean.class);</span><br><span class="line"><span class="comment">// æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;&#x27;5.00&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure></p><h2 id="å‡½æ•°ã€å¯¹è±¡ã€å˜é‡çš„å®šä¹‰åŠå¼•ç”¨"><a href="#å‡½æ•°ã€å¯¹è±¡ã€å˜é‡çš„å®šä¹‰åŠå¼•ç”¨" class="headerlink" title="å‡½æ•°ã€å¯¹è±¡ã€å˜é‡çš„å®šä¹‰åŠå¼•ç”¨"></a>å‡½æ•°ã€å¯¹è±¡ã€å˜é‡çš„å®šä¹‰åŠå¼•ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpELTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverseString</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        StringBuilder backwards = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class="line">            backwards.append(input.charAt(input.length() - <span class="number">1</span> - i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> backwards.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">        StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">        <span class="comment">// å®šä¹‰å˜é‡</span></span><br><span class="line">        context.setVariable(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è·¯äººç”²java&quot;</span>);</span><br><span class="line">        context.setVariable(<span class="string">&quot;lesson&quot;</span>, <span class="string">&quot;Springç³»åˆ—&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–nameå˜é‡ï¼Œlessonå˜é‡</span></span><br><span class="line">        String name = parser.parseExpression(<span class="string">&quot;#name&quot;</span>).getValue(context, String.class);</span><br><span class="line">        log.info(name);</span><br><span class="line">        String lesson = parser.parseExpression(<span class="string">&quot;#lesson&quot;</span>).getValue(context, String.class);</span><br><span class="line">        log.info(lesson);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// StandardEvaluationContextæ„é€ å™¨ä¼ å…¥rootå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡#rootæ¥è®¿é—®rootå¯¹è±¡</span></span><br><span class="line">        context = <span class="keyword">new</span> StandardEvaluationContext(<span class="string">&quot;æˆ‘æ˜¯rootå¯¹è±¡&quot;</span>);</span><br><span class="line">        String rootObj = parser.parseExpression(<span class="string">&quot;#root&quot;</span>).getValue(context, String.class);</span><br><span class="line">        log.info(rootObj);</span><br><span class="line">        <span class="comment">// #thisç”¨æ¥è®¿é—®å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„å¯¹è±¡</span></span><br><span class="line">        String thisObj = parser.parseExpression(<span class="string">&quot;#this&quot;</span>).getValue(context, String.class);</span><br><span class="line">        log.info(thisObj);</span><br><span class="line">        <span class="comment">// å®šä¹‰Listå¯¹è±¡ï¼Œè¿‡æ»¤Listå¹¶åšæŠ•å½±è¿ç®—</span></span><br><span class="line">        List&lt;Integer&gt; primes = <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>));</span><br><span class="line">        context.setVariable(<span class="string">&quot;primes&quot;</span>, primes);  <span class="comment">// æ³¨å†Œå¯¹è±¡å˜é‡</span></span><br><span class="line">        List&lt;Integer&gt; primesGreaterThanTen = (List&lt;Integer&gt;) parser.parseExpression(<span class="string">&quot;#primes.?[#this&gt;10]&quot;</span>).getValue(context);</span><br><span class="line">        log.info(primesGreaterThanTen.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰æ–¹æ³•</span></span><br><span class="line">        context.registerFunction(<span class="string">&quot;reverseString&quot;</span>, SpELTest.class.getDeclaredMethod(<span class="string">&quot;reverseString&quot;</span>, String.class));</span><br><span class="line">        log.info(parser.parseExpression(<span class="string">&quot;#reverseString(&#x27;hello&#x27;)&quot;</span>).getValue(context, String.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h2><p>SpELå¼•å…¥äº†Groovyè¯­è¨€ä¸­çš„å®‰å…¨å¯¼èˆªè¿ç®—ç¬¦<code>(å¯¹è±¡|å±æ€§)?.å±æ€§</code>ï¼Œç”¨æ¥é¿å…<code>?.</code>å‰è¾¹çš„è¡¨è¾¾å¼ä¸ºnullæ—¶æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè½¬è€Œè¿”å›nullã€‚è¿˜å¯ä»¥ä½¿ç”¨<code>?:</code>é€‰æ‹©åœ¨è¡¨è¾¾å¼ä¸ºnullæ—¶è¿”å›é»˜è®¤å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="keyword">new</span> Date(), <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line">EvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext(tesla);</span><br><span class="line">tesla.setName(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// nullæ—¶å–é»˜è®¤å€¼</span></span><br><span class="line">log.info(parser.parseExpression(<span class="string">&quot;name?:&#x27;Unknown&#x27;&quot;</span>).getValue(context, String.class));</span><br><span class="line"><span class="comment">// nullæ—¶å®‰å…¨è°ƒç”¨</span></span><br><span class="line">log.info(parser.parseExpression(<span class="string">&quot;name?.length()&quot;</span>).getValue(context, Integer.class).toString());</span><br></pre></td></tr></table></figure><h2 id="Listè¿ç®—"><a href="#Listè¿ç®—" class="headerlink" title="Listè¿ç®—"></a>Listè¿ç®—</h2><p>åœ¨ SpEL ä¸­ï¼Œ<code>?[]</code> å’Œ <code>![]</code> åˆ†åˆ«è¡¨ç¤ºé›†åˆé€‰æ‹©ï¼ˆcollection selectionï¼‰å’Œé›†åˆæŠ•å½±ï¼ˆcollection projectionï¼‰ã€‚<code>?[]</code> è¡¨è¾¾å¼ç”¨äºé€‰æ‹©æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„é›†åˆå…ƒç´ ï¼Œ<code>![]</code> è¡¨è¾¾å¼ç”¨äºå¯¹é›†åˆè¿›è¡ŒæŠ•å½±æ“ä½œã€‚</p><blockquote><p>é›†åˆæŠ•å½±æˆ–é›†åˆæ˜ å°„çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šé€šè¿‡å¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„é›†åˆï¼Œè¯¥é›†åˆåŒ…å«äº†åŸå§‹é›†åˆä¸­çš„å…ƒç´ ç»è¿‡æŸç§è½¬æ¢åçš„å€¼ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpELCollectionTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inventor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String nationality;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Bei Jin&quot;</span>);</span><br><span class="line">        Inventor tesla1 = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla1&quot;</span>, <span class="string">&quot;Shang Hai&quot;</span>);</span><br><span class="line">        Inventor tesla2 = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla2&quot;</span>, <span class="string">&quot;New York&quot;</span>);</span><br><span class="line">        Inventor tesla3 = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla3&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line">        Inventor tesla4 = <span class="keyword">new</span> Inventor(<span class="string">&quot;Nikola Tesla4&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line">        List&lt;Inventor&gt; inventors = Arrays.asList(tesla, tesla1, tesla2, tesla3, tesla4);</span><br><span class="line"></span><br><span class="line">        ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">        EvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">        context.setVariable(<span class="string">&quot;inventors&quot;</span>, inventors);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹Liståšå„ç±»è¿ç®—ï¼š</span></span><br><span class="line">        <span class="comment">// è¿‡æ»¤ï¼Œé€‰æ‹©æ‰€æœ‰ nationality å­—æ®µä¸º &#x27;Serbian&#x27; çš„ Inventor å¯¹è±¡</span></span><br><span class="line">        List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) parser.parseExpression(<span class="string">&quot;#inventors.?[nationality==&#x27;Serbian&#x27;]&quot;</span>).getValue(context);</span><br><span class="line">        log.info(list.toString());</span><br><span class="line">        <span class="comment">// æŠ•å½±ï¼Œé€‰æ‹©æ‰€æœ‰ Inventor å¯¹è±¡çš„ nationality å­—æ®µï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ List</span></span><br><span class="line">        List&lt;Inventor&gt; list1 = (List&lt;Inventor&gt;) parser.parseExpression(<span class="string">&quot;#inventors.![nationality]&quot;</span>).getValue(context);</span><br><span class="line">        log.info(list1.toString());</span><br><span class="line">        <span class="comment">// æŠ•å½±ï¼Œå¯¹æ‰€æœ‰å¯¹è±¡çš„ nationality å­—æ®µæ˜¯å¦ä¸º &#x27;Serbian&#x27; è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¸ƒå°”ç±»å‹List</span></span><br><span class="line">        List&lt;Inventor&gt; list2 = (List&lt;Inventor&gt;) parser.parseExpression(<span class="string">&quot;#inventors.![nationality==&#x27;Serbian&#x27;]&quot;</span>).getValue(context);</span><br><span class="line">        log.info(list2.toString());</span><br><span class="line">        <span class="comment">// æŠ•å½±ï¼Œé€‰æ‹©æ‰€æœ‰ Inventor å¯¹è±¡çš„ serbian å­—æ®µï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Listï¼Œä¸list1ç­‰åŒã€‚</span></span><br><span class="line">        List&lt;Inventor&gt; list3 = (List&lt;Inventor&gt;) parser.parseExpression(<span class="string">&quot;#inventors.![#this.getNationality()]&quot;</span>).getValue(context);</span><br><span class="line">        log.info(list3.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®Map"><a href="#è®¿é—®Map" class="headerlink" title="è®¿é—®Map"></a>è®¿é—®Map</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¿é—®map</span></span><br><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">params.put(<span class="string">&quot;backOrderCode&quot;</span>, <span class="string">&quot;H12345764564&quot;</span>);</span><br><span class="line">context.setVariable(<span class="string">&quot;params&quot;</span>, params);</span><br><span class="line">Object object = parser.parseExpression(<span class="string">&quot;#params[backOrderCode]&quot;</span>).getValue(context);</span><br><span class="line">log.info(object.toString());</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p>[1] <a href="https://zhuanlan.zhihu.com/p/174786047">https://zhuanlan.zhihu.com/p/174786047</a><br>[2] <a href="https://zhuanlan.zhihu.com/p/149920813">https://zhuanlan.zhihu.com/p/149920813</a><br>[3] <a href="https://docs.spring.io/spring-framework/reference/core/expressions.html">https://docs.spring.io/spring-framework/reference/core/expressions.html</a></p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;SpELå³Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ï¼Œå®ƒèƒ½åœ¨è¿è¡Œæ—¶æ„å»ºå¤æ‚è¡¨è¾¾å¼ã€å­˜å–å¯¹è±¡å›¾å±æ€§ã€å¯¹è±¡æ–¹æ³•è°ƒç”¨ç­‰ç­‰ï¼Œå¹¶ä¸”èƒ½ä¸SpringåŠŸèƒ½å®Œç¾æ•´åˆã€‚&lt;/p&gt;
&lt;p&gt;SpELæ˜¯å•ç‹¬æ¨¡å—ï¼ˆ&lt;code&gt;org.springframework.expression&lt;/code&gt;ï¼‰ï¼Œåªä¾èµ–äºcoreæ¨¡å—ï¼Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Spring" scheme="http://silencezheng.top/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>ç©ºæ´å·ç§¯</title>
    <link href="http://silencezheng.top/2023/12/25/article124/"/>
    <id>http://silencezheng.top/2023/12/25/article124/</id>
    <published>2023-12-24T18:01:57.000Z</published>
    <updated>2023-12-24T18:07:32.871Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç©ºæ´å·ç§¯ï¼ŒDilated Convolutionï¼Œä¹Ÿå¯è¯‘ä¸ºè†¨èƒ€å·ç§¯æˆ–æ‰©å¼ å·ç§¯ï¼Œå¯ä»¥ä½¿ç½‘ç»œåœ¨ä¸å¢åŠ å‚æ•°æ•°é‡çš„æƒ…å†µä¸‹æ‹¥æœ‰æ›´å¤§çš„æ„Ÿå—åŸŸã€‚<br><span id="more"></span></p><h2 id="æå‡º"><a href="#æå‡º" class="headerlink" title="æå‡º"></a>æå‡º</h2><p>ç©ºæ´å·ç§¯æœ€åˆçš„æå‡ºæ˜¯ä¸ºäº†è§£å†³å›¾åƒåˆ†å‰²çš„é—®é¢˜ï¼Œå¸¸è§çš„å›¾åƒåˆ†å‰²ç®—æ³•é€šå¸¸ä½¿ç”¨æ± åŒ–å±‚å’Œå·ç§¯å±‚æ¥å¢åŠ æ„Ÿå—åŸŸï¼ŒåŒæ—¶ä¹Ÿç¼©å°äº†ç‰¹å¾å›¾å°ºå¯¸(resolution)ï¼Œç„¶åå†åˆ©ç”¨ä¸Šé‡‡æ ·è¿˜åŸå›¾åƒå°ºå¯¸ï¼Œç‰¹å¾å›¾ç¼©å°å†æ”¾å¤§çš„è¿‡ç¨‹é€ æˆäº†ç²¾åº¦ä¸Šçš„æŸå¤±ï¼Œå› æ­¤éœ€è¦ä¸€ç§æ“ä½œå¯ä»¥åœ¨å¢åŠ æ„Ÿå—åŸŸçš„åŒæ—¶ä¿æŒç‰¹å¾å›¾çš„å°ºå¯¸ä¸å˜ï¼Œä»è€Œä»£æ›¿ä¸‹é‡‡æ ·å’Œä¸Šé‡‡æ ·æ“ä½œï¼Œåœ¨è¿™ç§éœ€æ±‚ä¸‹ï¼Œç©ºæ´å·ç§¯å°±è¯ç”Ÿäº†ã€‚å½“ç„¶ï¼Œè·³è·ƒè¿æ¥ï¼ˆskip connectionï¼‰ä¹Ÿæ˜¯å¦ä¸€ç§å¼¥è¡¥ä¿¡æ¯æŸå¤±çš„æ–¹æ³•ã€‚</p><p>ç©ºæ´å·ç§¯è‡ª2016åœ¨ICLRä¸Šè¢«æå‡ºåï¼Œæœ¬èº«æ˜¯ç”¨åœ¨å›¾åƒåˆ†å‰²é¢†åŸŸï¼Œä½†ç«‹é©¬è¢«Deepmindæ‹¿æ¥åº”ç”¨åˆ°è¯­éŸ³(WaveNet)å’ŒNLPé¢†åŸŸï¼Œå®ƒåœ¨ç‰©ä½“æ£€æµ‹ä¹Ÿå‘æŒ¥äº†é‡è¦çš„ä½œç”¨ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åœ¨å¸¸è§„å·ç§¯è¿ç®—ä¸­ï¼Œå›ºå®šå¤§å°çš„æ»¤æ³¢å™¨åœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œæ»¤æ³¢å™¨ä¸­çš„å€¼ä¸è¾“å…¥ç‰¹å¾å›¾ä¸­çš„ç›¸åº”å€¼ç›¸ä¹˜ä»¥äº§ç”Ÿå•ä¸ªè¾“å‡ºå€¼ã€‚è¾“å‡ºç‰¹å¾å›¾ä¸­ç¥ç»å…ƒçš„æ„Ÿå—åŸŸè¢«å®šä¹‰ä¸ºæ»¤æ³¢å™¨å¯ä»¥â€œçœ‹åˆ°â€çš„è¾“å…¥ç‰¹å¾å›¾ä¸­çš„åŒºåŸŸã€‚æ„Ÿå—åŸŸçš„å¤§å°ç”±æ»¤æ³¢å™¨çš„å¤§å°å’Œå·ç§¯çš„æ­¥é•¿å†³å®šã€‚</p><p>ç›¸åï¼Œåœ¨è†¨èƒ€å·ç§¯è¿ç®—ä¸­ï¼Œé€šè¿‡åœ¨æ»¤æ³¢å™¨å€¼ä¹‹é—´æ’å…¥é—´éš™æ¥â€œæ‰©å¼ â€æ»¤æ³¢å™¨ã€‚<strong>è†¨èƒ€ç‡</strong>(dilation rate) å†³å®šäº†é—´éš™çš„å¤§å°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥è°ƒæ•´çš„è¶…å‚æ•°ã€‚å½“è†¨èƒ€ç‡ä¸º 1 æ—¶ï¼Œè†¨èƒ€å·ç§¯ç®€åŒ–ä¸ºå¸¸è§„å·ç§¯ã€‚</p><p>è†¨èƒ€ç‡åœ¨ä¸å¢åŠ å‚æ•°æ•°é‡çš„æƒ…å†µä¸‹æœ‰æ•ˆåœ°å¢åŠ äº†æ»¤æ³¢å™¨çš„æ„Ÿå—åŸŸï¼Œå› ä¸ºæ»¤æ³¢å™¨çš„å¤§å°ä»ç„¶ç›¸åŒï¼Œä½†å€¼ä¹‹é—´æœ‰é—´éš™ã€‚è¿™åœ¨éœ€è¦æ›´å¤§æ„Ÿå—åŸŸçš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œä½†å¢åŠ æ»¤æ³¢å™¨çš„å¤§å°ä¼šå¯¼è‡´å‚æ•°æ•°é‡å’Œè®¡ç®—å¤æ‚æ€§çš„å¢åŠ ã€‚</p><p>ä¸‹å›¾æè¿°äº†æ­£å¸¸å·ç§¯ä¸æ‰©å¼ å·ç§¯ä¹‹é—´çš„å·®å¼‚ï¼Œé™„åŠ å‚æ•°$l$ï¼ˆè†¨èƒ€å› å­ï¼‰è¡¨ç¤ºè¾“å…¥æ‰©å¼ äº†å¤šå°‘ã€‚æ¢å¥è¯è¯´ï¼Œæ ¹æ®è¯¥å‚æ•°çš„å€¼ï¼Œæ»¤æ³¢å™¨ä¸­ä¼šè·³è¿‡$(l-1)$ä¸ªåƒç´ ã€‚</p><p><img src="/assets/post_img/article124/normalvsdilatedconv.png" alt="dc"></p><p>è†¨èƒ€å·ç§¯çš„å…¬å¼å¯è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\left(F_{* l} k\right)(p)=\sum_{(s+l t=p)} F(s) k(t)</script><p>å…¶ä¸­ï¼Œ$F(s)$ä¸ºè¾“å…¥ç‰¹å¾ï¼Œ$s$ä¸ºå„é‡‡æ ·ä½ç½®ï¼Œ$k(t)$è¡¨ç¤ºå·ç§¯æ ¸$k$åœ¨$t$å¤„çš„æƒé‡ï¼Œ${*l}$è¡¨ç¤ºè†¨èƒ€å› å­ä¸º$l$çš„è†¨èƒ€å·ç§¯ã€‚</p><p>$(F_{* l} k)(p)$ä¸ºåœ¨ä½ç½®$p$å¤„çš„è¾“å‡ºã€‚æ±‚å’Œæ¡ä»¶è¿˜éœ€è¦å†çœ‹ä¸‹â€¦</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>åœ¨Pytorchä¸­å®ç°ç©ºæ´å·ç§¯ååˆ†ç®€å•ï¼Œåªéœ€è¦æŒ‡å®šdilationå‚æ•°å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DilatedCNN</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="built_in">super</span>(DilatedCNN,self).__init__()</span><br><span class="line">    self.convlayers = nn.Sequential(</span><br><span class="line">      nn.Conv2d(in_channels = <span class="number">3</span>, out_channels = <span class="number">6</span>, kernel_size = <span class="number">9</span>, stride = <span class="number">1</span>, padding = <span class="number">0</span>, dilation=<span class="number">2</span>),</span><br><span class="line">      nn.ReLU(),</span><br><span class="line">      nn.Conv2d(in_channels=<span class="number">6</span>, out_channels=<span class="number">16</span>, kernel_size = <span class="number">3</span>, stride = <span class="number">1</span>, padding= <span class="number">0</span>, dilation = <span class="number">2</span>),</span><br><span class="line">      nn.ReLU(),</span><br><span class="line">    )</span><br><span class="line">    self.fclayers = nn.Sequential(</span><br><span class="line">      nn.Linear(<span class="number">2304</span>,<span class="number">120</span>),</span><br><span class="line">      nn.ReLU(),</span><br><span class="line">      nn.Linear(<span class="number">120</span>,<span class="number">84</span>),</span><br><span class="line">      nn.ReLU(),</span><br><span class="line">      nn.Linear(<span class="number">84</span>,<span class="number">10</span>)</span><br><span class="line">    )</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self,x</span>):</span></span><br><span class="line">    x = self.convlayers(x)</span><br><span class="line">    x = x.view(-<span class="number">1</span>,<span class="number">2304</span>)</span><br><span class="line">    x = self.fclayers(x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h2 id="å¯èƒ½äº§ç”Ÿçš„é—®é¢˜"><a href="#å¯èƒ½äº§ç”Ÿçš„é—®é¢˜" class="headerlink" title="å¯èƒ½äº§ç”Ÿçš„é—®é¢˜"></a>å¯èƒ½äº§ç”Ÿçš„é—®é¢˜</h2><ol><li>ç½‘æ ¼æ•ˆåº”ï¼ˆThe Gridding Effectï¼‰</li><li>Long-ranged information might be not relevant.</li></ol><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>[1] <a href="https://zhuanlan.zhihu.com/p/113285797">https://zhuanlan.zhihu.com/p/113285797</a><br>[2] <a href="https://www.geeksforgeeks.org/dilated-convolution/">https://www.geeksforgeeks.org/dilated-convolution/</a><br>[3] <a href="https://developer.orbbec.com.cn/v/blog_detail/892">https://developer.orbbec.com.cn/v/blog_detail/892</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç©ºæ´å·ç§¯ï¼ŒDilated Convolutionï¼Œä¹Ÿå¯è¯‘ä¸ºè†¨èƒ€å·ç§¯æˆ–æ‰©å¼ å·ç§¯ï¼Œå¯ä»¥ä½¿ç½‘ç»œåœ¨ä¸å¢åŠ å‚æ•°æ•°é‡çš„æƒ…å†µä¸‹æ‹¥æœ‰æ›´å¤§çš„æ„Ÿå—åŸŸã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Python" scheme="http://silencezheng.top/tags/Python/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://silencezheng.top/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨Springé¡¹ç›®ä¸­ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡</title>
    <link href="http://silencezheng.top/2023/11/24/article123/"/>
    <id>http://silencezheng.top/2023/11/24/article123/</id>
    <published>2023-11-24T15:48:44.000Z</published>
    <updated>2023-11-24T15:57:36.987Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è°ˆè®ºä¸€åˆ‡ä¹‹å‰ï¼Œä½¿ç”¨çš„æ•°æ®åº“ä¸€å®šè¦æ”¯æŒäº‹åŠ¡ï¼Œæœ¬æ–‡ä»¥MySQL InnoDBå­˜å‚¨å¼•æ“ä¸ºä¾‹ï¼Œä»æ•°æ®åº“äº‹åŠ¡åŸºæœ¬åŸç†å‡ºå‘ï¼Œç®€è¦è¯´æ˜äº‹åŠ¡ç›¸å…³çš„ä¸»è¦çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•åœ¨Springé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå¯¹äºç»†èŠ‚çš„æè¿°å°‘ä¸”æ¨¡ç³Šï¼Œéœ€è¦ä¸æ–­å®Œå–„ã€‚</p><p>ç›¸å…³å†…å®¹ï¼šInnoDBäº‹åŠ¡å®ç°ã€Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶ç­‰ã€‚<br><span id="more"></span></p><h1 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼ˆTransactionï¼‰"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼ˆTransactionï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼ˆTransactionï¼‰"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼ˆTransactionï¼‰</h1><p><strong>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</strong>ã€‚äº‹åŠ¡æ˜¯ä¸€ç§ç”¨äºç»´æŠ¤æ•°æ®ä¸€è‡´æ€§çš„æœºåˆ¶ï¼Œå®ƒç¡®ä¿äº†æ•°æ®åº“åœ¨å¤šä¸ªå¹¶å‘æ“ä½œä¸‹ä»ç„¶ä¿æŒä¸€è‡´æ€§ã€‚</p><p>äº‹åŠ¡ï¼ˆæœ€å°æ“ä½œå•å…ƒï¼‰å­˜åœ¨çš„ä¸»è¦æ„å›¾ï¼š</p><ul><li>åœ¨æœ€å°æ“ä½œå•å…ƒä¸­ä¿æŒç¨³å®šçš„æ“ä½œï¼Œå³ä½¿åœ¨æ•…éšœæ—¶ä¹Ÿèƒ½æ¢å¤åˆ°æ“ä½œä¹‹å‰çš„çŠ¶æ€ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚</li><li>ä¿æŒå„ä¸ªæœ€å°æ“ä½œå•å…ƒä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œä»¥é˜²æ­¢äº’ç›¸äº¤äº’äº§ç”Ÿçš„è¦†ç›–æ€§é”™è¯¯ã€‚</li></ul><p>äº‹åŠ¡ç»“æŸçš„ä¸¤ç§å¯èƒ½æ–¹å¼ï¼š</p><ul><li><code>commit</code>ï¼šæäº¤æœ€å°æ“ä½œå•å…ƒä¸­çš„æ‰€æœ‰æ“ä½œã€‚</li><li><code>terminate</code>ï¼šæ“ä½œç»ˆæ­¢ï¼Œæœ€å°æ“ä½œå•å…ƒä¸­æ‰€æœ‰ä¿®æ”¹æ— æ•ˆã€‚</li></ul><p>æ•°æ®åº“æ“ä½œçš„ç¯å¢ƒï¼š</p><ul><li>å…±äº«-å¤šç”¨æˆ·å¹¶å‘è®¿é—®</li><li>ä¸ç¨³å®š-æ½œåœ¨çš„ç¡¬ä»¶/è½¯ä»¶æ•…éšœ</li></ul><p>äº‹åŠ¡æ‰€éœ€ç¯å¢ƒï¼š</p><ul><li>ä¸å…±äº« - ä¸€ä¸ªäº‹åŠ¡å†…çš„æ“ä½œä¸å—å…¶ä»–äº‹åŠ¡å½±å“</li><li>ç¨³å®š - å³ä½¿é¢å¯¹ç³»ç»Ÿæ•…éšœï¼Œå½“å‰äº‹åŠ¡çš„æ“ä½œä¹Ÿèƒ½ä¿ç•™ç°åœº</li></ul><p>ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦å¼€å§‹ï¼Œåˆ™å¿…é¡»ç¡®ä¿ï¼š</p><ul><li>æ‰€æœ‰æ“ä½œå¿…é¡»å¯å›æº¯</li><li>æ‰€æœ‰æ“ä½œå¯¹åç»­æ“ä½œçš„å½±å“å¿…é¡»æ˜¯å¯è§çš„</li></ul><p>ä¸€ä¸ªäº‹åŠ¡å¼€å§‹çš„è¿‡ç¨‹ä¸­å¿…é¡»ç¡®ä¿ï¼šåœ¨è¯¥äº‹åŠ¡ç»“æŸä¹‹å‰å…¶ä»–äº‹åŠ¡çœ‹ä¸åˆ°å®ƒçš„ç»“æœã€‚å¦‚æœäº‹åŠ¡ä¸­æ­¢ï¼Œå¿…é¡»ç¡®ä¿å½“å‰äº‹åŠ¡æ‰€æœ‰å¯èƒ½å½±å“æ•°æ®ä¸€è‡´æ€§çš„æ“ä½œéƒ½ä¼šè¢«æ¸…ç†ã€‚å¦‚æœç³»ç»Ÿå‡ºç°æ•…éšœï¼Œå¿…é¡»ç¡®ä¿é‡æ–°å¯åŠ¨æ—¶æ‰€æœ‰æœªæäº¤çš„äº‹åŠ¡éƒ½ä¼šè¢«æ¸…ç†ã€‚</p><p>å…³ç³»å‹æ•°æ®åº“å¤§å¤šéµå¾ªäº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼š</p><ol><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œé‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šè¢«å›æ»šåˆ°åˆå§‹çŠ¶æ€ã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡åœ¨æ‰§è¡Œå‰åï¼Œæ•°æ®åº“å¿…é¡»ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚è¿™æ„å‘³ç€äº‹åŠ¡æ‰§è¡Œåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸä»ç„¶å¾—ä»¥ç»´æŠ¤ï¼Œä»¥è½¬è´¦ä¸šåŠ¡ä¸ºä¾‹ï¼ŒåŒæ–¹å­˜æ¬¾æ€»é¢åº”ä¸å˜ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šäº‹åŠ¡çš„æ‰§è¡Œåº”è¯¥ä¸å…¶ä»–äº‹åŠ¡ç›¸äº’éš”ç¦»ï¼Œå³ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”è¯¥å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚è¿™ç¡®ä¿äº†å¹¶å‘äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰å½±å“ã€‚</li></ol><p>å…³äºå››å¤§ç‰¹æ€§çš„ä¸€äº›ç†è§£ï¼š</p><blockquote><p>åŸå­æ€§ï¼Œéš”ç¦»æ€§å’ŒæŒä¹…æ€§æ˜¯æ•°æ®åº“çš„å±æ€§ï¼Œè€Œä¸€è‡´æ€§ï¼ˆåœ¨ ACID æ„ä¹‰ä¸Šï¼‰æ˜¯åº”ç”¨ç¨‹åºçš„å±æ€§ã€‚åº”ç”¨å¯èƒ½ä¾èµ–æ•°æ®åº“çš„åŸå­æ€§å’Œéš”ç¦»å±æ€§æ¥å®ç°ä¸€è‡´æ€§ï¼Œä½†è¿™å¹¶ä¸ä»…å–å†³äºæ•°æ®åº“ã€‚åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰å¯èƒ½å¾—åˆ°ä¿éšœã€‚</p></blockquote><ul><li>åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚</li><li>åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚ åœ¨å¹¶å‘çš„æƒ…å†µä¸‹å¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li><li>äº‹åŠ¡æ»¡è¶³æŒä¹…æ€§æ˜¯ä¸ºäº†èƒ½åº”å¯¹æ•°æ®åº“å´©æºƒçš„æƒ…å†µã€‚</li></ul><h1 id="InnoDBäº‹åŠ¡å®ç°"><a href="#InnoDBäº‹åŠ¡å®ç°" class="headerlink" title="InnoDBäº‹åŠ¡å®ç°"></a>InnoDBäº‹åŠ¡å®ç°</h1><p>MySQLæä¾›æ’ä»¶å¼å­˜å‚¨å¼•æ“ï¼Œè¿™äº›å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ï¼Œå…¶è®¾è®¡ç›®æ ‡ä¸»è¦é¢å‘åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰çš„åº”ç”¨ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯è¡Œé”è®¾è®¡ï¼Œæ”¯æŒå¤–é”®ï¼Œå¹¶æ”¯æŒéé”å®šè¯»ï¼Œå³é»˜è®¤è¯»å–æ“ä½œä¸ä¼šäº§ç”Ÿé”ã€‚ä»MySQLæ•°æ®åº“5.5.8ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯MySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚</p><p>åœ¨InnoDBå¼•æ“ä¸­å®ç°äº‹åŠ¡æœ€é‡è¦çš„ä¸œè¥¿å°±æ˜¯æ—¥å¿—ç³»ç»Ÿï¼Œä¿è¯äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ä¸»è¦ä¾é è¿™ä¸¤å¤§æ—¥å¿—ï¼š</p><ul><li><strong>redo log</strong>ï¼šä¿è¯äº‹åŠ¡æŒä¹…æ€§</li><li><strong>undo log</strong>ï¼šå›æ»šæ—¥å¿—ï¼Œä¿è¯äº‹åŠ¡åŸå­æ€§</li></ul><p>ä¸¤å¤§æ—¥å¿—ç³»ç»Ÿåˆ†åˆ«ä¿è¯äº†æŒä¹…æ€§å’ŒåŸå­æ€§ï¼Œéš”ç¦»æ€§åˆ™æ˜¯é€šè¿‡<strong>MVCCæœºåˆ¶</strong>å’Œ<strong>é”æœºåˆ¶</strong>æ¥æ§åˆ¶å®ç°ã€‚</p><h2 id="Logical-logs-amp-Physical-logs"><a href="#Logical-logs-amp-Physical-logs" class="headerlink" title="Logical logs &amp; Physical logs"></a>Logical logs &amp; Physical logs</h2><p><strong>é€»è¾‘æ—¥å¿—ï¼ˆLogical Logsï¼‰ï¼š</strong></p><ol><li><strong>è®°å½•å†…å®¹</strong>ï¼šé€»è¾‘æ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®åº“æ“ä½œçš„é€»è¾‘ä¿¡æ¯ï¼Œä¾‹å¦‚SQLè¯­å¥ã€è¡¨å’Œåˆ—çš„åç§°ã€æ•°æ®çš„é€»è¾‘ç»“æ„ç­‰ã€‚å®ƒä¸å…³å¿ƒåº•å±‚æ•°æ®çš„ç‰©ç†å­˜å‚¨æ–¹å¼ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šé€»è¾‘æ—¥å¿—ä¸»è¦ç”¨äºæ•°æ®å¯¼å…¥ã€å¯¼å‡ºã€å¤‡ä»½å’Œæ¢å¤ç­‰é«˜å±‚æ¬¡çš„æ•°æ®æ“ä½œã€‚å®ƒå…è®¸å°†æ•°æ®ä»ä¸€ä¸ªæ•°æ®åº“å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œä¸å¿…è€ƒè™‘åº•å±‚æ•°æ®çš„ç‰©ç†ç»“æ„ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šMySQLçš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰æ˜¯ä¸€ç§é€»è¾‘æ—¥å¿—ï¼Œè®°å½•äº†SQLè¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œä»¥ä¾¿åœ¨å¤åˆ¶æ•°æ®æˆ–è¿›è¡Œæ•°æ®å¤‡ä»½æ—¶ä½¿ç”¨ã€‚</li></ol><p><strong>ç‰©ç†æ—¥å¿—ï¼ˆPhysical Logsï¼‰ï¼š</strong></p><ol><li><strong>è®°å½•å†…å®¹</strong>ï¼šç‰©ç†æ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®åº“æ“ä½œå¯¹åº•å±‚ç‰©ç†æ•°æ®çš„å®é™…ä¿®æ”¹ï¼ŒåŒ…æ‹¬æ•°æ®é¡µçš„è¯»å†™ã€ç£ç›˜å—çš„åˆ†é…å’Œé‡Šæ”¾ç­‰ã€‚å®ƒå…³æ³¨æ•°æ®çš„ç‰©ç†å­˜å‚¨ç»†èŠ‚ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šç‰©ç†æ—¥å¿—ä¸»è¦ç”¨äºç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§å’Œæ¢å¤èƒ½åŠ›ã€‚å®ƒå…è®¸åœ¨ç³»ç»Ÿå´©æºƒæˆ–æ•…éšœåæ¢å¤æœªæäº¤çš„äº‹åŠ¡ï¼Œä»¥åŠå°†äº‹åŠ¡çš„ä¿®æ”¹åº”ç”¨åˆ°æ•°æ®åº“ä¸­ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šMySQLçš„é‡åšæ—¥å¿—ï¼ˆredo logï¼‰æ˜¯ä¸€ç§ç‰©ç†æ—¥å¿—ï¼Œè®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®é¡µçš„ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨äº‹åŠ¡æäº¤åå°†è¿™äº›ä¿®æ”¹åº”ç”¨åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ç³»ç»Ÿæ•…éšœæ—¶æ¢å¤æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><p>ä»¥ä¸Šåªæ˜¯ç®€è¦çš„æ¦‚å¿µè§£é‡Šï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è§[6]ã€‚</p><h2 id="Binlog"><a href="#Binlog" class="headerlink" title="Binlog"></a>Binlog</h2><p>åœ¨ä»‹ç»InnoDBçš„ä¸¤å¤§æ ¸å¿ƒæ—¥å¿—å‰ï¼Œå…ˆç®€å•èŠä¸€ä¸‹MySQLçš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¯¹ç†è§£Redo logçš„ä½œç”¨æœ‰å¸®åŠ©ã€‚</p><p>binlog = binary logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒè®°å½•äº†é™¤äº† select ä¹‹å¤–æ‰€æœ‰çš„ DDL å’Œ DML è¯­å¥ã€‚ä»¥äº‹ä»¶å½¢å¼è®°å½•ï¼Œè¿˜åŒ…å«è¯­å¥æ‰€æ‰§è¡Œçš„æ¶ˆè€—çš„æ—¶é—´ï¼ŒMySQL çš„äºŒè¿›åˆ¶æ—¥å¿—æ˜¯äº‹åŠ¡å®‰å…¨å‹çš„ã€‚binlogæ˜¯MySQLçš„é€»è¾‘æ—¥å¿—ï¼Œå¹¶ä¸”ç”±Serverå±‚è¿›è¡Œè®°å½•ï¼Œä½¿ç”¨ä»»ä½•å­˜å‚¨å¼•æ“çš„MySQLéƒ½ä¼šè®°å½•binlogæ—¥å¿—ã€‚</p><p>binlogæ—¥å¿—æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ä¸»ä»å¤åˆ¶ï¼šmysql replication åœ¨ master ç«¯å¼€å¯ binlogï¼Œmaster æŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™ slaves æ¥è¾¾åˆ° master-slave æ•°æ®ä¸€è‡´çš„ç›®çš„ã€‚</li><li>æ•°æ®æ¢å¤ï¼šé€šè¿‡ mysqlbinlog å·¥å…·æ¥æ¢å¤æ•°æ®ã€‚</li></ul><p>binlog æ—¥å¿—åŒ…æ‹¬ä¸¤ç±»æ–‡ä»¶ï¼š</p><ol><li>äºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶ï¼ˆæ–‡ä»¶ååç¼€ä¸º .indexï¼‰ç”¨äºè®°å½•æ‰€æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li><li>äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼ˆæ–‡ä»¶ååç¼€ä¸º .00000*ï¼‰è®°å½•æ•°æ®åº“æ‰€æœ‰çš„ DDL å’Œ DML è¯­å¥äº‹ä»¶ã€‚</li></ol><p>binlogæ–‡ä»¶æ˜¯é€šè¿‡è¿½åŠ çš„æ–¹å¼å†™å…¥çš„ï¼Œå¯é€šè¿‡é…ç½®å‚æ•°<code>max_binlog_size</code>è®¾ç½®æ¯ä¸ª binlog æ–‡ä»¶çš„å¤§å°ï¼Œå½“æ–‡ä»¶å¤§å°å¤§äºç»™å®šå€¼åï¼Œæ—¥å¿—ä¼šå‘ç”Ÿæ»šåŠ¨ï¼Œä¹‹åçš„æ—¥å¿—è®°å½•åˆ°æ–°çš„æ–‡ä»¶ä¸Šã€‚</p><p>binlogæ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œåˆ†åˆ«ä¸ºSTATMENTã€ROWå’ŒMIXEDã€‚åœ¨ MySQL 5.7.7ä¹‹å‰ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯STATEMENTï¼ŒMySQL 5.7.7ä¹‹åï¼Œé»˜è®¤å€¼æ˜¯ROWã€‚æ—¥å¿—æ ¼å¼é€šè¿‡<code>binlog-format</code>æŒ‡å®šã€‚</p><p>æˆ‘ä»¬å‡è®¾æ•°æ®åº“åªæœ‰ binlogï¼Œé‚£ä¹ˆæ•°æ®æ–‡ä»¶çš„æ›´æ–°å’Œå†™å…¥ binlog åªæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å…ˆæ›´æ–°æ•°æ®æ–‡ä»¶ï¼Œå†å†™å…¥ binlogã€‚</li><li>å…ˆå†™å…¥ binlogï¼Œå†æ›´æ–°æ•°æ®æ–‡ä»¶ã€‚</li></ol><p>å¦‚æœå…ˆæ›´æ–°æ•°æ®æ–‡ä»¶ï¼Œæ¥ç€æœåŠ¡å™¨å®•æœºï¼Œåˆ™å¯¼è‡´ binlog ä¸­ç¼ºå°‘æœ€åçš„æ›´æ–°ä¿¡æ¯ï¼›å¦‚æœå…ˆå†™ binlog å†æ›´æ–°æ•°æ®åˆ™å¯èƒ½å¯¼è‡´æ•°æ®æ–‡ä»¶æœªè¢«æ›´æ–°ã€‚æ‰€ä»¥åœ¨åªæœ‰ binlog çš„ç¯å¢ƒä¸­çš„ MySQL æ˜¯ä¸å…·å¤‡ crash-safe çš„èƒ½åŠ›ã€‚</p><p>PSï¼šè¿™é‡Œå…³äºbinlogçš„å†™å…¥æœºåˆ¶ä¸åšè¿‡å¤šå±•å¼€ï¼Œä½†ä¹Ÿæ˜¯åˆ†writeå’Œfsyncä¸¤ä¸ªæ­¥éª¤ï¼Œæ—¶æœºç”±å‚æ•°<code>sync_binlog</code>æ§åˆ¶ã€‚</p><h2 id="Write-Ahead-Logging"><a href="#Write-Ahead-Logging" class="headerlink" title="Write-Ahead Logging"></a>Write-Ahead Logging</h2><p>Write-Ahead Loggingç­–ç•¥æ˜¯ä¸€ç§ç”¨äºç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œæ¢å¤èƒ½åŠ›çš„é‡è¦æŠ€æœ¯ï¼Œä¸ºäº†ä¿è¯æ¢å¤æ—¶å¯ä»¥ä»æ—¥å¿—ä¸­çœ‹åˆ°æœ€æ–°çš„æ•°æ®åº“çŠ¶æ€ï¼Œè¦æ±‚æ—¥å¿—å…ˆäºæ•°æ®å†…å®¹è½ç›˜ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†è¿™äº›ä¿®æ”¹æ“ä½œè®°å½•åˆ°ä¸€ä¸ªæŒä¹…æ€§çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åå†å°†è¿™äº›æ“ä½œåº”ç”¨åˆ°å®é™…çš„æ•°æ®æ–‡ä»¶ã€‚æ³¨æ„è¿™é‡Œçš„æ—¥å¿—æ˜¯æ¯”binlogæ›´ç»†ç²’åº¦çš„æ—¥å¿—ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œäº‹åŠ¡å®Œæˆæäº¤å‰è¿˜éœ€è¦åœ¨æ—¥å¿—ä¸­è®°å½•å¯¹åº”çš„Commitæ ‡è®°ï¼Œä»¥ä¾›æ¢å¤æ—¶äº†è§£å½“å‰çš„äº‹åŠ¡çŠ¶æ€ï¼Œå› æ­¤è¿˜éœ€è¦å…³æ³¨Commitæ ‡è®°å’Œäº‹åŠ¡ä¸­æ•°æ®å†…å®¹çš„è½ç›˜é¡ºåºã€‚æ ¹æ®æ—¥å¿—ä¸­è®°å½•çš„å†…å®¹å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š<strong>Undo-Only</strong>ï¼Œ<strong>Redo-Only</strong>ï¼Œ<strong>Redo-Undo</strong>ã€‚</p><h3 id="Undo-Only-Logging"><a href="#Undo-Only-Logging" class="headerlink" title="Undo-Only Logging"></a>Undo-Only Logging</h3><p>Undo-Only Loggingçš„Logè®°å½•å¯ä»¥è¡¨ç¤ºä¸º<code>&lt;T, X, v&gt;</code>ï¼Œäº‹åŠ¡$T$ä¿®æ”¹äº†$X$çš„å€¼ï¼Œ$X$çš„æ—§å€¼æ˜¯vã€‚äº‹åŠ¡æäº¤æ—¶ï¼Œéœ€è¦é€šè¿‡å¼ºåˆ¶Flushä¿è¯Commitæ ‡è®°è½ç›˜å‰ï¼Œå¯¹åº”äº‹åŠ¡çš„æ‰€æœ‰æ•°æ®è½ç›˜ï¼Œå³è½ç›˜é¡ºåºä¸ºLogè®°å½•-&gt;Data-&gt;Commitæ ‡è®°ã€‚æ¢å¤æ—¶å¯ä»¥æ ¹æ®Commitæ ‡è®°åˆ¤æ–­äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡Undo Logä¸­è®°å½•çš„æ—§å€¼å°†æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹å›æ»šã€‚æˆ‘ä»¬æ¥å®¡è§†ä¸€ä¸‹Undo-Onlyå¯¹DurabilityåŠAtomicçš„ä¿è¯ï¼š</p><ul><li>Durability of Updatesï¼šDataå¼ºåˆ¶åˆ·ç›˜ä¿è¯ï¼Œå·²ç»Commitçš„äº‹åŠ¡ç”±äºå…¶æ‰€æœ‰Dataéƒ½å·²ç»åœ¨Commitæ ‡è®°ä¹‹å‰è½ç›˜ï¼Œå› æ­¤ä¼šä¸€ç›´å­˜åœ¨ï¼›</li><li>Failure Atomicï¼šUndo Logå†…å®¹ä¿è¯ï¼Œå¤±è´¥äº‹åŠ¡çš„å·²åˆ·ç›˜çš„ä¿®æ”¹ä¼šåœ¨æ¢å¤é˜¶æ®µé€šè¿‡Undoæ—¥å¿—å›æ»šï¼Œä¸å†å¯è§ã€‚<br>ç„¶è€ŒUndo-Onlyä¾ç„¶æœ‰ä¸èƒ½Pageå†…å¹¶å‘çš„é—®é¢˜ï¼Œå¦‚æœä¸¤ä¸ªäº‹åŠ¡çš„ä¿®æ”¹è½åˆ°ä¸€ä¸ªPageä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤å‰éœ€è¦çš„å¼ºåˆ¶Flushæ“ä½œï¼Œä¼šå¯¼è‡´åŒPageæ‰€æœ‰äº‹åŠ¡çš„Dataè½ç›˜ï¼Œå¯èƒ½ä¼šæ—©äºå¯¹åº”çš„Logé¡¹ä»è€ŒæŸå®³WALã€‚åŒæ—¶ï¼Œä¹Ÿä¼šå¯¼è‡´å…³é”®è·¯å¾„ä¸Šè¿‡äºé¢‘ç¹çš„ç£ç›˜éšæœºè®¿é—®ã€‚</li></ul><h3 id="Redo-Only-Logging"><a href="#Redo-Only-Logging" class="headerlink" title="Redo-Only Logging"></a>Redo-Only Logging</h3><p>ä¸åŒäºUndo-Onlyï¼Œé‡‡ç”¨Redo-Onlyçš„Logä¸­è®°å½•çš„æ˜¯ä¿®æ”¹åçš„æ–°å€¼ã€‚å¯¹åº”åœ°ï¼ŒCommitæ—¶éœ€è¦ä¿è¯ï¼ŒLogä¸­çš„Commitæ ‡è®°åœ¨äº‹åŠ¡çš„ä»»ä½•æ•°æ®ä¹‹å‰è½ç›˜ï¼Œå³è½ç›˜é¡ºåºä¸ºLogè®°å½•-&gt;Commitæ ‡è®°-&gt;Dataã€‚æ¢å¤æ—¶åŒæ ·æ ¹æ®Commitæ ‡è®°åˆ¤æ–­äº‹åŠ¡çŠ¶æ€ï¼Œå¹¶é€šè¿‡Redo Logä¸­è®°å½•çš„æ–°å€¼å°†å·²ç»Commitï¼Œä½†æ•°æ®æ²¡æœ‰è½ç›˜çš„äº‹åŠ¡ä¿®æ”¹é‡æ”¾ã€‚</p><ul><li>Durability of Updatesï¼šRedo Logå†…å®¹ä¿è¯ï¼Œå·²æäº¤äº‹åŠ¡çš„æœªåˆ·ç›˜çš„ä¿®æ”¹ï¼Œåˆ©ç”¨Redo Logä¸­çš„å†…å®¹é‡æ”¾ï¼Œä¹‹åå¯è§ï¼›</li><li>Failure Atomicï¼šé˜»æ­¢Commitå‰Dataè½ç›˜ä¿è¯ï¼Œå¤±è´¥äº‹åŠ¡çš„ä¿®æ”¹ä¸ä¼šå‡ºç°åœ¨ç£ç›˜ä¸Šï¼Œè‡ªç„¶ä¸å¯è§ã€‚<br>Redo-OnlyåŒæ ·æœ‰ä¸èƒ½Pageå†…å¹¶å‘çš„é—®é¢˜ï¼ŒPageä¸­çš„å¤šä¸ªä¸åŒäº‹åŠ¡ï¼Œ<strong>åªè¦æœ‰ä¸€ä¸ªæœªæäº¤å°±ä¸èƒ½åˆ·ç›˜ï¼Œè¿™äº›æ•°æ®å…¨éƒ¨éƒ½éœ€è¦ç»´æŠ¤åœ¨å†…å­˜ä¸­ï¼Œé€ æˆè¾ƒå¤§çš„å†…å­˜å‹åŠ›</strong>ã€‚</li></ul><h3 id="Redo-Undo-Logging"><a href="#Redo-Undo-Logging" class="headerlink" title="Redo-Undo Logging"></a>Redo-Undo Logging</h3><p>å¯ä»¥çœ‹å‡ºçš„åªæœ‰Undoæˆ–Redoçš„é—®é¢˜ï¼Œä¸»è¦æ¥è‡ªäºå¯¹Commitæ ‡è®°åŠDataè½ç›˜é¡ºåºçš„é™åˆ¶ï¼Œè€Œè¿™ç§é™åˆ¶å½’æ ¹ç»“åº•æ¥æºäºLogä¿¡æ¯ä¸­å¯¹æ–°å€¼æˆ–æ—§å€¼çš„ç¼ºå¤±ã€‚å› æ­¤Redo-Undoé‡‡ç”¨åŒæ—¶è®°å½•æ–°å€¼å’Œæ—§å€¼çš„æ–¹å¼ï¼Œæ¥æ¶ˆé™¤Commitå’ŒDataä¹‹é—´åˆ·ç›˜é¡ºåºçš„é™åˆ¶ã€‚</p><ul><li>Durability of Updatesï¼šRedo å†…å®¹ä¿è¯ï¼Œå·²æäº¤äº‹åŠ¡çš„æœªåˆ·ç›˜çš„ä¿®æ”¹ï¼Œåˆ©ç”¨Redo Logä¸­çš„å†…å®¹é‡æ”¾ï¼Œä¹‹åå¯è§ï¼›</li><li>Failure Atomicï¼šUndoå†…å®¹ä¿è¯ï¼Œå¤±è´¥äº‹åŠ¡çš„å·²åˆ·ç›˜çš„ä¿®æ”¹ä¼šåœ¨æ¢å¤é˜¶æ®µé€šè¿‡Undoæ—¥å¿—å›æ»šï¼Œä¸å†å¯è§ã€‚<br>å¦‚æ­¤ä¸€æ¥ï¼ŒåŒPageçš„ä¸åŒäº‹åŠ¡æäº¤å°±å˜å¾—éå¸¸ç®€å•ã€‚åŒæ—¶å¯ä»¥å°†è¿ç»­çš„æ•°æ®æ”’ç€è¿›è¡Œæ‰¹é‡çš„åˆ·ç›˜å·²åˆ©ç”¨ç£ç›˜è¾ƒé«˜çš„é¡ºåºå†™æ€§èƒ½ã€‚</li></ul><h2 id="è„é¡µ"><a href="#è„é¡µ" class="headerlink" title="è„é¡µ"></a>è„é¡µ</h2><p>å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸ºâ€œè„é¡µâ€ã€‚å†…å­˜æ•°æ®å†™å…¥ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µå†…å®¹å°±ä¸€è‡´äº†ï¼Œç§°ä¸ºâ€œå¹²å‡€é¡µâ€ã€‚åˆ·è„é¡µï¼Œå³æŠŠè„é¡µï¼ˆå†…å­˜ä¸­çš„ä¿®æ”¹è¿‡çš„æ•°æ®é¡µï¼‰åˆ·æ–°ï¼ˆflushï¼‰åˆ°ç£ç›˜ä¸Šã€‚</p><p>å¯¹äº InnoDB å­˜å‚¨å¼•æ“ï¼Œç¼“å†²æ± ï¼ˆbuffer poolï¼‰æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“æŸ¥è¯¢éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œæ•°æ®åº“é¦–å…ˆæŸ¥çœ‹ç¼“å†²æ± ä¸­æ˜¯å¦å·²ç»æœ‰ç›¸åº”çš„æ•°æ®é¡µã€‚å¦‚æœæ•°æ®é¡µåœ¨ç¼“å†²æ± ä¸­ï¼ŒæŸ¥è¯¢å¯ä»¥ç«‹å³ä»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸å¿…è¿›è¡Œç£ç›˜è¯»å–ï¼Œè¿™å¤§å¤§æé«˜äº†æ€§èƒ½ã€‚å¦‚æœæ•°æ®é¡µä¸åœ¨ç¼“å†²æ± ä¸­ï¼ˆç¼“å†²æ± æœªå‘½ä¸­ï¼‰ï¼Œæ•°æ®åº“ç³»ç»Ÿå°†ä»ç£ç›˜è¯»å–è¯¥æ•°æ®é¡µï¼Œå¹¶å°†å…¶æ”¾å…¥ç¼“å†²æ± ä¸­ï¼Œä»¥ä¾¿å°†æ¥çš„æŸ¥è¯¢å¯ä»¥æ›´å¿«åœ°è®¿é—®ã€‚ç¼“å†²æ± çš„å¤§å°é€šå¸¸æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„å†…å­˜å’Œæ€§èƒ½éœ€æ±‚æ¥è°ƒæ•´ç¼“å†²æ± çš„å¤§å°ã€‚</p><p>å¯¹äºäº‹åŠ¡å¤„ç†ï¼Œæ•°æ®çš„ä¿®æ”¹é€šå¸¸é¦–å…ˆåœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œç„¶åç­‰å¾…äº‹åŠ¡æäº¤ã€‚åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­è¢«è®¤ä¸ºæ˜¯è„çš„ï¼Œå› ä¸ºå®ƒä»¬è¿˜æœªè¢«å†™å…¥åˆ°ç£ç›˜ã€‚ä¸‹é¢æœ‰ä¸€æ®µæ–‡å­—å¯ä»¥ä¹Ÿå¯ä»¥å¸®åŠ©å¼•å‡ºRedo logçš„ä½œç”¨ã€‚</p><blockquote><p>InnoDB æœ‰ ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ã€‚ç¼“å†²æ± æ˜¯ç‰©ç†é¡µçš„ç¼“å­˜ï¼Œå¯¹ InnoDB çš„ä»»ä½•ä¿®æ”¹æ“ä½œéƒ½ä¼šé¦–å…ˆåœ¨ç¼“å†²æ± çš„ page ä¸Šè¿›è¡Œï¼Œç„¶åè¿™æ ·çš„é¡µé¢å°†è¢«æ ‡è®°ä¸º dirty å¹¶è¢«æ”¾åˆ°ä¸“é—¨çš„ flush list ä¸Šï¼Œåç»­å°†ç”±ä¸“é—¨çš„åˆ·è„çº¿ç¨‹é˜¶æ®µæ€§çš„å°†è¿™äº›é¡µé¢å†™å…¥ç£ç›˜ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯é¿å…æ¯æ¬¡å†™æ“ä½œéƒ½æ“ä½œç£ç›˜å¯¼è‡´å¤§é‡çš„éšæœºIOï¼Œé˜¶æ®µæ€§çš„åˆ·è„å¯ä»¥å°†å¤šæ¬¡å¯¹é¡µé¢çš„ä¿®æ”¹ merge æˆä¸€æ¬¡IOæ“ä½œï¼ŒåŒæ—¶å¼‚æ­¥å†™å…¥ä¹Ÿé™ä½äº†è®¿é—®çš„æ—¶å»¶ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœåœ¨ dirty page è¿˜æœªåˆ·å…¥ç£ç›˜æ—¶ï¼Œserveréæ­£å¸¸å…³é—­ï¼Œè¿™äº›ä¿®æ”¹æ“ä½œå°†ä¼šä¸¢å¤±ï¼Œå¦‚æœå†™å…¥æ“ä½œæ­£åœ¨è¿›è¡Œï¼Œç”šè‡³ä¼šç”±äºæŸåæ•°æ®æ–‡ä»¶å¯¼è‡´æ•°æ®åº“ä¸å¯ç”¨ã€‚ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜çš„å‘ç”Ÿï¼ŒInnodb å°†æ‰€æœ‰å¯¹é¡µé¢çš„ä¿®æ”¹æ“ä½œå†™å…¥ä¸€ä¸ªä¸“é—¨çš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ•°æ®åº“å¯åŠ¨æ—¶ä»æ­¤æ–‡ä»¶è¿›è¡Œæ¢å¤æ“ä½œï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ redo log fileã€‚è¿™æ ·çš„æŠ€æœ¯æ¨è¿Ÿäº†ç¼“å†²æ± é¡µé¢çš„åˆ·æ–°ï¼Œä»è€Œæå‡äº†æ•°æ®åº“çš„ååï¼Œæœ‰æ•ˆçš„é™ä½äº†è®¿é—®æ—¶å»¶ã€‚å¸¦æ¥çš„é—®é¢˜æ˜¯é¢å¤–çš„å†™ redo log æ“ä½œçš„å¼€é”€ï¼ˆé¡ºåº IOï¼Œæ¯”éšæœº IO å¿«å¾ˆå¤šï¼‰ï¼Œä»¥åŠæ•°æ®åº“å¯åŠ¨æ—¶æ¢å¤æ“ä½œæ‰€éœ€çš„æ—¶é—´ã€‚</p></blockquote><h2 id="Redo-log-Durability"><a href="#Redo-log-Durability" class="headerlink" title="Redo log (Durability)"></a>Redo log (Durability)</h2><p>Redo logåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²(redo log buffer)ï¼Œå¦ä¸€ä¸ªæ˜¯ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶(redo log file)ã€‚</p><p>åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´(user space)ä¸‹çš„ç¼“å†²åŒºæ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼Œä¸­é—´å¿…é¡»ç»è¿‡æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´(kernel space)ç¼“å†²åŒº(OS Buffer)ã€‚å› æ­¤ï¼Œredo log bufferå†™å…¥redo log fileå®é™…ä¸Šæ˜¯å…ˆå†™å…¥æ–‡ä»¶ç³»ç»Ÿpage cacheï¼Œç„¶åå†é€šè¿‡ç³»ç»Ÿè°ƒç”¨fsyncå°†å…¶åˆ·åˆ°redo log fileä¸­ã€‚ç”±æ­¤å¯ä»¥å¾—åˆ°redo logçš„ä¸‰ç§çŠ¶æ€ï¼š</p><ol><li>å­˜åœ¨ redo log buffer ä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨ MySQL è¿›ç¨‹å†…å­˜ä¸­ã€‚</li><li>å†™åˆ°ç£ç›˜ (write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ page cache é‡Œé¢ã€‚</li><li>è°ƒç”¨fsyncï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li></ol><p>äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹å†…å­˜ä¸­æ•°æ®é¡µè¿›è¡Œä¿®æ”¹å°†ç”Ÿæˆredo logï¼Œç”Ÿæˆçš„ redo log æ˜¯å…ˆå†™åˆ° redo log buffer ä¸­ï¼Œç„¶åé€šè¿‡æŸäº›æ–¹å¼åˆ·å…¥ç£ç›˜ã€‚è¿™é‡Œæ‰€æŒ‡çš„æ–¹å¼ï¼Œä¸ªäººç†è§£ä¸»è¦æœ‰äº”ç§ï¼š</p><ol><li>åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡æ‰§è¡Œåˆ·ç›˜ï¼Œå¹¶è¡Œè½®è¯¢ã€‚</li><li>æ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ä¾æ®ç­–ç•¥åˆ·ç›˜ã€‚</li><li>å½“redo log bufferç¼“å­˜å¯ç”¨ç©ºé—´å°äºä¸€åŠçš„æ—¶å€™åˆ·ç›˜ï¼Œæ•´ä½“ç©ºé—´å—<code>innodb_log_buffer_size</code>æ§åˆ¶ã€‚è¿™ä¸ªæƒ…å†µçš„åˆ·ç›˜ä»…æŒ‡writeï¼Œç„¶åå¯èƒ½è¢«åå°çº¿ç¨‹åˆ·ç›˜ï¼Œè¿™ä¹Ÿæ˜¯æœªæäº¤redo logåˆ·ç›˜çš„å¯èƒ½æƒ…å†µä¹‹ä¸€ã€‚</li><li>æ•°æ®åº“æœåŠ¡å™¨æ­£å¸¸å…³é—­æ—¶ã€‚</li><li>æ£€æŸ¥ç‚¹ï¼Œ<strong>checkpoints</strong>ã€‚</li></ol><p>PSï¼šå¦å¤–ä¸¤ç§æƒ…å†µæ˜¯ï¼š1ã€äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ redo log ä¹Ÿæ˜¯ç›´æ¥å†™åœ¨ redo log buffer ä¸­çš„ï¼Œå³å°†äº‹åŠ¡çš„ä¿®æ”¹æš‚æ—¶ä¿å­˜äºå†…å­˜ä¸­ï¼Œè¿™äº› redo log ä¹Ÿä¼šè¢«åå°çº¿ç¨‹ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å³ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo logï¼Œä¹Ÿæ˜¯å¯èƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚2ã€äº‹åŠ¡å¹¶è¡Œï¼Œå…ˆæäº¤çš„äº‹åŠ¡æŠŠå…¶ä»–äº‹åŠ¡çš„redo log bufferåˆ·ç›˜ã€‚</p><p>Redo logçš„åœ¨äº‹åŠ¡æäº¤æ—¶çš„å†™å…¥ç­–ç•¥ç”±å‚æ•°<code>innodb_flush_log_at_trx_commit</code>æ§åˆ¶ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§å–å€¼é€‰é¡¹ï¼š</p><ol><li>è®¾ç½®ä¸º<code>0</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;</li><li>è®¾ç½®ä¸º<code>1</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆé»˜è®¤ï¼‰ï¼›</li><li>è®¾ç½®ä¸º<code>2</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚</li></ol><p>ï¼ˆTODOï¼šè¿™ä¸€éƒ¨åˆ†åº”è¯¥æœ‰é—®é¢˜ï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¹Ÿä¼šå†™å…¥ï¼Œä¸è¿‡è¿™æ—¶å€™è½ç›˜çš„è„æ•°æ®å°±é undoäº†ï¼‰é‚£ä¹ˆäº†è§£äº†redo logçš„å†™å…¥æœºåˆ¶åï¼Œå®ƒåˆ°åº•æ˜¯å¦‚ä½•å®ç°ä¿è¯æ•°æ®åº“æŒä¹…æ€§çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘å°è¯•ä»ä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹è¿›è¡Œåˆ†æã€‚</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Chain1:</span> äº‹åŠ¡å¼€å§‹ -&gt; æ•°æ®é¡µè¯»å– -&gt; äº‹åŠ¡æ‰§è¡Œï¼ˆæ•°æ®é¡µä¿®æ”¹ &amp; <span class="keyword">redo</span> logç”Ÿæˆï¼‰-&gt; äº‹åŠ¡æäº¤ -&gt; äº‹åŠ¡ç»“æŸ</span><br><span class="line"><span class="symbol">Chain2:</span>                           æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿ<span class="keyword">redo</span> logåˆ·ç›˜  ä¾æ®ç­–ç•¥å†³å®šæ˜¯å¦ç›´æ¥åˆ·ç›˜    </span><br></pre></td></tr></table></figure><p>æˆ‘æŠŠæ‰§è¡Œæµç¨‹åˆ†ä¸ºäº†ä¸¤ä¸ªé“¾æ¡ï¼Œchain1æ˜¯äº‹åŠ¡æ‰§è¡Œçš„æµç¨‹ï¼Œchain2æ˜¯redo logéƒ¨åˆ†InnoDBåœ¨å¯¹åº”ä½ç½®å¯èƒ½é‡‡å–çš„æ“ä½œã€‚ä¸‹é¢æˆ‘ä»¬åœ¨chain1çš„æ¯ä¸ªéƒ¨åˆ†æ¨¡æ‹Ÿæ‰ç”µå…³æœºï¼Œçœ‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚ç”±äºè¿™ä¸€å—å†…å®¹å®é™…ä¸Šæ˜¯å´©æºƒæ¢å¤ç›¸å…³å†…å®¹ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰<strong>æ­£å¸¸çŠ¶æ€</strong>ï¼Œ<strong>æ­£å¸¸çŠ¶æ€</strong>æŒ‡çš„æ˜¯ MySQL å´©æºƒä¹‹å‰ï¼Œæ•°æ®é¡µæœ€åä¸€æ¬¡æ­£ç¡®çš„åˆ·æ–°åˆ°ç£ç›˜çš„çŠ¶æ€ã€‚</p><p>1ã€æ•°æ®é¡µè¯»å–ï¼šå¯¹æ•°æ®åº“å®Œæ•´æ€§æ— å½±å“ã€‚<br>2ã€äº‹åŠ¡æ‰§è¡Œï¼ˆredo logç”Ÿæˆæœªè½ç›˜ï¼‰ï¼šæ— å½±å“ï¼Œäº‹åŠ¡æœªæäº¤ã€‚<br>3ã€äº‹åŠ¡æ‰§è¡Œï¼ˆredo logç”Ÿæˆå·²è½ç›˜ï¼‰ï¼šæ— å½±å“ï¼Œäº‹åŠ¡æœªæäº¤ã€‚<br>4ã€äº‹åŠ¡æäº¤ï¼ˆredo logå†™å…¥ç­–ç•¥=1ï¼‰ï¼šä»»æ„æ—¶é—´å´©æºƒï¼Œéƒ½å¯ä»¥é€šè¿‡redo logæ‰§è¡Œæ¢å¤ï¼ŒæŸåçš„æ•°æ®é¡µå¯ä»¥é€šè¿‡<strong>double write</strong>ä¿®å¤åå†æ‰§è¡Œæ¢å¤ã€‚<br>5ã€äº‹åŠ¡æäº¤ï¼ˆredo logå†™å…¥ç­–ç•¥=2ï¼‰ï¼šå¦‚æœåœ¨redo logåˆšå†™å…¥æœªåˆ·ç›˜æ—¶æ–­ç”µï¼Œåˆ™ä¼šä¸¢å¤±ä¸Šä¸€ç§’çš„æ•°æ®ï¼Œä»…mysqldå´©æºƒä¸ä¼šä¸¢å¤±æ•°æ®ã€‚<br>6ã€äº‹åŠ¡æäº¤ï¼ˆredo logå†™å…¥ç­–ç•¥=0ï¼‰ï¼šä¸ä¸Šä¸€æƒ…å†µç›¸åŒï¼Œä½†å¦‚æœå´©æºƒæƒ…å†µé™çº§ï¼Œä¾‹å¦‚mysqldå´©æºƒï¼Œä¹Ÿä¼šä¸¢å¤±æ•°æ®ã€‚</p><p>æ³¨æ„ä»¥ä¸Šåˆ†æä»…æ˜¯ç®€åŒ–ç‰ˆï¼Œæ›´å¤šç»†èŠ‚å¦‚Checkpointsã€Double writeã€LSNã€Mini-Transactionç­‰â€¦éœ€è¦å¤šè¯»ä¹¦å®è·µæ‰èƒ½é€šé€äº†ï¼Œéœ€è¦æ—¶å†å­¦ä¹ å§ã€‚</p><h2 id="Undo-log-Atomicity"><a href="#Undo-log-Atomicity" class="headerlink" title="Undo log (Atomicity)"></a>Undo log (Atomicity)</h2><p>Undo Logæ˜¯InnoDBååˆ†é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒçš„ä½œç”¨æ¨ªè´¯InnoDBä¸­ä¸¤ä¸ªæœ€ä¸»è¦çš„éƒ¨åˆ†ï¼Œå¹¶å‘æ§åˆ¶ï¼ˆConcurrency Controlï¼‰å’Œæ•…éšœæ¢å¤ï¼ˆCrash Recoveryï¼‰ï¼ŒInnoDBä¸­undo logçš„å®ç°äº¦æ—¥å¿—äº¦æ•°æ®ã€‚</p><p>ä¸ºä¿è¯åŸå­æ€§ï¼ŒInnoDBä¼šåœ¨æ­£å¸¸äº‹åŠ¡è¿›è¡Œä¸­ï¼Œå°±ä¸æ–­çš„è¿ç»­å†™å…¥undo logï¼Œæ¥è®°å½•æœ¬æ¬¡ä¿®æ”¹ä¹‹å‰çš„å†å²å€¼ã€‚å½“æ•…éšœçœŸæ­£å‘ç”Ÿæ—¶ï¼Œå¯ä»¥åœ¨recoveryè¿‡ç¨‹ä¸­é€šè¿‡å›æ”¾undo logå°†æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æŠ¹æ‰ã€‚æ­¤å¤–ï¼Œundo logä¹Ÿå¯ä»¥ç”¨æ¥æ”¯æŒæ­»é”å¤„ç†æˆ–ç”¨æˆ·è¯·æ±‚çš„äº‹åŠ¡å›æ»šã€‚</p><p>åœ¨å¹¶å‘æ§åˆ¶ä¸­ï¼Œä¸»æµæ•°æ®åº“é‡‡ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œä¸ºæ¯æ¡è®°å½•ä¿å­˜å¤šä»½å†å²æ•°æ®ä¾›è¯»äº‹åŠ¡è®¿é—®ï¼Œæ–°çš„å†™å…¥åªéœ€è¦æ·»åŠ æ–°çš„ç‰ˆæœ¬å³å¯ï¼ŒInnoDBåˆ©ç”¨undo logæä¾›æ­¤åŠŸèƒ½ã€‚</p><p>åœ¨è®¾è®¡æ–¹é¢ï¼Œundo logéœ€è¦çš„æ˜¯äº‹åŠ¡ä¹‹é—´çš„å¹¶å‘ï¼Œä»¥åŠæ–¹ä¾¿çš„å¤šç‰ˆæœ¬æ•°æ®ç»´æŠ¤ï¼Œå…¶é‡æ”¾é€»è¾‘ä¸å¸Œæœ›å› æ•°æ®åº“ç‰©ç†å­˜å‚¨å˜åŒ–è€Œå˜åŒ–ï¼Œå› æ­¤InnoDBä¸­çš„undo logé‡‡ç”¨<strong>é€»è¾‘æ—¥å¿—</strong>ã€‚åŒæ—¶ï¼ŒInnoDBæ˜¯æŠŠundo logå½“åšä¸€ç§æ•°æ®æ¥ç»´æŠ¤å’Œä½¿ç”¨çš„ï¼Œå…¶æœ¬èº«ä¹Ÿåƒå…¶ä»–çš„æ•°æ®åº“æ•°æ®ä¸€æ ·ï¼Œä¼šå†™è‡ªå·±å¯¹åº”çš„redo logï¼Œä»¥æ­¤ä¿è¯è‡ªå·±ä¸å‡ºé”™ã€‚</p><h3 id="Undo-Recordçš„å†…å®¹"><a href="#Undo-Recordçš„å†…å®¹" class="headerlink" title="Undo Recordçš„å†…å®¹"></a>Undo Recordçš„å†…å®¹</h3><p>æ¯å½“InnoDBä¸­éœ€è¦ä¿®æ”¹æŸæ¡è®°å½•æ—¶ï¼Œéƒ½ä¼šå°†å…¶å†å²ç‰ˆæœ¬å†™å…¥ä¸€ä¸ªundo logä¸­ï¼Œå¯¹åº”çš„undo recordæ˜¯Updateç±»å‹ã€‚å½“æ’å…¥æ–°çš„è®°å½•æ—¶ï¼Œè¿˜æ²¡æœ‰ä¸€ä¸ªå†å²ç‰ˆæœ¬ï¼Œä½†ä¸ºäº†æ–¹ä¾¿äº‹åŠ¡å›æ»šæ—¶åšé€†å‘ï¼ˆDeleteï¼‰æ“ä½œï¼Œè¿˜æ˜¯ä¼šå†™å…¥ä¸€ä¸ªInsertç±»å‹çš„undo recordã€‚</p><p>å¯¹äºInsertç±»å‹çš„undo recordï¼Œå®ƒä»…ä»…æ˜¯ä¸ºäº†å¯èƒ½çš„äº‹åŠ¡å›æ»šå‡†å¤‡çš„ï¼Œå¹¶ä¸åœ¨MVCCåŠŸèƒ½ä¸­æ‰¿æ‹…ä½œç”¨ï¼Œå› æ­¤åªéœ€è¦ç”¨<strong>Key Fields</strong>è®°å½•å¯¹åº”æ•°æ®åº“è®°å½•çš„ä¸»é”®ï¼Œä¾›å›æ»šæ—¶æŸ¥æ‰¾è®°å½•ä½ç½®å³å¯ã€‚</p><p><img src="/assets/post_img/article123/insert_undo_record.png" alt=""></p><p>å…¶ä¸­Undo Numberæ˜¯Undoçš„ä¸€ä¸ªé€’å¢ç¼–å·ï¼ŒTable IDç”¨æ¥è¡¨ç¤ºæ˜¯å“ªå¼ è¡¨çš„ä¿®æ”¹ã€‚ä¸‹é¢ä¸€ç»„Key Fieldsçš„é•¿åº¦ä¸å®šï¼Œå› ä¸ºå¯¹åº”è¡¨çš„ä¸»é”®å¯èƒ½ç”±å¤šä¸ªfieldç»„æˆï¼Œè¿™é‡Œéœ€è¦å­˜å‚¨æ•°æ®åº“è®°å½•å®Œæ•´çš„ä¸»é”®ä¿¡æ¯ï¼Œå›æ»šçš„æ—¶å€™å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯åœ¨ç´¢å¼•ä¸­å®šä½åˆ°å¯¹åº”çš„è®°å½•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨Undo Recordçš„å¤´å°¾è¿˜å„ç•™äº†ä¸¤ä¸ªå­—èŠ‚ç”¨æˆ·è®°å½•å…¶å‰åºå’Œåç»§Undo Recordçš„ä½ç½®ã€‚</p><p>å¯¹äºUpdateç±»å‹çš„undo recordï¼Œæƒ…å†µç¨å¾®å¤æ‚ä¸€äº›ï¼Œç”±äºMVCCéœ€è¦ä¿ç•™è®°å½•çš„å¤šä¸ªå†å²ç‰ˆæœ¬ï¼Œå½“æŸä¸ªè®°å½•çš„å†å²ç‰ˆæœ¬è¿˜åœ¨è¢«ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ªè®°å½•æ˜¯ä¸èƒ½è¢«çœŸæ­£çš„åˆ é™¤çš„ã€‚å› æ­¤ï¼Œå½“éœ€è¦åˆ é™¤æ—¶ï¼Œå…¶å®åªæ˜¯ä¿®æ”¹å¯¹åº”è®°å½•çš„Delete Markæ ‡è®°ã€‚å¯¹åº”çš„ï¼Œå¦‚æœè¿™æ—¶è¿™ä¸ªè®°å½•åˆé‡æ–°æ’å…¥ï¼Œå…¶å®ä¹Ÿåªæ˜¯ä¿®æ”¹ä¸€ä¸‹Delete Markæ ‡è®°ï¼Œä¹Ÿå°±æ˜¯å°†è¿™ä¸¤ç§æƒ…å†µçš„åˆ é™¤å’Œæ’å…¥è½¬å˜æˆäº†æ›´æ–°æ“ä½œã€‚å†åŠ ä¸Šå¸¸è§„çš„æ›´æ–°è®°å½•ï¼Œè¿™ç§ç±»å‹çš„undo recordå­˜åœ¨ä¸‰ç§ç±»å‹ï¼š<code>TRX_UNDO_UPD_EXIST_REC, TRX_UNDO_DEL_MARK_REC, TRX_UNDO_UPD_DEL_REC</code>ã€‚</p><p><img src="/assets/post_img/article123/update_undo_record.png" alt=""></p><p>é™¤äº†<strong>Key Fields</strong>å¤–ï¼ŒUpdateç±»å‹çš„undo recordå¢åŠ äº†ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>Transaction Idï¼Œè®°å½•äº†äº§ç”Ÿè¿™ä¸ªå†å²ç‰ˆæœ¬äº‹åŠ¡IDï¼Œç”¨ä½œåç»­MVCCä¸­çš„ç‰ˆæœ¬å¯è§æ€§åˆ¤æ–­ã€‚</li><li>RollPtrï¼ŒæŒ‡å‘çš„æ˜¯è¯¥è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä½ç½®ï¼Œæ²¿ç€RollPtrå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªè®°å½•çš„æ‰€æœ‰å†å²ç‰ˆæœ¬ã€‚</li><li>Update Fieldsï¼Œå…¶ä¸­è®°å½•çš„å°±æ˜¯å½“å‰è¿™ä¸ªè®°å½•ç‰ˆæœ¬ç›¸å¯¹äºå…¶ä¹‹åçš„ä¸€æ¬¡ä¿®æ”¹çš„Deltaä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰è¢«ä¿®æ”¹çš„Fieldçš„ç¼–å·ï¼Œé•¿åº¦å’Œå†å²å€¼ã€‚</li></ol><h3 id="Undo-Recordçš„ç»„ç»‡æ–¹å¼"><a href="#Undo-Recordçš„ç»„ç»‡æ–¹å¼" class="headerlink" title="Undo Recordçš„ç»„ç»‡æ–¹å¼"></a>Undo Recordçš„ç»„ç»‡æ–¹å¼</h3><p>æ¯ä¸€æ¬¡çš„ä¿®æ”¹éƒ½ä¼šäº§ç”Ÿè‡³å°‘ä¸€ä¸ªUndo Recordï¼Œç°åœ¨è€ƒè™‘å¤§é‡Undo Recordå¦‚ä½•ç»„ç»‡èµ·æ¥æ”¯æŒé«˜æ•ˆè®¿é—®ä¸ç®¡ç†ã€‚é¦–å…ˆæ˜¯åœ¨ä¸è€ƒè™‘ç‰©ç†å­˜å‚¨çš„æƒ…å†µä¸‹çš„é€»è¾‘ç»„ç»‡æ–¹å¼ï¼›ä¹‹åï¼Œç‰©ç†ç»„ç»‡æ–¹å¼ä»‹ç»å¦‚ä½•å°†å…¶å­˜å‚¨åˆ°åˆ°å®é™…16KBç‰©ç†å—ä¸­ï¼›ç„¶åæ–‡ä»¶ç»„ç»‡æ–¹å¼ä»‹ç»æ•´ä½“çš„æ–‡ä»¶ç»“æ„ï¼›æœ€åå†ä»‹ç»å…¶åœ¨å†…å­˜ä¸­çš„ç»„ç»‡æ–¹å¼ã€‚</p><h4 id="é€»è¾‘ç»„ç»‡æ–¹å¼-Undo-Log"><a href="#é€»è¾‘ç»„ç»‡æ–¹å¼-Undo-Log" class="headerlink" title="é€»è¾‘ç»„ç»‡æ–¹å¼ - Undo Log"></a>é€»è¾‘ç»„ç»‡æ–¹å¼ - Undo Log</h4><p>æ¯ä¸ªäº‹åŠ¡ä¼šä¿®æ”¹ä¸€ç»„æ•°æ®åº“è®°å½•ï¼Œå¯¹åº”çš„ä¼šäº§ç”Ÿä¸€ç»„Undo Recordï¼Œè¿™äº›Undo Recordé¦–å°¾ç›¸è¿ç»„æˆäº†è¿™ä¸ªäº‹åŠ¡çš„Undo Logã€‚é™¤äº†ä¸€ä¸ªä¸ªçš„Undo Recordä¹‹å¤–ï¼Œè¿˜åœ¨å¼€å¤´å¢åŠ äº†ä¸€ä¸ªUndo Log Headeræ¥è®°å½•ä¸€äº›å¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼Œå› æ­¤ï¼Œä¸€ä¸ªUndo Logçš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/assets/post_img/article123/undo_log.png" alt=""></p><p><strong>Undo Log Header</strong>ä¸­è®°å½•äº†äº§ç”Ÿè¿™ä¸ªUndo Logçš„äº‹åŠ¡çš„Trx IDï¼›Trx Noæ˜¯äº‹åŠ¡çš„æäº¤é¡ºåºï¼Œä¹Ÿä¼šç”¨è¿™ä¸ªæ¥åˆ¤æ–­æ˜¯å¦èƒ½Purgeï¼Œè¿™ä¸ªåœ¨åé¢ä¼šè¯¦ç»†ä»‹ç»ï¼›Delete Markæ ‡æ˜è¯¥Undo Logä¸­æœ‰æ²¡æœ‰<code>TRX_UNDO_DEL_MARK_REC</code>ç±»å‹çš„Undo Recordï¼Œé¿å…Purgeæ—¶ä¸å¿…è¦çš„æ‰«æï¼›Log Start Offsetä¸­è®°å½•Undo Log Headerçš„ç»“æŸä½ç½®ï¼Œæ–¹ä¾¿ä¹‹åHeaderä¸­å¢åŠ å†…å®¹æ—¶çš„å…¼å®¹ï¼›ä¹‹åæ˜¯ä¸€äº›Flagä¿¡æ¯ï¼›Next Undo LogåŠPrev Undo Logæ ‡è®°å‰åä¸¤ä¸ªUndo Logï¼Œè¿™ä¸ªä¼šåœ¨æ¥ä¸‹æ¥ä»‹ç»ï¼›æœ€åé€šè¿‡History List Nodeå°†è‡ªå·±æŒ‚è½½åˆ°ä¸ºPurgeå‡†å¤‡çš„History Listä¸­ã€‚</p><p>ç´¢å¼•ä¸­çš„åŒä¸€ä¸ªæ•°æ®åº“è®°å½•è¢«ä¸åŒäº‹åŠ¡ä¿®æ”¹ï¼Œä¼šäº§ç”Ÿä¸åŒçš„å†å²ç‰ˆæœ¬ï¼Œè¿™äº›å†å²ç‰ˆæœ¬åˆé€šè¿‡<strong>Rollptr</strong>ç©¿æˆä¸€ä¸ªé“¾è¡¨ï¼Œä¾›MVCCä½¿ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/post_img/article123/undo_logical.png" alt=""></p><p>ç¤ºä¾‹ä¸­æœ‰ä¸‰ä¸ªäº‹åŠ¡æ“ä½œäº†è¡¨$t$ä¸Šï¼Œä¸»é”®idæ˜¯1çš„è®°å½•ï¼Œé¦–å…ˆäº‹åŠ¡$I$æ’å…¥äº†è¿™æ¡è®°å½•å¹¶ä¸”è®¾ç½®å­—æ®µ$a$çš„å€¼ä¸ºAï¼Œä¹‹åäº‹åŠ¡$J$å’Œäº‹åŠ¡$K$åˆ†åˆ«å°†è¿™æ¡idä¸º1çš„è®°å½•ä¸­çš„å­—æ®µ$a$çš„å€¼ä¿®æ”¹ä¸ºäº†Bå’ŒCã€‚$I$ï¼Œ$J$ï¼Œ$K$ä¸‰ä¸ªäº‹åŠ¡åˆ†åˆ«æœ‰è‡ªå·±çš„é€»è¾‘ä¸Šè¿ç»­çš„ä¸‰æ¡Undo Logï¼Œæ¯æ¡Undo Logæœ‰è‡ªå·±çš„Undo Log Headerã€‚ä»ç´¢å¼•ä¸­çš„è¿™æ¡æ•°æ®åº“è®°å½•æ²¿ç€<strong>Rollptr</strong>å¯ä»¥ä¾æ¬¡æ‰¾åˆ°è¿™ä¸‰ä¸ªäº‹åŠ¡Undo Logä¸­å…³äºè¿™æ¡è®°å½•çš„å†å²ç‰ˆæœ¬ã€‚åŒæ—¶å¯ä»¥çœ‹å‡ºï¼ŒInsertç±»å‹Undo Recordä¸­åªè®°å½•äº†å¯¹åº”çš„ä¸»é”®å€¼ï¼š<code>id=1</code>ï¼Œè€ŒUpdateç±»å‹çš„Undo Recordä¸­è¿˜è®°å½•äº†å¯¹åº”çš„å†å²ç‰ˆæœ¬çš„ç”Ÿæˆäº‹åŠ¡Trx_idï¼Œä»¥åŠè¢«ä¿®æ”¹çš„å­—æ®µ$a$çš„å†å²å€¼ã€‚</p><h4 id="ç‰©ç†ç»„ç»‡æ ¼å¼-Undo-Segment"><a href="#ç‰©ç†ç»„ç»‡æ ¼å¼-Undo-Segment" class="headerlink" title="ç‰©ç†ç»„ç»‡æ ¼å¼ - Undo Segment"></a>ç‰©ç†ç»„ç»‡æ ¼å¼ - Undo Segment</h4><p>ä¸€ä¸ªäº‹åŠ¡ä¼šäº§ç”Ÿå¤šå¤§çš„Undo Logæœ¬èº«æ˜¯ä¸å¯æ§çš„ï¼Œè€Œæœ€ç»ˆå†™å…¥ç£ç›˜å´æ˜¯æŒ‰ç…§å›ºå®šçš„å—å¤§å°ä¸ºå•ä½çš„ï¼ŒInnoDBä¸­é»˜è®¤æ˜¯16KBï¼Œå› æ­¤éœ€è¦è€ƒè™‘å¦‚ä½•ç”¨å›ºå®šçš„å—å¤§å°æ‰¿è½½ä¸å®šé•¿çš„Undo Logï¼Œä»¥å®ç°é«˜æ•ˆçš„ç©ºé—´åˆ†é…ã€å¤ç”¨ï¼Œé¿å…ç©ºé—´æµªè´¹ã€‚InnoDBçš„åŸºæœ¬æ€è·¯æ˜¯è®©å¤šä¸ªè¾ƒå°çš„Undo Logç´§å‡‘å­˜åœ¨ä¸€ä¸ªUndo Pageä¸­ï¼Œè€Œå¯¹è¾ƒå¤§çš„Undo Logåˆ™éšç€ä¸æ–­çš„å†™å…¥ï¼ŒæŒ‰éœ€åˆ†é…è¶³å¤Ÿå¤šçš„Undo Pageåˆ†æ•£æ‰¿è½½ã€‚ä¸‹é¢æ¥çœ‹è¿™éƒ¨åˆ†çš„ç‰©ç†å­˜å‚¨æ–¹å¼ï¼š</p><p><img src="/assets/post_img/article123/undo_physical.png" alt=""></p><p>æ¯ä¸ªå†™äº‹åŠ¡å¼€å§‹å†™æ“ä½œä¹‹å‰éƒ½éœ€è¦æŒæœ‰ä¸€ä¸ªUndo Segmentï¼Œä¸€ä¸ªUndo Segmentä¸­çš„æ‰€æœ‰ç£ç›˜ç©ºé—´çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯16KB Pageçš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªFSP Segmentç®¡ç†çš„ã€‚</p><blockquote><p>FSPï¼ˆFile Space Pageï¼‰æ˜¯InnoDBå­˜å‚¨å¼•æ“ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¡¨ç¤ºæ–‡ä»¶ç©ºé—´æ®µï¼ˆSegmentï¼‰ã€‚æ¯ä¸ªFSP Segmentå¯¹åº”äºä¸€ä¸ªè¡¨ç©ºé—´ï¼ˆtablespaceï¼‰ï¼Œç”¨äºå­˜å‚¨æ•°æ®å’Œç´¢å¼•ã€‚</p><p>åœ¨InnoDBä¸­ï¼Œæ•°æ®å’Œç´¢å¼•è¢«ç»„ç»‡ä¸ºä¸€ä¸ªä¸ªé¡µé¢ï¼ˆPageï¼‰ï¼Œè€Œè¿™äº›é¡µé¢åˆæŒ‰ç…§ä¸€å®šçš„æ–¹å¼æ¥ç»„ç»‡å¹¶ä¿å­˜åœ¨FSP Segmentä¸­ã€‚FSP Segmentæ˜¯InnoDBå­˜å‚¨å¼•æ“ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ã€‚</p><p>FSP SegmentåŒ…å«å¤šä¸ªè¿ç»­çš„æ–‡ä»¶ç©ºé—´é¡µï¼ˆFile Space Pagesï¼‰ï¼Œè¿™äº›é¡µé¢å¯ä»¥æ˜¯æ•°æ®é¡µã€ç´¢å¼•é¡µæˆ–å…¶ä»–ç±»å‹çš„é¡µï¼Œä»¥æ»¡è¶³ä¸åŒçš„å­˜å‚¨éœ€æ±‚ã€‚æ¯ä¸ªFSP Segmentéƒ½æœ‰è‡ªå·±çš„FSP IDï¼ˆFile Space Page IDï¼‰ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†å®ƒã€‚</p></blockquote><p>Undo Segmentä¼šæŒæœ‰è‡³å°‘ä¸€ä¸ªUndo Pageï¼Œæ¯ä¸ªUndo Pageä¼šåœ¨å¼€å¤´38å­—èŠ‚åˆ°56å­—èŠ‚è®°å½•Undo Page Headerï¼Œå…¶ä¸­è®°å½•Undo Pageçš„ç±»å‹ã€æœ€åä¸€æ¡Undo Recordçš„ä½ç½®ï¼Œå½“å‰Pageè¿˜ç©ºé—²éƒ¨åˆ†çš„å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€æ¡Undo Recordè¦å†™å…¥çš„ä½ç½®ã€‚Undo Segmentä¸­çš„ç¬¬ä¸€ä¸ªUndo Pageè¿˜ä¼šåœ¨56å­—èŠ‚åˆ°86å­—èŠ‚è®°å½•<strong>Undo Segment Header</strong>ï¼Œè¿™å°±æ˜¯è¿™ä¸ªUndo Segmentä¸­ç£ç›˜ç©ºé—´ç®¡ç†çš„Handleï¼Œå…¶ä¸­è®°å½•çš„æ˜¯è¿™ä¸ªUndo Segmentçš„çŠ¶æ€ï¼ˆStateï¼‰ï¼ŒåŒ…æ‹¬TRX_UNDO_CACHEDã€TRX_UNDO_TO_PURGEç­‰ï¼Œè¿˜è®°å½•äº†è¿™ä¸ªUndo Segmentä¸­æœ€åä¸€æ¡Undo Recordçš„ä½ç½®ã€è¿™ä¸ªFSP Segmentçš„Headerä»¥åŠå½“å‰åˆ†é…å‡ºæ¥çš„æ‰€æœ‰Undo Pageçš„é“¾è¡¨ã€‚</p><p>Undo Pageå‰©ä½™çš„ç©ºé—´éƒ½æ˜¯ç”¨æ¥å­˜æ”¾Undo Logçš„ï¼Œå¯¹äºåƒä¸Šå›¾Undo Log 1ï¼ŒUndo Log 2è¿™ç§è¾ƒçŸ­çš„Undo Logï¼Œä¸ºäº†é¿å…Pageå†…çš„ç©ºé—´æµªè´¹ï¼ŒInnoDBä¼šå¤ç”¨Undo Pageæ¥å­˜æ”¾å¤šä¸ªUndo Logï¼Œè€Œå¯¹äºåƒUndo Log 3è¿™ç§æ¯”è¾ƒé•¿çš„Undo Logå¯èƒ½ä¼šåˆ†é…å¤šä¸ªUndo Pageæ¥å­˜æ”¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯Undo Pageçš„å¤ç”¨åªä¼šå‘ç”Ÿåœ¨ç¬¬ä¸€ä¸ªPageã€‚</p><h4 id="æ–‡ä»¶ç»„ç»‡æ–¹å¼-Undo-Tablespace"><a href="#æ–‡ä»¶ç»„ç»‡æ–¹å¼-Undo-Tablespace" class="headerlink" title="æ–‡ä»¶ç»„ç»‡æ–¹å¼ - Undo Tablespace"></a>æ–‡ä»¶ç»„ç»‡æ–¹å¼ - Undo Tablespace</h4><p>æ¯ä¸€æ—¶åˆ»ä¸€ä¸ªUndo Segmentéƒ½æ˜¯è¢«ä¸€ä¸ªäº‹åŠ¡ç‹¬å çš„ã€‚æ¯ä¸ªå†™äº‹åŠ¡éƒ½ä¼šæŒæœ‰è‡³å°‘ä¸€ä¸ªUndo Segmentï¼Œå½“æœ‰å¤§é‡å†™äº‹åŠ¡å¹¶å‘è¿è¡Œæ—¶ï¼Œå°±éœ€è¦å­˜åœ¨å¤šä¸ªUndo Segmentã€‚InnoDBä¸­çš„Undoæ–‡ä»¶ä¸­å‡†å¤‡äº†å¤§é‡çš„Undo Segmentçš„æ§½ä½ï¼ŒæŒ‰ç…§1024ä¸€ç»„åˆ’åˆ†ä¸º<strong>Rollback Segment</strong>ã€‚æ¯ä¸ª<strong>Undo Tablespace</strong>æœ€å¤šä¼šåŒ…å«128ä¸ªRollback Segmentï¼ŒUndo Tablespaceæ–‡ä»¶ä¸­çš„ç¬¬ä¸‰ä¸ªPageä¼šå›ºå®šä½œä¸ºè¿™128ä¸ªRollback Segmentçš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯<strong>Rollback Segment Arrary Header</strong>ï¼Œå…¶ä¸­æœ€å¤šä¼šæœ‰128ä¸ªæŒ‡é’ˆæŒ‡å‘å„ä¸ªRollback Segment Headeræ‰€åœ¨çš„Pageã€‚Rollback Segment Headeræ˜¯æŒ‰éœ€åˆ†é…çš„ï¼Œå…¶ä¸­åŒ…å«1024ä¸ªSlotï¼Œæ¯ä¸ª<strong>Slot</strong>å å››ä¸ªå­—èŠ‚ï¼ŒæŒ‡å‘ä¸€ä¸ªUndo Segmentçš„First Pageã€‚é™¤æ­¤ä¹‹å‰è¿˜ä¼šè®°å½•è¯¥Rollback Segmentä¸­å·²æäº¤äº‹åŠ¡çš„History Listï¼Œåç»­çš„Purgeè¿‡ç¨‹ä¼šé¡ºåºä»è¿™é‡Œå¼€å§‹å›æ”¶å·¥ä½œã€‚</p><p>å¯ä»¥çœ‹å‡ºRollback Segmentçš„ä¸ªæ•°ä¼šç›´æ¥å½±å“InnoDBæ”¯æŒçš„æœ€å¤§äº‹åŠ¡å¹¶å‘æ•°ã€‚MySQL 8.0ç”±äºæ”¯æŒäº†æœ€å¤š127ä¸ªç‹¬ç«‹çš„Undo Tablespaceï¼Œä¸€æ–¹é¢é¿å…äº†ibdata1çš„è†¨èƒ€ï¼Œæ–¹ä¾¿undoç©ºé—´å›æ”¶ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¤§å¤§å¢åŠ äº†æœ€å¤§çš„Rollback Segmentçš„ä¸ªæ•°ï¼Œå¢åŠ äº†å¯æ”¯æŒçš„æœ€å¤§å¹¶å‘å†™äº‹åŠ¡æ•°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/post_img/article123/undo_tablespace.png" alt=""></p><h4 id="å†…å­˜ç»„ç»‡ç»“æ„"><a href="#å†…å­˜ç»„ç»‡ç»“æ„" class="headerlink" title="å†…å­˜ç»„ç»‡ç»“æ„"></a>å†…å­˜ç»„ç»‡ç»“æ„</h4><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯Undoæ•°æ®åœ¨ç£ç›˜ä¸Šçš„ç»„ç»‡ç»“æ„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿä¼šç»´æŠ¤å¯¹åº”çš„æ•°æ®ç»“æ„æ¥ç®¡ç†Undo Logï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/post_img/article123/undo_memory.png" alt=""></p><p>å¯¹åº”æ¯ä¸ªç£ç›˜Undo Tablespaceä¼šæœ‰ä¸€ä¸ª<strong>undo::Tablespace</strong>çš„å†…å­˜ç»“æ„ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å°±æ˜¯ä¸€ç»„<strong>trx_rseg_t</strong>çš„é›†åˆï¼Œtrx_rseg_tå¯¹åº”çš„å°±æ˜¯ä¸Šé¢ä»‹ç»è¿‡çš„ä¸€ä¸ªRollback Segment Headerï¼ˆç›®å½•ï¼‰ï¼Œé™¤äº†ä¸€äº›åŸºæœ¬çš„å…ƒä¿¡æ¯ä¹‹å¤–ï¼Œtrx_rseg_tä¸­ç»´æŠ¤äº†å››ä¸ªtrx_undo_tçš„é“¾è¡¨ï¼ŒUpdate Listä¸­æ˜¯æ­£åœ¨è¢«ä½¿ç”¨çš„ç”¨äºå†™å…¥Updateç±»å‹Undoçš„Undo Segmentï¼›Update Cache Listä¸­æ˜¯ç©ºé—²ç©ºé—´æ¯”è¾ƒå¤šï¼Œå¯ä»¥è¢«åç»­äº‹åŠ¡å¤ç”¨çš„Updateç±»å‹Undo Segment;å¯¹åº”çš„ï¼ŒInsert Listå’ŒInsert Cache Liståˆ†åˆ«æ˜¯æ­£åœ¨ä½¿ç”¨ä¸­çš„Insertç±»å‹Undo Segmentï¼Œå’Œç©ºé—´ç©ºé—´è¾ƒå¤šï¼Œå¯ä»¥è¢«åç»­å¤ç”¨çš„Insertç±»å‹Undo Segmentã€‚å› æ­¤<strong>trx_undo_tå¯¹åº”çš„å°±æ˜¯ä¸Šé¢ä»‹ç»è¿‡çš„Undo Segment</strong>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»Undoçš„å†™å…¥ã€Undoç”¨äºRollbackã€MVCCã€Crash Recoveryä»¥åŠå¦‚ä½•æ¸…ç†Undoç­‰æ–¹é¢æ¥ä»‹ç»InnoDBä¸­Undoçš„è§’è‰²å’ŒåŠŸèƒ½ã€‚</p><h3 id="Undo-Logçš„å†™å…¥"><a href="#Undo-Logçš„å†™å…¥" class="headerlink" title="Undo Logçš„å†™å…¥"></a>Undo Logçš„å†™å…¥</h3><p>å½“å†™äº‹åŠ¡å¼€å§‹æ—¶ï¼Œä¼šå…ˆé€šè¿‡<strong>trx_assign_rseg_durable</strong>æ“ä½œåˆ†é…ä¸€ä¸ªRollback Segmentï¼Œè¯¥äº‹åŠ¡çš„å†…å­˜ç»“æ„<strong>trx_t</strong>ä¹Ÿä¼šé€šè¿‡rsegsæŒ‡é’ˆæŒ‡å‘å¯¹åº”çš„trx_rseg_tå†…å­˜ç»“æ„ï¼Œè¿™é‡Œçš„åˆ†é…ç­–ç•¥å¾ˆç®€å•ï¼Œå°±æ˜¯ä¾æ¬¡å°è¯•ä¸‹ä¸€ä¸ªActiveçš„Rollback Segmentã€‚ä¹‹åå½“ç¬¬ä¸€æ¬¡çœŸæ­£äº§ç”Ÿä¿®æ”¹éœ€è¦å†™Undo Recordçš„æ—¶ï¼Œä¼šè°ƒç”¨<strong>trx_undo_assign_undo</strong>æ“ä½œæ¥è·å¾—ä¸€ä¸ªUndo Segmentã€‚è¿™é‡Œä¼šä¼˜å…ˆå¤ç”¨trx_rseg_tä¸Š<strong>Cached List</strong>ä¸­çš„trx_undo_tï¼Œä¹Ÿå°±æ˜¯å·²ç»åˆ†é…å‡ºæ¥ä½†æ²¡æœ‰è¢«æ­£åœ¨ä½¿ç”¨çš„Undo Segmentï¼Œå¦‚æœæ²¡æœ‰æ‰è°ƒç”¨<strong>trx_undo_create</strong>æ“ä½œåˆ›å»ºæ–°çš„Undo Segmentï¼Œtrx_undo_createä¸­ä¼šè½®è¯¢é€‰æ‹©å½“å‰Rollback Segmentä¸­å¯ç”¨çš„Slotï¼Œä¹Ÿæ˜¯å°±å€¼FIL_NULçš„Slotï¼Œç”³è¯·æ–°çš„Undo Pageï¼Œåˆå§‹åŒ–Undo Page Headerï¼ŒUndo Segment Headerç­‰ä¿¡æ¯ï¼Œåˆ›å»ºæ–°çš„trx_undo_tå†…å­˜ç»“æ„å¹¶æŒ‚åˆ°trx_rseg_tçš„å¯¹åº”Listä¸­ã€‚</p><p>è·å¾—äº†å¯ç”¨çš„Undo Segmentä¹‹åï¼Œè¯¥äº‹åŠ¡ä¼šåœ¨åˆé€‚çš„ä½ç½®åˆå§‹åŒ–è‡ªå·±çš„Undo Log Headerï¼Œä¹‹åï¼Œå…¶æ‰€æœ‰ä¿®æ”¹äº§ç”Ÿçš„Undo Recordéƒ½ä¼šé¡ºåºçš„é€šè¿‡<strong>trx_undo_report_row_operation</strong>æ“ä½œé¡ºåºçš„å†™å…¥å½“å‰çš„Undo Logï¼Œå…¶ä¸­ä¼šæ ¹æ®æ˜¯insertè¿˜æ˜¯updateç±»å‹ï¼Œåˆ†åˆ«è°ƒç”¨trx_undo_page_report_insertæˆ–è€…trx_undo_page_report_modifyã€‚æœ¬æ–‡å¼€å§‹å·²ç»ä»‹ç»è¿‡äº†å…·ä½“çš„Undo Recordå†…å®¹ã€‚ç®€å•çš„è®²ï¼Œinsertç±»å‹ä¼šè®°å½•æ’å…¥Recordçš„ä¸»é”®ï¼Œupdateç±»å‹é™¤äº†è®°å½•ä¸»é”®ä»¥å¤–è¿˜ä¼šæœ‰ä¸€ä¸ªupdate filedsè®°å½•è¿™ä¸ªå†å²å€¼è·Ÿç´¢å¼•å€¼çš„diffã€‚ä¹‹åæŒ‡å‘å½“å‰Undo Recordä½ç½®çš„Rollpträ¼šè¿”å›å†™å…¥ç´¢å¼•çš„Recordä¸Šã€‚</p><p>å½“ä¸€ä¸ªPageå†™æ»¡åï¼Œä¼šè°ƒç”¨<strong>trx_undo_add_page</strong>æ¥åœ¨å½“å‰çš„Undo Segmentä¸Šæ·»åŠ æ–°çš„Pageï¼Œæ–°Pageå†™å…¥Undo Page Headerä¹‹åç»§ç»­ä¾›äº‹åŠ¡å†™å…¥Undo Recordï¼Œä¸ºäº†æ–¹ä¾¿ç»´æŠ¤ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé™åˆ¶å°±æ˜¯å•æ¡Undo Recordä¸è·¨pageï¼Œå¦‚æœå½“å‰Pageæ”¾ä¸ä¸‹ï¼Œä¼šå°†æ•´ä¸ªUndo Recordå†™å…¥ä¸‹ä¸€ä¸ªPageã€‚</p><p>å½“äº‹åŠ¡ç»“æŸï¼ˆcommitæˆ–è€…rollbackï¼‰ä¹‹åï¼Œå¦‚æœåªå ç”¨äº†ä¸€ä¸ªUndo Pageï¼Œä¸”å½“å‰Undo Pageä½¿ç”¨ç©ºé—´å°äºpageçš„3/4ï¼Œè¿™ä¸ªUndo Segmentä¼šä¿ç•™å¹¶åŠ å…¥åˆ°å¯¹åº”çš„insert/update cached listä¸­ã€‚å¦åˆ™ï¼Œinsertç±»å‹çš„Undo Segmentä¼šç›´æ¥å›æ”¶ï¼Œè€Œupdateç±»å‹çš„Undo Segmentä¼šç­‰å¾…åå°çš„Purgeåšå®Œåå›æ”¶ã€‚æ ¹æ®ä¸åŒçš„æƒ…å†µï¼ŒUndo Segment Headerä¸­çš„Stateä¼šè¢«ä»<code>TRX_UNDO_ACTIVE</code>æ”¹æˆ<code>TRX_UNDO_TO_FREE</code>ï¼Œ<code>TRX_UNDO_TO_PURGE</code>æˆ–<code>TRX_UNDO_CACHED</code>ï¼Œè¿™ä¸ªä¿®æ”¹å…¶å®å°±æ˜¯InnoDBçš„äº‹åŠ¡ç»“æŸçš„æ ‡å¿—ï¼Œæ— è®ºæ˜¯Rollbackè¿˜æ˜¯Commitï¼Œåœ¨è¿™ä¸ªä¿®æ”¹å¯¹åº”çš„Redoè½ç›˜ä¹‹åï¼Œå°±å¯ä»¥è¿”å›ç”¨æˆ·ç»“æœï¼Œå¹¶ä¸”Crash Recoveryä¹‹åä¹Ÿä¸ä¼šå†åšå›æ»šå¤„ç†ã€‚</p><h3 id="Undo-Logä¹‹å›æ»š"><a href="#Undo-Logä¹‹å›æ»š" class="headerlink" title="Undo Logä¹‹å›æ»š"></a>Undo Logä¹‹å›æ»š</h3><p>InnoDBä¸­çš„äº‹åŠ¡å¯èƒ½ä¼šç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘Rollbackï¼›ä¹Ÿå¯èƒ½å› ä¸ºé‡åˆ°æ­»é”å¼‚å¸¸Rollbackï¼›æˆ–è€…å‘ç”ŸCrashï¼Œé‡å¯åå¯¹æœªæäº¤çš„äº‹åŠ¡å›æ»šã€‚åœ¨Undoå±‚é¢æ¥çœ‹ï¼Œè¿™äº›å›æ»šçš„æ“ä½œæ˜¯ä¸€è‡´çš„ï¼ŒåŸºæœ¬çš„è¿‡ç¨‹å°±æ˜¯ä»è¯¥äº‹åŠ¡çš„Undo Logä¸­ï¼Œä»åå‘å‰ä¾æ¬¡è¯»å–Undo Recordï¼Œå¹¶æ ¹æ®å…¶ä¸­å†…å®¹åšé€†å‘æ“ä½œï¼Œæ¢å¤ç´¢å¼•è®°å½•ã€‚</p><p>å›æ»šçš„å…¥å£æ˜¯å‡½æ•°<strong>row_undo</strong>ï¼Œå…¶ä¸­ä¼šå…ˆè°ƒç”¨trx_roll_pop_top_rec_of_trxè·å–å¹¶åˆ é™¤è¯¥äº‹åŠ¡çš„æœ€åä¸€æ¡Undo Recordã€‚å¦‚ä¸‹å›¾ä¾‹å­ä¸­çš„Undo LogåŒ…æ‹¬ä¸‰æ¡Undo Recordsï¼Œå…¶ä¸­Record 1åœ¨Undo Page 1ä¸­ï¼ŒRecord 2ï¼Œ3åœ¨Undo Page 2ä¸­ï¼Œå…ˆé€šè¿‡ä»Undo Segment Headerä¸­è®°å½•çš„Page Listæ‰¾åˆ°å½“å‰äº‹åŠ¡çš„æœ€åä¸€ä¸ªUndo Pageçš„Headerï¼Œå¹¶æ ¹æ®Undo Page 2çš„Headerä¸Šè®°å½•çš„Free Space Offsetå®šä½æœ€åä¸€æ¡Undo Recordç»“æŸçš„ä½ç½®ï¼Œå½“ç„¶å®é™…è¿è¡Œæ—¶ï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯ç¼“å­˜åœ¨trx_undo_tçš„top_page_noå’Œtop_offsetä¸­çš„ã€‚åˆ©ç”¨Prev Record Offsetå¯ä»¥æ‰¾åˆ°Undo Record 3ï¼Œåšå®Œå¯¹åº”çš„å›æ»šæ“ä½œä¹‹åï¼Œå†é€šè¿‡å‰åºæŒ‡é’ˆPrev Record Offsetæ‰¾åˆ°å‰ä¸€ä¸ªUndo Recordï¼Œä¾æ¬¡è¿›è¡Œå¤„ç†ã€‚å¤„ç†å®Œå½“å‰Pageä¸­çš„æ‰€æœ‰Undo Recordsåï¼Œå†æ²¿ç€Undo Page Headerä¸­çš„Listæ‰¾åˆ°å‰ä¸€ä¸ªUndo Pageï¼Œé‡å¤å‰é¢çš„è¿‡ç¨‹ï¼Œå®Œæˆä¸€ä¸ªäº‹åŠ¡æ‰€æœ‰Pageä¸Šçš„æ‰€æœ‰Undo Recordsçš„å›æ»šã€‚</p><p><img src="/assets/post_img/article123/undo_rollback.png" alt=""></p><p>æ‹¿åˆ°ä¸€ä¸ªUndo Recordä¹‹åï¼Œè‡ªç„¶åœ°ï¼Œå°±æ˜¯å¯¹å…¶ä¸­å†…å®¹çš„è§£æï¼Œè¿™é‡Œä¼šè°ƒç”¨row_undo_ins_parse_undo_recï¼Œä»Undo Recordä¸­è·å–ä¿®æ”¹è¡Œçš„tableï¼Œè§£æå‡ºå…¶ä¸­è®°å½•çš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯updateç±»å‹ï¼Œè¿˜ä¼šæ‹¿åˆ°ä¸€ä¸ªupdate vectorè®°å½•å…¶ç›¸å¯¹äºæ›´æ–°çš„ä¸€ä¸ªç‰ˆæœ¬çš„å˜åŒ–ã€‚</p><p><code>TRX_UNDO_INSERT_REC</code>ç±»å‹çš„Undoå›æ»šåœ¨row_undo_insä¸­è¿›è¡Œï¼Œinsertçš„é€†å‘æ“ä½œå½“ç„¶å°±æ˜¯deleteï¼Œæ ¹æ®ä»Undo Recordä¸­è§£æå‡ºæ¥çš„ä¸»é”®ï¼Œç”¨row_undo_search_clust_to_pcurå®šä½åˆ°å¯¹åº”çš„ROWï¼Œ åˆ†åˆ«è°ƒç”¨row_undo_ins_remove_sec_recå’Œrow_undo_ins_remove_clust_recåœ¨äºŒçº§ç´¢å¼•å’Œä¸»ç´¢å¼•ä¸Šå°†å½“å‰è¡Œåˆ é™¤ã€‚</p><p>updateç±»å‹çš„undoåŒ…æ‹¬<code>TRX_UNDO_UPD_EXIST_REC</code>ï¼Œ<code>TRX_UNDO_DEL_MARK_REC</code>å’Œ<code>TRX_UNDO_UPD_DEL_REC</code>ä¸‰ç§æƒ…å†µï¼Œä»–ä»¬çš„Undoå›æ»šéƒ½æ˜¯åœ¨row_undo_modä¸­è¿›è¡Œï¼Œé¦–å…ˆä¼šè°ƒç”¨row_undo_mod_del_unmark_sec_and_undo_updateï¼Œå…¶ä¸­æ ¹æ®ä»Undo Recordä¸­è§£æå‡ºçš„update vectoræ¥å›é€€è¿™æ¬¡æ“ä½œåœ¨æ‰€æœ‰äºŒçº§ç´¢å¼•ä¸Šçš„å½±å“ï¼Œå¯èƒ½åŒ…æ‹¬é‡æ–°æ’å…¥è¢«åˆ é™¤çš„äºŒçº§ç´¢å¼•è®°å½•ã€å»é™¤å…¶ä¸­çš„Delete Markæ ‡è®°ï¼Œæˆ–è€…ç”¨update vectorä¸­çš„diffä¿¡æ¯å°†äºŒçº§ç´¢å¼•è®°å½•ä¿®æ”¹ä¹‹å‰çš„å€¼ã€‚ä¹‹åè°ƒç”¨row_undo_mod_cluståŒæ ·åˆ©ç”¨update vectorä¸­è®°å½•çš„diffä¿¡æ¯å°†ä¸»ç´¢å¼•è®°å½•ä¿®æ”¹å›ä¹‹å‰çš„å€¼ã€‚</p><p>å®Œæˆå›æ»šçš„Undo Logéƒ¨åˆ†ï¼Œä¼šè°ƒç”¨trx_roll_try_truncateè¿›è¡Œå›æ”¶ï¼Œå¯¹ä¸å†ä½¿ç”¨çš„pageè°ƒç”¨trx_undo_free_last_pageå°†ç£ç›˜ç©ºé—´äº¤è¿˜ç»™Undo Segmentï¼Œè¿™ä¸ªæ˜¯å†™å…¥è¿‡ç¨‹ä¸­trx_undo_add_pageçš„é€†æ“ä½œã€‚</p><h3 id="Undo-Logä¹‹æ•…éšœæ¢å¤"><a href="#Undo-Logä¹‹æ•…éšœæ¢å¤" class="headerlink" title="Undo Logä¹‹æ•…éšœæ¢å¤"></a>Undo Logä¹‹æ•…éšœæ¢å¤</h3><p>Crash Recoveryæ—¶ï¼Œéœ€è¦åˆ©ç”¨Undoä¸­çš„ä¿¡æ¯å°†æœªæäº¤çš„äº‹åŠ¡çš„æ‰€æœ‰å½±å“å›æ»šï¼Œä»¥ä¿è¯æ•°æ®åº“çš„Failure Atomicã€‚å‰é¢æåˆ°è¿‡ï¼ŒInnoDBä¸­çš„Undoå…¶å®æ˜¯åƒæ•°æ®ä¸€æ ·å¤„ç†çš„ï¼Œä¹Ÿä»ä¸Šé¢çš„ç»„ç»‡ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒUndoæœ¬èº«æœ‰ç€æ¯”Redo Logå¤æ‚å¾—å¤šã€æŒ‰äº‹åŠ¡åˆ†é…è€Œä¸æ˜¯é¡ºåºå†™å…¥çš„ç»„ç»‡ç»“æ„ï¼Œå…¶æœ¬èº«çš„DurabilityåƒInnoDBä¸­å…¶ä»–çš„æ•°æ®ä¸€æ ·ï¼Œéœ€è¦é Redoæ¥ä¿è¯ã€‚é™¤äº†é€šç”¨çš„ä¸€äº›MLOG_2BYTESã€MLOG_4BYTESç±»å‹ä¹‹å¤–ï¼ŒUndoæœ¬èº«ä¹Ÿæœ‰è‡ªå·±å¯¹åº”çš„Redo Logç±»å‹ï¼š<strong>MLOG_UNDO_INIT</strong>ç±»å‹åœ¨Undo Pageèˆ’é€‚åŒ–çš„æ—¶å€™è®°å½•åˆå§‹åŒ–ï¼›åœ¨åˆ†é…Undo Logçš„æ—¶å€™ï¼Œéœ€è¦é‡ç”¨Undo Log Headeræˆ–éœ€è¦åˆ›å»ºæ–°çš„Undo Log Headerçš„æ—¶å€™ï¼Œä¼šåˆ†åˆ«è®°å½•<strong>MLOG_UNDO_HDR_REUSE</strong>å’Œ<strong>MLOG_UNDO_HDR_CREATE</strong>ç±»å‹çš„Redo Recordï¼›<strong>MLOG_UNDO_INSERT</strong>æ˜¯æœ€å¸¸è§çš„ï¼Œåœ¨Undo Logé‡Œå†™å…¥æ–°çš„Undo Recordéƒ½å¯¹åº”çš„å†™è¿™ä¸ªæ—¥å¿—è®°å½•å†™å…¥Undoä¸­çš„æ‰€æœ‰å†…å®¹ï¼›æœ€åï¼Œ<strong>MLOG_UNDO_ERASE_END</strong>å¯¹åº”Undo Logè·¨Undo Pageæ—¶æŠ¹é™¤æœ€åä¸€ä¸ªä¸å®Œæ•´çš„Undo</p><blockquote><p>ARIESï¼ˆAlgorithms for Recovery and Isolation Exploiting Semanticsï¼‰æ˜¯ä¸€ç§äº‹åŠ¡æ¢å¤åè®®ï¼Œç”¨äºæ•°æ®åº“ç³»ç»Ÿä¸­çš„å´©æºƒæ¢å¤å’Œå¹¶å‘æ§åˆ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªç»å…¸çš„æ¢å¤ç®—æ³•ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºè®¸å¤šå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ã€‚</p><p>ARIESæœ¬è´¨æ˜¯ä¸€ç§Redo-Undoçš„WALå®ç°ã€‚å…¶æ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸ºï¼šä¿®æ”¹æ•°æ®ä¹‹å‰å…ˆè¿½åŠ Logè®°å½•ï¼ŒLogå†…å®¹åŒæ—¶åŒ…æ‹¬Redoå’ŒUndoä¿¡æ¯ï¼Œæ¯ä¸ªæ—¥å¿—è®°å½•äº§ç”Ÿä¸€ä¸ªæ ‡è®°å…¶åœ¨æ—¥å¿—ä¸­ä½ç½®çš„é€’å¢LSNï¼ˆLog Sequence Numberï¼‰ï¼›æ•°æ®é¡µä¸­è®°å½•æœ€åä¿®æ”¹çš„æ—¥å¿—é¡¹LSNï¼Œä»¥æ­¤æ¥åˆ¤æ–­Pageä¸­çš„å†…å®¹çš„æ–°æ—§ç¨‹åº¦ï¼Œå®ç°å¹‚ç­‰ã€‚æ•…éšœæ¢å¤é˜¶æ®µéœ€è¦é€šè¿‡Logä¸­çš„å†…å®¹æ¢å¤æ•°æ®åº“çŠ¶æ€ï¼Œä¸ºäº†å‡å°‘æ¢å¤æ—¶éœ€è¦å¤„ç†çš„æ—¥å¿—é‡ï¼ŒARIESä¼šåœ¨æ­£å¸¸è¿è¡ŒæœŸé—´å‘¨æœŸæ€§çš„ç”ŸæˆCheckpointï¼ŒCheckpointä¸­é™¤äº†å½“å‰çš„æ—¥å¿—LSNä¹‹å¤–ï¼Œè¿˜éœ€è¦è®°å½•å½“å‰æ´»è·ƒäº‹åŠ¡çš„æœ€æ–°LSNï¼Œä»¥åŠæ‰€æœ‰è„é¡µï¼Œä¾›æ¢å¤æ—¶å†³å®šé‡æ”¾Redoçš„å¼€å§‹ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºç”ŸæˆCheckpointæ—¶æ•°æ®åº“è¿˜åœ¨æ­£å¸¸æä¾›æœåŠ¡ï¼ˆFuzzy Checkpointï¼‰ï¼Œå…¶ä¸­è®°å½•çš„æ´»è·ƒäº‹åŠ¡åŠè„é¡µä¿¡æ¯å¹¶ä¸ä¸€å®šå‡†ç¡®ï¼Œå› æ­¤éœ€è¦Recoveryé˜¶æ®µé€šè¿‡Logå†…å®¹è¿›è¡Œä¿®æ­£ã€‚</p><p>Recoverè¿‡ç¨‹ï¼šæ•…éšœæ¢å¤åŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼šAnalysisï¼ŒRedoå’ŒUndoã€‚Analysisé˜¶æ®µçš„ä»»åŠ¡ä¸»è¦æ˜¯åˆ©ç”¨CheckpointåŠLogä¸­çš„ä¿¡æ¯ç¡®è®¤åç»­Redoå’ŒUndoé˜¶æ®µçš„æ“ä½œèŒƒå›´ï¼Œé€šè¿‡Logä¿®æ­£Checkpointä¸­è®°å½•çš„è„é¡µé›†åˆä¿¡æ¯ï¼Œå¹¶ç”¨å…¶ä¸­æ¶‰åŠæœ€å°çš„LSNä½ç½®ä½œä¸ºä¸‹ä¸€æ­¥Redoçš„å¼€å§‹ä½ç½®RedoLSNã€‚åŒæ—¶ä¿®æ­£Checkpointä¸­è®°å½•çš„æ´»è·ƒäº‹åŠ¡é›†åˆï¼ˆæœªæäº¤äº‹åŠ¡ï¼‰ï¼Œä½œä¸ºUndoè¿‡ç¨‹çš„å›æ»šå¯¹è±¡ï¼›Redoé˜¶æ®µä»Analysisè·å¾—çš„RedoLSNå‡ºå‘ï¼Œé‡æ”¾æ‰€æœ‰çš„Logä¸­çš„Redoå†…å®¹ï¼Œæ³¨æ„è¿™é‡Œä¹ŸåŒ…å«äº†æœªCommitäº‹åŠ¡ï¼›æœ€åUndoé˜¶æ®µå¯¹æ‰€æœ‰æœªæäº¤äº‹åŠ¡åˆ©ç”¨Undoä¿¡æ¯è¿›è¡Œå›æ»šï¼Œé€šè¿‡Logçš„PrevLSNå¯ä»¥é¡ºåºæ‰¾åˆ°äº‹åŠ¡æ‰€æœ‰éœ€è¦å›æ»šçš„ä¿®æ”¹ã€‚</p></blockquote><p>ä»¥ARIESè¿‡ç¨‹ä¸ºä¾‹ï¼ŒCrash Recoveryçš„è¿‡ç¨‹ä¸­ä¼šå…ˆé‡æ”¾æ‰€æœ‰çš„Redo Logï¼Œæ•´ä¸ªUndoçš„ç£ç›˜ç»„ç»‡ç»“æ„ï¼Œä¹Ÿä¼šä½œä¸ºä¸€ç§æ•°æ®ç±»å‹ä¹Ÿä¼šé€šè¿‡ä¸Šé¢è®²åˆ°çš„è¿™äº›Redoç±»å‹çš„é‡æ”¾æ¢å¤å‡ºæ¥ã€‚ä¹‹ååœ¨trx_sys_init_at_db_startæ“ä½œä¸­ä¼šæ‰«æUndoçš„ç£ç›˜ç»“æ„ï¼Œéå†æ‰€æœ‰çš„Rollback Segmentå’Œå…¶ä¸­æ‰€æœ‰çš„Undo Segmentï¼Œé€šè¿‡è¯»å–Undo Segment Headerä¸­çš„Stateï¼Œå¯ä»¥çŸ¥é“åœ¨Crashå‰ï¼Œæœ€åæŒæœ‰è¿™ä¸ªUndo Segmentçš„äº‹åŠ¡çŠ¶æ€ã€‚å¦‚æœæ˜¯<code>TRX_UNDO_ACTIVE</code>ï¼Œè¯´æ˜å½“æ—¶äº‹åŠ¡éœ€è¦å›æ»šï¼Œå¦åˆ™è¯´æ˜äº‹åŠ¡å·²ç»ç»“æŸï¼Œå¯ä»¥ç»§ç»­æ¸…ç†Undo Segmentçš„é€»è¾‘ã€‚ä¹‹åï¼Œå°±å¯ä»¥æ¢å¤å‡ºUndo Logçš„å†…å­˜ç»„ç»‡æ¨¡å¼ï¼ŒåŒ…æ‹¬æ´»è·ƒäº‹åŠ¡çš„å†…å­˜ç»“æ„trx_tï¼ŒRollback Segmentçš„å†…å­˜ç»“æ„trx_rseg_tï¼Œä»¥åŠå…¶ä¸­çš„trx_undo_tçš„å››ä¸ªé“¾è¡¨ã€‚</p><p>Crash Recoveryå®Œæˆä¹‹å‰ï¼Œä¼šå¯åŠ¨åœ¨srv_dict_recover_on_restartä¸­å¯åŠ¨å¼‚æ­¥å›æ»šçº¿ç¨‹trx_recovery_rollback_threadï¼Œå…¶ä¸­å¯¹Crashå‰è¿˜æ´»è·ƒçš„äº‹åŠ¡ï¼Œé€šè¿‡trx_rollback_activeè¿›è¡Œå›æ»šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä¸Šé¢æåˆ°çš„Undoå›æ»šæ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="Undo-Logçš„æ¸…ç†"><a href="#Undo-Logçš„æ¸…ç†" class="headerlink" title="Undo Logçš„æ¸…ç†"></a>Undo Logçš„æ¸…ç†</h3><p>InnoDBåœ¨Undo Logä¸­ä¿å­˜äº†å¤šä»½å†å²ç‰ˆæœ¬æ¥å®ç°MVCCï¼Œå½“æŸä¸ªå†å²ç‰ˆæœ¬å·²ç»ç¡®è®¤ä¸ä¼šè¢«ä»»ä½•ç°æœ‰çš„å’Œæœªæ¥çš„äº‹åŠ¡çœ‹åˆ°çš„æ—¶å€™ï¼Œå°±åº”è¯¥è¢«æ¸…ç†æ‰ã€‚å› æ­¤å°±éœ€è¦æœ‰åŠæ³•åˆ¤æ–­å“ªäº›Undo Logä¸ä¼šå†è¢«çœ‹åˆ°ã€‚InnoDBä¸­æ¯ä¸ªå†™äº‹åŠ¡ç»“æŸæ—¶éƒ½ä¼šæ‹¿ä¸€ä¸ªé€’å¢çš„ç¼–å·trx_noä½œä¸ºäº‹åŠ¡çš„æäº¤åºå·ï¼Œè€Œæ¯ä¸ªè¯»äº‹åŠ¡ä¼šåœ¨è‡ªå·±çš„ReadViewä¸­è®°å½•è‡ªå·±å¼€å§‹çš„æ—¶å€™çœ‹åˆ°çš„æœ€å¤§çš„trx_noä¸ºm_low_limit_noã€‚é‚£ä¹ˆï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡çš„trx_noå°äºå½“å‰æ‰€æœ‰æ´»è·ƒçš„è¯»äº‹åŠ¡Readviewä¸­çš„è¿™ä¸ªm_low_limit_noï¼Œè¯´æ˜è¿™ä¸ªäº‹åŠ¡åœ¨æ‰€æœ‰çš„è¯»å¼€å§‹ä¹‹å‰å·²ç»æäº¤äº†ï¼Œå…¶ä¿®æ”¹çš„æ–°ç‰ˆæœ¬æ˜¯å¯è§çš„ï¼Œ å› æ­¤ä¸å†éœ€è¦é€šè¿‡undoæ„å»ºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªäº‹åŠ¡çš„Undo Logä¹Ÿå°±å¯ä»¥è¢«æ¸…ç†äº†ã€‚</p><p>è¿™é‡Œä¸å¤šæ·±å…¥ï¼Œæš‚æ—¶ç”¨å¤„ä¸å¤§ï¼Œç›¸å…³å†…å®¹ï¼šUndo Purgeã€Undo Truncateã€Undo Tablespace Truncateã€‚</p><h2 id="MVCCå’Œé”-Isolation"><a href="#MVCCå’Œé”-Isolation" class="headerlink" title="MVCCå’Œé” (Isolation)"></a>MVCCå’Œé” (Isolation)</h2><p>å¤šç‰ˆæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…å†™äº‹åŠ¡å’Œè¯»äº‹åŠ¡çš„äº’ç›¸ç­‰å¾…ï¼Œé‚£ä¹ˆæ¯ä¸ªè¯»äº‹åŠ¡éƒ½éœ€è¦åœ¨ä¸å¯¹æ•°æ®åº“è®°å½•åŠ é”çš„æƒ…å†µä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„åº”è¯¥çœ‹åˆ°çš„å†å²ç‰ˆæœ¬ã€‚æ‰€è°“å†å²ç‰ˆæœ¬å°±æ˜¯å‡è®¾åœ¨è¯¥åªè¯»äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å¯¹æ•´ä¸ªDBæ‰“ä¸€ä¸ªå¿«ç…§ï¼Œä¹‹åè¯¥äº‹åŠ¡çš„æ‰€æœ‰è¯»è¯·æ±‚éƒ½ä»è¿™ä¸ªå¿«ç…§ä¸Šè·å–ã€‚å½“ç„¶å®ç°ä¸Šä¸èƒ½çœŸæ­£å»ä¸ºæ¯ä¸ªäº‹åŠ¡æ‰“ä¸€ä¸ªå¿«ç…§ï¼Œè¿™ä¸ªæ—¶é—´ç©ºé—´éƒ½å¤ªé«˜äº†ã€‚InnoDBçš„åšæ³•ï¼Œæ˜¯åœ¨è¯»äº‹åŠ¡ç¬¬ä¸€æ¬¡è¯»å–çš„æ—¶å€™è·å–ä¸€ä»½ReadViewï¼Œå¹¶ä¸€ç›´æŒæœ‰ï¼Œå…¶ä¸­è®°å½•æ‰€æœ‰å½“å‰æ´»è·ƒçš„å†™äº‹åŠ¡IDï¼Œç”±äºå†™äº‹åŠ¡çš„IDæ˜¯è‡ªå¢åˆ†é…çš„ï¼Œé€šè¿‡è¿™ä¸ªReadViewæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨è¿™ä¸€ç¬é—´ï¼Œå“ªäº›äº‹åŠ¡å·²ç»æäº¤å“ªäº›è¿˜åœ¨è¿è¡Œï¼Œæ ¹æ®Read Committedçš„è¦æ±‚ï¼Œæœªæäº¤çš„äº‹åŠ¡çš„ä¿®æ”¹å°±æ˜¯ä¸åº”è¯¥è¢«çœ‹è§çš„ï¼Œå¯¹åº”åœ°ï¼Œå·²ç»æäº¤çš„äº‹åŠ¡çš„ä¿®æ”¹åº”è¯¥è¢«çœ‹åˆ°ã€‚</p><p>ä½œä¸ºå­˜å‚¨å†å²ç‰ˆæœ¬çš„Undo Recordï¼Œå…¶ä¸­è®°å½•çš„trx_idå°±æ˜¯åšè¿™ä¸ªå¯è§æ€§åˆ¤æ–­çš„ï¼Œå¯¹åº”çš„æ•°æ®åº“ä¸»ç´¢å¼•çš„è®°å½•ä¸Šä¹Ÿæœ‰è¿™ä¸ªå€¼ã€‚å½“ä¸€ä¸ªè¯»äº‹åŠ¡æ‹¿ç€è‡ªå·±çš„ReadViewè®¿é—®æŸä¸ªè¡¨ç´¢å¼•ä¸Šçš„è®°å½•æ—¶ï¼Œä¼šé€šè¿‡æ¯”è¾ƒè®°å½•ä¸Šçš„trx_idç¡®å®šæ˜¯å¦æ˜¯å¯è§çš„ç‰ˆæœ¬ï¼Œå¦‚æœä¸å¯è§å°±æ²¿ç€Recordæˆ–Undo Recordä¸­è®°å½•çš„rollpträ¸€è·¯æ‰¾æ›´è€çš„å†å²ç‰ˆæœ¬ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œäº‹åŠ¡$R$å¼€å§‹éœ€è¦æŸ¥è¯¢è¡¨$t$ä¸Šçš„idä¸º1çš„è®°å½•ï¼Œ$R$å¼€å§‹æ—¶äº‹åŠ¡$I$å·²ç»æäº¤ï¼Œäº‹åŠ¡$J$è¿˜åœ¨è¿è¡Œï¼Œäº‹åŠ¡$K$è¿˜æ²¡å¼€å§‹ï¼Œè¿™äº›ä¿¡æ¯éƒ½è¢«è®°å½•åœ¨äº†äº‹åŠ¡$R$çš„ReadViewä¸­ã€‚äº‹åŠ¡$R$ä»ç´¢å¼•ä¸­æ‰¾åˆ°å¯¹åº”çš„è¿™æ¡$Record_{1,C}$ï¼Œå¯¹åº”çš„trx_idæ˜¯$K$ï¼Œä¸å¯è§ã€‚æ²¿ç€rollptræ‰¾åˆ°Undoä¸­çš„å‰ä¸€ç‰ˆæœ¬$Record_{1,B}$ï¼Œå¯¹åº”çš„trx_idæ˜¯$J$ï¼Œä¸å¯è§ã€‚ç»§ç»­æ²¿ç€rollptræ‰¾åˆ°$Record_{1,A}$ï¼Œtrx_idæ˜¯$I$å¯è§ï¼Œè¿”å›ç»“æœã€‚</p><p><img src="/assets/post_img/article123/undo_mvcc.png" alt=""></p><p>å‰é¢æåˆ°è¿‡ï¼Œä½œä¸ºé€»è¾‘æ—¥å¿—ï¼ŒUndoä¸­è®°å½•çš„å…¶å®æ˜¯å‰åä¸¤ä¸ªç‰ˆæœ¬çš„diffä¿¡æ¯ï¼Œè€Œè¯»æ“ä½œæœ€ç»ˆæ˜¯è¦è·å¾—å®Œæ•´çš„Recordå†…å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ²¿ç€rollptræŒ‡é’ˆä¸€è·¯æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­éœ€è¦ç”¨Undo Recordä¸­çš„diffå†…å®¹ä¾æ¬¡æ„é€ å‡ºå¯¹åº”çš„å†å²ç‰ˆæœ¬ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨å‡½æ•°row_search_mvccä¸­ï¼Œå…¶ä¸­trx_undo_prev_version_buildä¼šæ ¹æ®å½“å‰çš„rollptræ‰¾åˆ°å¯¹åº”çš„Undo Recordä½ç½®ï¼Œè¿™é‡Œå¦‚æœæ˜¯rollptræŒ‡å‘çš„æ˜¯insertç±»å‹ï¼Œæˆ–è€…æ‰¾åˆ°äº†å·²ç»Purgeäº†çš„ä½ç½®ï¼Œè¯´æ˜åˆ°å¤´äº†ï¼Œä¼šç›´æ¥è¿”å›å¤±è´¥ã€‚å¦åˆ™ï¼Œå°±ä¼šè§£æå¯¹åº”çš„Undo Recordï¼Œæ¢å¤å‡ºtrx_idã€æŒ‡å‘ä¸‹ä¸€æ¡Undo Recordçš„rollptrã€ä¸»é”®ä¿¡æ¯å’Œdiffä¿¡æ¯update vectorç­‰ä¿¡æ¯ã€‚ä¹‹åé€šè¿‡row_upd_rec_in_placeï¼Œç”¨update vectorä¿®æ”¹å½“å‰æŒæœ‰çš„Recordæ‹·è´ä¸­çš„ä¿¡æ¯ï¼Œè·å¾—Recordçš„è¿™ä¸ªå†å²ç‰ˆæœ¬ã€‚ä¹‹åè°ƒç”¨è‡ªå·±ReadViewçš„changes_visibleåˆ¤æ–­å¯è§æ€§ï¼Œå¦‚æœå¯è§åˆ™è¿”å›ç”¨æˆ·ã€‚å®Œæˆè¿™ä¸ªå†å²ç‰ˆæœ¬çš„è¯»å–ã€‚</p><p>TODOï¼šè¡¥å……å…³äºé”çš„å†…å®¹å’ŒMVCCçš„ç›¸å…³å†…å®¹ï¼Œå¹¶å‘äº‹åŠ¡é—®é¢˜-&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«-&gt;ï¼ˆéš”ç¦»çº§åˆ«è®¾ç½®ï¼‰-&gt;éš”ç¦»çº§åˆ«çš„å®ç°-&gt;é”ï¼ˆè¡¨ã€è¡Œã€é¡µï¼‰-&gt;MVCCï¼ˆéšè—å­—æ®µã€undoã€read viewï¼‰ã€‚[3]</p><h1 id="Springäº‹åŠ¡ä½¿ç”¨"><a href="#Springäº‹åŠ¡ä½¿ç”¨" class="headerlink" title="Springäº‹åŠ¡ä½¿ç”¨"></a>Springäº‹åŠ¡ä½¿ç”¨</h1><p>å…ˆä»‹ç»Springæ”¯æŒçš„ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œç„¶åä»‹ç»Springæä¾›çš„ä¸»è¦äº‹åŠ¡ç®¡ç†æ¥å£ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>@Transactional</code>æ³¨è§£æ¥å¼€å¯äº‹åŠ¡ï¼Œäºæ˜¯æˆ‘ä»¬ä»‹ç»è¿™ä¸ªæ³¨è§£ä¸­åŒ…å«çš„äº‹åŠ¡å±æ€§å‚æ•°ï¼ˆåŒ…æ‹¬éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰ç­‰é‡è¦å†…å®¹ï¼‰ï¼Œå¹¶ä»‹ç»å¦‚ä½•ä½¿ç”¨è¯¥æ³¨è§£ã€‚</p><h2 id="ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼"><a href="#ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼" class="headerlink" title="ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼"></a>ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼</h2><h3 id="ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†"><a href="#ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†"></a>ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†</h3><p>é€šè¿‡ <code>TransactionTemplate</code> æˆ–è€… <code>TransactionManager</code> æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œå®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚ä½¿ç”¨ <code>TransactionTemplate</code> è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ....  ä¸šåŠ¡ä»£ç </span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    <span class="comment">//å›æ»š</span></span><br><span class="line">                    transactionStatus.setRollbackOnly();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>TransactionManager</code> è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PlatformTransactionManager transactionManager;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  TransactionStatus status = transactionManager.getTransaction(<span class="keyword">new</span> DefaultTransactionDefinition());</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="comment">// ....  ä¸šåŠ¡ä»£ç </span></span><br><span class="line">              transactionManager.commit(status);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              transactionManager.rollback(status);</span><br><span class="line">          &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆå¸¸ç”¨ï¼‰"><a href="#å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆå¸¸ç”¨ï¼‰"></a>å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆå¸¸ç”¨ï¼‰</h3><p>ä»£ç ä¾µå…¥æ€§æœ€å°ï¼Œå®é™…æ˜¯é€šè¿‡ AOP å®ç°ï¼ˆåŸºäº<code>@Transactional</code>çš„å…¨æ³¨è§£æ–¹å¼ä½¿ç”¨æœ€å¤šï¼‰ã€‚</p><p>ä½¿ç”¨<code>@Transactional</code>æ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">  <span class="comment">//do something</span></span><br><span class="line">  B b = <span class="keyword">new</span> B();</span><br><span class="line">  C c = <span class="keyword">new</span> C();</span><br><span class="line">  b.bMethod();</span><br><span class="line">  c.cMethod();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-äº‹åŠ¡ç®¡ç†æ¥å£"><a href="#Spring-äº‹åŠ¡ç®¡ç†æ¥å£" class="headerlink" title="Spring äº‹åŠ¡ç®¡ç†æ¥å£"></a>Spring äº‹åŠ¡ç®¡ç†æ¥å£</h2><p>Spring æ¡†æ¶ä¸­ï¼Œäº‹åŠ¡ç®¡ç†ç›¸å…³æœ€é‡è¦çš„ 3 ä¸ªæ¥å£å¦‚ä¸‹ï¼š<code>PlatformTransactionManager</code>ï¼Œï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ï¼ŒSpring äº‹åŠ¡ç­–ç•¥çš„æ ¸å¿ƒï¼›<code>TransactionDefinition</code>ï¼Œäº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)ï¼›<code>TransactionStatus</code>ï¼Œäº‹åŠ¡è¿è¡ŒçŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ <code>PlatformTransactionManager</code> æ¥å£å¯ä»¥è¢«çœ‹ä½œæ˜¯äº‹åŠ¡ä¸Šå±‚çš„ç®¡ç†è€…ï¼Œè€Œ <code>TransactionDefinition</code> å’Œ <code>TransactionStatus</code> è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥çœ‹ä½œæ˜¯äº‹åŠ¡çš„æè¿°ã€‚<code>PlatformTransactionManager</code> ä¼šæ ¹æ® <code>TransactionDefinition</code> çš„å®šä¹‰æ¯”å¦‚äº‹åŠ¡è¶…æ—¶æ—¶é—´ã€éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç† ï¼Œè€Œ <code>TransactionStatus</code> æ¥å£åˆ™æä¾›äº†ä¸€äº›æ–¹æ³•æ¥è·å–äº‹åŠ¡ç›¸åº”çš„çŠ¶æ€æ¯”å¦‚æ˜¯å¦æ–°äº‹åŠ¡ã€æ˜¯å¦å¯ä»¥å›æ»šç­‰ç­‰ã€‚</p><h3 id="PlatformTransactionManager-äº‹åŠ¡ç®¡ç†å™¨æ¥å£"><a href="#PlatformTransactionManager-äº‹åŠ¡ç®¡ç†å™¨æ¥å£" class="headerlink" title="PlatformTransactionManager - äº‹åŠ¡ç®¡ç†å™¨æ¥å£"></a><code>PlatformTransactionManager</code> - äº‹åŠ¡ç®¡ç†å™¨æ¥å£</h3><p>Spring å¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpring ä¸ºå„ä¸ªå¹³å°å¦‚ï¼šJDBC(<code>DataSourceTransactionManager</code>)ã€Hibernate(<code>HibernateTransactionManager</code>)ã€JPA(<code>JpaTransactionManager</code>)ç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚å°†äº‹åŠ¡ç®¡ç†è¡Œä¸ºæŠ½è±¡å‡ºæ¥æ–¹ä¾¿ç¨‹åºæ‰©å±•ã€‚</p><p><code>PlatformTransactionManager</code>æ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlatformTransactionManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å¾—äº‹åŠ¡</span></span><br><span class="line">    <span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(<span class="meta">@Nullable</span> TransactionDefinition var1)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">    <span class="comment">//æäº¤äº‹åŠ¡</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus var1)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">    <span class="comment">//å›æ»šäº‹åŠ¡</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus var1)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TransactionDefinition-äº‹åŠ¡å±æ€§å®šä¹‰"><a href="#TransactionDefinition-äº‹åŠ¡å±æ€§å®šä¹‰" class="headerlink" title="TransactionDefinition - äº‹åŠ¡å±æ€§å®šä¹‰"></a><code>TransactionDefinition</code> - äº‹åŠ¡å±æ€§å®šä¹‰</h3><p>äº‹åŠ¡ç®¡ç†å™¨æ¥å£ <code>PlatformTransactionManager</code> é€šè¿‡ <code>getTransaction(TransactionDefinition definition)</code> æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ˜¯ `TransactionDefinition</p><p>äº‹åŠ¡å±æ€§å¯ä»¥ç†è§£æˆäº‹åŠ¡çš„ä¸€äº›åŸºæœ¬é…ç½®ï¼Œæè¿°äº†äº‹åŠ¡ç­–ç•¥å¦‚ä½•åº”ç”¨åˆ°æ–¹æ³•ä¸Šã€‚</p><p>äº‹åŠ¡å±æ€§åŒ…å«äº† 5 ä¸ªæ–¹é¢ï¼š</p><ul><li>éš”ç¦»çº§åˆ«</li><li>ä¼ æ’­è¡Œä¸º</li><li>å›æ»šè§„åˆ™</li><li>æ˜¯å¦åªè¯»</li><li>äº‹åŠ¡è¶…æ—¶</li></ul><p><code>TransactionDefinition</code> æ¥å£ä¸­å®šä¹‰äº† 5 ä¸ªæ–¹æ³•ä»¥åŠä¸€äº›è¡¨ç¤ºäº‹åŠ¡å±æ€§çš„å¸¸é‡æ¯”å¦‚éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_COMMITTED = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_REPEATABLE_READ = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_SERIALIZABLE = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">int</span> TIMEOUT_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼æ˜¯ DEFAULT</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TransactionStatus-äº‹åŠ¡çŠ¶æ€"><a href="#TransactionStatus-äº‹åŠ¡çŠ¶æ€" class="headerlink" title="TransactionStatus - äº‹åŠ¡çŠ¶æ€"></a><code>TransactionStatus</code> - äº‹åŠ¡çŠ¶æ€</h3><p><code>TransactionStatus</code>æ¥å£ç”¨æ¥è®°å½•äº‹åŠ¡çš„çŠ¶æ€ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥è·å–æˆ–åˆ¤æ–­äº‹åŠ¡çš„ç›¸åº”çŠ¶æ€ä¿¡æ¯ã€‚<code>PlatformTransactionManager.getTransaction()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª <code>TransactionStatus</code> å¯¹è±¡ã€‚<code>TransactionStatus</code> æ¥å£å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æ˜¯æ–°çš„äº‹åŠ¡</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æœ‰æ¢å¤ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;  <span class="comment">// è®¾ç½®ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="keyword">boolean</span> isCompleted; <span class="comment">// æ˜¯å¦å·²å®Œæˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº‹åŠ¡å±æ€§è¯¦è§£"><a href="#äº‹åŠ¡å±æ€§è¯¦è§£" class="headerlink" title="äº‹åŠ¡å±æ€§è¯¦è§£"></a>äº‹åŠ¡å±æ€§è¯¦è§£</h2><p><code>@Transactional</code>ä¸­åŒ…å«çš„äº‹åŠ¡å±æ€§å‚æ•°ã€‚</p><h3 id="äº‹åŠ¡ä¼ æ’­è¡Œä¸º"><a href="#äº‹åŠ¡ä¼ æ’­è¡Œä¸º" class="headerlink" title="äº‹åŠ¡ä¼ æ’­è¡Œä¸º"></a>äº‹åŠ¡ä¼ æ’­è¡Œä¸º</h3><p><strong>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚</strong></p><p>å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ A ç±»çš„<code>aMethod()</code>ä¸­è°ƒç”¨äº† B ç±»çš„<code>bMethod()</code>ã€‚è¿™ä¸ªæ—¶å€™å°±æ¶‰åŠåˆ°ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚å¦‚æœ<code>bMethod()</code>å‘ç”Ÿå¼‚å¸¸éœ€è¦å›æ»šï¼Œå¦‚ä½•é…ç½®äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ‰èƒ½è®©<code>aMethod()</code>ä¹Ÿè·Ÿç€å›æ»šå‘¢ï¼Ÿä¸‹é¢æ¥çœ‹ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class A &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    B b;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.xxx)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        b.bMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class B &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.xxx)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bMethod &#123;</span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>TransactionDefinition</code>å®šä¹‰ä¸­åŒ…æ‹¬äº†å¦‚ä¸‹å‡ ä¸ªè¡¨ç¤ºä¼ æ’­è¡Œä¸ºçš„å¸¸é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring ç›¸åº”åœ°å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼š<code>Propagation</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.TransactionDefinition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Propagation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</span></span><br><span class="line">    REQUIRED(TransactionDefinition.PROPAGATION_REQUIRED),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</span></span><br><span class="line">    SUPPORTS(TransactionDefinition.PROPAGATION_SUPPORTS),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">    MANDATORY(TransactionDefinition.PROPAGATION_MANDATORY),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</span></span><br><span class="line">    REQUIRES_NEW(TransactionDefinition.PROPAGATION_REQUIRES_NEW),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</span></span><br><span class="line">    NOT_SUPPORTED(TransactionDefinition.PROPAGATION_NOT_SUPPORTED),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">    NEVER(TransactionDefinition.PROPAGATION_NEVER),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</span></span><br><span class="line">    NESTED(TransactionDefinition.PROPAGATION_NESTED);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    Propagation(<span class="keyword">int</span> value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¯èƒ½çš„å€¼å¦‚ä¸‹ï¼š</p><p>1.<code>TransactionDefinition.PROPAGATION_REQUIRED</code></p><p><code>@Transactional</code>æ³¨è§£é»˜è®¤ä½¿ç”¨çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>å¦‚æœå¤–éƒ¨æ–¹æ³•æ²¡æœ‰å¼€å¯äº‹åŠ¡çš„è¯ï¼Œ<code>Propagation.REQUIRED</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚</li><li>å¦‚æœå¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡å¹¶ä¸”è¢«<code>Propagation.REQUIRED</code>çš„è¯ï¼Œæ‰€æœ‰<code>Propagation.REQUIRED</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å’Œå¤–éƒ¨æ–¹æ³•å‡å±äºåŒä¸€äº‹åŠ¡ï¼Œåªè¦ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»šã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class A &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    B b;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        b.bMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class B &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bMethod &#123;</span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šé¢çš„<code>aMethod()</code>å’Œ<code>bMethod()</code>ä½¿ç”¨çš„éƒ½æ˜¯<code>PROPAGATION_REQUIRED</code>ä¼ æ’­è¡Œä¸ºçš„è¯ï¼Œä¸¤è€…ä½¿ç”¨çš„å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»šã€‚</p><p>2.<code>TransactionDefinition.PROPAGATION_REQUIRES_NEW</code></p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡å¤–éƒ¨æ–¹æ³•æ˜¯å¦å¼€å¯äº‹åŠ¡ï¼Œ<code>Propagation.REQUIRES_NEW</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class A &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    B b;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        b.bMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class B &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bMethod &#123;</span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šé¢çš„<code>bMethod()</code>ä½¿ç”¨<code>PROPAGATION_REQUIRES_NEW</code>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¿®é¥°ï¼Œ<code>aMethod()</code>è¿˜æ˜¯ç”¨<code>PROPAGATION_REQUIRED</code>ä¿®é¥°çš„è¯ã€‚å¦‚æœ<code>aMethod()</code>å‘ç”Ÿå¼‚å¸¸å›æ»šï¼Œ<code>bMethod()</code>ä¸ä¼šè·Ÿç€å›æ»šï¼Œå› ä¸º<code>bMethod()</code>å¼€å¯äº†ç‹¬ç«‹çš„äº‹åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœ<code>bMethod()</code>æŠ›å‡ºäº†æœªè¢«æ•è·çš„å¼‚å¸¸å¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ»¡è¶³äº‹åŠ¡å›æ»šè§„åˆ™çš„è¯ï¼Œ<code>aMethod()</code>åŒæ ·ä¹Ÿä¼šå›æ»šï¼Œå› ä¸ºè¿™ä¸ªå¼‚å¸¸è¢«<code>aMethod()</code>çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶æ£€æµ‹åˆ°äº†ã€‚</p><p>3.<code>TransactionDefinition.PROPAGATION_NESTED</code></p><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ‰§è¡Œä¸<code>TransactionDefinition.PROPAGATION_REQUIRED</code>ç±»ä¼¼çš„æ“ä½œã€‚åµŒå¥—äº‹åŠ¡å›æ»šä¸å½±å“å¤–éƒ¨äº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>åœ¨å¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œåœ¨å†…éƒ¨å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ã€‚</li><li>å¦‚æœå¤–éƒ¨æ–¹æ³•æ— äº‹åŠ¡ï¼Œåˆ™å•ç‹¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class A &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    B b;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        b.bMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line">Class B &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.NESTED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bMethod &#123;</span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœ <code>bMethod()</code> å›æ»šçš„è¯ï¼Œ<code>aMethod()</code>ä¸ä¼šå›æ»šã€‚å¦‚æœ<code>aMethod()</code>å›æ»šçš„è¯ï¼Œ<code>bMethod()</code>ä¼šå›æ»šã€‚</p><p>4.<code>TransactionDefinition.PROPAGATION_MANDATORY</code><br>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ç§æ–¹å¼è¿˜æ˜¯èƒ½ä¿è¯å…¨éƒ¨å›æ»šçš„ï¼Œä¸‹é¢çš„ä¸‰ç§åˆ™ä¸ä¸€å®šäº†ï¼Œéœ€è¦çœ‹æƒ…å†µä½¿ç”¨ã€‚</p><p>5.<code>TransactionDefinition.PROPAGATION_SUPPORTS</code><br>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</p><p>6.<code>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</code><br>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p><p>7.<code>TransactionDefinition.PROPAGATION_NEVER</code><br>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p><code>TransactionDefinition</code> æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_COMMITTED = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_REPEATABLE_READ = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_SERIALIZABLE = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸€æ ·ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring ä¹Ÿç›¸åº”åœ°å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼š<code>Isolation</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Isolation</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  DEFAULT(TransactionDefinition.ISOLATION_DEFAULT),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¯»æœªæäº¤</span></span><br><span class="line">  READ_UNCOMMITTED(TransactionDefinition.ISOLATION_READ_UNCOMMITTED),</span><br><span class="line">  <span class="comment">// è¯»å·²æäº¤</span></span><br><span class="line">  READ_COMMITTED(TransactionDefinition.ISOLATION_READ_COMMITTED),</span><br><span class="line">  <span class="comment">// å¯é‡å¤è¯»</span></span><br><span class="line">  REPEATABLE_READ(TransactionDefinition.ISOLATION_REPEATABLE_READ),</span><br><span class="line">  <span class="comment">// å¯ä¸²è¡Œ</span></span><br><span class="line">  SERIALIZABLE(TransactionDefinition.ISOLATION_SERIALIZABLE);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">  Isolation(<span class="keyword">int</span> value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡å¯¹æ¯ä¸€ç§äº‹åŠ¡éš”ç¦»çº§åˆ«è¿›è¡Œä»‹ç»ï¼š</p><ul><li><code>TransactionDefinition.ISOLATION_DEFAULT</code>ï¼šä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ <code>REPEATABLE_READ</code> éš”ç¦»çº§åˆ«ï¼ŒOracle é»˜è®¤é‡‡ç”¨çš„ <code>READ_COMMITTED</code> éš”ç¦»çº§åˆ«ã€‚</li><li><code>TransactionDefinition.ISOLATION_READ_UNCOMMITTED</code>ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«å¾ˆå°‘ï¼Œå› ä¸ºå®ƒå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</li><li><code>TransactionDefinition.ISOLATION_READ_COMMITTED</code>ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li><code>TransactionDefinition.ISOLATION_REPEATABLE_READ</code>ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li><code>TransactionDefinition.ISOLATION_SERIALIZABLE</code>ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚</li></ul><h3 id="äº‹åŠ¡è¶…æ—¶å±æ€§"><a href="#äº‹åŠ¡è¶…æ—¶å±æ€§" class="headerlink" title="äº‹åŠ¡è¶…æ—¶å±æ€§"></a>äº‹åŠ¡è¶…æ—¶å±æ€§</h3><p>æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚åœ¨ <code>TransactionDefinition</code> ä¸­ä»¥æ•´å‹çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º<code>-1</code>ï¼Œè¿™è¡¨ç¤ºäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´å–å†³äºåº•å±‚äº‹åŠ¡ç³»ç»Ÿæˆ–è€…æ²¡æœ‰è¶…æ—¶æ—¶é—´ã€‚</p><h3 id="äº‹åŠ¡åªè¯»å±æ€§"><a href="#äº‹åŠ¡åªè¯»å±æ€§" class="headerlink" title="äº‹åŠ¡åªè¯»å±æ€§"></a>äº‹åŠ¡åªè¯»å±æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºåªæœ‰è¯»å–æ•°æ®æŸ¥è¯¢çš„äº‹åŠ¡ï¼Œå¯ä»¥æŒ‡å®šäº‹åŠ¡ç±»å‹ä¸º <code>readonly</code>ï¼Œå³åªè¯»äº‹åŠ¡ã€‚åªè¯»äº‹åŠ¡ä¸æ¶‰åŠæ•°æ®çš„ä¿®æ”¹ï¼Œæ•°æ®åº“ä¼šæä¾›ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œé€‚åˆç”¨åœ¨æœ‰å¤šæ¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ä¸­ã€‚</p><p>ä¸ºä»€ä¹ˆæ•°æ®æŸ¥è¯¢æ“ä½œè¿˜è¦å¯ç”¨äº‹åŠ¡æ”¯æŒå‘¢ï¼Ÿæ‹¿Innodbä¸¾ä¾‹å­ï¼Œæ ¹æ®<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-autocommit-commit-rollback.html">å®˜ç½‘</a>æè¿°ï¼š</p><blockquote><p>MySQL é»˜è®¤å¯¹æ¯ä¸€ä¸ªæ–°å»ºç«‹çš„è¿æ¥éƒ½å¯ç”¨äº†<code>autocommit</code>æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªå‘é€åˆ° MySQL æœåŠ¡å™¨çš„sqlè¯­å¥éƒ½ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ä¸­è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p></blockquote><p>ä½†æ˜¯ï¼Œå¦‚æœä½ ç»™æ–¹æ³•åŠ ä¸Šäº†<code>@Transactional</code>æ³¨è§£çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ‰€æœ‰sqlä¼šè¢«æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚æœå£°æ˜äº†åªè¯»äº‹åŠ¡çš„è¯ï¼Œæ•°æ®åº“å°±ä¼šå»ä¼˜åŒ–å®ƒçš„æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå¸¦æ¥å…¶ä»–çš„ä»€ä¹ˆæ”¶ç›Šã€‚</p><p>å¦‚æœä¸åŠ <code>@Transactional</code>ï¼Œæ¯æ¡sqlä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œä¸­é—´è¢«å…¶å®ƒäº‹åŠ¡æ”¹äº†æ•°æ®ï¼Œéƒ½ä¼šå®æ—¶è¯»å–åˆ°æœ€æ–°å€¼ã€‚</p><p>åˆ†äº«ä¸€ä¸‹å…³äºäº‹åŠ¡åªè¯»å±æ€§ï¼Œå…¶ä»–äººçš„è§£ç­”ï¼š</p><ul><li>å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå•æ¡æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ²¡æœ‰å¿…è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®åº“é»˜è®¤æ”¯æŒ SQL æ‰§è¡ŒæœŸé—´çš„è¯»ä¸€è‡´æ€§ï¼›</li><li>å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ç»Ÿè®¡æŸ¥è¯¢ï¼ŒæŠ¥è¡¨æŸ¥è¯¢ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤šæ¡æŸ¥è¯¢ SQL å¿…é¡»ä¿è¯æ•´ä½“çš„è¯»ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œåœ¨å‰æ¡ SQL æŸ¥è¯¢ä¹‹åï¼Œåæ¡ SQL æŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¯¥æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡ºç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œåº”è¯¥å¯ç”¨äº‹åŠ¡æ”¯æŒã€‚</li></ul><h3 id="äº‹åŠ¡å›æ»šè§„åˆ™"><a href="#äº‹åŠ¡å›æ»šè§„åˆ™" class="headerlink" title="äº‹åŠ¡å›æ»šè§„åˆ™"></a>äº‹åŠ¡å›æ»šè§„åˆ™</h3><p>è¿™äº›è§„åˆ™å®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ï¼ˆ<code>RuntimeException</code> çš„å­ç±»ï¼‰æ—¶æ‰ä¼šå›æ»šï¼Œ<code>Error</code>ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯ï¼Œåœ¨é‡åˆ°æ£€æŸ¥å‹ï¼ˆCheckedï¼‰å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šã€‚</p><p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å›æ»šç‰¹å®šçš„å¼‚å¸¸ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor= MyException.class)</span></span><br></pre></td></tr></table></figure><h2 id="Transactional-æ³¨è§£ä½¿ç”¨è¯¦è§£"><a href="#Transactional-æ³¨è§£ä½¿ç”¨è¯¦è§£" class="headerlink" title="@Transactional æ³¨è§£ä½¿ç”¨è¯¦è§£"></a><code>@Transactional</code> æ³¨è§£ä½¿ç”¨è¯¦è§£</h2><h3 id="Transactional-çš„ä½œç”¨èŒƒå›´"><a href="#Transactional-çš„ä½œç”¨èŒƒå›´" class="headerlink" title="@Transactional çš„ä½œç”¨èŒƒå›´"></a><code>@Transactional</code> çš„ä½œç”¨èŒƒå›´</h3><ol><li>æ–¹æ³•ï¼šæ¨èå°†æ³¨è§£ä½¿ç”¨äºæ–¹æ³•ä¸Šï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ³¨è§£åªèƒ½åº”ç”¨åˆ° <code>public</code> æ–¹æ³•ä¸Šï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</li><li>ç±»ï¼šå¦‚æœè¿™ä¸ªæ³¨è§£ä½¿ç”¨åœ¨ç±»ä¸Šçš„è¯ï¼Œè¡¨æ˜è¯¥æ³¨è§£å¯¹è¯¥ç±»ä¸­æ‰€æœ‰çš„ <code>public</code> æ–¹æ³•éƒ½ç”Ÿæ•ˆã€‚</li><li>æ¥å£ï¼šä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ã€‚</li></ol><h3 id="Transactional-çš„å¸¸ç”¨é…ç½®å‚æ•°"><a href="#Transactional-çš„å¸¸ç”¨é…ç½®å‚æ•°" class="headerlink" title="@Transactional çš„å¸¸ç”¨é…ç½®å‚æ•°"></a><code>@Transactional</code> çš„å¸¸ç”¨é…ç½®å‚æ•°</h3><p><code>@Transactional</code>æ³¨è§£æºç å¦‚ä¸‹ï¼Œé‡Œé¢åŒ…å«äº†åŸºæœ¬äº‹åŠ¡å±æ€§çš„é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AliasFor(&quot;transactionManager&quot;)</span></span><br><span class="line"><span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line"><span class="function">String <span class="title">transactionManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Propagation <span class="title">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Isolation <span class="title">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">timeout</span><span class="params">()</span> <span class="keyword">default</span> TransactionDefinition.TIMEOUT_DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">Class&lt;? extends Throwable&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Class&lt;? extends Throwable&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨é…ç½®å‚æ•°å³ï¼špropagationã€isolationã€timeoutã€readOnlyã€rollbackForï¼Œå…·ä½“å†…å®¹ä¸ŠèŠ‚å·²åˆ—å‡ºã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://javaguide.cn/system-design/framework/spring/spring-transaction.html">https://javaguide.cn/system-design/framework/spring/spring-transaction.html</a><br>[2] <a href="https://blog.csdn.net/ITcreater000/article/details/115338657">https://blog.csdn.net/ITcreater000/article/details/115338657</a><br>[3] <a href="https://www.cnblogs.com/rickiyang/p/13652664.html">https://www.cnblogs.com/rickiyang/p/13652664.html</a><br>[4] <a href="https://dl.acm.org/doi/10.1145/289.291">https://dl.acm.org/doi/10.1145/289.291</a><br>[5] <a href="https://juejin.cn/post/6860252224930070536">https://juejin.cn/post/6860252224930070536</a><br>[6] <a href="https://spongecaptain.cool/post/database/logicalandphicallog/">https://spongecaptain.cool/post/database/logicalandphicallog/</a><br>[7] <a href="https://www.jianshu.com/p/646961b93c7e">https://www.jianshu.com/p/646961b93c7e</a><br>[8] <a href="https://zhuanlan.zhihu.com/p/394388285">https://zhuanlan.zhihu.com/p/394388285</a><br>[9] <a href="https://blog.csdn.net/qq_24854607/article/details/114639318">https://blog.csdn.net/qq_24854607/article/details/114639318</a><br>[10] <a href="https://blog.csdn.net/m0_71777195/article/details/130842268">https://blog.csdn.net/m0_71777195/article/details/130842268</a><br>[11] <a href="https://www.cnblogs.com/f66666/articles/10993873.html">https://www.cnblogs.com/f66666/articles/10993873.html</a><br>[12] <a href="http://catkang.github.io/2021/10/30/mysql-undo.html">http://catkang.github.io/2021/10/30/mysql-undo.html</a><br>[13] <a href="http://catkang.github.io/2020/02/27/mysql-redo.html">http://catkang.github.io/2020/02/27/mysql-redo.html</a><br>[14] <a href="http://catkang.github.io/2018/09/19/concurrency-control.html">http://catkang.github.io/2018/09/19/concurrency-control.html</a><br>[15] <a href="https://catkang.github.io/2023/08/08/mysql-buffer-pool.html">https://catkang.github.io/2023/08/08/mysql-buffer-pool.html</a><br>[16] <a href="https://mariadb.com/kb/en/innodb-undo-log">https://mariadb.com/kb/en/innodb-undo-log</a><br>[17] <a href="https://javaguide.cn/system-design/framework/spring/spring-transaction.html">https://javaguide.cn/system-design/framework/spring/spring-transaction.html</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è°ˆè®ºä¸€åˆ‡ä¹‹å‰ï¼Œä½¿ç”¨çš„æ•°æ®åº“ä¸€å®šè¦æ”¯æŒäº‹åŠ¡ï¼Œæœ¬æ–‡ä»¥MySQL InnoDBå­˜å‚¨å¼•æ“ä¸ºä¾‹ï¼Œä»æ•°æ®åº“äº‹åŠ¡åŸºæœ¬åŸç†å‡ºå‘ï¼Œç®€è¦è¯´æ˜äº‹åŠ¡ç›¸å…³çš„ä¸»è¦çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•åœ¨Springé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå¯¹äºç»†èŠ‚çš„æè¿°å°‘ä¸”æ¨¡ç³Šï¼Œéœ€è¦ä¸æ–­å®Œå–„ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³å†…å®¹ï¼šInnoDBäº‹åŠ¡å®ç°ã€Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶ç­‰ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Spring" scheme="http://silencezheng.top/tags/Spring/"/>
    
    <category term="MySQL" scheme="http://silencezheng.top/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Optionalä½¿ç”¨å…¥é—¨</title>
    <link href="http://silencezheng.top/2023/09/14/article122/"/>
    <id>http://silencezheng.top/2023/09/14/article122/</id>
    <published>2023-09-14T15:08:57.000Z</published>
    <updated>2023-09-14T15:11:44.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Optional æ˜¯ Java 8 å¼•è¿›çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œå¯ä»¥åŒ…å«æˆ–ä¸åŒ…å«éç©ºå€¼ã€‚</p><span id="more"></span><h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><p>Optionalçš„æœºåˆ¶ç±»ä¼¼äºå—æ£€å¼‚å¸¸ï¼Œå¼ºè¿«APIè°ƒç”¨è€…é¢å¯¹æ²¡æœ‰è¿”å›å€¼çš„ç°å®ï¼Œå› ä¸ºç¨‹åºç›´æ¥è¿”å› null å¾ˆå¯èƒ½å¯¼è‡´è°ƒç”¨ç«¯äº§ç”Ÿé”™è¯¯ï¼ˆç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ï¼‰ã€‚</p><p>Optional æ˜¯ç”¨æ¥ä½œä¸ºæ–¹æ³•è¿”å›å€¼çš„ï¼Œç›®çš„æ˜¯æ¸…æ™°åœ°è¡¨è¾¾è¿”å›å€¼ä¸­æ²¡æœ‰ç»“æœçš„å¯èƒ½æ€§ã€‚</p><h2 id="å¸¸ç”¨æ–¹æ³•åŠè°ƒç”¨æ–¹å¼"><a href="#å¸¸ç”¨æ–¹æ³•åŠè°ƒç”¨æ–¹å¼" class="headerlink" title="å¸¸ç”¨æ–¹æ³•åŠè°ƒç”¨æ–¹å¼"></a>å¸¸ç”¨æ–¹æ³•åŠè°ƒç”¨æ–¹å¼</h2><ul><li><p><code>of(value)</code>ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šéç©ºå€¼çš„ <code>Optional</code> å¯¹è±¡ã€‚</p></li><li><p><code>ofNullable(value)</code>ï¼šåˆ›å»ºä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„ <code>Optional</code> å¯¹è±¡ã€‚å¦‚æœä¼ å…¥çš„å€¼ä¸º <code>null</code>ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ <code>Optional</code>ã€‚</p></li><li><p><code>empty()</code>ï¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ <code>Optional</code> å¯¹è±¡ã€‚</p></li><li><p><code>isPresent()</code>ï¼šæ£€æŸ¥ <code>Optional</code> å¯¹è±¡æ˜¯å¦åŒ…å«å€¼ã€‚</p></li><li><p><code>get()</code>ï¼šè·å– <code>Optional</code> å¯¹è±¡ä¸­çš„å€¼ã€‚åœ¨è°ƒç”¨ä¹‹å‰åº”å…ˆä½¿ç”¨ <code>isPresent()</code> è¿›è¡Œåˆ¤æ–­ã€‚</p></li></ul><p><code>Optional</code> æ”¯æŒæ–¹æ³•é“¾å¼è°ƒç”¨ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ç³»åˆ—æ“ä½œä¸­è¿›è¡Œç©ºå€¼æ£€æŸ¥å’Œè½¬æ¢ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalValue = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (optionalValue.isPresent()) &#123;</span><br><span class="line">    String value = optionalValue.get();</span><br><span class="line">    System.out.println(value); <span class="comment">// è¾“å‡ºï¼šHello</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; nullableValue = Optional.ofNullable(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">String result = nullableValue.orElse(<span class="string">&quot;Default Value&quot;</span>);</span><br><span class="line">System.out.println(result); <span class="comment">// è¾“å‡ºï¼šDefault Value</span></span><br></pre></td></tr></table></figure><p>é™¤äº†å¸¸ç”¨æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å¯¹<code>Optional</code>å¯¹è±¡è¿›è¡Œå¿«æ·æ“ä½œï¼Œå¦‚ä¸Šé¢å‡ºç°çš„<code>orElse</code>ï¼Œä¸‹é¢ä»‹ç»å…¶ä¸­ä¸€äº›ã€‚</p><ul><li><p><code>orElse(T other)</code>ï¼šå¦‚æœåŒ…å«çš„å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ <code>other</code>ã€‚æ— è®ºå€¼æ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šè¿›è¡Œè®¡ç®—ï¼Œå¹¶è¿”å›ç»“æœã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalValue = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">String value = optionalValue.orElse(<span class="string">&quot;Default Value&quot;</span>);</span><br><span class="line">System.out.println(value); <span class="comment">// è¾“å‡ºï¼šHello</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; emptyOptional = Optional.empty();</span><br><span class="line">String defaultValue = emptyOptional.orElse(<span class="string">&quot;Default Value&quot;</span>);</span><br><span class="line">System.out.println(defaultValue); <span class="comment">// è¾“å‡ºï¼šDefault Value</span></span><br></pre></td></tr></table></figure></li><li><p><code>orElseGet(Supplier&lt;? extends T&gt; other)</code>ï¼šå¦‚æœåŒ…å«çš„å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æä¾›çš„ <code>Supplier</code> å‡½æ•°æ¥è®¡ç®—å¹¶è¿”å›å€¼ã€‚ä¸ <code>orElse()</code> ç±»ä¼¼ï¼Œä½†åœ¨å€¼ä¸å­˜åœ¨æ—¶ï¼Œ<code>Supplier</code> å‡½æ•°æ‰ä¼šè¢«è°ƒç”¨ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalValue = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">String value = optionalValue.orElseGet(() -&gt; expensiveOperation());</span><br><span class="line">System.out.println(value); <span class="comment">// è¾“å‡ºï¼šHello</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; emptyOptional = Optional.empty();</span><br><span class="line">String computedValue = emptyOptional.orElseGet(() -&gt; expensiveOperation());</span><br><span class="line">System.out.println(computedValue); <span class="comment">// è°ƒç”¨ expensiveOperation() æ–¹æ³•ï¼Œå¹¶è¾“å‡ºå…¶è¿”å›å€¼</span></span><br></pre></td></tr></table></figure></li><li><p><code>orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier)</code>ï¼šå¦‚æœåŒ…å«çš„å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ã€‚é€šè¿‡æä¾›ä¸€ä¸ªexceptionSupplieræ¥ç”Ÿæˆå¼‚å¸¸å¯¹è±¡ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalValue = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">String value = optionalValue.orElseThrow(() -&gt; <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Value not found&quot;</span>));</span><br><span class="line">System.out.println(value); <span class="comment">// è¾“å‡ºï¼šHello</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; emptyOptional = Optional.empty();</span><br><span class="line">String computedValue = emptyOptional.orElseThrow(() -&gt; <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Value not found&quot;</span>)); <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br></pre></td></tr></table></figure></li><li><p><code>ifPresent(Consumer&lt;? super T&gt; consumer)</code>ï¼šæ¥å—ä¸€ä¸ª Consumer å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨åŒ…å«çš„å€¼å­˜åœ¨æ—¶æ‰§è¡Œè¯¥å‡½æ•°ã€‚è¯¥æ–¹æ³•æ— è¿”å›å€¼ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optionalValue = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">optionalValue.ifPresent(value -&gt; System.out.println(<span class="string">&quot;Value is present: &quot;</span> + value)); <span class="comment">// è¾“å‡ºï¼šValue is present: Hello</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; emptyOptional = Optional.empty();</span><br><span class="line">emptyOptional.ifPresent(value -&gt; System.out.println(<span class="string">&quot;Value is present: &quot;</span> + value)); <span class="comment">// ç”±äºå€¼ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p>1ã€ä¸è¦ä½¿ç”¨<code>Optional</code>ä½œä¸ºJava Beanå®ä¾‹åŸŸçš„ç±»å‹<br>å³é¿å…ä»¥ä¸‹è¿™ç§ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AVOID</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    [access_modifier] [<span class="keyword">static</span>] [<span class="keyword">final</span>] Optional&lt;String&gt; zip;</span><br><span class="line">    [access_modifier] [<span class="keyword">static</span>] [<span class="keyword">final</span>] Optional&lt;String&gt; telephone = Optional.empty();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸º <code>Optional</code> æ²¡æœ‰å®ç°Serializableæ¥å£ï¼ˆä¸å¯åºåˆ—åŒ–ï¼‰</p><p>2ã€ä¸è¦æŠŠå®¹å™¨ç±»å‹åŒ…è£…åœ¨<code>Optional</code>ä¸­<br>å³é¿å…ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AVOID</span></span><br><span class="line"><span class="keyword">public</span> Optional&lt;List&lt;String&gt;&gt; fetchCartItems(<span class="keyword">long</span> id) &#123;</span><br><span class="line">    Cart cart = ... ;    </span><br><span class="line">    List&lt;String&gt; items = cart.getItems(); <span class="comment">// this may return null</span></span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(items);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸ºå®¹å™¨ç±»éƒ½æœ‰è‡ªå·±ç©ºå€¼è®¾è®¡ï¼Œå¦‚ <code>Collections.emptyList() Collections.emptySet() Collections.emptyMap() Stream.empty()</code> ç­‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PREFER</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">fetchCartItems</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">    Cart cart = ... ;    </span><br><span class="line">    List&lt;String&gt; items = cart.getItems(); <span class="comment">// this may return null</span></span><br><span class="line">    <span class="keyword">return</span> items == <span class="keyword">null</span> ? Collections.emptyList() : items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3ã€ä¸è¦ç»™<code>Optional</code>å¯¹è±¡èµ‹å€¼ null<br>é¿å…ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AVOID</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Optional&lt;Cart&gt; <span class="title">fetchCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Optional&lt;Cart&gt; emptyCart = <span class="keyword">null</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è€Œåº”è¯¥ç”¨ <code>Optional.empty()</code> è¡¨è¾¾ç©ºå€¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PREFER</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Optional&lt;Cart&gt; <span class="title">fetchCart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Optional&lt;Cart&gt; emptyCart = Optional.empty();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>4ã€å°½é‡ä½¿ç”¨<code>Optional</code>æä¾›çš„å¿«æ·APIé¿å…æ‰‹å†™æ¡ä»¶è¯­å¥<br>ä»£ç æ›´ç®€æ´ã€‚</p><p>5ã€ä½¿ç”¨ <code>equals</code> è€Œä¸æ˜¯ <code>==</code> æ¥æ¯”è¾ƒ <code>Optional</code> çš„å€¼<br><code>Optional</code> çš„ <code>equals</code> æ–¹æ³•å·²ç»å®ç°äº†å†…éƒ¨å€¼æ¯”è¾ƒã€‚</p><p>6ã€å¯¹äºå¯èƒ½æ˜¯ç©ºå€¼çš„å‡½æ•°è¿”å›ä½¿ç”¨<code>Optional</code><br>å¯¹äºè¯»å–å€¼ç±»å‹çš„å‡½æ•°ä½¿ç”¨æ˜¯å¾ˆå¥½çš„å®è·µã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html</a><br>[2] <a href="https://zhuanlan.zhihu.com/p/128481434">https://zhuanlan.zhihu.com/p/128481434</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Optional æ˜¯ Java 8 å¼•è¿›çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œå¯ä»¥åŒ…å«æˆ–ä¸åŒ…å«éç©ºå€¼ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>LombokåŸç†ç®€æ</title>
    <link href="http://silencezheng.top/2023/09/11/article121/"/>
    <id>http://silencezheng.top/2023/09/11/article121/</id>
    <published>2023-09-11T13:32:25.000Z</published>
    <updated>2023-09-11T13:36:03.780Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Lombokå®ç°åŸç†ç®€æã€‚<br><span id="more"></span></p><h2 id="JCPä¸JSR"><a href="#JCPä¸JSR" class="headerlink" title="JCPä¸JSR"></a>JCPä¸JSR</h2><p>JCPï¼ˆJava Community Processï¼‰æ˜¯ç®¡ç† Java ç”Ÿæ€ï¼ˆåŒ…æ‹¬ J2SEã€J2EE ç­‰ç­‰ï¼‰å‘å±•åŠæŒ‡å¯¼å’Œæ¨åŠ¨Javaå¹³å°å‘å±•çš„åˆä½œç»„ç»‡ï¼Œè€ŒJSRï¼ˆJava Specification Requestï¼‰åˆ™æ˜¯ç”±JCPæå‡ºçš„ä¸€ç§è§„èŒƒè¯·æ±‚ã€‚</p><blockquote><p>JCPæ˜¯ç”±Sun Microsystemsï¼ˆç°åœ¨æ˜¯Oracle Corporationï¼‰åˆ›å»ºçš„ä¸€ä¸ªç»„ç»‡ï¼Œè´Ÿè´£åˆ¶å®šå’Œç®¡ç†JavaæŠ€æœ¯çš„å‘å±•ã€‚å®ƒåŒ…æ‹¬äº†ä¸€ç³»åˆ—ä¸“å®¶ç»„å’Œå·¥ä½œç»„ï¼Œè¿™äº›ç»„ç»‡å’Œä¸ªäººå…±åŒåˆä½œåˆ¶å®šå’Œæ›´æ–°Javaè§„èŒƒã€‚</p><p>JSR æ˜¯ Java è§„èŒƒè¯·æ±‚ã€‚è¿™æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜æäº¤ç»™ PMO çš„æ–‡ä»¶ï¼Œä»¥æè®®å¼€å‘æ–°è§„èŒƒæˆ–å¯¹ç°æœ‰è§„èŒƒè¿›è¡Œé‡å¤§ä¿®è®¢ã€‚ JCP è®¡åˆ’ç›®å‰æ­£åœ¨å¼€å‘è®¸å¤š Java æŠ€æœ¯è§„èŒƒï¼ŒåŒ…æ‹¬ Javaâ„¢ Micro Edition (Java MEâ„¢)ã€Javaâ„¢ Platform Enterprise Edition (Java EEâ„¢) å’Œ Javaâ„¢ Standard Edition (Java SEâ„¢) çš„ä¸‹ä¸€ç‰ˆæœ¬ã€‚ JSR è¿˜æŒ‡ç”±è¿™äº›ææ¡ˆäº§ç”Ÿçš„è§„èŒƒå¼€å‘å·¥ä½œã€‚</p><p>JSRç»å†å¤šä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬è‰æ¡ˆã€ææ¡ˆã€å…¬å¼€è¯„è®ºã€ç»´æŠ¤å’Œæœ€ç»ˆå‘å¸ƒç­‰ã€‚</p><p>PMO å³ Program Management Officeï¼Œé¡¹ç›®ç®¡ç†åŠå…¬å®¤æ˜¯ Oracle å†…éƒ¨è´Ÿè´£ç›‘ç£ Java ç¤¾åŒºæµç¨‹å¹¶ç®¡ç†é¡¹ç›®æ—¥å¸¸è¿è¡Œçš„å°ç»„ã€‚è¯¥è§„èŒƒçš„å®é™…å¼€å‘æ˜¯åœ¨ä¸“å®¶ç»„å†…è¿›è¡Œçš„ã€‚</p></blockquote><p>JCPï¼š<a href="https://jcp.org/en/home/index">https://jcp.org/en/home/index</a></p><h2 id="JSR-000269"><a href="#JSR-000269" class="headerlink" title="JSR-000269"></a>JSR-000269</h2><p>JSR-000269ï¼ˆJSR-269ï¼‰çš„ç›®æ ‡æ˜¯å®šä¹‰å¹¶å®ç°Javaç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨çš„æ ‡å‡†APIï¼Œæˆ–ç§°ä¸ºå¯æ’æ‹”æ³¨è§£å¤„ç†ï¼ˆPluggable Annotation Processingï¼‰ï¼Œè¯¥JSRæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨Javaæºä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­è®¿é—®å’Œå¤„ç†æ³¨è§£ï¼Œä»è€Œå®ç°æ›´é«˜çº§çš„è¯­ä¹‰æ•ˆæœå’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p><p>è¦å®Œå…¨çš„äº†è§£JSR-269çš„å‰å› åæœåŠæŠ€æœ¯ç»†èŠ‚ï¼Œä¸åº”è¯¥åœ¨æœ¬æ–‡ä¸­å¯»æ‰¾ç­”æ¡ˆï¼Œæœ¬æ–‡ä»…é“ºå«ä¸€äº›å½¢è±¡åŒ–æè¿°Lombokå®ç°åŸç†æ‰€å¿…éœ€çš„å‰ç½®çŸ¥è¯†ã€‚æ€»ä¹‹ï¼Œé€šè¿‡JSR-269çš„å®ç°ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨ç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨çš„èƒ½åŠ›ï¼Œä»¥ä¸€ç§æ ‡å‡†åŒ–å’Œå¯æ‰©å±•çš„æ–¹å¼å¯¹æºä»£ç è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†ã€‚è¿™ç§å¤„ç†åŒ…æ‹¬ç”Ÿæˆé¢å¤–çš„ä»£ç ã€è¿›è¡Œé™æ€åˆ†æã€éªŒè¯çº¦æŸæ¡ä»¶ç­‰ã€‚</p><p>JSR-000269çš„åŸå§‹æå‡ºç¬¬ä¸€èŠ‚å¦‚ä¸‹ï¼š</p><blockquote><p>J2SE 1.5å¼•å…¥äº†ä¸€ç§æ–°çš„Javaè¯­è¨€æœºåˆ¶â€œæ³¨è§£â€ï¼Œå…è®¸ä½¿ç”¨æ³¨è§£ç±»å‹å¯¹ç±»ã€å­—æ®µå’Œæ–¹æ³•è¿›è¡Œæ³¨è§£ã€‚è¿™äº›æ³¨è§£é€šå¸¸ç”±ç¼–è¯‘æ—¶å·¥å…·æˆ–è¿è¡Œæ—¶åº“æ¥å¤„ç†ï¼Œä»¥å®ç°æ–°çš„è¯­ä¹‰æ•ˆæœã€‚ä¸ºäº†æ”¯æŒç¼–è¯‘æ—¶çš„æ³¨è§£å¤„ç†ï¼Œè¿™ä¸ªJSRå°†å®šä¹‰APIï¼Œå…è®¸ä½¿ç”¨æ ‡å‡†å¯æ’æ‹”çš„APIåˆ›å»ºæ³¨è§£å¤„ç†å™¨ã€‚è¿™å°†ç®€åŒ–åˆ›å»ºæ³¨è§£å¤„ç†å™¨çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è‡ªåŠ¨å‘ç°é€‚ç”¨äºç»™å®šæºæ–‡ä»¶çš„åˆé€‚çš„æ³¨è§£å¤„ç†å™¨ã€‚</p><p>è¯¥è§„èŒƒå°†åŒ…æ‹¬è‡³å°‘ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªéƒ¨åˆ†æ˜¯å¯¹Javaç¼–ç¨‹è¯­è¨€è¿›è¡Œå»ºæ¨¡çš„APIéƒ¨åˆ†ï¼Œå¦ä¸€ä¸ªéƒ¨åˆ†ç”¨äºå£°æ˜æ³¨è§£å¤„ç†å™¨å¹¶æ§åˆ¶å®ƒä»¬çš„è¿è¡Œæ–¹å¼ã€‚ç”±äºæ³¨è§£æ˜¯æ”¾ç½®åœ¨ç¨‹åºå…ƒç´ ä¸Šçš„ï¼Œæ³¨è§£å¤„ç†æ¡†æ¶éœ€è¦åæ˜ ç¨‹åºç»“æ„ã€‚æ³¨è§£å¤„ç†å™¨å°†èƒ½å¤ŸæŒ‡å®šå®ƒä»¬å¤„ç†çš„æ³¨è§£ï¼Œå¹¶ä¸”å¤šä¸ªå¤„ç†å™¨å°†èƒ½å¤Ÿåˆä½œè¿è¡Œã€‚</p><p>å¤„ç†å™¨å’Œç¨‹åºç»“æ„APIå¯ä»¥åœ¨ç¼–è¯‘æ—¶è®¿é—®ï¼›å³æ­¤åŠŸèƒ½è¡¥å……äº†æ ¸å¿ƒåå°„æ”¯æŒè¯»å–æ³¨è§£çš„èƒ½åŠ›ã€‚</p></blockquote><h2 id="Lombokä»£ç æ³¨å…¥åŸç†"><a href="#Lombokä»£ç æ³¨å…¥åŸç†" class="headerlink" title="Lombokä»£ç æ³¨å…¥åŸç†"></a>Lombokä»£ç æ³¨å…¥åŸç†</h2><p>Lombokä½¿ç”¨äº†JSR-269çš„APIï¼Œå³<code>javax.annotation.processing</code>ä¸‹çš„ä¸€ç»„æ¥å£ï¼Œåœ¨ç¼–è¯‘æœŸæ—¶æŠŠ Lombok çš„æ³¨è§£ä»£ç ï¼Œè½¬æ¢ä¸ºå¸¸è§„çš„ Java â½…æ³•â½½å®ç°æ³¨â¼Šã€‚</p><p>ä½¿ç”¨ <code>javac</code> è¿›è¡Œç¼–è¯‘æ—¶ï¼ŒLombokç”Ÿæˆç›®æ ‡æ–¹æ³•çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆ <code>javac</code> å¯¹æºä»£ç è¿›è¡Œåˆ†æç”Ÿæˆä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘(AST)</li><li>æ¥ç€åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨å®ç°äº† JSR-269 API çš„ lombok ç¨‹åº</li><li>æ¥ç€ç¼–è¯‘å™¨ä¼šè°ƒç”¨ lombok ç¨‹åºå¯¹ä¸Šé¢å¾—åˆ°çš„æŠ½è±¡è¯­æ³•æ ‘ AST è¿›è¡Œå¤„ç†ï¼Œæ‰¾åˆ°å…¶æ³¨è§£æ‰€åœ¨ç±»å¯¹åº”çš„è¯­æ³•æ ‘(AST)ï¼Œç„¶åä¿®æ”¹è¯¥è¯­æ³•æ ‘ï¼Œå¢åŠ æ³¨è§£å¯¹åº”çš„æ–¹æ³•æˆ–ä»£ç ç‰‡æ®µåˆ°å®šä¹‰çš„ç›¸åº”æ ‘èŠ‚ç‚¹</li><li><code>javac</code> ä½¿ç”¨ä¿®æ”¹åçš„æŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆæœ€ç»ˆçš„ class æ–‡ä»¶</li></ol><h2 id="åˆ©ç”¨269APIå®ç°Setteræ³¨è§£"><a href="#åˆ©ç”¨269APIå®ç°Setteræ³¨è§£" class="headerlink" title="åˆ©ç”¨269APIå®ç°Setteræ³¨è§£"></a>åˆ©ç”¨269APIå®ç°Setteræ³¨è§£</h2><p>1ã€â¾ƒå®šä¹‰æ³¨è§£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lombok.setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MySetter &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>2ã€è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨<br>æ³¨è§£å¤„ç†å™¨æ˜¯ä»£ç ç”Ÿæˆçš„æ ¸å¿ƒï¼Œå¯¹è¯­æ³•æ ‘çš„æ“ä½œéœ€è¦ä½¿ç”¨è‡ªå·±JDKçš„<code>tools.jar</code>ï¼Œæ¶‰åŠåˆ°çš„æ ¸å¿ƒåº“ä¸»è¦ä¸º<code>com.sun.tools.javac</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">package</span> lombok.setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.source.tree.Tree.Kind;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.api.JavacTrees;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.code.Flags;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.code.Type;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.processing.JavacProcessingEnvironment;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.JCTree;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.TreeMaker;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.tree.TreeTranslator;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Context;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.ListBuffer;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Name;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.Names;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.javac.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.*;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.SourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.Element;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.TypeElement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;lombok.setter.MySetter&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySetterProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JavacTrees javacTrees; <span class="comment">// æä¾›äº†å¾…å¤„ç†çš„æŠ½è±¡è¯­æ³•æ ‘</span></span><br><span class="line">    <span class="keyword">private</span> TreeMaker treeMaker; <span class="comment">// å°è£…äº†åˆ›å»ºASTèŠ‚ç‚¹çš„ä¸€äº›æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> Names names; <span class="comment">// æä¾›äº†åˆ›å»ºæ ‡è¯†ç¬¦çš„æ–¹æ³•</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment processingEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.init(processingEnv);</span><br><span class="line">        <span class="comment">// è·å–èµ„æº</span></span><br><span class="line">        <span class="keyword">this</span>.javacTrees = JavacTrees.instance(processingEnv);</span><br><span class="line">        Context context = ((JavacProcessingEnvironment) processingEnv).getContext();</span><br><span class="line">        <span class="keyword">this</span>.treeMaker = TreeMaker.instance(context);</span><br><span class="line">        <span class="keyword">this</span>.names = Names.instance(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–MySetteræ³¨è§£çš„å…ƒç´ </span></span><br><span class="line">        Set&lt;? extends Element&gt; elementsAnnotatedWith = roundEnv.getElementsAnnotatedWith(MySetter.class);</span><br><span class="line">        elementsAnnotatedWith.forEach(element -&gt; &#123;</span><br><span class="line">            JCTree tree = javacTrees.getTree(element);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ TreeTranslator éå†æŠ½è±¡è¯­æ³•æ ‘</span></span><br><span class="line">            tree.accept(<span class="keyword">new</span> TreeTranslator() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitClassDef</span><span class="params">(JCTree.JCClassDecl jcClassDecl)</span> </span>&#123;</span><br><span class="line">                    List&lt;JCTree.JCVariableDecl&gt; jcVariableDeclList = List.nil();</span><br><span class="line">                    <span class="comment">// åœ¨æŠ½è±¡æ ‘ä¸­æ‰¾å‡ºæ‰€æœ‰å˜é‡</span></span><br><span class="line">                    <span class="keyword">for</span>(JCTree jcTree:jcClassDecl.defs) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(jcTree.getKind().equals(Kind.VARIABLE)) &#123;</span><br><span class="line">                            JCTree.JCVariableDecl jcVariableDecl = (JCTree.JCVariableDecl) jcTree;</span><br><span class="line">                            jcVariableDeclList = jcVariableDeclList.append(jcVariableDecl);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å¯¹å˜é‡ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line">                    jcVariableDeclList.forEach(jcVariableDecl -&gt; &#123;</span><br><span class="line">                        jcClassDecl.defs = jcClassDecl.defs.prepend(makeGetterMethodDecl(jcVariableDecl));</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">super</span>.visitClassDef(jcClassDecl);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JCTree.<span class="function">JCMethodDecl <span class="title">makeGetterMethodDecl</span><span class="params">(JCTree.JCVariableDecl jcVariableDecl)</span> </span>&#123;</span><br><span class="line">        ListBuffer&lt;JCTree.JCStatement&gt; statements = <span class="keyword">new</span> ListBuffer&lt;&gt;();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ this.a = a;</span></span><br><span class="line">        JCTree.JCExpressionStatement aThis = makeAssignment(</span><br><span class="line">            treeMaker.Select(treeMaker.Ident(names.fromString(<span class="string">&quot;this&quot;</span>)), jcVariableDecl.getName()),</span><br><span class="line">            treeMaker.Ident(jcVariableDecl.getName())</span><br><span class="line">        );</span><br><span class="line">        statements.append(aThis);</span><br><span class="line">        JCTree.JCBlock block = treeMaker.Block(<span class="number">0</span>, statements.toList()); <span class="comment">// åˆ›å»ºä»£ç å—æŠ½è±¡è¯­æ³•æ ‘èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆå…¥å‚</span></span><br><span class="line">        JCTree.JCVariableDecl param = treeMaker.VarDef( <span class="comment">// åˆ›å»ºä¸€ä¸ªå˜é‡å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line">            treeMaker.Modifiers(Flags.PARAMETER), <span class="comment">// æŒ‡å®šä¿®é¥°ç¬¦ä¸ºå…¥å‚</span></span><br><span class="line">            jcVariableDecl.getName(), <span class="comment">// ä½¿ç”¨åŸå§‹å˜é‡å®šä¹‰èŠ‚ç‚¹çš„åç§°ä½œä¸ºå…¥å‚çš„åç§°</span></span><br><span class="line">            jcVariableDecl.vartype, <span class="comment">// ä½¿ç”¨åŸå§‹å˜é‡å®šä¹‰èŠ‚ç‚¹çš„å˜é‡ç±»å‹ä½œä¸ºå…¥å‚çš„ç±»å‹</span></span><br><span class="line">            <span class="keyword">null</span> <span class="comment">// è¡¨ç¤ºå…¥å‚æ²¡æœ‰åˆå§‹å€¼</span></span><br><span class="line">        );</span><br><span class="line">        List&lt;JCTree.JCVariableDecl&gt; parameters = List.of(param);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆè¿”å›å¯¹è±¡</span></span><br><span class="line">        JCTree.JCExpression methodType = treeMaker.Type(</span><br><span class="line">            <span class="keyword">new</span> Type.JCVoidType()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“åˆå†…å®¹ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> treeMaker.MethodDef(</span><br><span class="line">            treeMaker.Modifiers(Flags.PUBLIC),</span><br><span class="line">            getNewMethodName(jcVariableDecl.getName()),</span><br><span class="line">            methodType, List.nil(), parameters, List.nil(), block, <span class="keyword">null</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Name <span class="title">getNewMethodName</span><span class="params">(Name name)</span> </span>&#123;</span><br><span class="line">        String s = name.toString();</span><br><span class="line">        <span class="comment">// é©¼å³°å‘½åæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> names.fromString(</span><br><span class="line">            <span class="string">&quot;set&quot;</span> + s.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + s.substring(<span class="number">1</span>, name.length())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JCTree.<span class="function">JCExpressionStatement <span class="title">makeAssignment</span><span class="params">(JCTree.JCExpression lhs, JCTree.JCExpression rhs)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆèµ‹å€¼è¯­å¥çš„æŠ½è±¡è¯­æ³•æ ‘èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> treeMaker.Exec(</span><br><span class="line">            treeMaker.Assign(</span><br><span class="line">                lhs, <span class="comment">// left-hand side</span></span><br><span class="line">                rhs  <span class="comment">// right-hand side</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€ç¼–è¯‘æ³¨è§£å¤„ç†å™¨<br>ä¹‹åæ‰€æœ‰æ“ä½œéƒ½åœ¨MySetterçš„ç›®å½•ä¸‹è¿›è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -cp /path/to/tools.jar MySetter* -d .</span><br></pre></td></tr></table></figure><p>4ã€ç¼–å†™å’Œç¼–è¯‘ç›®æ ‡ç±»<br>ç›®æ ‡ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MySetter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMySetter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Integer intt;</span><br><span class="line">    <span class="keyword">public</span> String strr;</span><br><span class="line">    <span class="keyword">public</span> Byte bytee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”¨è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨ç¼–è¯‘ç›®æ ‡ç±»ï¼š<code>javac -processor  lombok.setter.MySetterProcessor TestMySetter.java</code></p><p>ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMySetter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Integer intt;</span><br><span class="line">    <span class="keyword">public</span> String strr;</span><br><span class="line">    <span class="keyword">public</span> Byte bytee;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBytee</span><span class="params">(Byte var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bytee = var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrr</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.strr = var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntt</span><span class="params">(Integer var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.intt = var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestMySetter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Lombokæ’ä»¶"><a href="#Lombokæ’ä»¶" class="headerlink" title="Lombokæ’ä»¶"></a>Lombokæ’ä»¶</h2><p>å‰é¢å½¢è±¡åŒ–çš„è®²è¿°äº†Lombokçš„ä»£ç ç”ŸæˆåŸç†ï¼Œä½†è¿™äº›éƒ½å‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œä»£ç ç¼–è¾‘å™¨å¦‚ä½•è·å–åˆ°è¿™äº›ä¿¡æ¯å¹¶æå‰åº”ç”¨åˆ°ä»£ç æç¤ºä¸Šå‘¢ï¼ŸLombokç»™ä¸»æµé›†æˆå¼€å‘ç¯å¢ƒç¼–å†™äº†Lombokæ’ä»¶ï¼Œåœ¨ä½¿ç”¨Lombokçš„è¿‡ç¨‹ä¸­ä¸éœ€è¦ç¼–è¯‘å³å¯å®ç°ä»£ç æç¤ºå’Œä»£ç è¡¥å…¨ï¼Œç›¸å…³æºç éƒ½å…¬å¼€åœ¨GitHubä¸Šï¼ˆè§[9]ï¼‰ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ç ”ç©¶ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://developer.aliyun.com/article/1081626">https://developer.aliyun.com/article/1081626</a><br>[2] <a href="https://blog.csdn.net/shouchenchuan5253/article/details/111658356">https://blog.csdn.net/shouchenchuan5253/article/details/111658356</a><br>[3] <a href="https://blog.csdn.net/weixin_43983762/article/details/105867398">https://blog.csdn.net/weixin_43983762/article/details/105867398</a><br>[4] <a href="https://juejin.cn/post/7103011031672176677">https://juejin.cn/post/7103011031672176677</a><br>[5] <a href="https://jcp.org/en/jsr/detail?id=269">https://jcp.org/en/jsr/detail?id=269</a><br>[6] <a href="https://jcp.org/aboutJava/communityprocess/mrel/jsr269/index6.html">https://jcp.org/aboutJava/communityprocess/mrel/jsr269/index6.html</a><br>[7] <a href="https://projectlombok.org/">https://projectlombok.org/</a><br>[8] <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/apt/GettingStarted.html">https://docs.oracle.com/javase/7/docs/technotes/guides/apt/GettingStarted.html</a><br>[9] <a href="https://github.com/projectlombok/lombok">https://github.com/projectlombok/lombok</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Lombokå®ç°åŸç†ç®€æã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Lombok" scheme="http://silencezheng.top/tags/Lombok/"/>
    
  </entry>
  
  <entry>
    <title>Lombokä¹‹@Builderç¢ç¢å¿µ</title>
    <link href="http://silencezheng.top/2023/09/10/article120/"/>
    <id>http://silencezheng.top/2023/09/10/article120/</id>
    <published>2023-09-10T12:23:30.000Z</published>
    <updated>2023-09-10T12:24:14.625Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Lombok@Builderå®ç°é“¾å¼æ„å»ºçš„å¼Šç—…åŠæ›¿ä»£æ–¹æ¡ˆã€‚<br><span id="more"></span></p><h2 id="Builderçš„å¼Šç—…"><a href="#Builderçš„å¼Šç—…" class="headerlink" title="@Builderçš„å¼Šç—…"></a>@Builderçš„å¼Šç—…</h2><h3 id="å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ååˆ†å¤æ‚"><a href="#å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ååˆ†å¤æ‚" class="headerlink" title="å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ååˆ†å¤æ‚"></a>å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ååˆ†å¤æ‚</h3><p>é”™è¯¯ç”¨æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String parentName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> parentAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String childName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> childAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠ¥é”™ï¼šImplicit super constructor Parent() is undefined. Must explicitly invoke another constructor</span></span><br></pre></td></tr></table></figure></p><p>æ­£ç¡®ç”¨æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String parentName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> parentAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String childName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> childAge;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Child</span><span class="params">(String parentName, <span class="keyword">int</span> parentAge, String childName, <span class="keyword">int</span> childAge)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parentName, parentAge);</span><br><span class="line">        <span class="keyword">this</span>.childName = childName;</span><br><span class="line">        <span class="keyword">this</span>.childAge = childAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">Child child = Child.builder()</span><br><span class="line">  .parentName(<span class="string">&quot;Andrea&quot;</span>)</span><br><span class="line">  .parentAge(<span class="number">38</span>)</span><br><span class="line">  .childName(<span class="string">&quot;Emma&quot;</span>)</span><br><span class="line">  .childAge(<span class="number">6</span>)</span><br><span class="line">  .build();</span><br></pre></td></tr></table></figure></p><p>ä½†å¦‚æœçˆ¶ç±»ä½¿ç”¨äº†@Builderæ³¨è§£å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String parentName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> parentAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç”¨åŸå­ç±»ä¼šæŠ¥é”™ï¼š<code>Childä¸­çš„builder()æ— æ³•è¦†ç›–Parentä¸­çš„builder()</code>ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹å­ç±»ä¸ºå¦‚ä¸‹å½¢å¼è§£å†³ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String childName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> childAge;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Builder(builderMethodName = &quot;childBuilder&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Child</span><span class="params">(String parentName, <span class="keyword">int</span> parentAge, String childName, <span class="keyword">int</span> childAge)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parentName, parentAge);</span><br><span class="line">        <span class="keyword">this</span>.childName = childName;</span><br><span class="line">        <span class="keyword">this</span>.childAge = childAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨é“¾å¼æ„å»ºå­ç±»å¯¹è±¡æ—¶ï¼Œå°±éœ€è¦è°ƒç”¨<code>Child.childBuilder()</code>äº†ã€‚å³ä¾¿å¦‚æ­¤ï¼Œåœ¨ç»§æ‰¿å±‚çº§å¤šæ—¶ä¹Ÿååˆ†ç¹çã€‚</p><p>åœ¨Lombok1.18ä¸­ï¼Œæä¾›äº†@SuperBuilderæ³¨è§£ï¼Œå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@SuperBuilder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String parentName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> parentAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@SuperBuilder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String childName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> childAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸å¯ä¸-DataåŒæ—¶ä½¿ç”¨"><a href="#ä¸å¯ä¸-DataåŒæ—¶ä½¿ç”¨" class="headerlink" title="ä¸å¯ä¸@DataåŒæ—¶ä½¿ç”¨"></a>ä¸å¯ä¸@DataåŒæ—¶ä½¿ç”¨</h3><p>å¾ˆå¤šæ¡†æ¶ä¼šä½¿ç”¨ç±»çš„æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœåŒæ—¶ä½¿â½¤@Dataå’Œ@Builderçš„è¯ï¼Œä¼šå¯¼è‡´ç±»çš„æ— å‚æ„é€ å‡½æ•°ç¼ºå¤±ã€‚</p><p>å¹¶ä¸”ï¼Œè¿™ç§æƒ…å†µå¹¶ä¸èƒ½é€šè¿‡æ‰‹åŠ¨æ·»åŠ æ— å‚æ„é€ å‡½æ•°æˆ–æ·»åŠ @NoArgsConstructorè§£å†³ã€‚</p><p>è¯¥é—®é¢˜åªèƒ½é€šè¿‡å¼•â¼Šæ³¨è§£@Tolerateæ¥è§£å†³ã€‚</p><p>LombokåŒæ—¶ä½¿â½¤@Dataå’Œ@Builderçš„æ—¶å€™ï¼Œå¦‚æœè¦â½£æˆâ½†å‚æ„é€ ï¼Œéœ€è¦åœ¨ä»£ç â¾¥â¾¯â¼¿åŠ¨å¼•â¼Šæ³¨è§£@Tolerateï¼Œè®©Lombokåœ¨â½£æˆç±»çš„æ—¶å€™ï¼Œå¯¹æŒ‡å®šçš„æ„é€ å‡½æ•°ä¸æ„ŸçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer int1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tolerate</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”¨-Accessorsæ›¿ä»£-Builder"><a href="#ç”¨-Accessorsæ›¿ä»£-Builder" class="headerlink" title="ç”¨@Accessorsæ›¿ä»£@Builder"></a>ç”¨@Accessorsæ›¿ä»£@Builder</h2><p>åœ¨ä¸ºäº†é“¾å¼ç¼–ç¨‹è€Œä½¿ç”¨@Builderæ—¶ï¼Œå®ƒå¹¶éæœ€ä½³å®è·µã€‚@Builderä¼šé¢å¤–åˆ›å»ºå†…éƒ¨ç±»ï¼Œæ— æ³•ä¸@Dataå…¼å®¹ï¼Œä¸”å¤„ç†ç»§æ‰¿å…³ç³»ååˆ†å¤æ‚ã€‚</p><p>ä½¿ç”¨@Accessors(chain = true)å®ç°é“¾å¼ç¼–ç¨‹æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">APIResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T payload;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Status status;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">APIResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T payload;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Status status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getPayload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.payload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> APIResponse&lt;T&gt; <span class="title">setPayload</span><span class="params">(T payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.payload = payload;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Status <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> APIResponse&lt;T&gt; <span class="title">setStatus</span><span class="params">(Status status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// å‡è®¾Statusä¹Ÿä½¿ç”¨äº†@Accessors(chain = true)</span></span><br><span class="line">Status status = <span class="keyword">new</span> Status().setResponseCode(<span class="string">&quot;RESPONSE_CODE_IDENTIFIER&quot;</span>).setDescription(<span class="string">&quot;Bla Bla Bla&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> APIResponse().setStatus(status);</span><br></pre></td></tr></table></figure></p><p>å®é™…è¿ç”¨æ—¶ï¼Œå¦‚æœå±æ€§è¾ƒå¤šï¼Œä¸”åˆ†ä¸ºå¿…ä¼ å±æ€§å’Œé€‰å¡«å±æ€§æ—¶ï¼Œå¯ä»¥å°†å¿…ä¼ å‚æ•°å®šä¹‰åœ¨æ„é€ æ–¹æ³•ä¸­ï¼ŒåŠ ä¸Š @Accessors æ³¨è§£ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¿…ä¼ å‚æ•°çš„ä¼ å…¥ï¼Œåˆå¯ä»¥å®ç°é€‰å¡«å‚æ•°çš„é“¾å¼è°ƒç”¨ã€‚</p><p>å‡è®¾ Student ç±»ï¼Œå®ƒçš„ å­¦ç”ŸIDå’Œå¹´çº§å’Œç­çº§æ˜¯å¿…å¡«çš„ï¼Œå§“åã€æ€§åˆ«ã€ä½å€æ˜¯é€‰å¡«çš„ï¼Œé‚£ä¹ˆç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å¿…ä¼ å±æ€§ï¼Œä½¿ç”¨ final ä¿®é¥°ï¼Œä¸æä¾› setter æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> studentId; <span class="comment">// å­¦ç”ŸID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> grade; <span class="comment">// å¹´çº§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> classNum; <span class="comment">// ç­çº§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰é€‰å¡«å±æ€§ï¼Œæä¾› setter æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// å§“å</span></span><br><span class="line">    <span class="keyword">private</span> String gender; <span class="comment">// æ€§åˆ«</span></span><br><span class="line">    <span class="keyword">private</span> String address; <span class="comment">// ä½å€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æ„é€ æ–¹æ³•ï¼Œæ¥æ”¶å¿…ä¼ å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> studentId, <span class="keyword">int</span> grade, <span class="keyword">int</span> classNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentId = studentId;</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">        <span class="keyword">this</span>.classNum = classNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥ getter å’Œ setter æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">Student student = <span class="keyword">new</span> Student(<span class="number">1001</span>, <span class="number">3</span>, <span class="number">8</span>) <span class="comment">// åˆ›å»ºä¸€ä¸ªå­¦ç”Ÿå¯¹è±¡ï¼Œä¼ å…¥å¿…ä¼ å‚æ•°</span></span><br><span class="line">        .setName(<span class="string">&quot;å¼ ä¸‰&quot;</span>) <span class="comment">// è®¾ç½®å§“å</span></span><br><span class="line">        .setGender(<span class="string">&quot;ç”·&quot;</span>) <span class="comment">// è®¾ç½®æ€§åˆ«</span></span><br><span class="line">        .setAddress(<span class="string">&quot;åŒ—äº¬å¸‚æœé˜³åŒº&quot;</span>); <span class="comment">// è®¾ç½®ä½å€</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://www.baeldung.com/lombok-builder-inheritance">https://www.baeldung.com/lombok-builder-inheritance</a><br>[2] <a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA%3D%3D&amp;mid=2247534735&amp;idx=1&amp;sn=c6363bff49edbe8b03b5789d2f5b18b9&amp;chksm=e92a7580de5dfc967aaaa7d696a95a7361c4188fe8a626037f51cb70c53466f9ee78efef369d&amp;scene=262&amp;from=industrynews">https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA%3D%3D&amp;mid=2247534735&amp;idx=1&amp;sn=c6363bff49edbe8b03b5789d2f5b18b9&amp;chksm=e92a7580de5dfc967aaaa7d696a95a7361c4188fe8a626037f51cb70c53466f9ee78efef369d&amp;scene=262&amp;from=industrynews</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Lombok@Builderå®ç°é“¾å¼æ„å»ºçš„å¼Šç—…åŠæ›¿ä»£æ–¹æ¡ˆã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Lombok" scheme="http://silencezheng.top/tags/Lombok/"/>
    
  </entry>
  
  <entry>
    <title>åŒ¿åå†…éƒ¨ç±»</title>
    <link href="http://silencezheng.top/2023/09/02/article119/"/>
    <id>http://silencezheng.top/2023/09/02/article119/</id>
    <published>2023-09-02T10:10:40.000Z</published>
    <updated>2023-09-02T10:11:20.145Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Javaä¸­çš„åŒ¿åç±»ï¼ŒJava8åŠä»¥åã€‚</p><p>æ¶‰åŠæ¦‚å¿µåŒ…æ‹¬ï¼š<strong>ç­‰æ•ˆ<code>final</code></strong>ï¼Œæˆå‘˜ï¼Œå˜é‡ï¼Œä½œç”¨åŸŸã€‚<br><span id="more"></span></p><h2 id="åŒ¿åå†…éƒ¨ç±»-Anonymous-Classes"><a href="#åŒ¿åå†…éƒ¨ç±»-Anonymous-Classes" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»(Anonymous Classes)"></a>åŒ¿åå†…éƒ¨ç±»(Anonymous Classes)</h2><p>åŒ¿åå†…éƒ¨ç±»ï¼ˆåŒ¿åç±»ï¼‰æ˜¯ä¸€ç§åœ¨Javaä¸­ç”¨äºåˆ›å»ºä¸´æ—¶æ€§ã€ä¸€æ¬¡æ€§ä½¿ç”¨çš„ç±»çš„ç‰¹æ®Šè¯­æ³•ç»“æ„ã€‚å®ƒå¯ä»¥ç”¨æ¥å®ç°æ¥å£ã€ç»§æ‰¿ç±»æˆ–åˆ›å»ºä¸´æ—¶å¯¹è±¡ç­‰æ“ä½œï¼Œé€šå¸¸åœ¨éœ€è¦ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œä½†åˆä¸å¸Œæœ›å•ç‹¬ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç±»æ–‡ä»¶æ—¶ä½¿ç”¨ã€‚</p><p>åŒ¿åç±»å¯ä»¥ä½¿ä½ çš„ä»£ç æ›´åŠ ç®€æ´ï¼Œä½ å¯ä»¥åœ¨å®šä¹‰ä¸€ä¸ªç±»çš„åŒæ—¶å¯¹å…¶è¿›è¡Œå®ä¾‹åŒ–ã€‚å®ƒä¸å±€éƒ¨ç±»å¾ˆç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ²¡æœ‰ç±»åï¼Œå¦‚æœæŸä¸ªå±€éƒ¨ç±»ä½ åªéœ€è¦ç”¨ä¸€æ¬¡ï¼Œå°±å¯ä»¥ä½¿ç”¨åŒ¿åç±»æ¥è¡¨è¾¾ã€‚</p><p>åŒ¿åç±»é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li><p><strong>å®ç°æ¥å£ï¼š</strong> é€šè¿‡åŒ¿åç±»å®ç°ä¸€ä¸ªæ¥å£ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ¥å£çš„å®ä¾‹ã€‚</p></li><li><p><strong>ç»§æ‰¿ç±»ï¼š</strong> é€šè¿‡åŒ¿åç±»ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªå­ç±»çš„å®ä¾‹ã€‚</p></li><li><p><strong>åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼š</strong> åœ¨ä¸€äº›ä¸´æ—¶éœ€è¦çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åŒ¿åç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚</p></li></ol><h2 id="åŒ¿åç±»ä¸å±€éƒ¨ç±»å¯¹æ¯”"><a href="#åŒ¿åç±»ä¸å±€éƒ¨ç±»å¯¹æ¯”" class="headerlink" title="åŒ¿åç±»ä¸å±€éƒ¨ç±»å¯¹æ¯”"></a>åŒ¿åç±»ä¸å±€éƒ¨ç±»å¯¹æ¯”</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldAnonymousClasses</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒ…å«ä¸¤ä¸ªæ–¹æ³•çš„HelloWorldæ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greetSomeone</span><span class="params">(String someone)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1ã€å±€éƒ¨ç±»EnglishGreetingå®ç°äº†HelloWorldæ¥å£</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">EnglishGreeting</span> <span class="keyword">implements</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">            String name = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                greetSomeone(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greetSomeone</span><span class="params">(String someone)</span> </span>&#123;</span><br><span class="line">                name = someone;</span><br><span class="line">                System.out.println(<span class="string">&quot;Hello &quot;</span> + name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        HelloWorld englishGreeting = <span class="keyword">new</span> EnglishGreeting();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€åŒ¿åç±»å®ç°HelloWorldæ¥å£</span></span><br><span class="line">        HelloWorld frenchGreeting = <span class="keyword">new</span> HelloWorld() &#123;</span><br><span class="line">            String name = <span class="string">&quot;tout le monde&quot;</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                greetSomeone(<span class="string">&quot;tout le monde&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greetSomeone</span><span class="params">(String someone)</span> </span>&#123;</span><br><span class="line">                name = someone;</span><br><span class="line">                System.out.println(<span class="string">&quot;Salut &quot;</span> + name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€åŒ¿åç±»å®ç°HelloWorldæ¥å£</span></span><br><span class="line">        HelloWorld spanishGreeting = <span class="keyword">new</span> HelloWorld() &#123;</span><br><span class="line">            String name = <span class="string">&quot;mundo&quot;</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                greetSomeone(<span class="string">&quot;mundo&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">greetSomeone</span><span class="params">(String someone)</span> </span>&#123;</span><br><span class="line">                name = someone;</span><br><span class="line">                System.out.println(<span class="string">&quot;Hola, &quot;</span> + name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        englishGreeting.greet();</span><br><span class="line">        frenchGreeting.greetSomeone(<span class="string">&quot;Fred&quot;</span>);</span><br><span class="line">        spanishGreeting.greet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        HelloWorldAnonymousClasses myApp = <span class="keyword">new</span> HelloWorldAnonymousClasses();</span><br><span class="line">        myApp.sayHello();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">        <span class="comment">// Hello world</span></span><br><span class="line">        <span class="comment">// Salut Fred</span></span><br><span class="line">        <span class="comment">// Hola, mundo</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ä¾‹ä¸­ç”¨å±€éƒ¨ç±»æ¥åˆå§‹åŒ–å˜é‡<code>englishGreeting</code>ï¼Œç”¨åŒ¿ç±»æ¥åˆå§‹åŒ–å˜é‡<code>frenchGreeting</code>å’Œ<code>spanishGreeting</code>ï¼Œä¸¤ç§å®ç°ä¹‹é—´æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼š</p><p>1ï¼‰å±€éƒ¨ç±»<code>EnglishGreeting</code>ç»§æ‰¿<code>HelloWorld</code>æ¥å£ï¼Œæœ‰è‡ªå·±çš„ç±»åï¼Œå®šä¹‰å®Œæˆä¹‹åéœ€è¦å†ç”¨newå…³é”®å­—å®ä¾‹åŒ–æ‰å¯ä»¥ä½¿ç”¨ï¼›</p><p>2ï¼‰<code>frenchGreetingã€spanishGreeting</code>åœ¨å®šä¹‰çš„æ—¶å€™å°±å®ä¾‹åŒ–äº†ï¼Œå®šä¹‰å®Œäº†å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼›</p><p>3ï¼‰<strong>åŒ¿åç±»æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ï¼Œå› æ­¤åœ¨å®šä¹‰çš„æœ€åç”¨åˆ†å·â€;â€ç»“æŸã€‚</p><h2 id="åŒ¿åç±»çš„è¯­æ³•"><a href="#åŒ¿åç±»çš„è¯­æ³•" class="headerlink" title="åŒ¿åç±»çš„è¯­æ³•"></a>åŒ¿åç±»çš„è¯­æ³•</h2><p>åŒ¿åç±»è¡¨è¾¾å¼çš„é€šç”¨è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºåŒ¿åç±»å®ä¾‹</span></span><br><span class="line">SuperClassOrInterface obj = <span class="keyword">new</span> SuperClassOrInterface() &#123;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å—ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–¹æ³•é‡å†™</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">returnType <span class="title">methodName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ–¹æ³•å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„å…³é”®ç‚¹åŒ…æ‹¬ï¼š</p><ul><li><p><code>SuperClassOrInterface</code>ï¼šåŒ¿åç±»å¯ä»¥ç»§æ‰¿ä¸€ä¸ªç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªéƒ¨åˆ†å°±æ˜¯ä½ è¦ç»§æ‰¿æˆ–å®ç°çš„ç±»æˆ–æ¥å£çš„ç±»å‹ã€‚</p></li><li><p>æˆå‘˜å˜é‡ï¼šå¦‚æœéœ€è¦ï¼Œåœ¨åŒ¿åç±»å†…éƒ¨å¯ä»¥å®šä¹‰æˆå‘˜å˜é‡ï¼Œå¯ä»¥åœ¨æ„é€ å™¨ã€åˆå§‹åŒ–å—ä»¥åŠæ–¹æ³•ä¸­ä½¿ç”¨ã€‚</p></li><li><p>åˆå§‹åŒ–å—ï¼šå¦‚æœéœ€è¦ï¼Œåœ¨åŒ¿åç±»å†…éƒ¨å¯ä»¥å®šä¹‰åˆå§‹åŒ–å—ï¼Œç”¨æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ã€‚</p></li><li><p>æ–¹æ³•é‡å†™ï¼šåŒ¿åç±»å¯ä»¥é‡å†™çˆ¶ç±»æˆ–æ¥å£ä¸­çš„æ–¹æ³•ã€‚</p></li><li><p><code>returnType</code>ï¼šé‡å†™æ–¹æ³•çš„è¿”å›ç±»å‹ã€‚</p></li><li><p><code>methodName()</code>ï¼šè¦é‡å†™çš„æ–¹æ³•åã€‚</p></li></ul><h2 id="åŒ¿åç±»å¯¹å±€éƒ¨å˜é‡çš„è®¿é—®è§„åˆ™ï¼ŒåŠå¯¹æˆå‘˜çš„å£°æ˜åŠè®¿é—®è§„åˆ™"><a href="#åŒ¿åç±»å¯¹å±€éƒ¨å˜é‡çš„è®¿é—®è§„åˆ™ï¼ŒåŠå¯¹æˆå‘˜çš„å£°æ˜åŠè®¿é—®è§„åˆ™" class="headerlink" title="åŒ¿åç±»å¯¹å±€éƒ¨å˜é‡çš„è®¿é—®è§„åˆ™ï¼ŒåŠå¯¹æˆå‘˜çš„å£°æ˜åŠè®¿é—®è§„åˆ™"></a>åŒ¿åç±»å¯¹å±€éƒ¨å˜é‡çš„è®¿é—®è§„åˆ™ï¼ŒåŠå¯¹æˆå‘˜çš„å£°æ˜åŠè®¿é—®è§„åˆ™</h2><p>ä¸å±€éƒ¨ç±»ä¸€æ ·ï¼ŒåŒ¿åç±»å¯ä»¥æ•è·å˜é‡ï¼Œå®ƒä»¬å¯¹å¤–éƒ¨åŸŸçš„å±€éƒ¨å˜é‡å…·æœ‰ç›¸åŒçš„è®¿é—®æƒé™ï¼š</p><ol><li>åŒ¿åç±»å¯ä»¥è®¿é—®å…¶å¤–éƒ¨ç±»çš„æˆå‘˜ã€‚</li><li>åŒ¿åç±»æ— æ³•è®¿é—®å…¶å¤–éƒ¨åŸŸå†…æœªå£°æ˜ä¸º<code>final</code>æˆ–å®é™…ä¸Šæœªå£°æ˜ä¸º<code>final</code>çš„<strong>å±€éƒ¨å˜é‡</strong>ã€‚</li><li>ä¸åµŒå¥—ç±»ä¸€æ ·ï¼ŒåŒ¿åç±»ä¸­çš„ç±»å‹ï¼ˆä¾‹å¦‚å˜é‡ï¼‰å£°æ˜ä¼šéšè—ï¼ˆ<strong>shadow</strong>ï¼‰å¤–éƒ¨åŸŸä¸­å…·æœ‰ç›¸åŒåç§°çš„ä»»ä½•å…¶ä»–å£°æ˜ã€‚</li></ol><p>åŒ¿åç±»å¯¹äºå…¶æˆå‘˜ä¹Ÿæœ‰ä¸å±€éƒ¨ç±»ç›¸åŒçš„é™åˆ¶ï¼š</p><ol><li>ä¸èƒ½åœ¨åŒ¿åç±»ä¸­å£°æ˜<strong>é™æ€åˆå§‹åŒ–å—</strong>æˆ–<strong>æˆå‘˜æ¥å£</strong>ã€‚</li><li>åŒ¿åç±»å¯ä»¥å…·æœ‰é™æ€æˆå‘˜ï¼Œå‰ææ˜¯å®ƒä»¬æ˜¯<strong>å¸¸é‡å˜é‡</strong>ã€‚</li></ol><p>åŒ¿åç±»ä¸­å¯ä»¥å£°æ˜ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>å­—æ®µ</li><li>é¢å¤–çš„æ–¹æ³•ï¼ˆå³ä½¿å®ƒä»¬ä¸å®ç°çˆ¶ç±»çš„ä»»ä½•æ–¹æ³•ï¼‰</li><li>å®ä¾‹åˆå§‹åŒ–å—ï¼ˆInstance initializersï¼‰</li><li>å±€éƒ¨ç±»ï¼ˆLocal classesï¼‰</li></ul><p>ä½†æ˜¯ï¼Œ<strong>åœ¨åŒ¿åç±»ä¸­ä¸èƒ½å£°æ˜æ„é€ å‡½æ•°</strong>ï¼ˆconstructorsï¼‰ã€‚</p><h2 id="åŒ¿åç±»è®¿é—®å¤–éƒ¨ç±»æˆå‘˜"><a href="#åŒ¿åç±»è®¿é—®å¤–éƒ¨ç±»æˆå‘˜" class="headerlink" title="åŒ¿åç±»è®¿é—®å¤–éƒ¨ç±»æˆå‘˜"></a>åŒ¿åç±»è®¿é—®å¤–éƒ¨ç±»æˆå‘˜</h2><p>ä¸€ä¸ªæœ‰ç»§æ‰¿çˆ¶ç±»çš„åŒ¿åç±»ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnimalTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤–éƒ¨ç±»æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> String ANIMAL = <span class="string">&quot;åŠ¨ç‰©&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤–éƒ¨ç±»æˆå‘˜æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accessTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¿åç±»è®¿é—®å…¶å¤–éƒ¨ç±»æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAnimalName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(bird.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¸Ÿç±»ï¼ŒåŒ¿åå­ç±»ï¼Œç»§æ‰¿è‡ªAnimalç±»ï¼Œå¯ä»¥è¦†å†™çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    Animal bird = <span class="keyword">new</span> Animal(<span class="string">&quot;å¸ƒè°·é¸Ÿ&quot;</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAnimalName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            accessTest();   <span class="comment">// è®¿é—®å¤–éƒ¨ç±»æˆå‘˜æ–¹æ³•</span></span><br><span class="line">            System.out.println(ANIMAL);  <span class="comment">// è®¿é—®å¤–éƒ¨ç±»æˆå‘˜å˜é‡</span></span><br><span class="line">            <span class="keyword">super</span>.printAnimalName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bird.printAnimalName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        AnimalTest animalTest = <span class="keyword">new</span> AnimalTest();</span><br><span class="line">        animalTest.print();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">        <span class="comment">// åŒ¿åç±»è®¿é—®å…¶å¤–éƒ¨ç±»æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// åŠ¨ç‰©</span></span><br><span class="line">        <span class="comment">// å¸ƒè°·é¸Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŒ¿åç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ã€‚äº‹å®ä¸Šï¼Œä»–ä»¬ç”šè‡³å¯ä»¥ä¿®æ”¹è¿™äº›æˆå‘˜ã€‚</p><h2 id="åŒ¿åç±»è®¿é—®å±€éƒ¨å˜é‡"><a href="#åŒ¿åç±»è®¿é—®å±€éƒ¨å˜é‡" class="headerlink" title="åŒ¿åç±»è®¿é—®å±€éƒ¨å˜é‡"></a>åŒ¿åç±»è®¿é—®å±€éƒ¨å˜é‡</h2><p>åŒ¿åç±»ä¸å±€éƒ¨ç±»å¯¹å¤–éƒ¨åŸŸ<strong>å±€éƒ¨å˜é‡</strong>çš„è®¿é—®æƒé™æ˜¯ç›¸åŒçš„ï¼Œå…ˆçœ‹ä¸‹é¢å±€éƒ¨ç±»çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OuterClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> outerValue = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// å°è¯•ä¿®æ”¹å±€éƒ¨å˜é‡ localValueï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outerMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> localValue = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">LocalInner</span> </span>&#123;</span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">innerMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// è¾“å‡ºValue</span></span><br><span class="line">                System.out.println(<span class="string">&quot;å†…éƒ¨æ–¹æ³•å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨å˜é‡Int: &quot;</span> + outerValue);</span><br><span class="line">                System.out.println(<span class="string">&quot;å†…éƒ¨æ–¹æ³•å†…éƒ¨ç±»è®¿é—®å±€éƒ¨å˜é‡Int: &quot;</span> + localValue);</span><br><span class="line">                outerValue = <span class="number">20</span>;</span><br><span class="line">                System.out.println(<span class="string">&quot;å†…éƒ¨æ–¹æ³•å†…éƒ¨ç±»ä¿®æ”¹å¤–éƒ¨å˜é‡Int: &quot;</span> + outerValue);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°è¯•ä¿®æ”¹å±€éƒ¨å˜é‡ localValueï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LocalInner localInner = <span class="keyword">new</span> LocalInner();</span><br><span class="line">        localInner.innerMethod();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        OuterClass outer = <span class="keyword">new</span> OuterClass();</span><br><span class="line">        outer.outerMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">        <span class="comment">// å†…éƒ¨ç±»æ–¹æ³•è®¿é—®å¤–éƒ¨ç±»æˆå‘˜å˜é‡Int: 10</span></span><br><span class="line">        <span class="comment">// å†…éƒ¨ç±»æ–¹æ³•è®¿é—®å±€éƒ¨å˜é‡Int: 20</span></span><br><span class="line">        <span class="comment">// å†…éƒ¨ç±»æ–¹æ³•ä¿®æ”¹å¤–éƒ¨ç±»æˆå‘˜å˜é‡Int: 20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºè¯´æ˜å±€éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»æˆå‘˜ï¼Œä¹Ÿå¯ä»¥è®¿é—®å±€éƒ¨å˜é‡ã€‚ä½†ä¿®æ”¹å±€éƒ¨å˜é‡ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ·»åŠ <code>localValue = 10;</code>åœ¨å¯¹åº”æ³¨é‡Šä¸‹å¹¶æ‰§è¡Œï¼Œä¼šæŠ¥é”™ï¼š<code>java: ä»å†…éƒ¨ç±»å¼•ç”¨çš„æœ¬åœ°å˜é‡å¿…é¡»æ˜¯æœ€ç»ˆå˜é‡æˆ–å®é™…ä¸Šçš„æœ€ç»ˆå˜é‡</code>ã€‚</p><p>è¿™æ˜¯å› ä¸ºå±€éƒ¨ç±»è®¿é—®å±€éƒ¨å˜é‡çš„å…ˆå†³æ¡ä»¶æ˜¯å±€éƒ¨å˜é‡æ»¡è¶³<code>final</code>æˆ–<strong>ç­‰æ•ˆ<code>final</code></strong>ã€‚ç®€å•æ¥è¯´ï¼Œè¯¥å±€éƒ¨å˜é‡å¿…é¡»åœ¨åˆå§‹åŒ–åä¸è¢«ä¿®æ”¹ï¼Œæ— è®ºæ˜¯å¦å£°æ˜ä¸º<code>final</code>ã€‚</p><p>åŒ¿åç±»å¯¹äºå±€éƒ¨å˜é‡çš„è®¿é—®è§„åˆ™ä¸å±€éƒ¨ç±»ç›¸åŒï¼Œå¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EffectivelyFinalExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">10</span>; <span class="comment">// Effectively Finalï¼Œè™½ç„¶æ²¡æœ‰å£°æ˜ä¸ºfinalï¼Œä½†ä¸ä¼šå†æ¬¡ä¿®æ”¹</span></span><br><span class="line">        <span class="comment">// x = 20; // å¦‚æœå°è¯•ä¿®æ”¹xçš„å€¼ï¼Œç¼–è¯‘å™¨å°†äº§ç”Ÿé”™è¯¯</span></span><br><span class="line"></span><br><span class="line">        Runnable r = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Value of x: &quot;</span> + x); <span class="comment">// åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­è®¿é—®Effectively Finalå˜é‡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒ¿åç±»éšè—å¤–éƒ¨åŸŸå£°æ˜"><a href="#åŒ¿åç±»éšè—å¤–éƒ¨åŸŸå£°æ˜" class="headerlink" title="åŒ¿åç±»éšè—å¤–éƒ¨åŸŸå£°æ˜"></a>åŒ¿åç±»éšè—å¤–éƒ¨åŸŸå£°æ˜</h2><p>å½“åœ¨åŒ¿åç±»ä¸­å£°æ˜å…·æœ‰ä¸å¤–éƒ¨ç±»ç›¸åŒåç§°çš„ç±»å‹ï¼ˆä¾‹å¦‚å˜é‡ï¼‰æ—¶ï¼Œä¼šå‘ç”Ÿéšè—ï¼ˆshadowingï¼‰ç°è±¡ã€‚è¿™æ„å‘³ç€åŒ¿åç±»ä¸­çš„ç±»å‹å£°æ˜ä¼šè¦†ç›–å¤–éƒ¨ç±»ä¸­å…·æœ‰ç›¸åŒåç§°çš„ä»»ä½•å…¶ä»–å£°æ˜ï¼Œä»è€Œéšè—å¤–éƒ¨ç±»ä¸­çš„ç›¸åº”å†…å®¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œç”¨äºè¯´æ˜è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShadowingExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">10</span>; <span class="comment">// å¤–éƒ¨ç±»ä¸­çš„æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value = <span class="number">20</span>; <span class="comment">// å¤–éƒ¨ç±»ä¸­çš„å±€éƒ¨å˜é‡</span></span><br><span class="line"></span><br><span class="line">        Runnable r = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> value = <span class="number">30</span>; <span class="comment">// åŒ¿åç±»ä¸­çš„å±€éƒ¨å˜é‡ï¼Œä¼šéšè—å¤–éƒ¨ç±»çš„å±€éƒ¨å˜é‡</span></span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;Value in anonymous class: &quot;</span> + value); <span class="comment">// è®¿é—®åŒ¿åç±»ä¸­çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Value in outer class method: &quot;</span> + ShadowingExample.<span class="keyword">this</span>.value); <span class="comment">// è®¿é—®å¤–éƒ¨ç±»æˆå‘˜å˜é‡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        r.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShadowingExample example = <span class="keyword">new</span> ShadowingExample();</span><br><span class="line">        example.performAction();</span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">        <span class="comment">// Value in anonymous class: 30</span></span><br><span class="line">        <span class="comment">// Value in outer class method: 10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åŒ¿åç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ShadowingExample.this.value</code> è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå› ä¸ºåŒ¿åç±»ä¸­çš„å±€éƒ¨å˜é‡ <code>value</code> éšè—äº†å¤–éƒ¨ç±»çš„å±€éƒ¨å˜é‡ <code>value</code>ï¼Œä½†æ²¡æœ‰éšè—å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ <code>value</code>ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html">https://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html</a><br>[2] <a href="https://www.cnblogs.com/wuhenzhidu/p/anonymous.html">https://www.cnblogs.com/wuhenzhidu/p/anonymous.html</a><br>[3] <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html#shadowing">https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html#shadowing</a><br>[4] <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html">https://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Javaä¸­çš„åŒ¿åç±»ï¼ŒJava8åŠä»¥åã€‚&lt;/p&gt;
&lt;p&gt;æ¶‰åŠæ¦‚å¿µåŒ…æ‹¬ï¼š&lt;strong&gt;ç­‰æ•ˆ&lt;code&gt;final&lt;/code&gt;&lt;/strong&gt;ï¼Œæˆå‘˜ï¼Œå˜é‡ï¼Œä½œç”¨åŸŸã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis-Plusä¹‹é…ç½®è‡ªåŠ¨å¡«å……</title>
    <link href="http://silencezheng.top/2023/08/26/article118/"/>
    <id>http://silencezheng.top/2023/08/26/article118/</id>
    <published>2023-08-26T05:12:19.000Z</published>
    <updated>2023-08-26T05:13:41.546Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é€šè¿‡<code>MetaObjectHandler</code>æ¥å£ï¼Œé…ç½®MyBatis-Plusçš„è‡ªåŠ¨å¡«å……ã€‚</p><p>MyBatis-Plusç‰ˆæœ¬ï¼š<code>3.4.3.4</code><br><span id="more"></span></p><h2 id="ä»€ä¹ˆæ˜¯è‡ªåŠ¨å¡«å……"><a href="#ä»€ä¹ˆæ˜¯è‡ªåŠ¨å¡«å……" class="headerlink" title="ä»€ä¹ˆæ˜¯è‡ªåŠ¨å¡«å……"></a>ä»€ä¹ˆæ˜¯è‡ªåŠ¨å¡«å……</h2><p>é€šå¸¸åœ¨å»ºè¡¨æ—¶ï¼Œä¼šè®¾ç½®ä¸€äº›å…¬å…±å­—æ®µï¼Œä¾‹å¦‚åˆ›å»ºäººï¼ˆcreatorï¼‰ã€æ›´æ–°äººï¼ˆuptaterï¼‰ã€åˆ›å»ºæ—¶é—´ï¼ˆcreate_timeï¼‰ã€æ›´æ–°æ—¶é—´ï¼ˆupdate_timeï¼‰ç­‰ç­‰ã€‚</p><p>æ¯æ¬¡å°†å®ä½“å¯¹è±¡æ–°å¢å…¥åº“æ—¶ï¼Œéƒ½è¦è®¾ç½®åˆ›å»ºäººå’Œåˆ›å»ºæ—¶é—´ï¼›æ¯æ¬¡æ›´æ–°å®ä½“å¯¹è±¡æ—¶ï¼Œéƒ½è¦è®¾ç½®æ›´æ–°äººå’Œæ›´æ–°æ—¶é—´ï¼›å¦‚æœè¿™äº›éƒ½æ”¾åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¾ˆæ˜¯ç¹çï¼Œäºæ˜¯å°±éœ€è¦é…ç½®è‡ªåŠ¨å¡«å……æ¥ç®€åŒ–å·¥ä½œã€‚</p><h2 id="MetaObjectHandler"><a href="#MetaObjectHandler" class="headerlink" title="MetaObjectHandler"></a>MetaObjectHandler</h2><p><code>MetaObjectHandler</code> æ˜¯ MyBatis-Plus æä¾›çš„ä¸€ä¸ªæ¥å£ç±»ï¼Œé€šè¿‡å®ç°è¯¥æ¥å£å¹¶é‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼ˆæ’å…¥å’Œæ›´æ–°ï¼‰æ—¶è‡ªåŠ¨å¡«å……æŸäº›å­—æ®µçš„å€¼ã€‚</p><p><code>MetaObjectHandler</code> ä¸­æœ‰è‹¥å¹²é»˜è®¤æ–¹æ³•ï¼ˆå·²å®ç°ï¼‰å’Œä¸¤ä¸ªæ¥å£æ–¹æ³•ï¼ˆéœ€å®ç°ï¼‰ï¼Œæ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MetaObject æ˜¯ MyBatis çš„ä¸€ä¸ªåå°„å·¥å…·ç±»ï¼Œç”¨äºæ“ä½œ Java å¯¹è±¡çš„å±æ€§ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥è·å–ã€è®¾ç½®ã€åˆ¤æ–­å’Œæ“ä½œ Java å¯¹è±¡çš„å±æ€§ï¼Œä½¿å¾—åœ¨ä¸ç›´æ¥è°ƒç”¨ JavaBean çš„ getter å’Œ setter æ–¹æ³•çš„æƒ…å†µä¸‹è¿›è¡Œå±æ€§æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿å’Œçµæ´»ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºç¡€çš„è‡ªåŠ¨å¡«å……é…ç½®ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ–°å¢æ—¶å¡«å……</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, LocalDateTime.class, LocalDateTime.now()); <span class="comment">// èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨èä½¿ç”¨)</span></span><br><span class="line">            <span class="comment">// æˆ–è€…</span></span><br><span class="line">            <span class="keyword">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, () -&gt; LocalDateTime.now(), LocalDateTime.class); <span class="comment">// èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹æ—¶å¡«å……</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now()); <span class="comment">// èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨è)</span></span><br><span class="line">            <span class="comment">// æˆ–è€…</span></span><br><span class="line">            <span class="keyword">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, () -&gt; LocalDateTime.now(), LocalDateTime.class); <span class="comment">// èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æƒ³ä½¿ç”¨ <code>MetaObjectHandler</code>ï¼Œéœ€è¦åœ¨å…¶å®ç°ç±»ä¸Šæ·»åŠ  <code>@Component</code> æ³¨è§£ï¼Œç„¶åå°†å…¶æ³¨å†Œä¸º Spring çš„ä¸€ä¸ª Beanï¼Œè¿™æ · MyBatis Plus å°±ä¼šè‡ªåŠ¨è°ƒç”¨å…¶ä¸­å®šä¹‰çš„æ–¹æ³•æ¥è¿›è¡Œå­—æ®µå€¼çš„å¡«å……ã€‚</p><p>ç„¶åï¼Œåœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå‘ŠçŸ¥Mybatis-Pluséœ€è¦é¢„ç•™æ³¨å…¥SQLå­—æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(value = &quot;create_time&quot;,fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br></pre></td></tr></table></figure><p>å¡«å……ç­–ç•¥åŒ…æ‹¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FieldFill</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ä¸å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DEFAULT,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥å¡«å……å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSERT,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°å¡«å……å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UPDATE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥å’Œæ›´æ–°å¡«å……å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSERT_UPDATE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>1ã€å¦‚æœå±æ€§æœ‰å€¼åˆ™ä¸è¦†ç›–ï¼Œå¦‚æœsqlä¸­èµ‹å€¼äº†ï¼Œè‡ªåŠ¨å¡«å……åˆè®¾ç½®ä¸ºå…¶ä»–å€¼ï¼Œåˆ™ä»¥sqlä¸­çš„å€¼ä¸ºå‡†ã€‚</p><p>2ã€å¦‚æœå¡«å……å€¼ä¸ºnullåˆ™ä¸å¡«å……ï¼Œæ¯”å¦‚<code>this.setFieldValByName(â€œupdate_timeâ€, null, metaObject);</code>å®é™…æ˜¯ä¸ä¼šæ›´æ–°ä¸ºnullçš„ã€‚</p><p>3ã€å¡«å……å¤„ç†å™¨ï¼ˆå¦‚<code>MyMetaObjectHandler</code>ï¼‰åœ¨ Spring Boot ä¸­éœ€è¦å£°æ˜<code>@Component</code>æˆ–<code>@Bean</code>æ³¨å…¥</p><p>4ã€æœ€å¥½ä¸è¦åœ¨è‡ªå®šä¹‰mapperæ–¹æ³•ä¸­ä½¿ç”¨å¡«å……ï¼Œéè¦ä½¿ç”¨çš„è¯éœ€è¦ä½¿ç”¨ç‰¹å®šå‚æ•°æ³¨è§£ï¼Œå¦‚<code>@Param(&quot;et&quot;)</code>ç­‰ã€‚</p><p>5ã€<code>update(T t,Wrapper updateWrapper)</code>æ—¶<code>t</code>ä¸èƒ½ä¸ºç©º,å¦åˆ™è‡ªåŠ¨å¡«å……å¤±æ•ˆï¼Œå¦‚<code>this.update(new User(), new UpdateWrapper&lt;User&gt;().set(&quot;name&quot;, &quot;å¼ ä¸‰&quot;)));</code>ä¸èƒ½çœç•¥<code>new User()</code>ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;MetaObjectHandler&lt;/code&gt;æ¥å£ï¼Œé…ç½®MyBatis-Plusçš„è‡ªåŠ¨å¡«å……ã€‚&lt;/p&gt;
&lt;p&gt;MyBatis-Plusç‰ˆæœ¬ï¼š&lt;code&gt;3.4.3.4&lt;/code&gt;&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="MyBatis" scheme="http://silencezheng.top/tags/MyBatis/"/>
    
  </entry>
  
  <entry>
    <title>å›¾å·ç§¯(GCN)å­¦ä¹ </title>
    <link href="http://silencezheng.top/2023/08/15/article117/"/>
    <id>http://silencezheng.top/2023/08/15/article117/</id>
    <published>2023-08-15T15:11:28.000Z</published>
    <updated>2023-08-15T15:16:44.254Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å›¾å·ç§¯å­¦ä¹ è®°å½•ï¼ŒåŒæ—¶ä¹Ÿæ¶‰åŠç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­å†…å®¹ï¼Œå¯èƒ½å¯¹è§†è§‰æ–¹å‘æœ‰å¸®åŠ©ã€‚</p><p>ç›¸å…³å†…å®¹ï¼šå·ç§¯ã€å‚…ç«‹å¶å˜æ¢ã€æ‹‰æ™®æ‹‰æ–¯ç®—å­ã€ç‹„åˆ©å…‹é›·èƒ½é‡ã€å›¾å·ç§¯<br><span id="more"></span></p><h2 id="ä¼ ç»Ÿå·ç§¯"><a href="#ä¼ ç»Ÿå·ç§¯" class="headerlink" title="ä¼ ç»Ÿå·ç§¯"></a>ä¼ ç»Ÿå·ç§¯</h2><p>ä¼ ç»Ÿçš„å·ç§¯ä¸»è¦åº”ç”¨äºEuclidean Structureçš„æ•°æ®ä¸Šï¼ˆæ’åˆ—å¾ˆæ•´é½ã€Gridå½¢å¼çš„ï¼‰ï¼Œå¦‚å›¾åƒã€è¯­å¥ç­‰ï¼Œä¸»è¦æ˜¯å› ä¸ºæ¬§å¼ç»“æ„æ•°æ®èƒ½å¤Ÿä¿è¯å·ç§¯çš„æ€§è´¨ï¼Œå³å¹³ç§»ä¸å˜æ€§ï¼Œè€ŒNon-Euclideanæ— æ³•ä¿è¯å¹³ç§»ä¸å˜æ€§ï¼Œé€šä¿—ç†è§£å°±æ˜¯åœ¨æ‹“æ‰‘å›¾ä¸­æ¯ä¸ªé¡¶ç‚¹çš„ç›¸é‚»é¡¶ç‚¹æ•°ç›®éƒ½å¯èƒ½ä¸åŒï¼Œé‚£ä¹ˆå½“ç„¶æ— æ³•ç”¨ä¸€ä¸ªåŒæ ·å°ºå¯¸çš„å·ç§¯æ ¸æ¥è¿›è¡Œå·ç§¯è¿ç®—ã€‚</p><h2 id="æ¨å¹¿å·ç§¯åˆ°å›¾"><a href="#æ¨å¹¿å·ç§¯åˆ°å›¾" class="headerlink" title="æ¨å¹¿å·ç§¯åˆ°å›¾"></a>æ¨å¹¿å·ç§¯åˆ°å›¾</h2><p>å·ç§¯å®šç†æŒ‡å‡ºï¼Œ<strong>å‡½æ•°å·ç§¯çš„å‚…é‡Œå¶å˜æ¢æ˜¯å‡½æ•°å‚…é‡Œå¶å˜æ¢çš„ä¹˜ç§¯</strong>ã€‚å³ä¸€ä¸ªåŸŸä¸­çš„å·ç§¯å¯¹åº”äºå¦ä¸€ä¸ªåŸŸä¸­çš„ä¹˜ç§¯, ä¾‹å¦‚æ—¶åŸŸä¸­çš„å·ç§¯å¯¹åº”äºé¢‘åŸŸä¸­çš„ä¹˜ç§¯ã€‚</p><script type="math/tex; mode=display">\mathcal{F}\{f * g\}=\mathcal{F}\{f\} \cdot \mathcal{F}\{g\}</script><p>å…¶ä¸­ $\mathcal{F}(f)$ è¡¨ç¤º $f$ çš„å‚…é‡Œå¶å˜æ¢ã€‚ä¸‹é¢è¿™ç§å½¢å¼ä¹Ÿæˆç«‹ï¼š</p><script type="math/tex; mode=display">\mathcal{F}\{f \cdot g\}=\mathcal{F}\{f\} * \mathcal{F}\{g\}</script><p>å€Ÿç”±å‚…é‡Œå¶é€†å˜æ¢ $\mathcal{F}^{-1}$, ä¹Ÿå¯ä»¥å†™æˆï¼š</p><script type="math/tex; mode=display">f * g=\mathcal{F}^{-1}\{\mathcal{F}\{f\} \cdot \mathcal{F}\{g\}\}</script><p>æ³¨æ„ä»¥ä¸Šçš„å†™æ³•åªå¯¹ç‰¹å®šå½¢å¼å®šä¹‰çš„å˜æ¢æ­£ç¡®ï¼Œå˜æ¢å¯èƒ½ç”±å…¶å®ƒæ–¹å¼æ­£è§„åŒ–ï¼Œä½¿å¾—ä¸Šé¢çš„å…³ç³»å¼ä¸­å‡ºç°å…¶å®ƒçš„å¸¸æ•°å› å­ã€‚</p><p>è¿™ä¸€å®šç†å¯¹æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€åŒè¾¹æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€Zå˜æ¢ã€æ¢…æ—å˜æ¢å’ŒHartleyå˜æ¢ç­‰å„ç§å‚…é‡Œå¶å˜æ¢çš„å˜ä½“åŒæ ·æˆç«‹ã€‚</p><p>åˆ©ç”¨å·ç§¯å®šç†å¯ä»¥ç®€åŒ–å·ç§¯çš„è¿ç®—é‡ã€‚å¯¹äºé•¿åº¦ä¸º $n$ çš„åºåˆ—ï¼ŒæŒ‰ç…§å·ç§¯çš„å®šä¹‰è¿›è¡Œè®¡ç®—ï¼Œéœ€è¦åš $2 n-1$ ç»„å¯¹ä½ä¹˜æ³•ï¼Œå…¶è®¡ç®—å¤æ‚åº¦ä¸º $\mathcal{O}\left(n^2\right)$ï¼›è€Œåˆ©ç”¨å‚…é‡Œå¶å˜æ¢å°†åºåˆ—å˜æ¢åˆ°é¢‘åŸŸä¸Šåï¼Œåªéœ€è¦ä¸€ç»„å¯¹ä½ä¹˜æ³•ï¼Œåˆ©ç”¨å‚…é‡Œå¶å˜æ¢çš„å¿«é€Ÿç®—æ³•ä¹‹åï¼Œæ€»çš„è®¡ç®—å¤æ‚åº¦ä¸º $\mathcal{O}(n \log n)$ ã€‚è¿™ä¸€ç»“æœå¯ä»¥åœ¨å¿«é€Ÿä¹˜æ³•è®¡ç®—ä¸­å¾—åˆ°åº”ç”¨ã€‚</p><p>å‚…é‡Œå¶å˜æ¢åˆå¯ä»¥é€šè¿‡<strong>è°±å›¾ç†è®º</strong>æ¨å¹¿åˆ°å›¾ä¸Šè¿›è¡Œå˜æ¢ã€‚</p><blockquote><p>è°±å›¾ç†è®ºæ˜¯å›¾è®ºä¸çº¿æ€§ä»£æ•°ç›¸ç»“åˆçš„äº§ç‰©ï¼Œå®ƒé€šè¿‡åˆ†æå›¾çš„æŸäº›çŸ©é˜µçš„ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡è€Œç ”ç©¶å›¾çš„æ€§è´¨ã€‚æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ˜¯è°±å›¾ç†è®ºä¸­çš„æ ¸å¿ƒä¸åŸºæœ¬æ¦‚å¿µï¼Œåœ¨æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ ä¸­æœ‰é‡è¦çš„åº”ç”¨ã€‚åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼šæµå½¢å­¦ä¹ æ•°æ®é™ç»´ç®—æ³•ä¸­çš„æ‹‰æ™®æ‹‰æ–¯ç‰¹å¾æ˜ å°„ã€å±€éƒ¨ä¿æŒæŠ•å½±ï¼Œæ— ç›‘ç£å­¦ä¹ ä¸­çš„è°±èšç±»ç®—æ³•ï¼ŒåŠç›‘ç£å­¦ä¹ ä¸­åŸºäºå›¾çš„ç®—æ³•ï¼Œä»¥åŠç›®å‰ç‚™æ‰‹å¯çƒ­çš„å›¾ç¥ç»ç½‘ç»œç­‰ã€‚è¿˜æœ‰åœ¨å›¾åƒå¤„ç†ã€è®¡ç®—æœºå›¾å½¢å­¦ä»¥åŠå…¶ä»–å·¥ç¨‹é¢†åŸŸåº”ç”¨å¹¿æ³›çš„å›¾åˆ‡å‰²é—®é¢˜ã€‚ç†è§£æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„å®šä¹‰ä¸æ€§è´¨æ˜¯æŒæ¡è¿™äº›ç®—æ³•çš„åŸºç¡€ã€‚</p></blockquote><p>æ‰€ä»¥ï¼ŒConvolution â€”â€” Fourier â€”â€” Spectral Graphï¼Œå·ç§¯é€šè¿‡å‚…é‡Œå¶å˜æ¢å’Œå›¾ï¼ˆé¢‘è°±åŸŸï¼‰å‘ç”Ÿäº†è”ç³»ã€‚</p><p>ä»æ•´ä¸ªçš„ç ”ç©¶è¿›ç¨‹æ¥çœ‹ï¼Œé¦–å…ˆæ˜¯ç ”ç©¶GSPï¼ˆGraph Signal Processingï¼‰çš„å­¦è€…æå‡ºäº†Graphä¸Šçš„Fourier Transformationï¼Œè¿›è€Œå®šä¹‰äº†Graphçš„Convolutionï¼Œæœ€åä¸æ·±åº¦å­¦ä¹ ç»“åˆèµ·æ¥ï¼Œå‘å±•å‡ºæ¥GCNã€‚</p><h2 id="å›¾å‚…ç«‹å¶å˜æ¢çš„å®æ–½"><a href="#å›¾å‚…ç«‹å¶å˜æ¢çš„å®æ–½" class="headerlink" title="å›¾å‚…ç«‹å¶å˜æ¢çš„å®æ–½"></a>å›¾å‚…ç«‹å¶å˜æ¢çš„å®æ–½</h2><p>å…³äºæ—¶åŸŸå’Œé¢‘åŸŸï¼Œæˆ‘åœ¨<a href="https://silencezheng.top/2022/10/05/article67/">é«˜æ–¯æ»¤æ³¢å’ŒåŒè¾¹æ»¤æ³¢</a>ä¸€æ–‡ä¸­å·²æœ‰ä¸€äº›ä»‹ç»ã€‚</p><p>æ­¤å¤„éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯<strong>å‚…é‡Œå¶çº§æ•°æ˜¯å‘é‡</strong>ï¼Œä¸€èˆ¬æè¿°å‘é‡çš„æ—¶å€™ï¼Œéƒ½æœ‰å¯¹åº”çš„åŸºï¼Œå³åœ¨æŸç»„åŸºä¸‹çš„åæ ‡è¡¨ç¤ºæ„æˆäº†å‘é‡ã€‚é»˜è®¤æ˜¯å•ä½åŸºæ—¶ï¼Œåˆ™ä¸æ˜¾å¼æåˆ°ã€‚é¢‘åŸŸä¸‹ï¼ŒæŸä¸ªæ›²çº¿æ˜¯è¡¨ç¤ºæˆäº†å…³äºæ­£å¼¦å‡½æ•°æ­£äº¤åŸºä¸‹çš„å‚…é‡Œå¶çº§æ•°å‘é‡ã€‚è€Œåœ¨æ—¶åŸŸä¸‹ï¼ŒæŸä¸ªæ›²çº¿æ˜¯è¡¨ç¤ºæˆäº†å…³äºæ—¶é—´çš„å‘¨æœŸå‡½æ•°ã€‚ä¸ç®¡æ—¶åŸŸè¿˜æ˜¯é¢‘åŸŸï¼Œå…¶å®åæ˜ çš„éƒ½æ˜¯åŒä¸€ä¸ªæ›²çº¿ï¼Œåªæ˜¯ä¸€ä¸ªæ˜¯ç”¨å‡½æ•°çš„è§‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç”¨å‘é‡çš„è§‚ç‚¹ã€‚</p><p>å›¾ä¸Šçš„å‚…é‡Œå¶å˜æ¢æ˜¯é€šè¿‡ä¸‹è¿°è”ç³»å®æ–½çš„ï¼š</p><ol><li>å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼Œ Laplacian Operator â€”- Graph Laplacian Matrixã€‚</li><li>å›¾æ‹‰æ™®æ‹‰æ–¯çš„è°±åˆ†è§£ï¼ŒGraph Laplacian Matrix â€”- Spectral Decompositionã€‚</li><li>å›¾ä¸Šç‹„åˆ©å…‹é›·èƒ½é‡æœ€å°çš„åŸºï¼Œ Dirichlet Energy â€”- Orthonormal Basis â€”- Spectral Decomposition â€”- Eigenvectors</li><li>å‚…é‡Œå¶å˜æ¢ï¼ŒFourier â€”- Fourier Basis â€”- Laplacian eigenfunctions</li></ol><p>æ ¹æ®4ï¼Œå¯ä»¥è¯æ˜ï¼ŒFourier basis = Laplacian eigenfunctionsï¼Œå³å‚…ç«‹å¶çº§æ•°çš„åŸº(å’Œé¢‘ç‡ä¸€ä¸€å¯¹åº”)æ˜¯æ‹‰æ™®æ‹‰æ–¯ç®—å­çš„ç‰¹å¾å‡½æ•° (æ»¡è¶³ç‰¹å¾æ–¹ç¨‹)ã€‚æ ¹æ®1ï¼Œåœ¨å›¾ä¸Šï¼Œæ‹‰æ™®æ‹‰æ–¯ç®—å­ä¸ºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µã€‚æ ¹æ®2ï¼Œæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è°±åˆ†è§£å¾—åˆ°çš„ç‰¹å¾å‘é‡(å’Œç‰¹å¾å€¼ä¸€ä¸€å¯¹åº”)ç±»æ¯”ç‰¹å¾å‡½æ•°ã€‚å› æ­¤ï¼Œ<strong>ä¼ ç»Ÿå‚…é‡Œå¶å˜æ¢åœ¨å›¾çš„æ‹“å±•å°±æ˜¯å°†æ­£å¼¦å‡½æ•°åŸºæ›¿æ¢æ¢æˆå›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„ç‰¹å¾å‘é‡</strong>ï¼Œæ­£å¼¦å‡½æ•°ä¸é¢‘ç‡ä¸€ä¸€å¯¹åº”ï¼Œç‰¹å¾å‘é‡ä¸ç‰¹å¾å€¼ä¸€ä¸€å¯¹åº”ã€‚è€Œæ ¹æ®3ï¼Œè¿™ä¸€æ›¿æ¢çš„æ ¹æºæ„ä¹‰åœ¨äºï¼Œå›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„ç‰¹å¾å‘é‡ä½œä¸ºä¸€ç»„åŸºçš„è¯ï¼Œè¿™ç»„åŸºæ˜¯å›¾ä¸Šç‹„åˆ©å…‹é›·èƒ½é‡æœ€å°çš„åŸºã€‚</p><blockquote><p>Laplacian Operatorï¼ˆæ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼‰å’ŒLaplacian eigenfunctionsï¼ˆæ‹‰æ™®æ‹‰æ–¯ç‰¹å¾å‡½æ•°ï¼‰æ˜¯åœ¨å›¾è®ºå’Œå›¾ä¿¡å·å¤„ç†ä¸­å¯†åˆ‡ç›¸å…³çš„æ¦‚å¿µã€‚</p><ol><li><p>Laplacian Operator:<br>åœ¨å›¾è®ºä¸­ï¼ŒLaplacian Operatoræ˜¯ç”¨æ¥æè¿°å›¾çš„æ‹“æ‰‘ç»“æ„å’ŒèŠ‚ç‚¹ä¹‹é—´è¿æ¥å…³ç³»çš„ç®—å­ã€‚å¯¹äºä¸€ä¸ªæ— å‘å›¾Gï¼ŒLaplacian Operatoré€šå¸¸å®šä¹‰ä¸ºåº¦çŸ©é˜µï¼ˆDegree Matrixï¼‰Då’Œé‚»æ¥çŸ©é˜µï¼ˆAdjacency Matrixï¼‰Aä¹‹é—´çš„å·®ï¼Œå³L = D - Aã€‚å…¶ä¸­ï¼Œåº¦çŸ©é˜µDæ˜¯ä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼Œå…¶å¯¹è§’çº¿å…ƒç´ æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åº¦æ•°ï¼ˆä¸è¯¥èŠ‚ç‚¹ç›¸è¿æ¥çš„è¾¹çš„æ•°é‡ï¼‰ï¼Œé‚»æ¥çŸ©é˜µAæè¿°äº†èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚<br>Laplacian Operatoræœ‰å¤šç§å½¢å¼ï¼Œå¸¸è§çš„æœ‰åº¦æ ‡å‡†åŒ–Laplacianã€éšæœºæ¸¸èµ°æ ‡å‡†åŒ–Laplacianç­‰ï¼Œä¸åŒçš„å½¢å¼åœ¨ä¸åŒçš„å›¾ä¿¡å·å¤„ç†ä»»åŠ¡ä¸­æœ‰ä¸åŒçš„åº”ç”¨ã€‚</p></li><li><p>Laplacian eigenfunctions:<br>Laplacian eigenfunctionsæ˜¯æŒ‡Laplacian Operatorå¯¹åº”çš„ç‰¹å¾å‡½æ•°ï¼Œä¹Ÿç§°ä¸ºæ‹‰æ™®æ‹‰æ–¯ç‰¹å¾å‘é‡ã€‚Laplacian Operatorçš„ç‰¹å¾å‡½æ•°æ˜¯åœ¨å›¾ä¸Šå®šä¹‰çš„ä¸€ç»„æ­£äº¤å‡½æ•°ï¼Œå®ƒä»¬æè¿°äº†å›¾çš„æŒ¯åŠ¨æ¨¡å¼å’Œé¢‘ç‡ã€‚</p></li></ol><p>å¯¹äºå›¾çš„Laplacian Operator Lï¼Œå®ƒå¯ä»¥è¿›è¡Œè°±åˆ†è§£ï¼Œå¾—åˆ°ä¸€ç»„ç‰¹å¾å‘é‡ï¼ˆLaplacian eigenfunctionsï¼‰å’Œå¯¹åº”çš„ç‰¹å¾å€¼ï¼ˆLaplacian eigenvaluesï¼‰ã€‚è¿™äº›ç‰¹å¾å‘é‡åœ¨å›¾ä¿¡å·å¤„ç†ä¸­å…·æœ‰é‡è¦çš„æ„ä¹‰ï¼Œå®ƒä»¬æ„æˆäº†ä¸€ä¸ªåŸºï¼Œå¯ä»¥ç”¨äºå°†å›¾ä¿¡å·ä»åŸå§‹çš„èŠ‚ç‚¹ç©ºé—´è½¬æ¢åˆ°é¢‘åŸŸç©ºé—´ï¼Œç±»ä¼¼äºå‚…é‡Œå¶å˜æ¢ä¸­çš„åŸºå‡½æ•°ã€‚</p><p>Laplacian eigenfunctionså¯¹åº”çš„ç‰¹å¾å€¼å¯ä»¥ç”¨æ¥è¡¨ç¤ºå›¾çš„ç»“æ„å’ŒèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼Œä¸åŒçš„ç‰¹å¾å€¼å¯¹åº”ä¸åŒçš„é¢‘ç‡ï¼Œåæ˜ äº†å›¾çš„æŒ¯åŠ¨ç‰¹æ€§ã€‚åœ¨å›¾ä¿¡å·å¤„ç†ä»»åŠ¡ä¸­ï¼ŒLaplacian eigenfunctionså¸¸å¸¸è¢«ç”¨ä½œå›¾åµŒå…¥ã€å›¾å·ç§¯ç¥ç»ç½‘ç»œï¼ˆGCNï¼‰ç­‰æ–¹æ³•çš„åŸºç¡€ï¼Œä»¥ä¾¿æœ‰æ•ˆåœ°å­¦ä¹ å›¾çš„ç‰¹å¾å’Œç»“æ„ã€‚</p></blockquote><h2 id="å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­"><a href="#å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­" class="headerlink" title="å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­"></a>å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­</h2><p>å…ˆè®¨è®ºå¸¸è§„è¿ç»­æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼Œç„¶åé€šè¿‡<strong>æœ‰é™å·®åˆ†æ³•</strong>åœ¨ç¦»æ•£ç½‘æ ¼ä¸Šè¿‘ä¼¼è®¡ç®—æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼Œå¯¹å…¶è¿›è¡Œç¦»æ•£åŒ–ã€‚</p><blockquote><p>æœ‰é™å·®åˆ†æ³•æ˜¯å°†å¯¼æ•°æˆ–å¾®åˆ†ç®—å­æ›¿æ¢ä¸ºå·®åˆ†çš„å½¢å¼ï¼Œä»è€Œå°†å¾®åˆ†æ–¹ç¨‹è½¬åŒ–ä¸ºå·®åˆ†æ–¹ç¨‹ã€‚</p><p>å·®åˆ†æ–¹ç¨‹æ˜¯ä¸€ç§æ•°å­¦æ–¹ç¨‹ï¼Œç”¨äºæè¿°ç¦»æ•£ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œé€šå¸¸åœ¨æ•°å€¼è®¡ç®—å’Œç¦»æ•£æ¨¡å‹ä¸­ä½¿ç”¨ã€‚ä¸å¾®åˆ†æ–¹ç¨‹ç±»ä¼¼ï¼Œå·®åˆ†æ–¹ç¨‹æ˜¯åœ¨ç¦»æ•£æ—¶é—´æˆ–ç©ºé—´ä¸Šå»ºç«‹å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯è¿ç»­å˜é‡çš„å…³ç³»ã€‚</p></blockquote><p>æœ€åï¼Œæˆ‘ä»¬æ¨å¹¿åˆ°å›¾ç»“æ„ä¸Šã€‚</p><h3 id="æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼ˆLaplacian-Operatorï¼‰"><a href="#æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼ˆLaplacian-Operatorï¼‰" class="headerlink" title="æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼ˆLaplacian Operatorï¼‰"></a>æ‹‰æ™®æ‹‰æ–¯ç®—å­ï¼ˆLaplacian Operatorï¼‰</h3><p>æ‹‰æ™®æ‹‰æ–¯ç®—å­çš„ä¸¥æ ¼æ•°å­¦å®šä¹‰ï¼šå¤šå…ƒå‡½æ•°$f(x_1,â€¦,x_n)$çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­æ˜¯<strong>æ‰€æœ‰è‡ªå˜é‡çš„éæ··åˆäºŒé˜¶åå¯¼æ•°ä¹‹å’Œ</strong>ã€‚</p><script type="math/tex; mode=display">\Delta f=\sum_{i=1}^n \frac{\partial^2 f}{\partial x_i^2}</script><p>åŸºäºå®šä¹‰ï¼Œæ‰€æœ‰çš„__æ‹‰æ™®æ‹‰æ–¯ç®—å­éƒ½æ˜¯å…¶ä¸€ä¸ªç‰¹ä¾‹ï¼Œæˆ–æ˜¯æŸç§æƒ…å†µä¸‹(æ¯”å¦‚ç¦»æ•£æƒ…å†µä¸‹)çš„ä¸€ç§è¿‘ä¼¼ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¹‹åªèƒ½è¿‘ä¼¼è®¡ç®—å¯¼æ•°å€¼ï¼Œç§°ä¸º<strong>æ•°å€¼å¾®åˆ†</strong>ã€‚</p><blockquote><p>æ•°å€¼å¾®åˆ†æ˜¯ä¸€ç§é€šè¿‡æ•°å€¼è®¡ç®—æ¥è¿‘ä¼¼è®¡ç®—å‡½æ•°çš„å¯¼æ•°çš„æ–¹æ³•ã€‚å®ƒåœ¨æ•°å€¼åˆ†æå’Œç§‘å­¦è®¡ç®—ä¸­ç»å¸¸ç”¨äºè§£å†³æ— æ³•é€šè¿‡è§£ææ–¹æ³•æ±‚å¾—å¯¼æ•°çš„é—®é¢˜ï¼Œæˆ–è€…ç”¨äºéªŒè¯è§£æå¯¼æ•°çš„ç»“æœã€‚</p><p>æ•°å€¼å¾®åˆ†çš„åŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨å‡½æ•°åœ¨æŸä¸€ç‚¹é™„è¿‘çš„å‡½æ•°å€¼æ¥è¿‘ä¼¼è®¡ç®—è¯¥ç‚¹çš„å¯¼æ•°ã€‚å¸¸è§çš„æ•°å€¼å¾®åˆ†æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä¸­å¿ƒå·®åˆ†æ³•ï¼š</strong> ä¸­å¿ƒå·®åˆ†æ³•ä½¿ç”¨å‡½æ•°åœ¨å½“å‰ç‚¹çš„å‰åä¸¤ä¸ªé‚»è¿‘ç‚¹çš„å‡½æ•°å€¼æ¥è¿‘ä¼¼è®¡ç®—å¯¼æ•°ã€‚å®ƒçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f'(x) \approx \frac{f(x+h) - f(x-h)}{2h}</script><p>è¿™é‡Œï¼Œ$h$ æ˜¯ä¸€ä¸ªå°çš„æ­£æ•°ï¼Œä»£è¡¨ç‚¹çš„é—´éš”ã€‚</p></li><li><p><strong>å‰å‘å·®åˆ†æ³•ï¼š</strong> å‰å‘å·®åˆ†æ³•ä½¿ç”¨å‡½æ•°åœ¨å½“å‰ç‚¹å’Œè¯¥ç‚¹ä¹‹åçš„ä¸€ä¸ªé‚»è¿‘ç‚¹çš„å‡½æ•°å€¼æ¥è¿‘ä¼¼è®¡ç®—å¯¼æ•°ã€‚å®ƒçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f'(x) \approx \frac{f(x+h) - f(x)}{h}</script></li><li><p><strong>åå‘å·®åˆ†æ³•ï¼š</strong> åå‘å·®åˆ†æ³•ä½¿ç”¨å‡½æ•°åœ¨å½“å‰ç‚¹å’Œè¯¥ç‚¹ä¹‹å‰çš„ä¸€ä¸ªé‚»è¿‘ç‚¹çš„å‡½æ•°å€¼æ¥è¿‘ä¼¼è®¡ç®—å¯¼æ•°ã€‚å®ƒçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f'(x) \approx \frac{f(x) - f(x-h)}{h}</script></li></ol><p>æ•°å€¼å¾®åˆ†æ–¹æ³•çš„ç²¾åº¦å–å†³äºé—´éš”$h$çš„å¤§å°ï¼Œè¿‡å¤§çš„$h$å¯èƒ½å¼•å…¥è¾ƒå¤§çš„è¿‘ä¼¼è¯¯å·®ï¼Œè€Œè¿‡å°çš„$h$å¯èƒ½å¼•å…¥èˆå…¥è¯¯å·®ã€‚é€‰æ‹©åˆé€‚çš„$h$å€¼æ˜¯ç¡®ä¿æ•°å€¼å¾®åˆ†ç»“æœç²¾åº¦çš„å…³é”®ã€‚</p></blockquote><p>å¯¹äºäºŒé˜¶å¯¼æ•°ï¼Œåˆ™æœ‰ï¼š</p><script type="math/tex; mode=display">\begin{aligned}f^{\prime \prime}(x) & \approx \frac{f^{\prime}(x)-f^{\prime}(x-\Delta x)}{\Delta x} \approx \frac{\frac{f(x+\Delta x)-f(x)}{\Delta x}-\frac{f(x)-f(x-\Delta x)}{\Delta x}}{\Delta x} \\& =\frac{f(x+\Delta x)+f(x-\Delta x)-2 f(x)}{(\Delta x)^2}\end{aligned}</script><p>ä¸‹é¢è€ƒè™‘å¤šå…ƒå‡½æ•°çš„åå¯¼æ•°ã€‚å¯¹äºäºŒå…ƒå‡½æ•°$f(x,y)$ï¼Œå…¶æ‹‰æ™®æ‹‰æ–¯ç®—å­å¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼è¿‘ä¼¼è®¡ç®—ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\Delta f & =\frac{\partial^2 f}{\partial x^2}+\frac{\partial^2 f}{\partial y^2} \\& \approx \frac{f(x+\Delta x, y)+f(x-\Delta x, y)-2 f(x, y)}{(\Delta x)^2}+\frac{f(x, y+\Delta y)+f(x, y-\Delta y)-2 f(x, y)}{(\Delta y)^2}\end{aligned}</script><h3 id="ç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­"><a href="#ç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­" class="headerlink" title="ç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­"></a>ç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­</h3><p>å›¾åƒå’Œå›¾ç»“æ„éƒ½æ˜¯ç¦»æ•£æ•°æ®ï¼Œå…¶æ‹‰æ™®æ‹‰æ–¯ç®—å­å¿…ç„¶è¦è¿›è¡Œç¦»æ•£åŒ–ã€‚å¦‚æœä¸Šé¢çš„äºŒå…ƒå‡½æ•°è¿›è¡Œç¦»æ•£åŒ–ï¼Œå¯¹è‡ªå˜é‡çš„ä¸€ç³»åˆ—ç‚¹å¤„çš„å‡½æ•°å€¼è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°ä¸‹é¢ä¸€ç³»åˆ—ç‚¹å¤„çš„å‡½æ•°å€¼ï¼Œæ„æˆä¸€ä¸ªçŸ©é˜µã€‚</p><script type="math/tex; mode=display">\left[\begin{array}{cccc}f\left(x_1, y_1\right) & f\left(x_2, y_1\right) & \ldots & f\left(x_n, y_1\right) \\f\left(x_1, y_2\right) & f\left(x_2, y_2\right) & \ldots & f\left(x_n, y_2\right) \\\ldots & \ldots & \ldots & \ldots \\f\left(x_1, y_n\right) & f\left(x_2, y_n\right) & \ldots & f\left(x_n, y_n\right)\end{array}\right]</script><p>åœ¨è¿™é‡Œ $x$ ä¸ºæ°´å¹³æ–¹å‘ï¼Œ $y$ ä¸ºå‚ç›´æ–¹å‘ã€‚ä¸ºäº†ç®€åŒ–ï¼Œ å‡è®¾ $x$ å’Œ $y$ çš„å¢é‡ï¼ˆæ­¥é•¿ï¼‰å…¨ä¸º $1$ ï¼Œ å³ï¼š</p><script type="math/tex; mode=display">\Delta x=x_{i+1}-x_i=1, \Delta y=y_{i+1}-y_i=1</script><p>åˆ™ç‚¹ $\left(x_i, y_j\right)$ å¤„çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­å¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼è¿‘ä¼¼è®¡ç®—ï¼š</p><script type="math/tex; mode=display">\begin{aligned}& \frac{f\left(x_i+\Delta x, y_j\right)+f\left(x_i-\Delta x, y_j\right)-2 f\left(x_i, y_j\right)}{(\Delta x)^2}+\frac{f\left(x_i, y_j+\Delta y\right)+f\left(x_i, y_j-\Delta y\right)-2 f\left(x_i, y_j\right)}{(\Delta y)^2} \\& \quad=\frac{f\left(x_{i+1}, y_j\right)+f\left(x_{i-1}, y_j\right)-2 f\left(x_i, y_j\right)}{1^2}+\frac{f\left(x_i, y_{j+1}\right)+f\left(x_i, y_{j-1}\right)-2 f\left(x_i, y_j\right)}{1^2} \\& \quad=f\left(x_{i+1}, y_j\right)+f\left(x_{i-1}, y_j\right)+f\left(x_i, y_{j+1}\right)+f\left(x_i, y_{j-1}\right)-4 f\left(x_i, y_j\right)\end{aligned}</script><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç¾çš„ç»“æœï¼Œ å®ƒå°±æ˜¯ $\left(x_i, y_j\right)$ çš„ 4 ä¸ªç›¸é‚»ç‚¹å¤„çš„å‡½æ•°å€¼ä¹‹å’Œä¸ $\left(x_i, y_j\right)$ ç‚¹å¤„çš„å‡½æ•°å€¼ä¹˜ä»¥ 4 åçš„å·®å€¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/post_img/article117/lisan-lapo.png" alt="lisan"></p><p>åŸºäºè¿™ç§ç¦»æ•£è¡¨ç¤ºï¼Œæ‹‰æ™®æ‹‰æ–¯ç®—å­çš„è®¡ç®—å…¬å¼å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\Delta f & =f\left(x_{i+1}, y_j\right)+f\left(x_{i-1}, y_j\right)+f\left(x_i, y_{j+1}\right)+f\left(x_i, y_{j-1}\right)-4 f\left(x_i, y_j\right) \\& =f\left(x_{i+1}, y_j\right)-f\left(x_i, y_j\right)+f\left(x_{i-1}, y_j\right)-f\left(x_i, y_j\right) \\& +f\left(x_i, y_{j+1}\right)-f\left(x_i, y_j\right)+f\left(x_i, y_{j-1}\right)-f\left(x_i, y_j\right) \\& =\sum_{(k, l) \in N(i, j)}\left(f\left(x_k, y_l\right)-f\left(x_i, y_j\right)\right)\end{aligned}</script><p>å…¶ä¸­ $N(i, j)$ æ˜¯ $\left(x_i, y_j\right)$ é‚»å±…èŠ‚ç‚¹çš„é›†åˆã€‚</p><p>è¿™ä¹Ÿç»™æˆ‘ä»¬ä¸€ç§å½¢è±¡çš„ç»“è®ºï¼šäºŒç»´ç½‘æ ¼ï¼ˆç¦»æ•£äºŒå…ƒå‡½æ•°ï¼‰ä¸Šè®¡ç®—æŸç‚¹çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­å°±æ˜¯è®¡ç®—ä¸Šä¸‹å·¦å³å››ä¸ªè‡ªç”±åº¦ä¸Šçš„â€œå˜åŒ–å’Œâ€ã€‚</p><p>PSï¼šå˜åŒ–å’Œæ˜¯ç¬”è€…çš„ä¸ªäººç†è§£ï¼Œä¹Ÿæœ‰äººè¯´æ˜¯â€œå¾®å°å˜åŒ–åè·å¾—çš„å¢ç›Šâ€ã€‚å¦å¤–ï¼Œå¯¹äºäºŒç»´ç½‘æ ¼ï¼Œä¹Ÿå¯ä»¥æ‹“å±•å‡ºå…«ä¸ªè‡ªç”±åº¦çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­ã€‚</p><h3 id="å›¾ä¸Šçš„æ‹‰æ™®æ‹‰æ–¯ç®—å­"><a href="#å›¾ä¸Šçš„æ‹‰æ™®æ‹‰æ–¯ç®—å­" class="headerlink" title="å›¾ä¸Šçš„æ‹‰æ™®æ‹‰æ–¯ç®—å­"></a>å›¾ä¸Šçš„æ‹‰æ™®æ‹‰æ–¯ç®—å­</h3><p>åœ¨å›¾ä¸­ï¼Œé¡¶ç‚¹çš„è¿æ¥å…³ç³»æ˜¯ä»»æ„çš„ï¼Œè¿™æ„å‘³ç€é¡¶ç‚¹çš„é‚»å±…èŠ‚ç‚¹æ•°é‡ä¸å›ºå®šã€‚å°†æ‹‰æ™®æ‹‰æ–¯ç®—å­æ¨å¹¿åˆ°å›¾ä¸Šï¼Œå¦‚æœå°†å›¾çš„é¡¶ç‚¹å¤„çš„å€¼çœ‹ä½œæ˜¯å‡½æ•°å€¼ï¼Œåˆ™åœ¨é¡¶ç‚¹$i$å¤„çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­ä¸ºï¼š</p><script type="math/tex; mode=display">\Delta f_i=\sum_{j \in N_i}\left(f_i-f_j\right)</script><p>å…¶ä¸­ $N_i$ æ˜¯é¡¶ç‚¹ $i$ çš„æ‰€æœ‰é‚»å±…é¡¶ç‚¹çš„é›†åˆã€‚è¿™é‡Œæˆ‘ä»¬è°ƒæ¢äº† $f_i$ å’Œ $f_j$ çš„ä½ç½®ï¼Œ å’Œä¹‹å‰çš„æ‹‰æ™®æ‹‰æ–¯ç®—å­ç›¸æ¯”ï¼Œ ç›¸å½“äºå¤šäº†ä¸€ä¸ªè´Ÿå·ã€‚ç”±äºå›¾çš„è¾¹å¯ä»¥å¸¦æœ‰æƒé‡ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢çš„è®¡ç®—å…¬å¼ä¸­åŠ ä¸Šæƒé‡ï¼š</p><script type="math/tex; mode=display">\Delta f_i=\sum_{j \in N_i} w_{i j}\left(f_i-f_j\right)</script><p>å¦‚æœ $j$ ä¸æ˜¯ $i$ çš„é‚»å±…, åˆ™ $w_{i j}=0$ ã€‚å› æ­¤ä¸Šé¢çš„å¼å­ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><script type="math/tex; mode=display">\Delta f_i=\sum_{j \in V} w_{i j}\left(f_i-f_j\right)=\sum_{j \in V} w_{i j} f_i-\sum_{j \in V} w_{i j} f_j=d_i f_i-\mathbf{w}_i \mathbf{f}</script><p>è¿™é‡Œçš„ $d_i$ æ˜¯é¡¶ç‚¹ $i$ çš„åŠ æƒåº¦ï¼Œ$w_i$ æ˜¯é‚»æ¥çŸ©é˜µçš„ç¬¬ $i$ è¡Œ, $f$ æ˜¯æ‰€æœ‰é¡¶ç‚¹çš„å€¼æ„æˆçš„åˆ—å‘é‡, $w_i f$ æ˜¯äºŒè€…çš„å†…ç§¯ã€‚å¯¹äºå›¾çš„æ‰€æœ‰é¡¶ç‚¹, æœ‰</p><script type="math/tex; mode=display">\begin{aligned}\Delta f & =\left[\begin{array}{c}\Delta f_1 \\\ldots \\\Delta f_n\end{array}\right]=\left[\begin{array}{c}d_1 f_1-\mathbf{w}_1 \mathbf{f} \\\ldots \\d_n f_n-\mathbf{w}_n \mathbf{f}\end{array}\right]=\left[\begin{array}{ccc}d_1 & \ldots & \ldots \\\ldots & \ldots & \ldots \\\ldots & \ldots & d_n\end{array}\right]\left[\begin{array}{c}f_1 \\\ldots \\f_n\end{array}\right]-\left[\begin{array}{c}\mathbf{w}_1 \\\ldots \\\mathbf{w}_n\end{array}\right]\left[\begin{array}{c}f_1 \\\ldots \\f_n\end{array}\right] \\& =(\mathbf{D}-\mathbf{A}) \mathbf{f}\end{aligned}</script><p>ä¸Šå¼çš„å…¨ç§°æ˜¯ï¼šå›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­ä½œç”¨åœ¨ç”±å›¾èŠ‚ç‚¹ä¿¡æ¯æ„æˆçš„å‘é‡$f$ä¸Šå¾—åˆ°çš„ç»“æœç­‰äº<strong>å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ</strong>å’Œå‘é‡$f$çš„ç‚¹ç§¯ã€‚</p><p>è¿™ä¹Ÿè¯´æ˜ï¼Œ<strong>åœ¨å›¾ä¸Šï¼Œæ‹‰æ™®æ‹‰æ–¯ç®—å­ç­‰äºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ</strong>ã€‚</p><h3 id="å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆLaplacian-Matrixï¼‰"><a href="#å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆLaplacian-Matrixï¼‰" class="headerlink" title="å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆLaplacian Matrixï¼‰"></a>å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆLaplacian Matrixï¼‰</h3><p>ç”±æ­¤ï¼Œæˆ‘ä»¬æ¨å‡ºäº†æ— å‘å›¾ä¸Šå®šä¹‰æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„ä¸€ç§æ–¹å¼ï¼š</p><script type="math/tex; mode=display">L = D - A</script><p>å…¶ä¸­ï¼Œ$L$æ˜¯å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼Œ$D$æ˜¯åŠ æƒåº¦çŸ©é˜µï¼ˆWeighted Degree Matrixï¼‰ï¼Œ$A$æ˜¯é‚»æ¥çŸ©é˜µï¼ˆAdjacency Matrixï¼‰ã€‚</p><p>ç”±äº$D$ å’Œ $A$éƒ½æ˜¯å¯¹ç§°çŸ©é˜µï¼Œåˆ™æ— å‘å›¾çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µä¹Ÿæ˜¯å¯¹ç§°çŸ©é˜µï¼Œå®ƒå®é™…ä¸Šä»£è¡¨äº†å›¾çš„äºŒé˜¶å¯¼æ•°ã€‚</p><p>æ˜¾ç„¶æ— å‘å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ¯ä¸€è¡Œå…ƒç´ ä¹‹å’Œéƒ½ä¸º 0 ã€‚ä¸‹é¢ä»‹ç»æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è‹¥å¹²é‡è¦æ€§è´¨ï¼ˆçœç•¥è¯æ˜ï¼‰ï¼š</p><p>1ã€å¯¹ä»»æ„å‘é‡ $\mathbf{f} \in \mathbb{R}^n$ æœ‰ï¼š</p><script type="math/tex; mode=display">\mathbf{f}^{\mathrm{T}} \mathbf{L} \mathbf{f}=\frac{1}{2} \sum_{i=1}^n \sum_{j=1}^n w_{i j}\left(f_i-f_j\right)^2</script><p>2ã€æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ˜¯å¯¹ç§°åŠæ­£å®šçŸ©é˜µ;</p><p>3ã€æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„æœ€å°ç‰¹å¾å€¼ä¸º 0 ï¼Œå…¶å¯¹åº”çš„ç‰¹å¾å‘é‡ä¸ºå¸¸å‘é‡ 1 ï¼Œå³æ‰€æœ‰åˆ†é‡ä¸º 1 ;</p><p>4ã€æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæœ‰ $n$ ä¸ªéè´Ÿå®æ•°ç‰¹å¾å€¼ï¼Œå¹¶ä¸”æ»¡è¶³ï¼š</p><script type="math/tex; mode=display">0=\lambda_1 \leq \lambda_2 \leq \ldots \leq \lambda_n</script><p>5ï¼ˆç»“è®ºï¼‰ã€å‡è®¾ $G$ æ˜¯ä¸€ä¸ªæœ‰éè´Ÿæƒé‡çš„æ— å‘å›¾ï¼Œå…¶æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ $L$ çš„ç‰¹å¾å€¼0çš„é‡æ•° $k$ ç­‰äºå›¾çš„è”é€šåˆ†é‡çš„ä¸ªæ•°$A_1ï¼Œ \ldots, A_k$ã€‚ç‰¹å¾å€¼0çš„ç‰¹å¾ç©ºé—´ç”±è¿™äº›è”é€šåˆ†é‡æ‰€å¯¹åº”çš„ç‰¹å¾å‘é‡$\mathbf{1}_{A_1}ï¼Œ \ldots, \mathbf{1}_{A_k}$æ‰€å¼ æˆã€‚</p><p>å¯¹äºç»“è®º5ï¼Œä¸¾ä¸€ä¸ªä¾‹å­è¿›è¡Œè¯´æ˜ï¼š</p><p><img src="/assets/post_img/article117/jl5.png" alt="jl5"></p><p>ä¸Šå›¾æœ‰ä¸¤ä¸ªè”é€šå­å›¾ï¼Œå…¶é‚»æ¥çŸ©é˜µä¸ºï¼š</p><script type="math/tex; mode=display">\mathbf{A}=\left[\begin{array}{ccccc}0 & 0.37 & 0.37 & 0 & 0 \\0.37 & 0 & 0.14 & 0 & 0 \\0.37 & 0.14 & 0 & 0 & 0 \\0 & 0 & 0 & 0 & 0.37 \\0 & 0 & 0 & 0.37 & 0\end{array}\right]</script><p>å…¶åŠ æƒåº¦çŸ©é˜µä¸ºï¼š</p><script type="math/tex; mode=display">\mathbf{D}=\left[\begin{array}{ccccc}0.74 & 0 & 0 & 0 & 0 \\0 & 0.51 & 0 & 0 & 0 \\0 & 0 & 0.51 & 0 & 0 \\0 & 0 & 0 & 0.37 & 0 \\0 & 0 & 0 & 0 & 0.37\end{array}\right]</script><p>æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µä¸ºï¼š</p><script type="math/tex; mode=display">\mathbf{L}=\mathbf{D}-\mathbf{A}=\left[\begin{array}{ccccc}0.74 & -0.37 & -0.37 & 0 & 0 \\-0.37 & 0.51 & -0.14 & 0 & 0 \\-0.37 & -0.14 & 0.51 & 0 & 0 \\0 & 0 & 0 & 0.37 & -0.37 \\0 & 0 & 0 & -0.37 & 0.37\end{array}\right]</script><p>å®ƒç”±å¦‚ä¸‹ä¸¤ä¸ªå­çŸ©é˜µæ„æˆï¼š</p><script type="math/tex; mode=display">\begin{aligned}& \mathbf{L}_1=\left[\begin{array}{ccc}0.74 & -0.37 & -0.37 \\-0.37 & 0.51 & -0.14 \\-0.37 & -0.14 & 0.51\end{array}\right] \\& \mathbf{L}_2=\left[\begin{array}{cc}0.37 & -0.37 \\-0.37 & 0.37\end{array}\right]\end{aligned}</script><p>æ¯ä¸ªå­çŸ©é˜µå¯¹åº”äºå›¾çš„ä¸€ä¸ªè”é€šåˆ†é‡ã€‚0 æ˜¯æ¯ä¸ªå­çŸ©é˜µçš„ 1 é‡ç‰¹å¾å€¼ï¼Œç”±äºæœ‰ä¸¤ä¸ªè”é€šåˆ†é‡ï¼Œå› æ­¤ 0 æ˜¯æ•´ä¸ªå›¾çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„ 2 é‡ç‰¹å¾å€¼ã€‚ä¸¤ä¸ªçº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡ä¸ºï¼š</p><script type="math/tex; mode=display">\begin{aligned}& \mathbf{1}_{A_1}=\left[\begin{array}{lllll}1 & 1 & 1 & 0 & 0\end{array}\right]^{\mathrm{T}} \\& \mathbf{1}_{A_2}=\left[\begin{array}{lllll}0 & 0 & 0 & 1 & 1\end{array}\right]^{\mathrm{T}}\end{aligned}</script><h3 id="å½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆNormalized-Laplacian-Matrixï¼‰"><a href="#å½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆNormalized-Laplacian-Matrixï¼‰" class="headerlink" title="å½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆNormalized Laplacian Matrixï¼‰"></a>å½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼ˆNormalized Laplacian Matrixï¼‰</h3><p>å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæœ‰ä¸¤ç§å½¢å¼çš„å½’ä¸€åŒ–ã€‚</p><p>ç¬¬ä¸€ç§ç§°ä¸º<strong>å¯¹ç§°å½’ä¸€åŒ–</strong>ï¼Œå®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">\mathbf{L}_{\text {sym }}=\mathbf{D}^{-1 / 2} \mathbf{L D}^{-1 / 2}=\mathbf{I}-\mathbf{D}^{-1 / 2} \mathbf{A} \mathbf{D}^{-1 / 2}</script><p>è¿™é‡Œ $D^{1 / 2}$ æ˜¯ $D$ çš„æ‰€æœ‰å…ƒç´ è®¡ç®—æ­£å¹³æ–¹æ ¹å¾—åˆ°çš„çŸ©é˜µã€‚ä½ç½®ä¸º $(i . j), i \neq j$ çš„å…ƒç´ ä¸ºå°†æœªå½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µå¯¹åº”ä½ç½®å¤„çš„å…ƒç´  $l_{i j}$ é™¤ä»¥ $\sqrt{d_{i i} d_{j j}}$ åå½¢æˆçš„ï¼Œä¸»å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¸º 1 ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{L}_{\mathrm{sym}} & =\left[\begin{array}{cccc}1 / \sqrt{d_{11}} & 0 & \ldots & 0 \\0 & 1 / \sqrt{d_{22}} & \ldots & 0 \\\ldots & \ldots & \ldots & \ldots \\0 & 0 & \ldots & 1 / \sqrt{d_{n n}}\end{array}\right]\left[\begin{array}{cccc}l_{11} & l_{12} & \ldots & l_{1 n} \\l_{21} & l_{22} & \ldots & l_{2 n} \\\ldots & \ldots & \ldots & \ldots \\l_{n 1} & l_{n 2} & \ldots & l_{n n}\end{array}\right]\left[\begin{array}{cccc}1 / \sqrt{d_{11}} & 0 & \ldots & 0 \\0 & 1 / \sqrt{d_{22}} & \ldots & 0 \\\ldots & \ldots & \ldots & \ldots \\0 & 0 & \ldots & 1 / \sqrt{d_{n n}}\end{array}\right] \\& =\left[\begin{array}{cccc}1 & l_{12} / \sqrt{d_{11} d_{22}} & \ldots & l_{1 n} / \sqrt{d_{11} d_{n n}} \\l_{21} / \sqrt{d_{22} d_{11}} & 1 & \ldots & l_{2 n} / \sqrt{d_{22} d_{n n}} \\\ldots & \ldots & \ldots & \ldots \\l_{n 1} / \sqrt{d_{n n} d_{11}} & l_{n 2} / \sqrt{d_{n n} d_{22}} & \ldots & 1\end{array}\right]\end{aligned}</script><p>ç”±äº $D^{1 / 2}$ å’Œ $L$ éƒ½æ˜¯å¯¹ç§°çŸ©é˜µ, å› æ­¤ $L_{sym}$ ä¹Ÿæ˜¯å¯¹ç§°çŸ©é˜µã€‚å¦‚æœå›¾æ˜¯è”é€šçš„ï¼Œåˆ™ $D$ å’Œ $D^{1 / 2}$ éƒ½æ˜¯å¯é€†çš„å¯¹è§’çŸ©é˜µï¼Œå…¶é€†çŸ©é˜µåˆ†åˆ«ä¸ºå…¶ä¸»å¯¹è§’çº¿å…ƒç´ çš„é€†ã€‚</p><p>ç¬¬äºŒç§ç§°ä¸º<strong>éšæœºæ¼«æ­¥å½’ä¸€åŒ–</strong>ï¼Œå®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">\mathbf{L}_{\mathrm{rw}}=\mathbf{D}^{-1} \mathbf{L}=\mathbf{I}-\mathbf{D}^{-1} \mathbf{A}</script><p>å…¶ä½ç½®ä¸º $(i, j), i \neq j$ çš„å…ƒç´ ä¸ºå°†æœªå½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µå¯¹åº”ä½ç½®å¤„çš„å…ƒç´  $l_{i j}$ é™¤ä»¥ $d_{i i}$ åå½¢æˆçš„ï¼Œä¸»å¯¹è§’çº¿å…ƒç´ ä¹Ÿä¸º 1ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{L}_{\mathrm{rw}} & =\left[\begin{array}{cccc}1 / d_{11} & 0 & \ldots & 0 \\0 & 1 / d_{22} & \ldots & 0 \\\ldots & \ldots & \ldots & \ldots \\0 & 0 & \ldots & 1 / d_{n n}\end{array}\right]\left[\begin{array}{cccc}l_{11} & l_{12} & \ldots & l_{1 n} \\l_{21} & l_{22} & \ldots & l_{2 n} \\\ldots & \ldots & \ldots & \ldots \\l_{n 1} & l_{n 2} & \ldots & l_{n n}\end{array}\right] \\& =\left[\begin{array}{cccc}1 & l_{12} / d_{11} & \ldots & l_{1 n} / d_{11} \\l_{21} / d_{22} & 1 & \ldots & l_{2 n} / d_{22} \\\ldots & \ldots & \ldots & \ldots \\l_{n 1} / d_{n n} & l_{n 2} / d_{n n} & \ldots & 1\end{array}\right]\end{aligned}</script><p>ä¸‹é¢ä»‹ç»è¿™ä¸¤ç§å½’ä¸€åŒ–çŸ©é˜µçš„è‹¥å¹²é‡è¦æ€§è´¨ï¼š</p><p>1ã€å¯¹ä»»æ„å‘é‡ $\mathbf{f} \in \mathbb{R}^n$ æœ‰ï¼š</p><script type="math/tex; mode=display">\mathbf{f}^{\mathrm{T}} \mathbf{L}_{\mathrm{sym}} \mathbf{f}=\frac{1}{2} \sum_{i=1}^n \sum_{j=1}^n w_{i j}\left(\frac{f_i}{\sqrt{d_i}}-\frac{f_j}{\sqrt{d_j}}\right)^2</script><p>2ã€$\lambda$ æ˜¯çŸ©é˜µ $L_{rw}$ çš„ç‰¹å¾å€¼ï¼Œ$\mu$ æ˜¯ç‰¹å¾å‘é‡, å½“ä¸”ä»…å½“ $\lambda$ æ˜¯ $L_{sym}$ çš„ç‰¹å¾å€¼ä¸”å…¶ç‰¹å¾å‘é‡ä¸º $w=D^{1 / 2} \mu$ã€‚</p><p>3ã€$\mu$ æ˜¯çŸ©é˜µ $L_{rw}$ çš„ç‰¹å¾å€¼ï¼Œ$\mu$ æ˜¯å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå½“ä¸”ä»…å½“ $\lambda$ å’Œ $\mu$ æ˜¯å¹¿ä¹‰ç‰¹å¾å€¼é—®é¢˜ $L u=\lambda D u$ çš„è§£ã€‚</p><p>4ã€0 æ˜¯çŸ©é˜µ $L_{rw}$ çš„ç‰¹å¾å€¼ï¼Œå…¶å¯¹åº”çš„ç‰¹å¾å‘é‡ä¸ºå¸¸å‘é‡ 1 ï¼Œå³æ‰€æœ‰åˆ†é‡ä¸º 1ã€‚ 0 æ˜¯çŸ©é˜µ $L_{sym}$ çš„ç‰¹å¾å€¼ï¼Œå…¶å¯¹åº”çš„ç‰¹å¾å‘é‡ä¸º $D^{1 / 2} 1$ ã€‚</p><p>5ã€çŸ©é˜µ $L_{sym}$ å’Œ $L_{rw}$ æ˜¯åŠæ­£å®šçŸ©é˜µï¼Œæœ‰ $n$ ä¸ªéè´Ÿå®æ•°ç‰¹å¾å€¼, å¹¶ä¸”æ»¡è¶³ï¼š</p><script type="math/tex; mode=display">0=\lambda_1 \leq \lambda_2 \leq \ldots \leq \lambda_n</script><p>6ï¼ˆç»“è®ºï¼‰ã€å’Œæœªå½’ä¸€åŒ–çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µç±»ä¼¼ï¼Œå‡è®¾ $G$ æ˜¯ä¸€ä¸ªæœ‰éè´Ÿæƒé‡çš„æ— å‘å›¾ï¼Œå…¶å½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ $L_{rw}$ å’Œ $L_{sym}$ çš„ç‰¹å¾å€¼0çš„é‡æ•° $k$ ç­‰äºå›¾çš„è”é€šåˆ†é‡çš„ä¸ªæ•° $A_1, \ldots, A_k$ ã€‚</p><p>å¯¹äºçŸ©é˜µ $L_{rw}$ï¼Œç‰¹å¾å€¼0çš„ç‰¹å¾ç©ºé—´ç”±è¿™äº›è”é€šåˆ†é‡æ‰€å¯¹åº”çš„å‘é‡ $1_{A_1}, \ldots, 1_{A_k}$ æ‰€å¼ æˆã€‚ $1_{A_i}$ çš„å®šä¹‰ä¸æœªå½’ä¸€åŒ–æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ0ç‰¹å¾å€¼çš„ç‰¹å¾å‘é‡ç›¸åŒã€‚</p><p>å¯¹äºçŸ©é˜µ $L_{sym}$, ç‰¹å¾å€¼Oçš„ç‰¹å¾ç©ºé—´ç”±è¿™äº›è”é€šåˆ†é‡æ‰€å¯¹åº”çš„å‘é‡ $\mathbf{D}^{1 / 2} \mathbf{1}_{A_1}, \ldots, \mathbf{D}^{1 / 2} \mathbf{1}_{A_k}$ æ‰€å¼ æˆã€‚</p><h2 id="æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è°±åˆ†è§£ï¼ˆSpectral-Decompositionï¼‰"><a href="#æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è°±åˆ†è§£ï¼ˆSpectral-Decompositionï¼‰" class="headerlink" title="æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è°±åˆ†è§£ï¼ˆSpectral Decompositionï¼‰"></a>æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„è°±åˆ†è§£ï¼ˆSpectral Decompositionï¼‰</h2><p>åœ¨çŸ©é˜µèŒƒå›´å†…ï¼Œä¸è€ƒè™‘è¿‡äºå¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œè°±åˆ†è§£åˆç§°ä¸ºç‰¹å¾å€¼åˆ†è§£ï¼Œåªæœ‰æ–¹é˜µæ‰èƒ½è¿›è¡Œè°±åˆ†è§£ã€‚</p><blockquote><p><strong>ç‰¹å¾å‘é‡ï¼ˆEigenvectorsï¼‰</strong>ï¼šä¸€ä¸ªçŸ©é˜µçš„ç‰¹å¾å‘é‡æ˜¯æŒ‡ä¸€ä¸ªéé›¶å‘é‡ï¼Œå…¶åœ¨ç»è¿‡çŸ©é˜µå˜æ¢ååªå‘ç”Ÿäº†ä¼¸ç¼©è€Œæ²¡æœ‰æ”¹å˜æ–¹å‘ï¼Œåªç›¸å·®äº†ä¸€ä¸ªå¸¸æ•°å€æ•°ã€‚æ¢å¥è¯è¯´ï¼ŒçŸ©é˜µä¹˜ä»¥ç‰¹å¾å‘é‡åï¼Œç›¸å½“äºå¯¹è¯¥å‘é‡è¿›è¡Œäº†ä¸€ä¸ªæ¯”ä¾‹çš„æ‹‰ä¼¸ã€‚</p><p><strong>ç‰¹å¾å€¼ï¼ˆEigenvaluesï¼‰</strong>ï¼šç‰¹å¾å€¼æ˜¯å¯¹åº”äºç‰¹å¾å‘é‡çš„æ ‡é‡ï¼Œå®ƒè¡¨ç¤ºäº†åœ¨ç‰¹å¾å‘é‡è¿›è¡ŒçŸ©é˜µå˜æ¢åçš„ä¼¸ç¼©å€æ•°ã€‚ä¸€ä¸ªçŸ©é˜µå¯ä»¥æœ‰å¤šä¸ªç‰¹å¾å‘é‡å’Œå¯¹åº”çš„ç‰¹å¾å€¼ã€‚</p></blockquote><p>å¯¹äºä¸€ä¸ªæ–¹é˜µ $A$ï¼Œè°±åˆ†è§£çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å®ƒè¡¨ç¤ºä¸ºç‰¹å¾å‘é‡çŸ©é˜µ $P$ ä¸å¯¹è§’ç‰¹å¾å€¼çŸ©é˜µ $Î›$ ç›¸ä¹˜çš„å½¢å¼ï¼Œå³ $A = P <em> Î› </em> P^{-1} $ã€‚å¦‚æœ $A$ æ˜¯å¯¹ç§°çŸ©é˜µï¼Œåˆ™ $P$ æ˜¯æ­£äº¤çŸ©é˜µï¼Œåˆ™åŸå¼ä¹Ÿå¯å†™ä½œ $A = P <em> Î› </em> P^T$ã€‚</p><p>ç”±äºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ˜¯<strong>å¯¹ç§°åŠæ­£å®š</strong>çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹æ€§è´¨ï¼š<br>1ã€ä¸€å®šæœ‰$n$ä¸ªçº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡ï¼ˆå¯¹ç§°ï¼‰ã€‚<br>2ã€çŸ©é˜µçš„ç‰¹å¾å€¼ä¸€å®šéè´Ÿï¼ˆåŠæ­£å®šï¼‰ã€‚<br>3ã€çŸ©é˜µçš„ç‰¹å¾å‘é‡ç›¸äº’æ­£äº¤ï¼Œå³æ‰€æœ‰ç‰¹å¾å‘é‡æ„æˆçš„çŸ©é˜µä¸ºæ­£äº¤çŸ©é˜µï¼ˆå¯¹ç§°ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ $L$ çš„è°±åˆ†è§£ä¹Ÿå¯ä»¥å†™æˆ $P <em> Î› </em> P^T$ çš„å½¢å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><script type="math/tex; mode=display">\boldsymbol{L}=\boldsymbol{\Phi} \boldsymbol{\Lambda} \boldsymbol{\Phi}^{\top}</script><p>$\Phi=\left(\phi_1, \phi_2, \ldots, \phi_n\right) \in \mathbb{R}^{\mathrm{n} \times n}$ æ˜¯æ­£äº¤çŸ©é˜µï¼Œå…¶åˆ—å‘é‡ä¸ºå•ä½ç‰¹å¾å‘é‡ã€‚<br>$\Lambda=\operatorname{diag}\left(\lambda_1, \ldots, \lambda_n\right)$ æ˜¯ç”±å¯¹åº”ç‰¹å¾å€¼æ„æˆçš„å¯¹è§’çŸ©é˜µã€‚</p><h2 id="ç‹„åˆ©å…‹é›·èƒ½é‡ï¼ˆDirichlet-Energyï¼‰"><a href="#ç‹„åˆ©å…‹é›·èƒ½é‡ï¼ˆDirichlet-Energyï¼‰" class="headerlink" title="ç‹„åˆ©å…‹é›·èƒ½é‡ï¼ˆDirichlet Energyï¼‰"></a>ç‹„åˆ©å…‹é›·èƒ½é‡ï¼ˆDirichlet Energyï¼‰</h2><p>ç‹„åˆ©å…‹é›·èƒ½é‡è¡¡é‡äº†å‡½æ•°çš„å¹³æ»‘æ€§ï¼ˆSmoothnessï¼‰ï¼Œè¶Šå°è¯´æ˜å‡½æ•°è¶Šå¹³æ»‘ã€‚ç‹„åˆ©å…‹é›·èƒ½é‡å®šä¹‰ä¸º:</p><script type="math/tex; mode=display">\mathrm{E}_{\mathrm{Dir}}(\boldsymbol{f})=\boldsymbol{f}^{\top} \boldsymbol{\Delta} \boldsymbol{f}</script><p>å…¶ä¸­$f$ æ˜¯å‡½æ•°ï¼Œ$\Delta$ æ˜¯æ‹‰æ™®æ‹‰æ–¯ç®—å­ã€‚æ•´ä¸ªå…¬å¼åœ¨å›¾ç»“æ„ä¸Šçš„å«ä¹‰æ˜¯ï¼Œè®¡ç®—å‡½æ•°$\boldsymbol{f}$åœ¨å›¾çš„èŠ‚ç‚¹ä¸Šçš„å˜åŒ–ç¨‹åº¦ï¼Œå…¶ä¸­å˜åŒ–ç¨‹åº¦é€šè¿‡å°†å‡½æ•°$\boldsymbol{f}$æ˜ å°„åˆ°æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„ç©ºé—´ï¼ˆ$\boldsymbol{\Delta} \boldsymbol{f}$ï¼‰ï¼Œå¹¶è®¡ç®—æ˜ å°„åçš„å‘é‡ä¸åŸå‘é‡çš„å†…ç§¯æ¥è¡¡é‡ã€‚</p><p>åœ¨å›¾è®ºä¸­ï¼Œç‹„åˆ©å…‹é›·èƒ½é‡è¶Šå°è¡¨ç¤ºå›¾ä¸­èŠ‚ç‚¹çš„å‡½æ•°åœ¨ç©ºé—´ä¸­å˜åŒ–è¶Šå¹³æ»‘ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥æˆ–å…³ç³»è¶Šç´§å¯†ã€‚è¿™å¯ä»¥ç”¨äºé‡åŒ–å›¾ä¸­çš„å¹³æ»‘æ€§å’Œè¿é€šæ€§ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>ç‹„åˆ©å…‹é›·èƒ½é‡æœ€å°åŒ–é—®é¢˜å¯¹æ¨å¹¿å›¾å‚…ç«‹å¶å˜æ¢æœ‰ä»€ä¹ˆå¸®åŠ©å‘¢</strong>ï¼Ÿ</p><p>å›¾å‚…ç«‹å¶å˜æ¢æ˜¯å°†ä¸€ä¸ªå®šä¹‰åœ¨å›¾çš„èŠ‚ç‚¹ä¸Šçš„å‡½æ•°æ˜ å°„åˆ°é¢‘è°±åŸŸï¼Œç±»ä¼¼äºä¿¡å·å¤„ç†ä¸­çš„å‚…ç«‹å¶å˜æ¢ã€‚åœ¨è¿ç»­ä¿¡å·çš„æƒ…å†µä¸‹ï¼Œå‚…ç«‹å¶å˜æ¢å°†ä¿¡å·åˆ†è§£ä¸ºä¸åŒé¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨å›¾ä¸Šï¼Œå›¾å‚…ç«‹å¶å˜æ¢å°†ä¸€ä¸ªå‡½æ•°åˆ†è§£ä¸ºå›¾ä¸­çš„åŸºå‡½æ•°ï¼Œ<strong>è¿™äº›åŸºå‡½æ•°ç”±ç‹„åˆ©å…‹é›·èƒ½é‡æœ€å°åŒ–é—®é¢˜å¾—åˆ°</strong>ã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯»æ‰¾å›¾ä¸Šç‹„åˆ©å…‹é›·èƒ½é‡æœ€å°çš„ä¸€ç»„å•ä½æ­£äº¤åŸºï¼ˆæ¯ä¸ªåŸºéƒ½å¯ä»¥çœ‹æˆå‡½æ•°ï¼‰ã€‚ å·§åˆçš„æ˜¯ï¼Œè¿™æ ·çš„æ­£äº¤åŸºæ­£å¥½å°±æ˜¯å¯¹æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ $L$ è¿›è¡Œè°±åˆ†è§£å¾—åˆ°çš„å•ä½ç‰¹å¾å‘é‡ $\phi_1, \ldots, \phi_n$ ã€‚ è¿™å¯¹æˆ‘ä»¬ä»ä¼ ç»Ÿå‚…é‡Œå¶å˜æ¢æ¨å¹¿åˆ°å›¾ä¸Šå‚…é‡Œå¶å˜æ¢æ—¶è¿›è¡Œçš„ç±»æ¯”å’Œæ›¿æ¢æä¾›äº†ç†è®ºè§£é‡Šã€‚</p><h2 id="å›¾å‚…ç«‹å¶å˜æ¢ï¼ˆGraph-Fourier-Transformationï¼‰"><a href="#å›¾å‚…ç«‹å¶å˜æ¢ï¼ˆGraph-Fourier-Transformationï¼‰" class="headerlink" title="å›¾å‚…ç«‹å¶å˜æ¢ï¼ˆGraph Fourier Transformationï¼‰"></a>å›¾å‚…ç«‹å¶å˜æ¢ï¼ˆGraph Fourier Transformationï¼‰</h2><p>ç®€å•å›é¡¾å‚…ç«‹å¶å˜æ¢ï¼Œç„¶åæ¨å¹¿åˆ°å›¾ã€‚</p><h3 id="å‚…ç«‹å¶å˜æ¢ï¼ˆFourier-Transformationï¼‰"><a href="#å‚…ç«‹å¶å˜æ¢ï¼ˆFourier-Transformationï¼‰" class="headerlink" title="å‚…ç«‹å¶å˜æ¢ï¼ˆFourier Transformationï¼‰"></a>å‚…ç«‹å¶å˜æ¢ï¼ˆFourier Transformationï¼‰</h3><p>å‚…é‡Œå¶å˜æ¢äºå°†ä¸€ä¸ªå‡½æ•°ä»æ—¶é—´ï¼ˆæˆ–ç©ºé—´ï¼‰åŸŸè½¬æ¢åˆ°é¢‘ç‡åŸŸï¼Œä»¥ä¾¿åˆ†æå…¶é¢‘ç‡ç‰¹æ€§ã€‚å‚…é‡Œå¶å˜æ¢å¯ä»¥å°†ä¸€ä¸ªä¿¡å·åˆ†è§£æˆä¸åŒé¢‘ç‡çš„æˆåˆ†ï¼Œä»è€Œæ­ç¤ºå‡ºä¿¡å·çš„é¢‘è°±ä¿¡æ¯ã€‚</p><p>å‚…é‡Œå¶å˜æ¢çš„å…¬å¼å¦‚ä¸‹ï¼š</p><p>å¯¹äºè¿ç»­ä¿¡å·ï¼š</p><script type="math/tex; mode=display">F(\omega) = \int_{-\infty}^{\infty} f(t) e^{-j\omega t} dt</script><p>å¯¹äºç¦»æ•£ä¿¡å·ï¼š</p><script type="math/tex; mode=display">F(k) = \sum_{n=0}^{N-1} f(n) e^{-j\frac{2\pi}{N}kn}</script><p>å…¶ä¸­ï¼Œ$ F(\omega) $ æˆ– $ F(k)$ æ˜¯ä¿¡å·åœ¨é¢‘ç‡åŸŸçš„è¡¨ç¤ºï¼Œ$ f(t) $ æˆ– $ f(n) $ æ˜¯ä¿¡å·åœ¨æ—¶é—´ï¼ˆæˆ–ç©ºé—´ï¼‰åŸŸçš„è¡¨ç¤ºï¼Œ$ \omega $ æ˜¯è§’é¢‘ç‡ï¼Œ$ j $ æ˜¯è™šæ•°å•ä½ï¼Œ $ t $ æˆ– $ n $ æ˜¯æ—¶é—´ï¼ˆæˆ–ç©ºé—´ï¼‰çš„å˜é‡ã€‚</p><p>$F(\omega)$ å°±æ˜¯å‚…é‡Œå¶å˜æ¢ï¼Œå¾—åˆ°çš„å°±æ˜¯é¢‘åŸŸå›¾ï¼Œå®ƒåœ¨ $\omega_0$ çš„å€¼ $F(\omega_0)$ è¡¨ç¤º $f(x)$ åœ¨ $\omega_0$ é¢‘ç‡å¯¹åº”çš„æ­£äº¤åŸºä¸Šçš„ç³»æ•°ã€‚</p><p>ä¸‹é¢ä¸¤è€…ç§°ä¸ºå‚…é‡Œå¶å˜æ¢å¯¹, å¯ä»¥ç›¸äº’è½¬æ¢:</p><script type="math/tex; mode=display">f(x) \Leftrightarrow F(\omega)</script><p>å¦å¤–ï¼Œ$e^{-j\omega t}$ æ˜¯å‚…ç«‹å¶åŸºå‡½æ•°ä¹‹ä¸€ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>å¤æŒ‡æ•°å‡½æ•°</strong>ã€‚å‚…ç«‹å¶å˜æ¢å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°ä»æ—¶åŸŸè½¬æ¢åˆ°é¢‘åŸŸï¼Œå®ƒå°†ä¸€ä¸ªå‡½æ•°è¡¨ç¤ºä¸ºä¸åŒé¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„å åŠ ã€‚$e^{-j\omega t}$ å°±æ˜¯è¿™äº›æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„å¤æ•°å½¢å¼ï¼Œå‚ç…§$e^{jx} = \cos(x) + j \sin(x)$ã€‚</p><h3 id="å‚…ç«‹å¶åŸºå‡½æ•°ï¼ˆFourier-Basis-Functionsï¼‰"><a href="#å‚…ç«‹å¶åŸºå‡½æ•°ï¼ˆFourier-Basis-Functionsï¼‰" class="headerlink" title="å‚…ç«‹å¶åŸºå‡½æ•°ï¼ˆFourier Basis Functionsï¼‰"></a>å‚…ç«‹å¶åŸºå‡½æ•°ï¼ˆFourier Basis Functionsï¼‰</h3><p>å‚…ç«‹å¶åŸºå‡½æ•°ï¼ˆFourier Basis Functionsï¼‰æ˜¯ä¸€ç»„æ­£äº¤å‡½æ•°ï¼Œç”¨äºå±•å¼€å’Œè¡¨ç¤ºä¿¡å·åœ¨é¢‘ç‡åŸŸçš„æˆåˆ†ã€‚åœ¨å‚…ç«‹å¶å˜æ¢ä¸­ï¼ŒåŸå§‹ä¿¡å·å¯ä»¥è¢«åˆ†è§£ä¸ºå„ç§é¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„çº¿æ€§ç»„åˆï¼Œè€Œè¿™äº›æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å°±æ„æˆäº†å‚…ç«‹å¶åŸºå‡½æ•°ã€‚</p><p>å‚…ç«‹å¶åŸºå‡½æ•°çš„å…·ä½“å½¢å¼å–å†³äºæ˜¯è¿ç»­ä¿¡å·è¿˜æ˜¯ç¦»æ•£ä¿¡å·ã€‚å¯¹äºè¿ç»­ä¿¡å·ï¼Œå‚…ç«‹å¶åŸºå‡½æ•°æ˜¯æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\phi_k(t) = \frac{1}{\sqrt{T}} \cdot \begin{cases} \cos(2\pi kft), & \text{for even}\ k \\ \sin(2\pi kft), & \text{for odd}\ k \end{cases}</script><p>å…¶ä¸­ï¼Œ$k$ ä¸ºé¢‘ç‡ç´¢å¼•ï¼Œ$f$ ä¸ºä¿¡å·çš„åŸºæœ¬é¢‘ç‡ï¼Œ$T$ ä¸ºä¿¡å·çš„å‘¨æœŸã€‚</p><p>å¯¹äºç¦»æ•£ä¿¡å·ï¼Œå‚…ç«‹å¶åŸºå‡½æ•°æ˜¯å¤æŒ‡æ•°å‡½æ•°ï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\phi_k[n] = \frac{1}{\sqrt{N}} \cdot e^{j2\pi kn/N}</script><p>å…¶ä¸­ï¼Œ$k$ ä¸ºé¢‘ç‡ç´¢å¼•ï¼Œ$N$ ä¸ºä¿¡å·çš„æ ·æœ¬ç‚¹æ•°ã€‚</p><p>å‚…ç«‹å¶åŸºå‡½æ•°æ„æˆäº†é¢‘ç‡åŸŸçš„æ­£äº¤åŸºï¼Œæ„å‘³ç€ä¸åŒé¢‘ç‡çš„åŸºå‡½æ•°ä¹‹é—´å½¼æ­¤æ­£äº¤ã€‚é€šè¿‡å°†ä¿¡å·åœ¨å‚…ç«‹å¶åŸºå‡½æ•°ä¸Šçš„æŠ•å½±ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¿¡å·åœ¨ä¸åŒé¢‘ç‡ä¸Šçš„åˆ†é‡ï¼Œä»è€Œå®ç°é¢‘åŸŸåˆ†æã€‚</p><p>å‚…ç«‹å¶åŸºå‡½æ•°æ˜¯å‚…ç«‹å¶å˜æ¢çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬çš„çº¿æ€§ç»„åˆå¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•ä¿¡å·ã€‚</p><h3 id="å›¾å‚…ç«‹å¶å˜æ¢"><a href="#å›¾å‚…ç«‹å¶å˜æ¢" class="headerlink" title="å›¾å‚…ç«‹å¶å˜æ¢"></a>å›¾å‚…ç«‹å¶å˜æ¢</h3><p>é¦–å…ˆï¼Œåœ¨å›¾ä¸Šï¼Œæ‹‰æ™®æ‹‰æ–¯ç®—å­ç­‰äºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µã€‚å¤æŒ‡æ•°å‡½æ•°$e^{-j\omega t}$ï¼Œå³å‚…ç«‹å¶å˜æ¢çš„åŸºå‡½æ•°ï¼Œå¯ä»¥è¢«è¯æ˜æ˜¯å›¾ä¸Šæ‹‰æ™®æ‹‰æ–¯ç®—å­çš„ä¸€ä¸ªç‰¹å¾å‡½æ•°ã€‚</p><script type="math/tex; mode=display">\Delta e^{-j\omega t}=\frac{\partial^2 e^{-j\omega t}}{\partial t^2}=-\omega^2 e^{-j\omega t}</script><p>åœ¨å›¾ä¸Šä½œç±»æ¯”ï¼Œä»¤å˜é‡ä¸º $x$ï¼Œä»¤é¢‘ç‡ä¸º $\mathrm{k}$ ï¼ˆæ³¨æ„ä¸è§’é¢‘ç‡çš„åŒºåˆ«ï¼‰ï¼Œ $\phi_{\mathrm{k}}$ ä¸ºå›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­ $L$ çš„ç‰¹å¾å‘é‡ï¼ˆæ»¡è¶³ $L \phi_k=\lambda_k \phi_k$ ï¼‰ã€‚å³åœ¨å›¾ä¸­ $\Delta=\boldsymbol{L}, \mathrm{e}^{-\mathrm{jkx}}=\phi_k$ ï¼Œè€Œ $\mathrm{k}$ å’Œç‰¹å¾å€¼ $\lambda_{\mathrm{k}}$ æœ‰å…³ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†åœ¨å›¾ä¸Šè¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼Œå¯ä»¥æŠŠä¼ ç»Ÿå‚…é‡Œå¶å˜æ¢ä¸­çš„ $\mathrm{e}^{-\mathrm{jk} x}$ æ¢æˆ $\phi_k$ ï¼ŒæŠŠé¢‘ç‡ $\mathrm{k}$ æ¢ä¸º ç‰¹å¾å€¼ $\lambda_{\mathrm{k}}$ã€‚</p><p>åˆ™å›¾å‚…é‡Œå¶å˜æ¢å†™ä½œ:</p><script type="math/tex; mode=display">F\left(\lambda_k\right)=\hat{f_k}=\left\langle f, \phi_k\right\rangle</script><p>$f=\left(f_1, \ldots, f_n\right)$ æ˜¯ç”±èŠ‚ç‚¹ä¿¡æ¯æ„æˆçš„nç»´å‘é‡ã€‚åšä¸ªç±»ä¼¼çš„è§£é‡Šï¼Œå³ç‰¹å¾å€¼ $\lambda_k$ ä¸‹ï¼Œ$f$ çš„ å›¾å‚…é‡Œå¶å˜æ¢ï¼ˆæŒ¯å¹…ï¼‰ç­‰äº $f$ ä¸ $\lambda_k$ å¯¹åº”çš„ç‰¹å¾å‘é‡ $\phi_k$ çš„å†…ç§¯ã€‚</p><p>æ¨å¹¿åˆ°çŸ©é˜µå½¢å¼ï¼Œå›¾å‚…é‡Œå¶å˜æ¢:</p><script type="math/tex; mode=display">\hat{f} = \boldsymbol{\Phi}^{\top} f</script><p>å…¶ä¸­, $\hat{f}=\left(\hat{f_1} , \hat{f_2}, \ldots, \hat{f_n}\right)$ï¼Œå³å›¾å‚…é‡Œå¶å˜æ¢ï¼Œå³ä¸åŒç‰¹å¾å€¼(é¢‘ç‡)ä¸‹å¯¹åº”çš„æŒ¯å¹…æ„æˆçš„å‘é‡ã€‚ $f=\left(f_1, \ldots, f_n\right)$ æ˜¯ç”±èŠ‚ç‚¹ä¿¡æ¯æ„æˆçš„nç»´å‘é‡ã€‚</p><p>ç±»ä¼¼çš„ï¼Œä¼ ç»Ÿé€†å‚…é‡Œå¶å˜æ¢ï¼ˆnä¸ªæ­£å¼¦æ³¢çš„å åŠ ï¼‰ï¼š</p><script type="math/tex; mode=display">{ }^{-1}[F(k)]=f(x)=\sum_k F(k) e^{i k x}=\sum_k \frac{1}{2 \pi} \int_{-\infty}^{\infty} f\left(x^{\prime}\right) e^{-i k x^{\prime}} d x^{\prime} e^{i k x}</script><p>è¿ç§»åˆ°å›¾ä¸Šï¼Œ$\mathrm{e}^{ikx} \mathrm{e}^{-ikx}=1$ï¼Œä¸¤ä¸ªåŸºæ­£äº¤ï¼Œç±»æ¯”äº $\left(\phi_{\mathrm{k}}^{\top} \phi_{\mathrm{k}}\right)_{\mathrm{i}}=1$ï¼Œåˆ™å›¾é€†å‚…é‡Œå¶å˜æ¢ï¼š</p><script type="math/tex; mode=display">\mathrm{f}_{\mathrm{i}}=\sum_{\mathrm{k}=1}^{\mathrm{n}} \hat{\mathrm{f}_{\mathrm{k}}}\left(\boldsymbol{\phi}_k^{\top}\right)_{\mathrm{i}}</script><p>æ¨å¹¿åˆ°çŸ©é˜µå½¢å¼ï¼Œå›¾é€†å‚…ç«‹å¶å˜æ¢ï¼š</p><script type="math/tex; mode=display">f = \boldsymbol{\Phi} \hat{f}</script><h2 id="å›¾å·ç§¯ï¼ˆGraph-Convolutionï¼‰"><a href="#å›¾å·ç§¯ï¼ˆGraph-Convolutionï¼‰" class="headerlink" title="å›¾å·ç§¯ï¼ˆGraph Convolutionï¼‰"></a>å›¾å·ç§¯ï¼ˆGraph Convolutionï¼‰</h2><p>ç»“åˆå›¾å‚…ç«‹å¶å˜æ¢å’Œå·ç§¯å®šç†çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºå›¾å·ç§¯ï¼Œé¦–å…ˆæœ‰ï¼š</p><script type="math/tex; mode=display">\begin{align}    f * g=\mathcal{F}^{-1}\{\mathcal{F}\{f\} \cdot \mathcal{F}\{g\}\} \\    \\    \hat{f} = \boldsymbol{\Phi}^{\top} f \\    \\    f = \boldsymbol{\Phi} \hat{f}\end{align}</script><p>ä¸‹é¢ä»¤å›¾ä¸º $f$ï¼Œå·ç§¯æ ¸ä¸º $h$ï¼Œåˆ™å›¾å·ç§¯ä¸º $f * h$ï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">\begin{align}f * h = \mathcal{F}^{-1}\{\mathcal{F}\{f\} \cdot \mathcal{F}\{h\}\} \\= \mathcal{F}^{-1}\{\boldsymbol{\Phi}^{\top} f \odot \boldsymbol{\Phi}^{\top} h\} \\ = \boldsymbol{\Phi}\boldsymbol{\Phi}^{\top} f \odot \boldsymbol{\Phi}^{\top} h \\= \boldsymbol{\Phi}\boldsymbol{\Phi}^{\top} h \odot \boldsymbol{\Phi}^{\top} f \\= \boldsymbol{\Phi}\hat{h} \odot \boldsymbol{\Phi}^{\top} f \\= \boldsymbol{\Phi} \operatorname{diag}\left[\hat{h}\left(\lambda_1\right), \ldots, \hat{h}\left(\lambda_n\right)\right] \boldsymbol{\Phi}^T \boldsymbol{f}\end{align}</script><p>ä¸Šå¼æ˜¯æˆ‘æŒ‰è‡ªå·±çš„ç†è§£æ¨å¯¼å¾—æ¥ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·è”ç³»æˆ‘çš„é‚®ç®±èµæ•™ğŸ™ï¼Œæ„Ÿè°¢ã€‚</p><p>å¯¹äºå·ç§¯æ ¸çš„å›¾å‚…é‡Œå¶å˜æ¢: $\hat{h}=\left(\hat{h}_1, \ldots, \hat{h}_n\right)$, å…¶ä¸­ $\hat{h}_k=\left\langle h, \phi_k\right\rangle, k=1,2 \ldots, n$ã€‚</p><p>å¯¹äºæŠŠ $\hat{h}$ ç»„ç»‡æˆå¯¹è§’çŸ©é˜µ $\operatorname{diag}\left[\hat{h}\left(\lambda_k\right)\right] \in \mathbb{R}^{N \times N}$ï¼Œä¸ªäººç†è§£ï¼Œå¹¶ä¸æ˜¯åœ¨æ”¹å˜å‘é‡çš„å½¢çŠ¶ï¼Œè€Œæ˜¯åœ¨æ”¹å˜æ“ä½œæ–¹å¼ï¼ˆè½¬å˜æˆçŸ©é˜µä¹˜æ³•ï¼‰ï¼Œä»¥æ›´å¥½åœ°è¡¨è¾¾å›¾å·ç§¯çš„è¿ç®—ã€‚</p><p>æ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯å°±æ˜¯è¦è®¾è®¡å¯å­¦ä¹ çš„å·ç§¯æ ¸ï¼Œä»å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œå°±æ˜¯è¦è®¾è®¡ $\operatorname{diag}\left[\hat{h}\left(\lambda_1\right), \ldots, \hat{h}\left(\lambda_n\right)\right]$, ç”±æ­¤, å¯ä»¥ç›´æ¥å°†å…¶å˜ä¸ºå·ç§¯æ ¸ $\operatorname{diag}\left[\theta_1, \ldots, \theta_n\right]$ï¼Œè€Œä¸éœ€è¦å†å°†å·ç§¯æ ¸è¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼Œç›¸å½“äºç›´æ¥å¯¹å˜æ¢åçš„å‚é‡è¿›è¡Œå­¦ä¹ ï¼Œå¯ä»¥æŠŠå®ƒç†è§£æˆå¯è®­ç»ƒæƒé‡å‘é‡ã€‚</p><p>PSï¼šæœ¬äººè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡ææ‡‚ï¼Œæ˜¯å¦å›¾å’Œå·ç§¯æ ¸è¦åˆ†åˆ«è®¡ç®— $\boldsymbol{\Phi}$ ï¼Ÿ</p><h3 id="ä¸€ä»£GCN"><a href="#ä¸€ä»£GCN" class="headerlink" title="ä¸€ä»£GCN"></a>ä¸€ä»£GCN</h3><p>è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1312.6203">Spectral Networks and Locally Connected Networks on Graphs</a></p><p>ç”±ä¸Šè¿°å›¾å·ç§¯å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä»£GCNï¼š</p><script type="math/tex; mode=display">\boldsymbol{y}_{\text {output }}=\sigma\left(\boldsymbol{\Phi} \boldsymbol{g}_\theta \boldsymbol{\Phi}^T \boldsymbol{x}\right)=\sigma\left(\boldsymbol{\Phi} \operatorname{diag}\left[\theta_1, \ldots, \theta_n\right] \boldsymbol{\Phi}^T \boldsymbol{x}\right)</script><p>å…¶ä¸­ï¼Œ$\boldsymbol{g}_{\boldsymbol{\theta}}=\text{diag}[\theta_1,â€¦,\theta_n]$ ä¸ºå·ç§¯æ ¸ï¼Œ$\sigma$ æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$\boldsymbol{x}$ å°±æ˜¯å›¾ä¸Šå¯¹åº”æ¯ä¸ªèŠ‚ç‚¹çš„ç‰¹å¾æ„æˆçš„å‘é‡ï¼Œ$x=\left(x_1, x_2, \ldots, x_n\right)$ï¼Œè¿™é‡Œæš‚æ—¶å¯¹æ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨æ ‡é‡ï¼Œç›¸å½“äºé€šé“æ•°ä¸º 1 ï¼Œç„¶åç»è¿‡æ¿€æ´»ä¹‹åï¼Œå¾—åˆ°è¾“å‡º $\boldsymbol{y}_{\text {output, }}$ ä¹‹åä¼ å…¥ä¸‹ä¸€å±‚ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦å¯¹æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µè¿›è¡Œè°±åˆ†è§£æ¥æ±‚ $\boldsymbol{\Phi}$ï¼Œåœ¨å›¾å¾ˆå¤§çš„æ—¶å€™å¤æ‚åº¦å¾ˆé«˜ã€‚ å¦å¤–ï¼Œè¿˜éœ€è¦è®¡ç®—çŸ©é˜µä¹˜ç§¯ï¼Œå¤æ‚åº¦ä¸º $O\left(n^2\right)$ ã€‚</li><li>å·ç§¯æ ¸å‚æ•°ä¸º $n$ï¼Œå½“å›¾å¾ˆå¤§çš„æ—¶å€™ï¼Œ$n$ ä¼šå¾ˆå¤§ã€‚</li><li>å·ç§¯æ ¸çš„spatial localizationä¸å¥½ã€‚</li></ul><blockquote><p>å·ç§¯æ ¸çš„ç©ºé—´å®šä½ï¼ˆspatial localizationï¼‰æ˜¯æŒ‡å·ç§¯æ ¸åœ¨è¾“å…¥æ•°æ®çš„ç©ºé—´ç»´åº¦ä¸Šçš„æ“ä½œèŒƒå›´å’Œå½±å“èŒƒå›´ã€‚åœ¨å·ç§¯æ“ä½œä¸­ï¼Œå·ç§¯æ ¸ä¼šåœ¨è¾“å…¥æ•°æ®çš„ä¸åŒä½ç½®ä¸Šæ»‘åŠ¨ï¼Œé€šè¿‡ä¸è¾“å…¥æ•°æ®çš„å±€éƒ¨åŒºåŸŸè¿›è¡Œé€å…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œæ¥ç”Ÿæˆè¾“å‡ºã€‚</p><p>åœ¨å›¾åƒå¤„ç†é¢†åŸŸï¼Œå·ç§¯æ ¸çš„ç©ºé—´å®šä½å†³å®šäº†å·ç§¯æ“ä½œåœ¨å›¾åƒä¸­æå–ç‰¹å¾çš„æ–¹å¼ã€‚ä¸åŒå¤§å°çš„å·ç§¯æ ¸å’Œä¸åŒçš„å·ç§¯æ“ä½œæ–¹å¼å¯ä»¥æ•æ‰åˆ°å›¾åƒä¸­ä¸åŒå°ºåº¦å’Œç»“æ„çš„ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå°å°ºå¯¸çš„å·ç§¯æ ¸å¯ä»¥æ•æ‰åˆ°å›¾åƒä¸­çš„ç»†èŠ‚ç‰¹å¾ï¼Œè€Œè¾ƒå¤§å°ºå¯¸çš„å·ç§¯æ ¸åˆ™å¯ä»¥æ•æ‰åˆ°å›¾åƒä¸­çš„æ•´ä½“ç»“æ„ç‰¹å¾ã€‚</p><p>åœ¨å›¾å·ç§¯ç½‘ç»œä¸­ï¼Œå·ç§¯æ ¸çš„ç©ºé—´å®šä½ä¹Ÿå¾ˆé‡è¦ã€‚ç”±äºå›¾æ•°æ®ä¸åƒå›¾åƒä¸€æ ·å…·æœ‰è§„åˆ™çš„ç½‘æ ¼ç»“æ„ï¼Œå·ç§¯æ ¸çš„è®¾è®¡éœ€è¦è€ƒè™‘å›¾çš„æ‹“æ‰‘ç»“æ„ã€‚å·ç§¯æ ¸åœ¨å›¾ä¸Šçš„ç©ºé—´å®šä½å¯ä»¥ç”¨æ¥æ§åˆ¶å·ç§¯æ“ä½œåœ¨å›¾èŠ‚ç‚¹ä¹‹é—´ä¼ æ’­ä¿¡æ¯çš„æ–¹å¼ï¼Œä»è€Œæ•æ‰åˆ°å›¾çš„å±€éƒ¨å’Œå…¨å±€ç‰¹å¾ã€‚</p><p>å› æ­¤ï¼Œå·ç§¯æ ¸çš„ç©ºé—´å®šä½åœ¨å·ç§¯æ“ä½œä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒå†³å®šäº†å·ç§¯æ“ä½œå¦‚ä½•åœ¨è¾“å…¥æ•°æ®çš„ä¸åŒä½ç½®ä¸Šè¿›è¡Œç‰¹å¾æå–ã€‚</p></blockquote><h3 id="äºŒä»£GCN"><a href="#äºŒä»£GCN" class="headerlink" title="äºŒä»£GCN"></a>äºŒä»£GCN</h3><p>è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1606.09375">Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering</a></p><p>å›¾å‚…é‡Œå¶å˜æ¢æ˜¯å…³äºç‰¹å¾å€¼(ç›¸å½“äºæ™®é€šå‚…é‡Œå¶å˜æ¢çš„é¢‘ç‡)çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ $F\left(\lambda_1\right), \ldots, F\left(\lambda_n\right)$ï¼Œå³ $F(\boldsymbol{\Lambda})$, å› æ­¤ï¼Œå°†å·ç§¯æ ¸ $\boldsymbol{g}_\theta$ å†™æˆ $\boldsymbol{g}_\theta(\Lambda)$ï¼Œç„¶åå°† $\boldsymbol{g}_\theta(\Lambda)$ å®šä¹‰ä¸ºå¦‚ä¸‹ké˜¶å¤šé¡¹å¼</p><script type="math/tex; mode=display">g_{\theta^{\prime}}(\mathbf{\Lambda}) \approx \sum_{k=0}^K \theta_k^{\prime} \mathbf{\Lambda}^k</script><p>è¿™é‡Œçš„ $\Lambda$ ä¸ºä»¥ç‰¹å¾å€¼ä¸ºå¯¹è§’å…ƒç´ çš„å¯¹è§’çŸ©é˜µï¼Œæ‰€ä»¥ $\Lambda^k$ ä¹Ÿæ˜¯å¯¹è§’çŸ©é˜µï¼Œé€šè¿‡æ±‚å’Œä¹‹åï¼Œè¿˜æ˜¯å¯¹è§’çŸ©é˜µï¼Œå°±è¿™ä¸€ç‚¹æ¥è¯´ï¼Œå’Œ $g_\theta$ æœ¬èº«æ˜¯å¯¹è§’çŸ©é˜µæ˜¯éå¸¸å»åˆçš„ã€‚</p><p>å°†å·ç§¯å…¬å¼å¸¦å…¥ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\begin{aligned}g_{\theta^{\prime}} * x & \approx \Phi \sum_{k=0}^K \theta_k^{\prime} \boldsymbol{\Lambda}^k \boldsymbol{\Phi}^T \boldsymbol{x} \\& =\sum_{k=0}^K \theta_k^{\prime}\left(\boldsymbol{\Phi} \boldsymbol{\Lambda}^k \boldsymbol{\Phi}^T\right) x \\& =\sum_{k=0}^K \theta_k^{\prime}\left(\mathbf{\Phi} \boldsymbol{\Lambda} \boldsymbol{\Phi}^T\right)^k x \\& =\sum_{k=0}^K \theta_k^{\prime} \boldsymbol{L}^k x\end{aligned}</script><p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸€ä»£çš„GCNä¸éœ€è¦åšç‰¹å¾åˆ†è§£äº†ï¼Œå¯ä»¥ç›´æ¥å¯¹LaplaciançŸ©é˜µåšå˜æ¢ï¼Œé€šè¿‡äº‹å…ˆå°†LaplaciançŸ©é˜µæ±‚å‡ºæ¥ï¼Œä»¥åŠ $\boldsymbol{L}^k$ æ±‚å‡ºæ¥ï¼Œå‰å‘ä¼ æ’­çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¤æ‚åº¦ä¸º $O\left(K n^2\right)$ ã€‚</p><p>é‚£ä¹ˆä¸Šå¼æ˜¯å¦‚ä½•ä½“ç°localizationå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒçŸ©é˜µçš„$k$æ¬¡æ–¹å¯ä»¥ç”¨äºæ±‚è¿é€šæ€§ï¼Œå³1ä¸ªèŠ‚ç‚¹ç»è¿‡$k$æ­¥èƒ½å¦åˆ°è¾¾å¦ä¸€ä¸ªé¡¶ç‚¹ï¼ŒçŸ©é˜µ$k$æ¬¡æ–¹ç»“æœä¸­å¯¹åº”å…ƒç´ é0çš„è¯å¯è¾¾ï¼Œä¸º0ä¸å¯è¾¾ã€‚é‚£ä¹ˆ $\boldsymbol{L}^k$ æ‰€è¡¨è¾¾çš„å°±æ˜¯ k-hop å†…çš„èŠ‚ç‚¹ã€‚åˆå¯ä»¥é€šè¿‡æ‹‰æ™®æ‹‰æ–¯ç®—å­çš„æ€§è´¨è¯æ˜ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„å¤§äº $k$ çš„è¯ï¼Œ$\boldsymbol{L}^k$ åœ¨ç›¸åº”ä½ç½®çš„å…ƒç´ å€¼ä¸º0ã€‚</p><p>ç»¼ä¸Šï¼Œç›¸å½“äºåªæœ‰nèŠ‚ç‚¹çš„k-hopä¹‹å†…çš„é‚»å±…èŠ‚ç‚¹èƒ½å¤Ÿä¼ é€’ä¿¡æ¯ï¼Œå®é™…ä¸Šåªåˆ©ç”¨äº†èŠ‚ç‚¹çš„K-Localizedä¿¡æ¯ã€‚</p><p>å¦å¤–ï¼Œä½œè€…æå‡ºå¯ä»¥ä½¿ç”¨åˆ‡æ¯”é›ªå¤«å±•å¼€å¼æ¥è¿‘ä¼¼ $\boldsymbol{L}^k$ï¼Œå› ä¸ºä»»ä½• $\mathbf{k}$ æ¬¡å¤šé¡¹å¼éƒ½å¯ä»¥ä½¿ç”¨åˆ‡æ¯”é›ªå¤«å±•å¼€å¼æ¥è¿‘ä¼¼ï¼Œç”±æ­¤ï¼Œå¼•å…¥åˆ‡æ¯”é›ªå¤«å¤šé¡¹å¼çš„ $K$ é˜¶æˆªæ–­è·å¾— $\boldsymbol{L}^k$ è¿‘ä¼¼ï¼Œä»è€Œè·å¾—å¯¹ $g_\theta(\boldsymbol{\Lambda})$ çš„è¿‘ä¼¼</p><script type="math/tex; mode=display">g_{\theta^{\prime}}(\mathbf{\Lambda}) \approx \sum_{k=0}^K \theta_k^{\prime} T_k(\tilde{\mathbf{\Lambda}})</script><p>å…¶ä¸­ï¼Œ$\tilde{\boldsymbol{\Lambda}}=\frac{2}{\lambda_{\max }} \boldsymbol{\Lambda}-\boldsymbol{I}_n $ ä¸ºç»å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ $L$ çš„æœ€å¤§ç‰¹å¾å€¼ï¼ˆå³è°±åŠå¾„ï¼‰ç¼©æ”¾åçš„ç‰¹å¾å‘é‡çŸ©é˜µï¼ˆé˜²æ­¢è¿ä¹˜çˆ†ç‚¸ï¼‰ï¼Œ$ \boldsymbol{\theta}^{\prime} \in \mathbb{R}^K$ ä¸ºä¸€ä¸ªåˆ‡æ¯”é›ªå¤«å‘é‡ï¼Œ$\theta_k^{\prime}$ ä¸ºç¬¬ $k$ ç»´åˆ†é‡ï¼Œåˆ‡æ¯”é›ªå¤«å¤šé¡¹å¼ $T_k(x)$ ä½¿ç”¨é€’å½’çš„æ–¹å¼è¿›è¡Œå®šä¹‰ï¼š</p><script type="math/tex; mode=display">T_k(x)=2 x T_{k-1}(x)-T_{k-2}(x)</script><p>å…¶ä¸­, $T_0(x)=1, T_1(x)=x$ ã€‚</p><p>æ­¤æ—¶ï¼Œç”¨è¿‘ä¼¼çš„å·ç§¯æ ¸å¸¦å…¥åˆ°åŸå…¬å¼ï¼Œå¯å¾—ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{g}_{\boldsymbol{\theta}^{\prime}} * \boldsymbol{x} & \approx \boldsymbol{\Phi} \sum_{k=0}^K \theta_k^{\prime} T_k(\tilde{\boldsymbol{\Lambda}}) \boldsymbol{\Phi}^T \boldsymbol{x} \\& \approx \sum_{k=0}^K \theta_k^{\prime}\left(\boldsymbol{\Phi} T_k(\tilde{\boldsymbol{\Lambda}}) \boldsymbol{\Phi}^T\right) x \\& =\sum_{k=0}^K \theta_k^{\prime} T_k(\tilde{\boldsymbol{L}}) \boldsymbol{x}\end{aligned}</script><p>å…¶ä¸­ï¼Œ$\tilde{\boldsymbol{L}}=\frac{2}{\lambda_{\max }} \boldsymbol{L}-\boldsymbol{I}_n$ ã€‚</p><p>å› æ­¤ï¼Œå¯ä»¥å¾—åˆ°è¾“å‡ºä¸ºï¼š</p><script type="math/tex; mode=display">\boldsymbol{y}_{\text {output }}=\sigma\left(\sum_{k=0}^K \theta_k^{\prime} T_k(\tilde{\boldsymbol{L}}) \boldsymbol{x}\right)</script><p>å…¶ä¸­å‚æ•°å‘é‡ $\boldsymbol{\theta}^{\prime} \in \mathbb{R}^{k}$ éœ€è¦å­¦ä¹ ã€‚</p><h3 id="ä¸‰ä»£GCN"><a href="#ä¸‰ä»£GCN" class="headerlink" title="ä¸‰ä»£GCN"></a>ä¸‰ä»£GCN</h3><p>è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1609.02907">Semi-supervised Classification with Graph Convolutional Networks</a></p><p>è¿™ä¸€ä»£GCNç›´æ¥å–åˆ‡æ¯”é›ªå¤«å¤šé¡¹å¼ä¸­ $K=1$ï¼Œæ­¤æ—¶æ¨¡å‹æ˜¯ 1 é˜¶è¿‘ä¼¼ï¼Œå³æ¯å±‚å·ç§¯å±‚åªè€ƒè™‘äº†ç›´æ¥é‚»åŸŸï¼Œç±»ä¼¼CNNä¸­ $3 \times 3$ çš„å·ç§¯æ ¸ã€‚å¹¶ä¸”ï¼Œè¿™ä¸€ä»£GCNåŠ æ·±äº†æ·±åº¦è€Œå‡å°äº†å®½åº¦ï¼Œè‹¥è¦å»ºç«‹å¤šé˜¶ proximityï¼Œåªéœ€è¦ä½¿ç”¨å¤šä¸ªå·ç§¯å±‚ã€‚åŒæ—¶ï¼ŒåŠ å…¥äº†ä¸€äº›å‚æ•°çº¦æŸï¼Œå¦‚ $\lambda_{\max }=2$ å’Œå¼•å…¥renormalization trickï¼Œå¤§å¤§ç®€åŒ–äº†æ¨¡å‹ã€‚</p><p>ä¸‹é¢å¼€å§‹æ¨å¯¼ï¼Œå°† $K=1, \quad \lambda_{\max }=2$ å¸¦å…¥å¯ä»¥å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{g}_{\theta^{\prime}} * \boldsymbol{x} & \approx \boldsymbol{\theta}_0^{\prime} \boldsymbol{x}+\theta_1^{\prime}\left(\boldsymbol{L}-\boldsymbol{I}_n\right) \boldsymbol{x} \\& =\boldsymbol{\theta}_0^{\prime} \boldsymbol{x}+\theta_1^{\prime}\left(\boldsymbol{L}-\boldsymbol{I}_n\right) \boldsymbol{x} \\& =\theta_0^{\prime} \boldsymbol{x}-\theta_1^{\prime}\left(\boldsymbol{D}^{-1 / 2} \boldsymbol{W} \boldsymbol{D}^{-1 / 2}\right) \boldsymbol{x}\end{aligned}</script><p>æœ€ç»ˆè½¬æ¢æ­¥éª¤çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\boldsymbol{L}=\boldsymbol{D}^{-1 / 2}(\boldsymbol{D}-\boldsymbol{W}) \boldsymbol{D}^{-1 / 2}=\boldsymbol{I}_n-\boldsymbol{D}^{-1 / 2} \boldsymbol{W} \boldsymbol{D}^{-1 / 2}</script><p>ç°åœ¨æ¯ä¸ªå·ç§¯æ ¸åªæœ‰2ä¸ªå‚æ•°ï¼Œä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œä»¤ $\theta_0^{\prime}=-\theta_1^{\prime}$ï¼Œæ­¤æ—¶åªå«æœ‰ä¸€ä¸ªå‚æ•° $\theta$ï¼š</p><script type="math/tex; mode=display">g_{\theta^{\prime}} * x=\theta\left(I_n+D^{-1 / 2} W D^{-1 / 2}\right) x</script><p>ç”±äº $\boldsymbol{I}_n+\boldsymbol{D}^{-1 / 2} \boldsymbol{W} \boldsymbol{D}^{-1 / 2}$ çš„è°±åŠå¾„ $[0,2]$ å¤ªå¤§ï¼Œä½¿ç”¨renormalization trickï¼š</p><script type="math/tex; mode=display">\boldsymbol{I}_n+\boldsymbol{D}^{-1 / 2} \boldsymbol{W} \boldsymbol{D}^{-1 / 2} \rightarrow \tilde{\boldsymbol{D}}^{-1 / 2} \tilde{\boldsymbol{W}} \tilde{\boldsymbol{D}}^{-1 / 2}</script><p>å…¶ä¸­ï¼Œ$\tilde{\boldsymbol{W}}=\boldsymbol{W}+\boldsymbol{I}_n$ (ç›¸å½“äºåŠ äº†self-connectionï¼Œæœ¬æ¥$\boldsymbol{W}$å¯¹è§’å…ƒç´ ä¸º0)ï¼Œ$\tilde{D}_{i j}=\Sigma_j \tilde{W}_{i j}$ ã€‚</p><p>å¸¦å…¥å·ç§¯å…¬å¼ï¼š</p><script type="math/tex; mode=display">\underbrace{g_{\theta^{\prime}} * x}_{\mathbb{R}^{n \times 1}}=\theta(\underbrace{\tilde{D}^{-1 / 2} \tilde{W} \tilde{D}^{-1 / 2}}_{\mathbb{R}^{n \times n}}) \underbrace{x}_{\mathbb{R}^{n \times 1}}</script><p>å¦‚æœæ¨å¹¿åˆ°å¤šé€šé“ï¼Œç›¸å½“äºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯æ˜¯å‘é‡ï¼Œä¸”æœ‰å¤šå·ç§¯æ ¸ï¼š</p><script type="math/tex; mode=display">x \in \mathbb{R}^{N \times 1} \rightarrow X \in \mathbb{R}^{N \times C}</script><p>å…¶ä¸­ï¼Œ$N$ æ˜¯èŠ‚ç‚¹æ•°é‡ï¼Œ$C$ æ˜¯é€šé“æ•°ï¼Œæˆ–è€…ç§°ä½œè¡¨ç¤ºèŠ‚ç‚¹çš„ä¿¡æ¯ç»´åº¦æ•°ã€‚ $\mathrm{X}$ æ˜¯ èŠ‚ç‚¹çš„ç‰¹å¾çŸ©é˜µã€‚</p><p>ç›¸åº”çš„å·ç§¯æ ¸å‚æ•°å˜åŒ–ï¼š</p><script type="math/tex; mode=display">\theta \in \mathbb{R} \rightarrow \Theta \in \mathbb{R}^{C \times F}</script><p>å…¶ä¸­ï¼Œ$F$ ä¸ºå·ç§¯æ ¸æ•°é‡ã€‚</p><p>é‚£ä¹ˆå·ç§¯ç»“æœå†™æˆçŸ©é˜µå½¢å¼ä¸ºï¼š</p><script type="math/tex; mode=display">\underbrace{Z}_{\mathbb{R}^{N \times F}}=\underbrace{\tilde{D}^{-1 / 2} \tilde{W} \tilde{D}^{-1 / 2}}_{\mathbb{R}^{N \times N}} \underbrace{X}_{\mathbb{R}^{N \times C}}  \underbrace{\Theta}_{\mathbb{R}^{C \times F}}</script><p>ä¸Šè¿°æ“ä½œå¯ä»¥å åŠ å¤šå±‚ï¼Œå¯¹è¾“å‡º$Z$æ¿€æ´»ä¸€ä¸‹ï¼Œå°±å¯ä»¥ä½œä¸ºä¸‹ä¸€å±‚èŠ‚ç‚¹çš„ç‰¹å¾çŸ©é˜µã€‚</p><p>è¿™ä¸€ä»£GCNç‰¹ç‚¹ï¼š</p><ul><li>å– $K=1$ï¼Œç›¸å½“äºç›´æ¥å–é‚»åŸŸä¿¡æ¯ï¼Œç±»ä¼¼äº $3 \times 3$ çš„å·ç§¯æ ¸ã€‚</li><li>ç”±äºå·ç§¯æ ¸å®½åº¦å‡å°ï¼Œå¯ä»¥é€šè¿‡å¢åŠ å·ç§¯å±‚æ•°æ¥æ‰©å¤§æ„Ÿå—åŸŸï¼Œä»è€Œå¢å¼ºç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ã€‚</li><li>å¢åŠ äº†å‚æ•°çº¦æŸï¼Œæ¯”å¦‚ $\lambda_{\max } \approx 2$ï¼Œå¼•å…¥é‡å½’ä¸€åŒ–trickã€‚</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://zhuanlan.zhihu.com/p/76296353">https://zhuanlan.zhihu.com/p/76296353</a><br>[2] <a href="https://zhuanlan.zhihu.com/p/54505069">https://zhuanlan.zhihu.com/p/54505069</a><br>[3] <a href="http://xtf615.com/2019/02/24/gcn/">http://xtf615.com/2019/02/24/gcn/</a><br>[4] <a href="https://zhuanlan.zhihu.com/p/362416124">https://zhuanlan.zhihu.com/p/362416124</a><br>[5] <a href="https://qddmj.cn/gcn-laplacian.htm">https://qddmj.cn/gcn-laplacian.htm</a><br>[6] <a href="https://zhuanlan.zhihu.com/p/170091053">https://zhuanlan.zhihu.com/p/170091053</a><br>[7] <a href="https://qddmj.cn/gcn-laplacian2.htm">https://qddmj.cn/gcn-laplacian2.htm</a><br>[8] <a href="https://zhuanlan.zhihu.com/p/41609577">https://zhuanlan.zhihu.com/p/41609577</a><br>[9] <a href="https://zhuanlan.zhihu.com/p/464121739">https://zhuanlan.zhihu.com/p/464121739</a><br>[10] <a href="https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#convolutional-layers">https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html#convolutional-layers</a><br>[11] <a href="https://zhuanlan.zhihu.com/p/60014316">https://zhuanlan.zhihu.com/p/60014316</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å›¾å·ç§¯å­¦ä¹ è®°å½•ï¼ŒåŒæ—¶ä¹Ÿæ¶‰åŠç¦»æ•£æ‹‰æ™®æ‹‰æ–¯ç®—å­å†…å®¹ï¼Œå¯èƒ½å¯¹è§†è§‰æ–¹å‘æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³å†…å®¹ï¼šå·ç§¯ã€å‚…ç«‹å¶å˜æ¢ã€æ‹‰æ™®æ‹‰æ–¯ç®—å­ã€ç‹„åˆ©å…‹é›·èƒ½é‡ã€å›¾å·ç§¯&lt;br&gt;</summary>
    
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://silencezheng.top/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å›¾è®º" scheme="http://silencezheng.top/tags/%E5%9B%BE%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>Yiliaå›¾ç‰‡å±…ä¸­</title>
    <link href="http://silencezheng.top/2023/08/13/article116/"/>
    <id>http://silencezheng.top/2023/08/13/article116/</id>
    <published>2023-08-13T07:48:59.000Z</published>
    <updated>2023-08-13T07:50:37.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Hexoåšå®¢ï¼ŒYiliaä¸»é¢˜è®¾ç½®å›¾ç‰‡å±…ä¸­ã€‚</p><span id="more"></span><p>Yiliaç”¨äº†å¾ˆä¹…äº†ï¼Œç»ˆäºæƒ³èµ·æ¥åŠ¨ä¸€ä¸‹å›¾ç‰‡å±…ä¸­çš„æ¯›ç—…ï¼ŒåŸç‰ˆæ˜¯æ— æ³•å®ç°å›¾ç‰‡å±…ä¸­çš„ï¼Œåœ¨<code>article-main.scss</code>ä¸­åŠ ä¸ªæ ·å¼å¯ä»¥è§£å†³ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span>&#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">  // è¦æ·»åŠ çš„</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ·»åŠ å®Œéœ€è¦é‡æ–°ç¼–è¯‘ä¸»é¢˜é¡¹ç›®ï¼Œè¿›å…¥é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">npm install</span><br><span class="line"><span class="comment"># ç¼–è¯‘ã€å‹ç¼©ã€‚</span></span><br><span class="line">npm run dist</span><br></pre></td></tr></table></figure></p><p>Yiliaè¿™ä¸ªé¡¹ç›®2017å¹´åå°±æ²¡æœ‰ç»´æŠ¤äº†ï¼Œæ³¨æ„åœ¨å®‰è£…ä¾èµ–æ—¶ç”¨Python2ç¯å¢ƒã€‚</p><p>å‚è€ƒ<a href="https://github.com/litten/hexo-theme-yilia/wiki/Yiliaæºç ç›®å½•ç»“æ„åŠæ„å»ºé¡»çŸ¥">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>åœ¨å¤–éƒ¨ç¼–è¯‘å‹ç¼©å®Œï¼Œæ›¿æ¢sourceç›®å½•ä¸‹çš„<code>main.XXX.css</code>æ–‡ä»¶å°±è¡Œäº†ã€‚</p><p>ä½†å¦‚æœé¡¹ç›®ç¼–è¯‘ç¯å¢ƒæœ‰é—®é¢˜çš„è¯ï¼Œè¿™æ ·æ›¿æ¢è¿˜æ˜¯å®¹æ˜“é€ æˆå…¶ä»–bugï¼Œæœ€ç¨³å¦¥çš„æ–¹å¼è¿˜æ˜¯ç›´æ¥åœ¨å·²å‘å¸ƒçš„<code>main.XXX.css</code>ä¸­æœç´¢<code>.article img</code>ç„¶åè¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Hexoåšå®¢ï¼ŒYiliaä¸»é¢˜è®¾ç½®å›¾ç‰‡å±…ä¸­ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Yilia" scheme="http://silencezheng.top/tags/Yilia/"/>
    
  </entry>
  
  <entry>
    <title>Rediså®‰è£…ä½¿ç”¨å…¥é—¨</title>
    <link href="http://silencezheng.top/2023/08/12/article115/"/>
    <id>http://silencezheng.top/2023/08/12/article115/</id>
    <published>2023-08-12T12:32:55.000Z</published>
    <updated>2023-08-12T12:34:10.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Rediså®‰è£…ä½¿ç”¨å…¥é—¨ï¼ŒåŒ…å«åŸºæœ¬çŸ¥è¯†å’Œå‘½ä»¤è¡Œå®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯Redis"><a href="#ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="ä»€ä¹ˆæ˜¯Redis"></a>ä»€ä¹ˆæ˜¯Redis</h2><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ã€ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ã€æ”¯æŒç½‘ç»œäº¤äº’çš„ã€å¯åŸºäºå†…å­˜ä¹Ÿå¯æŒä¹…åŒ–çš„Key-Valueæ•°æ®åº“ã€‚Redisçš„å…¨ç§°æ˜¯<code>REmote DIctionary Server</code>ã€‚</p><p>Redis æä¾›æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€å¸¦æœ‰èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†ã€ä½å›¾ã€HyperLogLogã€åœ°ç†ç©ºé—´ç´¢å¼•å’Œæµã€‚ Redis å…·æœ‰å†…ç½®å¤åˆ¶ã€Lua è„šæœ¬ã€LRU é€å‡ºã€äº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…æ€§ï¼Œå¹¶é€šè¿‡ Redis Sentinel å’Œ Redis é›†ç¾¤çš„è‡ªåŠ¨åˆ†åŒºæä¾›é«˜å¯ç”¨æ€§ã€‚</p><p>å¦å¤–ï¼Œè†œæ‹œä¸€ä¸‹<a href="http://antirez.com/latest/0">ä½œè€…å¤§ä½¬çš„åšå®¢</a>ï¼Œé£æ ¼å¤ªç®€çº¦äº†ğŸ˜„ã€‚</p><h2 id="Rediså¿«é€Ÿå®‰è£…"><a href="#Rediså¿«é€Ÿå®‰è£…" class="headerlink" title="Rediså¿«é€Ÿå®‰è£…"></a>Rediså¿«é€Ÿå®‰è£…</h2><p>Dockerå®‰è£…ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># author: SilenceZheng66 2023.8.11</span></span><br><span class="line"><span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">docker search redis</span><br><span class="line"></span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir myredis</span><br><span class="line">mkdir myredis/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæŒä¹…åŒ–ç›®å½•</span></span><br><span class="line">mkdir myredis/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line">wget -O myredis/config/redis.conf http://download.redis.io/redis-stable/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªåä¸º&quot;myredis&quot;çš„Rediså®¹å™¨ï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„é…ç½®æ–‡ä»¶å’Œå‚æ•°è¿›è¡Œé…ç½®</span></span><br><span class="line">docker run --restart=always --log-opt max-size=50m --log-opt max-file=1 -p 6379:6379 --name myredis -v /path/to/myredis/redis.conf:/etc/redis/redis.conf -v /path/to/myredis/data:/data -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹æ˜¯å„ä¸ªå‚æ•°çš„è§£é‡Šï¼š</span></span><br><span class="line"><span class="comment"># `--restart=always`: è®¾ç½®å®¹å™¨åœ¨é€€å‡ºæ—¶æ€»æ˜¯è‡ªåŠ¨é‡å¯ã€‚</span></span><br><span class="line"><span class="comment"># `--log-opt max-size=100m`: è®¾ç½®å®¹å™¨æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ä¸º100MBã€‚å½“æ—¥å¿—æ–‡ä»¶è¾¾åˆ°è¯¥å¤§å°æ—¶ï¼Œå°†è¿›è¡Œè½®è½¬ã€‚</span></span><br><span class="line"><span class="comment"># `--log-opt max-file=2`: è®¾ç½®å®¹å™¨æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§æ•°é‡ä¸º2ä¸ªã€‚å½“æ—¥å¿—æ–‡ä»¶æ•°é‡è¶…è¿‡è¯¥å€¼æ—¶ï¼Œæœ€æ—§çš„æ—¥å¿—æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚</span></span><br><span class="line"><span class="comment"># `-p 6379:6379`: å°†å®¿ä¸»æœºçš„6379ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„6379ç«¯å£ï¼Œå…è®¸ä»å®¿ä¸»æœºè®¿é—®RedisæœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment"># `--name myredis`: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œå³&quot;myredis&quot;ã€‚</span></span><br><span class="line"><span class="comment"># `-v /path/to/myredis/redis.conf:/etc/redis/redis.conf`: å°†ä¸»æœºä¸Šçš„ `/path/to/myredis/redis.conf` æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/etc/redis/redis.conf` è·¯å¾„ï¼Œç”¨ä½œRedisé…ç½®æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment"># `-v /path/to/myredis/data:/data`: å°†ä¸»æœºä¸Šçš„ `/path/to/myredis/data` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/data` è·¯å¾„ï¼Œç”¨ä½œRedisæ•°æ®ç›®å½•ã€‚</span></span><br><span class="line"><span class="comment"># `-d redis`: åœ¨åå°è¿è¡Œä¸€ä¸ªRediså®¹å™¨ã€‚</span></span><br><span class="line"><span class="comment"># `redis-server /etc/redis/redis.conf`: æŒ‡å®šè¦è¿è¡Œçš„RedisæœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä½¿ç”¨ `/etc/redis/redis.conf` ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</span></span><br><span class="line">docker logs --since 30m myredis</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æ‰€æœ‰ä¸ç«¯å£å·ç›¸å…³çš„ç½‘ç»œè¿æ¥å’Œç›‘å¬ç«¯å£</span></span><br><span class="line">netstat -an | grep 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</span></span><br><span class="line">docker <span class="built_in">exec</span> -it myredis redis-cli</span><br></pre></td></tr></table></figure></p><h2 id="RedisåŸºç¡€ä»‹ç»"><a href="#RedisåŸºç¡€ä»‹ç»" class="headerlink" title="RedisåŸºç¡€ä»‹ç»"></a>RedisåŸºç¡€ä»‹ç»</h2><h3 id="æŸ¥çœ‹Redisä¿¡æ¯"><a href="#æŸ¥çœ‹Redisä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Redisä¿¡æ¯"></a>æŸ¥çœ‹Redisä¿¡æ¯</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:<span class="number">7.0</span>.11</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸæ¿å—ä¿¡æ¯</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; info CPU</span><br><span class="line"><span class="comment"># CPU</span></span><br><span class="line">used_cpu_sys:<span class="number">1.023336</span></span><br><span class="line">used_cpu_user:<span class="number">0.675062</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>Redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªå¯ä»¥åœ¨é…ç½®æ–‡ä»¶redis.confä¸­åšå‡ºä¿®æ”¹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure><p>è¿™16ä¸ªæ•°æ®åº“ä»¥ç¼–å·0-15å‘½åï¼Œä¸æ”¯æŒä¿®æ”¹åå­—ï¼Œè€Œä¸”å„ä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®å¹¶ä¸å…·å¤‡å®Œå…¨çš„éš”ç¦»æ€§ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ‡æ¢åˆ°ä»»æ„ä¸€ä¸ªæ•°æ®åº“ï¼Œæ‰§è¡Œå‘½ä»¤<code>flushall</code>å°±å¯ä»¥æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€ä»¥å¹¶ä¸å»ºè®®é€šè¿‡æ•°æ®åº“æ¥éš”ç¦»ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿæ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é’ˆå¯¹åŒä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸åŒæ¨¡å—å°†å…¶è®¾ç½®åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚</p><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>Redisçš„åŸºæœ¬æ•°æ®ç±»å‹å¦‚ä¸‹å›¾ï¼š<br><img src="/assets/post_img/article115/redis-data-struct.png" alt="bdt"></p><p>ä½†è¿˜æœ‰å…¶ä»–ä¸€äº›æ•°æ®ç±»å‹å¯æ‰©å±•ï¼Œæˆªè‡³ç›®å‰ï¼Œå®˜ç½‘åŒ…å«å¦‚ä¸‹æ•°æ®ç±»å‹ï¼š<br><img src="/assets/post_img/article115/all-psb-dt.png" alt="alldt"></p><p>ä»¥ä¸‹æ˜¯å¸¸ç”¨æ•°æ®ç»“æ„çš„ç®€è¦ä»‹ç»ï¼š</p><ol><li><p><strong>Stringsï¼ˆå­—ç¬¦ä¸²ï¼‰</strong>ï¼š</p><ul><li>å­˜å‚¨æ–‡æœ¬ã€äºŒè¿›åˆ¶æ•°æ®ç­‰ã€‚</li><li>å¯ç”¨äºç¼“å­˜ã€è®¡æ•°å™¨ç­‰ã€‚</li></ul></li><li><p><strong>Listsï¼ˆåˆ—è¡¨ï¼‰</strong>ï¼š</p><ul><li>æœ‰åºã€å¯é‡å¤çš„å…ƒç´ é›†åˆã€‚</li><li>æ”¯æŒåœ¨åˆ—è¡¨å¤´éƒ¨å’Œå°¾éƒ¨æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼Œä»¥åŠè·å–å­åˆ—è¡¨ã€‚</li><li>é€‚ç”¨äºå®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€æœ€æ–°åŠ¨æ€ç­‰ã€‚</li></ul></li><li><p><strong>Setsï¼ˆé›†åˆï¼‰</strong>ï¼š</p><ul><li>æ— åºã€ä¸é‡å¤çš„å…ƒç´ é›†åˆã€‚</li><li>æ”¯æŒæ·»åŠ ã€åˆ é™¤ã€åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰æ“ä½œã€‚</li><li>é€‚ç”¨äºå­˜å‚¨ä¸é‡å¤çš„æ ‡ç­¾ã€å¥½å‹å…³ç³»ç­‰ã€‚</li></ul></li><li><p><strong>Sorted Setsï¼ˆæœ‰åºé›†åˆï¼‰</strong>ï¼š</p><ul><li>ä¸é›†åˆç±»ä¼¼ï¼Œä½†æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰ç”¨äºæ’åºã€‚</li><li>æ”¯æŒæŒ‰ç…§åˆ†æ•°èŒƒå›´è·å–å…ƒç´ ã€‚</li><li>é€‚ç”¨äºæ’è¡Œæ¦œã€ä¼˜å…ˆçº§é˜Ÿåˆ—ç­‰ã€‚</li></ul></li><li><p><strong>Hashsï¼ˆå“ˆå¸Œï¼‰</strong>ï¼š</p><ul><li>å­˜å‚¨å¯¹è±¡ï¼Œæ¯ä¸ªå­—æ®µå­˜å‚¨ä¸€ä¸ªå±æ€§ã€‚</li><li>æ”¯æŒå•ä¸ªå­—æ®µçš„è¯»å†™ã€åˆ é™¤ï¼Œä»¥åŠè·å–æ‰€æœ‰å­—æ®µã€‚</li><li>é€‚ç”¨äºå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€å•†å“å±æ€§ç­‰ã€‚</li></ul></li><li><p><strong>Bitmapsï¼ˆä½å›¾ï¼‰</strong>ï¼š</p><ul><li>ä½å­˜å‚¨ç»“æ„ï¼Œé€‚åˆè¡¨ç¤ºæŸäº›çŠ¶æ€æˆ–äº‹ä»¶ã€‚</li><li>æ”¯æŒä½çš„è®¾ç½®ã€æ¸…é™¤ã€æŸ¥è¯¢ç­‰æ“ä½œã€‚</li><li>é€‚ç”¨äºç”¨æˆ·åœ¨çº¿çŠ¶æ€ã€ç­¾åˆ°ç­‰ã€‚</li></ul></li><li><p><strong>HyperLogLogï¼ˆåŸºæ•°ä¼°ç®—ï¼‰</strong>ï¼š</p><ul><li>ç”¨äºä¼°ç®—é›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡ï¼Œå ç”¨å¾ˆå°‘çš„å†…å­˜ã€‚</li><li>æ”¯æŒæ·»åŠ å…ƒç´ ï¼Œä»¥åŠè®¡ç®—ä¼°ç®—çš„åŸºæ•°æ•°é‡ã€‚</li><li>é€‚ç”¨äºç»Ÿè®¡ä¸é‡å¤ IP æ•°é‡ã€UV æ•°é‡ç­‰ã€‚</li></ul></li><li><p><strong>Geospatialsï¼ˆåœ°ç†ä½ç½®ï¼‰</strong>ï¼š</p><ul><li>å­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ã€‚</li><li>æ”¯æŒæ·»åŠ åœ°ç‚¹ã€è®¡ç®—ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´çš„è·ç¦»ç­‰æ“ä½œã€‚</li><li>é€‚ç”¨äºé™„è¿‘å•†åº—æŸ¥æ‰¾ã€ä½ç½®æœåŠ¡ç­‰ã€‚</li></ul></li></ol><p>è¿™äº›æ•°æ®ç»“æ„çš„ç‰¹ç‚¹åœ¨äºå¿«é€Ÿçš„è¯»å†™æ“ä½œï¼Œä»¥åŠè®¸å¤šæ–¹ä¾¿çš„å‘½ä»¤å’ŒåŠŸèƒ½ã€‚</p><h3 id="Keyå‘½åè§„èŒƒ"><a href="#Keyå‘½åè§„èŒƒ" class="headerlink" title="Keyå‘½åè§„èŒƒ"></a>Keyå‘½åè§„èŒƒ</h3><p>åœ¨ Redis ä¸­ï¼ŒKey çš„å‘½åæ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒä¸ä»…å½±å“åˆ°æ•°æ®å­˜å‚¨çš„æ€§èƒ½ï¼Œè¿˜ä¼šå½±å“åˆ°ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº› Redis Key å‘½åçš„è§„èŒƒå’Œå»ºè®®ï¼š</p><ol><li><p><strong>æ¸…æ™°è€Œæœ‰æ„ä¹‰çš„å‘½å</strong>ï¼šKey åº”è¯¥èƒ½å¤Ÿæ¸…æ¥šåœ°è¡¨è¾¾å‡ºå®ƒæ‰€å¯¹åº”çš„æ•°æ®å«ä¹‰ï¼Œä¸è¦ä½¿ç”¨è¿‡äºç®€å•çš„åç§°ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºå‘½åç©ºé—´çš„æ–¹å¼æ¥åˆ†éš”ä¸åŒä¸šåŠ¡é¢†åŸŸçš„æ•°æ®ã€‚</p></li><li><p><strong>é¿å…ç‰¹æ®Šå­—ç¬¦</strong>ï¼šKey ä¸åº”è¯¥åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹åˆ«æ˜¯ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ã€‚å»ºè®®ä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è‹±æ–‡å†’å·ç­‰å­—ç¬¦ç»„æˆã€‚</p></li><li><p><strong>é•¿åº¦é€‚ä¸­</strong>ï¼šKey çš„é•¿åº¦åº”è¯¥é€‚ä¸­ï¼Œä¸è¦è¿‡é•¿ï¼Œå°½é‡ä¸è¦è¶…è¿‡1024å­—èŠ‚ï¼Œè¿™ä¸ä»…æ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”ä¼šé™ä½æŸ¥æ‰¾çš„æ•ˆç‡ã€‚</p></li><li><p><strong>å°å†™å­—æ¯</strong>ï¼šå»ºè®®ä½¿ç”¨å°å†™å­—æ¯æ¥å‘½å Keyï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„ Redis é…ç½®ä¸­å¼•èµ·é—®é¢˜ã€‚</p></li><li><p><strong>ä½¿ç”¨åˆ†éš”ç¬¦</strong>ï¼šåœ¨ Key ä¸­ä½¿ç”¨åˆ†éš”ç¬¦ï¼Œä»¥æé«˜å¯è¯»æ€§ï¼Œæ¯”å¦‚ä½¿ç”¨å†’å·ï¼ˆ:ï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æ¥åˆ†éš”ä¸åŒçš„å±‚çº§ã€‚æ³¨æ„è™½ç„¶å¯ä»¥ä½¿ç”¨åˆ†éš”ç¬¦æ–¹å¼åˆ’åˆ† Keyï¼Œä½†ä¸è¦è¿‡åº¦åµŒå¥—ï¼Œä»¥å…å¢åŠ æŸ¥æ‰¾å’Œç»´æŠ¤çš„å¤æ‚æ€§ã€‚</p></li><li><p><strong>é¿å…é‡å¤</strong>ï¼šç¡®ä¿ä¸åŒä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„ Keyï¼Œä»¥å…å†²çªå’Œæ··æ·†ã€‚</p></li><li><p><strong>é¿å…æ•æ„Ÿä¿¡æ¯</strong>ï¼šé¿å…åœ¨ Key ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç ã€å®‰å…¨ä»¤ç‰Œç­‰ã€‚</p></li></ol><p>åˆç†çš„å‘½åè§„èŒƒå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ›´å¥½åœ°åˆ©ç”¨ Redis çš„æ€§èƒ½ä¼˜åŠ¿ã€‚æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œå›¢é˜Ÿçš„çº¦å®šï¼Œå¯ä»¥åˆ¶å®šé€‚åˆè‡ªå·±çš„ Key å‘½åè§„èŒƒã€‚</p><p>ä¸‹é¢åˆ—ä¸¾ä¸€äº›é”®å‘½åç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‘½åè§„èŒƒï¼šuser:&#123;user_id&#125;:name</span><br><span class="line">ç¤ºä¾‹ï¼šuser:123:name</span><br><span class="line"></span><br><span class="line">å‘½åè§„èŒƒï¼špost:&#123;post_id&#125;</span><br><span class="line">ç¤ºä¾‹ï¼špost:456</span><br><span class="line"></span><br><span class="line">å‘½åè§„èŒƒï¼šonline:&#123;date&#125;</span><br><span class="line">ç¤ºä¾‹ï¼šonline:2023-06-01</span><br></pre></td></tr></table></figure></p><h2 id="Redisä½¿ç”¨å…¥é—¨ï¼ˆCLIï¼‰"><a href="#Redisä½¿ç”¨å…¥é—¨ï¼ˆCLIï¼‰" class="headerlink" title="Redisä½¿ç”¨å…¥é—¨ï¼ˆCLIï¼‰"></a>Redisä½¿ç”¨å…¥é—¨ï¼ˆCLIï¼‰</h2><p>ä¸‹é¢ä½¿ç”¨Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿›è¡Œä¸€äº›æ“ä½œï¼ŒåŠ æ·±å¯¹ä¸Šè¿°çŸ¥è¯†çš„ç†è§£ğŸ˜„ã€‚</p><h3 id="é€šç”¨æ“ä½œ"><a href="#é€šç”¨æ“ä½œ" class="headerlink" title="é€šç”¨æ“ä½œ"></a>é€šç”¨æ“ä½œ</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; select <span class="number">1</span>    <span class="comment"># æ•°æ®åº“é€‰æ‹©</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; set a a</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; select <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">2</span>]&gt; get a</span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">2</span>]&gt; keys *   <span class="comment"># æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é”®</span></span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; select <span class="number">1</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; flushdb <span class="comment"># æ¸…ç©ºå½“å‰æ•°æ®åº“</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>[<span class="number">1</span>]&gt; flushdb <span class="comment"># æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²ï¼ˆStringsï¼‰"><a href="#å­—ç¬¦ä¸²ï¼ˆStringsï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ï¼ˆStringsï¼‰"></a>å­—ç¬¦ä¸²ï¼ˆStringsï¼‰</h3><p>åœ¨ Redis ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œä½†ä¹Ÿæ˜¯æœ€é€šç”¨å’Œå¸¸ç”¨çš„ï¼Œå®ƒä¸ä»…å¯ä»¥å­˜å‚¨æ–‡æœ¬ã€æ•´æ•°ã€æµ®ç‚¹æ•°ï¼Œç”šè‡³åŒ…æ‹¬ä»»ä½•äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚å›¾åƒå’Œåºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p><p>è¿™æ˜¯å› ä¸ºåœ¨ Redis ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼ˆBinary-safeï¼‰ã€‚è¿™æ„å‘³ç€ Redis çš„å­—ç¬¦ä¸²å€¼å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾åƒã€åºåˆ—åŒ–çš„å¯¹è±¡ç­‰ï¼Œè€Œä¸ä¼šå¯¹å…¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®åšä»»ä½•å¤„ç†æˆ–è§£é‡Šã€‚</p><p>å¦‚æœéœ€è¦å¯¹å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œè§£ç ï¼Œæ¯”å¦‚å°†å…¶è½¬æ¢ä¸ºç‰¹å®šçš„å¯¹è±¡æˆ–æ–‡ä»¶æ ¼å¼ï¼Œéœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­å¤„ç†è§£ç æ“ä½œã€‚</p><h4 id="è®¾-å–å€¼"><a href="#è®¾-å–å€¼" class="headerlink" title="è®¾/å–å€¼"></a>è®¾/å–å€¼</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•ä¸ªè®¾ç½®</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; set test:<span class="number">1</span>:string <span class="string">&quot;Silence&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; get test:<span class="number">1</span>:string</span><br><span class="line"><span class="string">&quot;Silence&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡è®¾ç½®</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; mset name:<span class="number">1</span> Silence name:<span class="number">2</span> Zheng</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; mget name:<span class="number">1</span> name:<span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Silence&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Zheng&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä¸å­˜åœ¨åˆ™è®¾å€¼ï¼Œå­˜åœ¨åˆ™è®¾ç½®å¤±è´¥</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; setnx name:<span class="number">1</span> <span class="string">&quot;Eminem&quot;</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; get name:<span class="number">1</span></span><br><span class="line"><span class="string">&quot;Silence&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; set name:<span class="number">3</span> <span class="string">&quot;Eminem&quot;</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p><code>SET</code> å‘½ä»¤æ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€èˆ¬åˆ†å¸ƒå¼é”å°±æ˜¯åŸºäºå¸¦è¿‡æœŸæ—¶é—´çš„è¿™ä¸ªå‘½ä»¤æ¥å®ç°çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key value EX|PX 18 <span class="comment"># EXè¡¨ç¤ºç§’ï¼ŒPXè¡¨ç¤ºæ¯«ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®3ç§’åè‡ªåŠ¨è¿‡æœŸ</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> tmp:1 5 EX 3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get tmp:1</span><br><span class="line"><span class="string">&quot;5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get tmp:1</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h4 id="å¢å‡"><a href="#å¢å‡" class="headerlink" title="å¢å‡"></a>å¢å‡</h4><p>å­—ç¬¦ä¸²ç±»å‹åŒ…å«æ•´æ•°å’Œæµ®ç‚¹æ•°ã€‚</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; SET counter <span class="number">10</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; INCR counter</span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; DECR counter</span><br><span class="line">(integer) <span class="number">10</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; INCRBY counter <span class="number">5</span></span><br><span class="line">(integer) <span class="number">15</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; DECRBY counter <span class="number">100</span></span><br><span class="line">(integer) -<span class="number">85</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; DECRBYFLOAT counter <span class="number">5.2465</span></span><br><span class="line">(error) ERR unknown command <span class="string">&#x27;DECRBYFLOAT&#x27;</span>, with args beginning with: <span class="string">&#x27;counter&#x27;</span> <span class="string">&#x27;5.2465&#x27;</span> </span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; INCRBYFLOAT counter -<span class="number">5.2465</span></span><br><span class="line"><span class="string">&quot;-90.2465&quot;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæµ®ç‚¹è¿ç®—ï¼Œä¸å­˜åœ¨<code>DECRBYFLOAT</code>ï¼Œè€Œæ˜¯é€šè¿‡<code>INCRBYFLOAT</code>è´Ÿå€¼æ¥è¿›è¡Œå‡å°‘ã€‚</p><p>æœ€é‡è¦çš„æ˜¯ï¼Œ<code>INCR</code>ç­‰æŒ‡ä»¤æœ¬èº«å°±å…·æœ‰åŸå­æ“ä½œçš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨redisçš„<code>INCRã€INCRBYã€DECRã€DECRBY</code>ç­‰æŒ‡ä»¤æ¥å®ç°å¤šå®¢æˆ·ç«¯åŸå­è®¡æ•°çš„æ•ˆæœï¼Œä¸å°‘ç½‘ç«™éƒ½åˆ©ç”¨redisçš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°ä¸šåŠ¡ä¸Šçš„ç»Ÿè®¡è®¡æ•°éœ€æ±‚ã€‚</p><h4 id="æ›´å¤šæ“ä½œ"><a href="#æ›´å¤šæ“ä½œ" class="headerlink" title="æ›´å¤šæ“ä½œ"></a>æ›´å¤šæ“ä½œ</h4><p>åœ¨å€¼åæ–°å¢å†…å®¹&amp;è·å–å€¼çš„å­ä¸²ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; append <span class="built_in">test</span>:1:string <span class="string">&quot;Zheng66&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 14</span><br><span class="line">127.0.0.1:6379&gt; get <span class="built_in">test</span>:1:string</span><br><span class="line"><span class="string">&quot;SilenceZheng66&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; GETRANGE <span class="built_in">test</span>:1:string 2 10</span><br><span class="line"><span class="string">&quot;lenceZhen&quot;</span></span><br></pre></td></tr></table></figure></p><h3 id="åˆ—è¡¨ï¼ˆListsï¼‰"><a href="#åˆ—è¡¨ï¼ˆListsï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆListsï¼‰"></a>åˆ—è¡¨ï¼ˆListsï¼‰</h3><p>åœ¨ Redis ä¸­ï¼ŒList æ˜¯ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œå®ƒå…è®¸å­˜å‚¨å¤šä¸ªå­—ç¬¦ä¸²å€¼ï¼Œå¹¶ä¸”ä¿æŒå®ƒä»¬çš„æ’å…¥é¡ºåºã€‚æ¯ä¸ªå€¼éƒ½è¢«ç§°ä¸ºå…ƒç´ ï¼ˆelementï¼‰ã€‚Redis ä¸­çš„ List æ˜¯ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼ˆdouble-ended listï¼‰ï¼Œè¿™ä½¿å¾—åœ¨ä¸¤ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œéå¸¸å¿«é€Ÿã€‚</p><h4 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h4><p>ä¸‹é¢ç§°åˆ—è¡¨çš„å·¦ä¾§ä¸ºå¤´éƒ¨ï¼Œå³ä¾§ä¸ºå°¾éƒ¨ã€‚</p><ol><li><code>lpush</code>ï¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ª<code>value</code>æ’å…¥åˆ°åˆ—è¡¨keyçš„å¤´éƒ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºåˆ—è¡¨keyã€‚</li><li><code>lpushx</code>ï¼šå°†<code>value</code>æ’å…¥åˆ°åˆ—è¡¨keyçš„å¤´éƒ¨ï¼Œä¸å­˜åœ¨åˆ™ä¸åšä»»ä½•å¤„ç†ã€‚</li><li><code>lpop</code>ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨keyæŒ‡å®šæ•°é‡çš„å¤´å…ƒç´ ï¼Œé»˜è®¤1ã€‚</li><li><code>rpush</code>ã€<code>rpushx</code>ï¼šå°¾éƒ¨æ’å…¥ï¼Œå¯¹åº”å…³ç³»åŒä¸Šã€‚</li><li><code>rpop</code>ï¼šå°¾éƒ¨æ¨å‡ºï¼ŒåŒä¸Šã€‚</li><li><code>llen</code>ï¼šè¿”å›åˆ—è¡¨keyçš„é•¿åº¦ã€‚</li><li><code>lindex</code>ï¼šè·å–åˆ—è¡¨keyæŒ‡å®šç´¢å¼•ä½ç½®ä¸Šçš„å…ƒç´ ï¼Œå¤´éƒ¨ä»0å¼€å§‹ï¼Œå°¾éƒ¨ä»-1å¼€å§‹ã€‚</li><li><code>lrange</code>ï¼šè¿”å›åˆ—è¡¨keyä¸­ä¸‹æ ‡startåˆ°stopä¹‹é—´çš„å…ƒç´ ï¼ŒåŒ…å«è¾¹ç•Œã€‚</li><li><code>lset</code>ï¼šå°†valueè®¾ç½®åˆ°åˆ—è¡¨keyä¸­æŒ‡å®šindexä½ç½®ã€‚keyä¸å­˜åœ¨æˆ–è€…indexè¶…å‡ºèŒƒå›´æŠ¥é”™ã€‚</li><li><code>lrem</code>ï¼šä»åˆ—è¡¨keyä¸­åˆ é™¤æŒ‡å®šæ•°é‡çš„åŒ¹é…å€¼ã€‚</li><li><code>ltrim</code>ï¼šä¿®å‰ªåŸåˆ—è¡¨ï¼Œåªä¿ç•™æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼ŒåŒ…å«è¾¹ç•Œã€‚</li><li><code>linsert</code>ï¼šåœ¨åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ å‰æˆ–åæ’å…¥æ–°å…ƒç´ ã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; LPUSH mylist item1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; LPUSHX mylist item2 item3</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; RPUSH mylist item4 item5</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; RPUSHX mylist item6</span><br><span class="line">(integer) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lpop mylist</span><br><span class="line"><span class="string">&quot;item3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; rpop mylist</span><br><span class="line"><span class="string">&quot;item6&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; llen mylist</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lindex mylist <span class="number">0</span></span><br><span class="line"><span class="string">&quot;item2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lindex mylist -<span class="number">1</span></span><br><span class="line"><span class="string">&quot;item5&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lindex mylist -<span class="number">2</span></span><br><span class="line"><span class="string">&quot;item4&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; LRANGE mylist <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;item2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;item1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;item4&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;item5&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lset mylist <span class="number">0</span> item2:new</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lpop mylist</span><br><span class="line"><span class="string">&quot;item2:new&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; ltrim mylist <span class="number">2</span> <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; llen mylist</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; LINSERT mylist BEFORE item5 item100</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; LINSERT mylist after item5 item100</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;item100&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;item5&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;item100&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lrem mylist <span class="number">2</span> item100</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;item5&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; lpush mylist item1 item2 item3</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; rpop mylist <span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;item5&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;item1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;item2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;item3&quot;</span></span><br></pre></td></tr></table></figure><h4 id="æ›´å¤šæ“ä½œ-1"><a href="#æ›´å¤šæ“ä½œ-1" class="headerlink" title="æ›´å¤šæ“ä½œ"></a>æ›´å¤šæ“ä½œ</h4><p><strong>BLPOP / BRPOP</strong></p><ul><li><code>BLPOP key [key ...] timeout</code>: é˜»å¡å¼å·¦å¼¹å‡ºæ“ä½œï¼Œç­‰å¾…å¹¶å¼¹å‡ºç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„å…ƒç´ ã€‚</li><li><code>BRPOP key [key ...] timeout</code>: é˜»å¡å¼å³å¼¹å‡ºæ“ä½œï¼Œç­‰å¾…å¹¶å¼¹å‡ºç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„å…ƒç´ ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å¤šä¸ªåˆ—è¡¨ä¸­å¼¹å‡ºå…ƒç´ ï¼Œç­‰å¾…æ—¶é—´ä¸º10ç§’</span></span><br><span class="line">BLPOP mylist1 mylist2 10 </span><br></pre></td></tr></table></figure><h3 id="é›†åˆï¼ˆSetsï¼‰"><a href="#é›†åˆï¼ˆSetsï¼‰" class="headerlink" title="é›†åˆï¼ˆSetsï¼‰"></a>é›†åˆï¼ˆSetsï¼‰</h3><p>Redisä¸­çš„é›†åˆæ˜¯ä¸€ä¸ªStringç±»å‹çš„æ— åºé›†åˆï¼Œé›†åˆä¸­å…ƒç´ å”¯ä¸€ä¸å¯é‡å¤ã€‚</p><p>Setsåœ¨Redisä¸­çš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>SADD key member [member ...]</code>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜æ·»åŠ åˆ°é›†åˆkeyä¸­ã€‚</li><li><code>SCARD key</code>ï¼šè¿”å›é›†åˆkeyçš„åŸºæ•°ï¼ˆé›†åˆä¸­å…ƒç´ çš„æ•°é‡ï¼‰ã€‚</li><li><code>SISMEMBER key member</code>ï¼šåˆ¤æ–­memberå…ƒç´ æ˜¯å¦æ˜¯é›†åˆkeyçš„æˆå‘˜ã€‚</li><li><code>SREM key member [member ...]</code>ï¼šç§»é™¤é›†åˆkeyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªmemberå…ƒç´ ã€‚</li><li><code>SMEMBERS key</code>ï¼šè¿”å›é›†åˆkeyä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚</li><li><code>SPOP key [count]</code>ï¼šç§»é™¤å¹¶è¿”å›é›†åˆkeyä¸­çš„countä¸ªéšæœºå…ƒç´ ã€‚</li><li><code>SRANDMEMBER key [count]</code>ï¼šä»é›†åˆkeyä¸­éšæœºè·å–countä¸ªå…ƒç´ ã€‚</li><li><code>SDIFF key [key ...]</code>ï¼šè¿”å›æ‰€æœ‰ç»™å®šé›†åˆä¹‹é—´çš„å·®é›†ã€‚</li><li><code>SINTER key [key ...]</code>ï¼šè¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„äº¤é›†ã€‚</li><li><code>SUNION key [key ...]</code>ï¼šè¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†ã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; SADD myset value1 value2 value3</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; SCARD myset</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; SISMEMBER myset value1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sadd aset value2 value3 value4</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; SISMEMBER aset value1</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;value2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; srem myset value2 value3</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; smove myset aset value1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sadd myset value1 value3 value5</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; spop aset <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; smembers aset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value4&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; srandmember myset <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sdiff myset aset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;value5&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sdiff aset myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value4&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sinter myset aset</span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; sunion myset aset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;value4&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;value5&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;value2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æœ‰åºé›†åˆï¼ˆSorted-setsï¼‰"><a href="#æœ‰åºé›†åˆï¼ˆSorted-setsï¼‰" class="headerlink" title="æœ‰åºé›†åˆï¼ˆSorted setsï¼‰"></a>æœ‰åºé›†åˆï¼ˆSorted setsï¼‰</h3><p>åœ¨Redisä¸­ï¼ŒSorted Setï¼ˆæœ‰åºé›†åˆï¼‰æ˜¯ä¸€ç§å¯ä»¥æ’åºçš„é›†åˆæ•°æ®ç»“æ„ï¼Œå®ƒçš„æ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„åˆ†æ•°ï¼ˆscoreï¼‰ï¼Œæ ¹æ®åˆ†æ•°çš„æ’åˆ—é¡ºåºå¯¹æˆå‘˜è¿›è¡Œæ’åºã€‚<br>Sorted Setä¸»è¦ç”¨äºå¤„ç†éœ€è¦æ’åºå’Œå»é‡çš„æ•°æ®ã€‚</p><h4 id="æ·»åŠ æ“ä½œ"><a href="#æ·»åŠ æ“ä½œ" class="headerlink" title="æ·»åŠ æ“ä½œ"></a>æ·»åŠ æ“ä½œ</h4><p>å› ä¸ºæ·»åŠ æ“ä½œçš„å‚æ•°è¾ƒå¤šï¼Œå•ç‹¬æ‹¿å‡ºæ¥è¯´ä¸€ä¸‹ã€‚<code>ZADD</code>å‘½ä»¤ç”¨äºå°†ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¸­ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°ã€‚</p><p>ä¸‹é¢æ˜¯<code>ZADD</code>å‘½ä»¤çš„å„ç§ç”¨æ³•ç¤ºä¾‹ï¼š</p><ol><li>æ·»åŠ å•ä¸ªæˆå‘˜åˆ°æœ‰åºé›†åˆï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset 3 <span class="string">&quot;member1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><ol><li>æ·»åŠ å¤šä¸ªæˆå‘˜åˆ°æœ‰åºé›†åˆï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset 2 <span class="string">&quot;member2&quot;</span> 4 <span class="string">&quot;member3&quot;</span> 1 <span class="string">&quot;member4&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨<code>NX</code>é€‰é¡¹ï¼Œä»…åœ¨æˆå‘˜ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset NX 3 <span class="string">&quot;member1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨<code>XX</code>é€‰é¡¹ï¼Œä»…åœ¨æˆå‘˜å·²å­˜åœ¨æ—¶æ‰æ›´æ–°åˆ†æ•°ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset XX 5 <span class="string">&quot;member1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨<code>CH</code>é€‰é¡¹ï¼Œè¿”å›æ›´æ–°æˆ–æ·»åŠ çš„æˆå‘˜æ•°é‡ï¼ŒåŒ…æ‹¬åˆ†æ•°æœªå˜åŠ¨çš„æˆå‘˜ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset CH 5 <span class="string">&quot;member1&quot;</span> 2 <span class="string">&quot;member2&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨<code>INCR</code>é€‰é¡¹ï¼Œå°†åˆ†æ•°ä½œä¸ºå¢é‡è¿›è¡Œæ›´æ–°ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset INCR 2 <span class="string">&quot;member1&quot;</span></span><br><span class="line"><span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure><ol><li>ç»“åˆ<code>NX</code>ã€<code>CH</code>å’Œ<code>INCR</code>é€‰é¡¹çš„å¤šåŠŸèƒ½ç”¨æ³•ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD myzset NX CH INCR 3 <span class="string">&quot;member1&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="åŸºç¡€æ“ä½œ-1"><a href="#åŸºç¡€æ“ä½œ-1" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h4><p>Sorted Setsåœ¨Redisä¸­çš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</code>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆkeyä¸­ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°ã€‚</li><li><code>ZCARD key</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyçš„åŸºæ•°ï¼ˆæœ‰åºé›†åˆä¸­å…ƒç´ çš„æ•°é‡ï¼‰ã€‚</li><li><code>ZSCORE key member</code>ï¼šè¿”å›æˆå‘˜memberçš„åˆ†æ•°ã€‚</li><li><code>ZCOUNT key min max</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyä¸­åˆ†æ•°ä»‹äºminå’Œmaxä¹‹é—´çš„æˆå‘˜æ•°é‡ã€‚</li><li><code>ZINCRBY key increment member</code>ï¼šå°†æˆå‘˜memberçš„åˆ†æ•°å¢åŠ incrementã€‚</li><li><code>ZRANGE key start stop [WITHSCORES]</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyä¸­ç´¢å¼•ä»startåˆ°stopä¹‹é—´çš„æˆå‘˜ã€‚</li><li><code>ZREVRANGE key start stop [WITHSCORES]</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyä¸­ç´¢å¼•ä»startåˆ°stopä¹‹é—´çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°ä»å¤§åˆ°å°æ’åˆ—ã€‚</li><li><code>ZRANK key member</code>ï¼šè¿”å›æˆå‘˜memberåœ¨æœ‰åºé›†åˆkeyä¸­çš„æ’åï¼Œä»0å¼€å§‹è®¡æ•°ã€‚</li><li><code>ZREVRANK key member</code>ï¼šè¿”å›æˆå‘˜memberåœ¨æœ‰åºé›†åˆkeyä¸­çš„æ’åï¼Œä»é«˜åˆ°ä½æ’åˆ—ã€‚</li><li><code>ZREM key member [member ...]</code>ï¼šç§»é™¤æœ‰åºé›†åˆkeyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚</li><li><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyä¸­åˆ†æ•°ä»‹äºminå’Œmaxä¹‹é—´çš„æˆå‘˜ã€‚</li><li><code>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</code>ï¼šè¿”å›æœ‰åºé›†åˆkeyä¸­åˆ†æ•°ä»‹äºmaxå’Œminä¹‹é—´çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°ä»å¤§åˆ°å°æ’åˆ—ã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; ZADD mysset <span class="number">1</span> member1 <span class="number">2</span> member2</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zadd mysset NX <span class="number">3</span> member3</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zcard mysset</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zscore mysset member2</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zcount mysset <span class="number">2</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zincrby mysset <span class="number">2</span> member1</span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrange mysset <span class="number">0</span> -<span class="number">1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;member2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;member1&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;member3&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrevrange mysset <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;member3&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;member1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;member2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrank mysset member2</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrevrank mysset member2</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrem mysset member3</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrangebyscore mysset <span class="number">3</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;member1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; zrevrangebyscore mysset <span class="number">3</span> <span class="number">1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;member1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;member2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å“ˆå¸Œè¡¨ï¼ˆHashsï¼‰"><a href="#å“ˆå¸Œè¡¨ï¼ˆHashsï¼‰" class="headerlink" title="å“ˆå¸Œè¡¨ï¼ˆHashsï¼‰"></a>å“ˆå¸Œè¡¨ï¼ˆHashsï¼‰</h3><p>åœ¨Redisä¸­ï¼ŒHashsæ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å­—æ®µå’Œå€¼çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªå­—æ®µéƒ½ä¸ä¸€ä¸ªå€¼ç›¸å…³è”ï¼Œç±»ä¼¼äºPythonä¸­çš„å­—å…¸ã€‚<br>Hashsä¸»è¦ç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œä»¥åŠéœ€è¦å¤šä¸ªå­—æ®µæ¥è¡¨ç¤ºçš„æ•°æ®ã€‚</p><p>Redisä¸­Hashsçš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>HSET key field value</code>ï¼šå°†å“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼è®¾ç½®ä¸ºvalueã€‚</li><li><code>HSETNX key field value</code>ï¼šå°†å“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼è®¾ç½®ä¸ºvalueï¼Œå¦‚æœfieldå·²å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</li><li><code>HGET key field</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­ç»™å®šå­—æ®µfieldçš„å€¼ã€‚</li><li><code>HMSET key field1 value1 [field2 value2 ...]</code>ï¼šåŒæ—¶å°†å¤šä¸ªfield-valueå¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨keyä¸­ã€‚</li><li><code>HMGET key field1 [field2 ...]</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­ç»™å®šå­—æ®µçš„å€¼ã€‚</li><li><code>HDEL key field1 [field2 ...]</code>ï¼šåˆ é™¤å“ˆå¸Œè¡¨keyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå­—æ®µã€‚</li><li><code>HGETALL key</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­æ‰€æœ‰å­—æ®µå’Œå€¼ã€‚</li><li><code>HKEYS key</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­çš„æ‰€æœ‰å­—æ®µã€‚</li><li><code>HVALS key</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­çš„æ‰€æœ‰å€¼ã€‚</li><li><code>HLEN key</code>ï¼šè¿”å›å“ˆå¸Œè¡¨keyä¸­å­—æ®µçš„æ•°é‡ã€‚</li><li><code>HEXISTS key field</code>ï¼šæŸ¥çœ‹å“ˆå¸Œè¡¨keyä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šå­—æ®µã€‚</li><li><code>HINCRBY key field increment</code>ï¼šä¸ºå“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼å¢åŠ incrementã€‚</li><li><code>HINCRBYFLOAT key field increment</code>ï¼šä¸ºå“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼å¢åŠ æµ®ç‚¹æ•°incrementã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; HSET myhash field1 value1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HSET myhash field2 value2</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HGET myhash field1</span><br><span class="line"><span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HMSET myhash field3 value3 field4 value4</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HMGET myhash field1 field2 field3</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value2&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HDEL myhash field2</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HGETALL myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field3&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HKEYS myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;field3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HVALS myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;value1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;value3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HLEN myhash</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HEXISTS myhash field1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HINCRBY myhash field3 <span class="number">2</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; HINCRBYFLOAT myhash field3 <span class="number">1.5</span></span><br><span class="line"><span class="string">&quot;3.5&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä½å›¾ï¼ˆBitmapsï¼‰"><a href="#ä½å›¾ï¼ˆBitmapsï¼‰" class="headerlink" title="ä½å›¾ï¼ˆBitmapsï¼‰"></a>ä½å›¾ï¼ˆBitmapsï¼‰</h3><p>åœ¨Redisä¸­ï¼ŒBitmapsæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸€ç³»åˆ—ä½çš„é›†åˆï¼Œæ¯ä¸ªä½çš„å€¼è¦ä¹ˆæ˜¯0ï¼Œè¦ä¹ˆæ˜¯1ã€‚<br>æ¯”å¦‚å­˜å‚¨æ•°æ®æ ¼å¼ä¸€èˆ¬ä¸ºï¼š100110000111ï¼Œè¿™é‡Œçš„0å’Œ1å°±æ˜¯bitå€¼ï¼Œè®¾ç½®çš„æ—¶å€™å¯ä»¥è®¾ç½®æŒ‡å®šä½ç½®(åç§»é‡)çš„bitå€¼ã€‚<br>Bitmapsé€šå¸¸ç”¨äºå­˜å‚¨å¸ƒå°”å€¼çš„ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ã€ç”¨æˆ·æ´»è·ƒæƒ…å†µç­‰ã€‚</p><p>Redisä¸­Bitmapsçš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>SETBIT key offset value</code>ï¼šå°†keyå¯¹åº”çš„Bitmapä¸­çš„offsetä½è®¾ç½®ä¸ºvalueï¼ˆ0æˆ–1ï¼‰ã€‚</li><li><code>GETBIT key offset</code>ï¼šè¿”å›keyå¯¹åº”çš„Bitmapä¸­offsetä½çš„å€¼ã€‚</li><li><code>BITCOUNT key [start end]</code>ï¼šç»Ÿè®¡keyå¯¹åº”çš„Bitmapä¸­[start, end]èŒƒå›´å†…å€¼ä¸º1çš„ä½çš„æ•°é‡ã€‚</li><li><code>BITOP operation destkey key [key ...]</code>ï¼šå¯¹å¤šä¸ªBitmapæ‰§è¡Œä½è¿ç®—ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destkeyä¸­ï¼Œoperationå¯ä»¥æ˜¯ANDã€ORã€XORã€NOTã€‚</li><li><code>BITPOS key bit [start] [end]</code>ï¼šè¿”å›keyå¯¹åº”çš„Bitmapä¸­å€¼ä¸ºbitçš„ç¬¬ä¸€ä¸ªä½çš„ä½ç½®ï¼Œ[start, end]èŒƒå›´å†…ã€‚</li><li><code>BITFIELD key [GET type offset] [SET type offset value]</code>ï¼šæ‰§è¡Œå¤šç§ä½åŸŸæ“ä½œï¼Œå¯ä»¥è¿›è¡Œä½å–åã€ä½æˆªå–ã€ä½å¢åŠ ç­‰æ“ä½œã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; SETBIT online_users <span class="number">1000</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GETBIT online_users <span class="number">1000</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; SETBIT online_users <span class="number">2000</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; SETBIT online_users <span class="number">3000</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITCOUNT online_users</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITCOUNT online_users <span class="number">0</span> <span class="number">2000</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITOP OR all_online online_users1 online_users2</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GETBIT all_online <span class="number">1000</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GETBIT all_online <span class="number">2000</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITPOS all_online <span class="number">1</span></span><br><span class="line">(integer) <span class="number">2000</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITPOS all_online <span class="number">1</span> <span class="number">2000</span> <span class="number">3000</span></span><br><span class="line">(integer) <span class="number">3000</span></span><br><span class="line"><span class="comment"># åœ¨åä¸ºonline_usersçš„Bitmapä¸­ï¼Œæ‰§è¡Œä½åŸŸæ“ä½œï¼Œä½¿ç”¨GETå‘½ä»¤ä»åç§»é‡ä¸º1000çš„ä½å¼€å§‹ï¼Œè·å–ä¸€ä¸ªæœ‰ç¬¦å·çš„4ä½æ•´æ•°ï¼ˆu4ç±»å‹ï¼Œæ— ç¬¦å·4ä½æ•´æ•°ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># ç»“æœä¸ºå­—ç¬¦ä¸²&quot;6&quot;ï¼Œè¡¨ç¤ºåœ¨åç§»é‡1000çš„4ä½ä¸­ï¼Œå€¼ä¸º6ã€‚</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITFIELD online_users GET u4 <span class="number">1000</span></span><br><span class="line"><span class="string">&quot;6&quot;</span></span><br><span class="line"><span class="comment"># åœ¨åä¸ºonline_usersçš„Bitmapä¸­ï¼Œæ‰§è¡Œä½åŸŸæ“ä½œï¼Œä½¿ç”¨SETå‘½ä»¤å°†åç§»é‡ä¸º1000çš„4ä½è®¾ç½®ä¸º2ã€‚å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›æ•´æ•°0ã€‚</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITFIELD online_users SET u4 <span class="number">1000</span> <span class="number">2</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="comment"># å†æ¬¡ä½¿ç”¨GETå‘½ä»¤ä»åç§»é‡ä¸º1000çš„ä½å¼€å§‹ï¼Œè·å–ä¸€ä¸ªæœ‰ç¬¦å·çš„4ä½æ•´æ•°ï¼ˆu4ç±»å‹ï¼‰ã€‚ç»“æœä¸ºå­—ç¬¦ä¸²&quot;2&quot;ï¼Œè¡¨ç¤ºåœ¨åç§»é‡1000çš„4ä½ä¸­ï¼Œå€¼å·²ç»è¢«è®¾ç½®ä¸º2ã€‚</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; BITFIELD online_users GET u4 <span class="number">1000</span></span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åŸºæ•°ä¼°ç®—ï¼ˆHyperLogLogï¼‰"><a href="#åŸºæ•°ä¼°ç®—ï¼ˆHyperLogLogï¼‰" class="headerlink" title="åŸºæ•°ä¼°ç®—ï¼ˆHyperLogLogï¼‰"></a>åŸºæ•°ä¼°ç®—ï¼ˆHyperLogLogï¼‰</h3><p>HyperLogLogæœ¬èº«æ˜¯ä¸€ç§ç®—æ³•ï¼Œå…¶æ¥æºäºè®ºæ–‡ã€ŠHyperLogLog the analysis of a near-optimal cardinality estimation algorithmã€‹ã€‚</p><p>åœ¨Redisä¸­ï¼ŒHyperLogLogæ˜¯ä¸€ç§ç”¨äºç»Ÿè®¡åŸºæ•°ï¼ˆé›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡ï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡ä½¿ç”¨å›ºå®šçš„ç©ºé—´æ¥ä¼°è®¡é›†åˆçš„åŸºæ•°ï¼Œå ç”¨çš„ç©ºé—´ç›¸å¯¹è¾ƒå°ã€‚<br>HyperLogLogä¸»è¦ç”¨äºå¯¹å¤§å‹æ•°æ®é›†åˆçš„å»é‡ç»Ÿè®¡ï¼Œé€‚ç”¨äºå¯¹æ•°æ®çš„<strong>è¿‘ä¼¼è®¡æ•°</strong>ï¼Œè€Œä¸éœ€è¦å®é™…å­˜å‚¨æ‰€æœ‰å…ƒç´ ã€‚</p><p>åœ¨Redisé‡Œé¢ï¼Œæ¯ä¸ªHyperLogLogé”®åªéœ€è¦èŠ±è´¹12KBå†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æœ‰0.81%çš„é”™è¯¯ç‡ã€‚</p><p>HyperLogLogåœ¨Redisä¸­çš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>PFADD key element [element ...]</code>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„HyperLogLogä¸­ã€‚</li><li><code>PFCOUNT key [key ...]</code>ï¼šè¿”å›æŒ‡å®šHyperLogLogçš„åŸºæ•°ä¼°ç®—å€¼ã€‚</li><li><code>PFMERGE destkey sourcekey [sourcekey ...]</code>ï¼šåˆå¹¶å¤šä¸ªHyperLogLogä¸ºä¸€ä¸ªHyperLogLogã€‚</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; PFADD myhll element1 element2 element3</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; PFADD myhll element4 element5</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; PFCOUNT myhll</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; PFMERGE merged-hll myhll myhll2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; PFCOUNT merged-hll</span><br><span class="line">(integer) <span class="number">7</span></span><br></pre></td></tr></table></figure><h3 id="åœ°ç†ç©ºé—´ï¼ˆGeospatialsï¼‰"><a href="#åœ°ç†ç©ºé—´ï¼ˆGeospatialsï¼‰" class="headerlink" title="åœ°ç†ç©ºé—´ï¼ˆGeospatialsï¼‰"></a>åœ°ç†ç©ºé—´ï¼ˆGeospatialsï¼‰</h3><p>åœ¨Redisä¸­ï¼ŒGeospatialsæ•°æ®ç»“æ„ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆç»çº¬åº¦ï¼‰å’Œç›¸å…³çš„æ•°æ®ï¼Œç„¶åå¯ä»¥é€šè¿‡ä½ç½®ä¿¡æ¯è¿›è¡Œè·ç¦»è®¡ç®—å’ŒèŒƒå›´æŸ¥è¯¢ã€‚<br>Redisæä¾›äº†ä¸€ç§å«åšGeohashçš„ç®—æ³•æ¥å°†åœ°ç†ä½ç½®æ˜ å°„åˆ°å­—ç¬¦ä¸²ï¼Œä»è€Œå¯ä»¥åœ¨Redisä¸­é«˜æ•ˆåœ°è¿›è¡Œä½ç½®æŸ¥è¯¢å’Œè®¡ç®—ã€‚</p><p>Geospatialæ•°æ®åœ¨Redisä¸­çš„å¸¸ç”¨å‡½æ•°æœ‰ï¼š</p><ol><li><code>GEOADD key longitude latitude member [longitude latitude member ...]</code>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªåœ°ç†ä½ç½®æˆå‘˜æ·»åŠ åˆ°æŒ‡å®šçš„keyä¸­ã€‚</li><li><code>GEODIST key member1 member2 [unit]</code>ï¼šè¿”å›ä¸¤ä¸ªåœ°ç†ä½ç½®æˆå‘˜ä¹‹é—´çš„è·ç¦»ã€‚</li><li><code>GEOHASH key member [member ...]</code>ï¼šè¿”å›æŒ‡å®šåœ°ç†ä½ç½®æˆå‘˜çš„Geohashå­—ç¬¦ä¸²ã€‚</li><li><code>GEOPOS key member [member ...]</code>ï¼šè¿”å›æŒ‡å®šåœ°ç†ä½ç½®æˆå‘˜çš„ç»çº¬åº¦åæ ‡ã€‚</li><li><code>GEORADIUS key longitude latitude radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]</code>ï¼šåœ¨æŒ‡å®šçš„ç»çº¬åº¦èŒƒå›´å†…æŸ¥æ‰¾åœ°ç†ä½ç½®æˆå‘˜ã€‚</li><li><code>GEORADIUSBYMEMBER key member radius unit [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC]</code>ï¼šåœ¨æŒ‡å®šåœ°ç†ä½ç½®æˆå‘˜é™„è¿‘æŸ¥æ‰¾å…¶ä»–åœ°ç†ä½ç½®æˆå‘˜ã€‚</li><li><code>GEODEL key member [member ...]</code>ï¼šä»æŒ‡å®škeyä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªåœ°ç†ä½ç½®æˆå‘˜ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€äº›é…åˆcliç¤ºä¾‹ï¼š</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:<span class="number">6379</span>&gt; GEOADD mygeo <span class="number">13.361389</span> <span class="number">38.115556</span> <span class="string">&quot;Palermo&quot;</span> <span class="number">15.087269</span> <span class="number">37.502669</span> <span class="string">&quot;Catania&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEODIST mygeo Palermo Catania km</span><br><span class="line"><span class="string">&quot;166.2740&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEOHASH mygeo Palermo Catania</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;sqc8b49rny0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;sqdtr74hyu0&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEOPOS mygeo Palermo Catania</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;13.36138933897018433&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;38.11555639549629859&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;15.08726745843887329&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;37.50266842333162032&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEORADIUS mygeo <span class="number">15</span> <span class="number">37</span> <span class="number">200</span> km</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Catania&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEORADIUSBYMEMBER mygeo Palermo <span class="number">200</span> km</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Palermo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.0.1:<span class="number">6379</span>&gt; GEODEL mygeo Catania</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="Redisçš„ä½¿ç”¨åœºæ™¯"><a href="#Redisçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Redisçš„ä½¿ç”¨åœºæ™¯"></a>Redisçš„ä½¿ç”¨åœºæ™¯</h2><p>Redisæ˜¯åŸºäºå†…å­˜æ“ä½œï¼Œå…·å¤‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰ç‰¹ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ã€‚ä¸€èˆ¬å¯ç”¨äºå¦‚ä¸‹åœºæ™¯ï¼š</p><p>1ã€æ•°æ®ç¼“å­˜ã€‚é¡¹ç›®æ—©æœŸä¸€èˆ¬éƒ½æ˜¯å°†æ•°æ®å­˜å‚¨åˆ°<code>MySQLã€oracle</code>ç­‰å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®è¯»å†™éƒ½æ˜¯åŸºäºç£ç›˜æ“ä½œã€‚éšç€ä¸šåŠ¡çš„ä¸æ–­æ‰©å¤§ï¼Œé€šè¿‡ä¼ ç»Ÿçš„æ–¹å¼è¿›è¡Œæ•°æ®çš„è¯»å–ï¼Œç³»ç»Ÿåœ¨è¯»å†™æ–¹é¢éƒ½ä¼šé‡åˆ°ç“¶é¢ˆã€‚é’ˆå¯¹è¿™ä¸€æƒ…å†µï¼Œå°†æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ‰€æœ‰çš„è¯»æ“ä½œéƒ½é€šè¿‡å†…å­˜è¿›è¡ŒæŸ¥è¯¢ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•°æ®æŸ¥è¯¢èƒ½åŠ›ã€‚å¯¹äºæ•°æ®çš„è¯»ï¼Œåœ¨é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å…ˆå†™å…¥å†…å­˜ä¸­ï¼Œåœ¨é€šè¿‡å¼‚æ­¥çš„æ–¹å¼æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚</p><p>2ã€å­˜å‚¨ç”¨æˆ·ç™»å½•<code>token</code>ã€‚é’ˆå¯¹ç”¨æˆ·ç™»å½•é‰´æƒï¼Œä¸€èˆ¬å¯ä»¥åŸºäº<code>cookie</code>ã€jwtæ¥å®ç°ã€‚<code>cookie</code>æ˜¯åŸºäºæ–‡ä»¶å­˜å‚¨ï¼Œå¹¶ä¸”<code>cookie</code>ä¼šæ¶‰åŠåˆ°è·¨åŸŸã€åˆ†å¸ƒå¼æ¶æ„é—®é¢˜ï¼Œjwtç”±äºæ˜¯åŸºäºå®¢æˆ·ç«¯æ–­å­˜å‚¨æ–¹æ¡ˆï¼ŒæœåŠ¡ç«¯æ— æ³•ç›´æ¥æ§åˆ¶ç™»å½•<code>token</code>çš„çŠ¶æ€ã€‚ç”±äºRedisæ˜¯å…·å¤‡åˆ†å¸ƒå¼éƒ¨ç½²æ¶æ„ï¼Œå¾ˆå¥½çš„è§£å†³äº†åˆ†å¸ƒå¼æ¶æ„<code>token</code>é‰´æƒã€ç”¨æˆ·ç™»å½•çŠ¶æ€ç­‰é—®é¢˜çš„æ§åˆ¶ã€‚åŒæ—¶å°†ç™»å½•<code>token</code>å­˜æ”¾åœ¨Redisä¸­ï¼Œæ¯æ¬¡è¯»å–éƒ½é‡‡ç”¨å†…å­˜è¯»å–ï¼Œä¹Ÿæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>3ã€ç§’æ€åœºæ™¯ã€‚å¯¹äºç§’æ€ä¸šåŠ¡åœºæ™¯ï¼Œå¯¹äºç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›éƒ½æ˜¯éå¸¸é«˜çš„ã€‚åœ¨è¯¥åœºæ™¯ä¸‹ï¼Œå°†å•†å“æ•°æ®å­˜å‚¨åˆ°Redisä¸­ï¼Œæé«˜äº†ç³»ç»Ÿçš„æŸ¥è¯¢èƒ½åŠ›ï¼Œå‡å°‘äº†MySQLçš„å‹åŠ›ã€‚å°†å•†å“åº“å­˜éƒ½å­˜å‚¨åˆ°Redisä¸­ï¼Œå› Redisé‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹æ¶æ„ï¼Œä¹Ÿå¯ä»¥å®ç°å•†å“è¶…å–é—®é¢˜ã€‚</p><p>4ã€ç”¨æˆ·ç­¾åˆ°ã€‚å¯ä»¥ä½¿ç”¨ <code>bitmap</code> æ•°æ®ç±»å‹ï¼Œå°†ç”¨æˆ·ç­¾åˆ°å­˜å‚¨åœ¨Redisä¸­ï¼Œç„¶åé€šè¿‡å¼‚æ­¥çº¿ç¨‹å°†æ•°æ®å­˜å‚¨åˆ°MySQLä¸­ã€‚æ—¢èŠ‚çº¦äº†å†…å­˜ï¼Œä¹Ÿæä¾›äº†ç³»ç»Ÿçš„è¯»å†™èƒ½åŠ›ã€‚</p><p>5ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚Redisæä¾› <code>list</code> æ•°æ®ç±»å‹ï¼ŒæŠ€èƒ½ç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿèƒ½ç”¨æ¥åšæ ˆç­‰åœºæ™¯ã€‚åœ¨ Redis5.0 å¼€å§‹ï¼Œä¹Ÿæä¾›äº†ä¸€ç§ <code>stream</code> æ•°æ®ç±»å‹ï¼Œæé«˜äº†æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§ã€‚</p><p>6ã€ç¤¾äº¤åœºæ™¯ã€‚Redisæä¾›äº†ä¸¤ç§é›†åˆæ•°æ®ç±»å‹(set sortset)ï¼Œå¯ä»¥ç”¨åœ¨ç§¯åˆ†æ’è¡Œã€å¥½å‹æ¨èç­‰åœºæ™¯ã€‚</p><p>7ã€å°±è¿‘æ¨èã€‚Redisä¸­æä¾›äº†ä¸€ç§ <code>Geospatials</code> çš„æ•°æ®ç±»å‹æ¥è¿›è¡Œä½è¿ç®—ã€‚å¯ä»¥æ ¹æ®ç”¨æˆ·å½“å‰çš„ç»çº¬åº¦ï¼Œæ¥è®¡ç®—é™„è¿‘çš„é…’åº—ã€å•†åœºç­‰åœºæ‰€çš„æœç´¢ä¸æ¨èåŠŸèƒ½ã€‚</p><p>8ã€åˆ†å¸ƒå¼é”ã€‚å½“åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œéœ€è¦å¯¹å…±äº«æ•°æ®çš„è¯»å†™æ“ä½œ(ä¾‹å¦‚å•†å“ç§’æ€)ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼é”å®ç°ï¼ŒRedisèƒ½å¤Ÿéå¸¸ç®€å•çš„å®ç°åˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>setnx key value + expire time</code> æ“ä½œï¼Œä¸ºäº†å®ç°åŸå­æ€§æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>lua</code> å®ç°ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://zhuanlan.zhihu.com/p/411888708">https://zhuanlan.zhihu.com/p/411888708</a><br>[2] <a href="https://redis.io/docs/getting-started/">https://redis.io/docs/getting-started/</a><br>[3] <a href="https://zhuanlan.zhihu.com/p/609596571">https://zhuanlan.zhihu.com/p/609596571</a><br>[4] <a href="https://zhuanlan.zhihu.com/p/270168739">https://zhuanlan.zhihu.com/p/270168739</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Rediså®‰è£…ä½¿ç”¨å…¥é—¨ï¼ŒåŒ…å«åŸºæœ¬çŸ¥è¯†å’Œå‘½ä»¤è¡Œå®¢æˆ·ç«¯ä½¿ç”¨ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Redis" scheme="http://silencezheng.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Pyinstalleré€†å‘åˆä½“éªŒ</title>
    <link href="http://silencezheng.top/2023/08/08/article114/"/>
    <id>http://silencezheng.top/2023/08/08/article114/</id>
    <published>2023-08-08T15:28:09.000Z</published>
    <updated>2023-08-08T15:28:55.814Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å†™äº†ä¸ªPythonå°å·¥å…·ï¼Œçªç„¶æƒ³åˆ°é˜²é€†å‘çš„é—®é¢˜ï¼Œå†™ç¯‡å°æ–‡å®è·µä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="ç”¨PyInstalleræ‰“åŒ…ç¨‹åº"><a href="#ç”¨PyInstalleræ‰“åŒ…ç¨‹åº" class="headerlink" title="ç”¨PyInstalleræ‰“åŒ…ç¨‹åº"></a>ç”¨PyInstalleræ‰“åŒ…ç¨‹åº</h2><p>å¯¹æœ‰å›¾å½¢ç•Œé¢çš„ç¨‹åºï¼Œæœ€ç®€å•çš„æ‰“åŒ…å°±æ˜¯<code>pyinstaller -F --noconsole xxx.py</code>ã€‚</p><h2 id="åç¼–è¯‘è¯¥ç¨‹åº"><a href="#åç¼–è¯‘è¯¥ç¨‹åº" class="headerlink" title="åç¼–è¯‘è¯¥ç¨‹åº"></a>åç¼–è¯‘è¯¥ç¨‹åº</h2><p>ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„å·¥å…·æ˜¯<a href="https://github.com/WithSecureLabs/python-exe-unpacker">pyinstxtractor</a>ã€‚</p><p>å¯¹äºWindowsä¸­æ‰“åŒ…çš„Pythonåº”ç”¨ï¼ˆpython3.9ï¼Œpyinstaller5.x+ï¼‰ï¼Œå¯ä»¥ç›´æ¥æå–ã€‚ä½†å¯¹äºåŒé…ç½®ä¸‹MacOSä¸­æ‰“åŒ…çš„åº”ç”¨ä¸èƒ½æå–ã€‚ä¸‹é¢ç®€å•æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ã€‚</p><p>é¦–å…ˆä¸‹è½½é¡¹ç›®ä»£ç ï¼Œå°†å¾…æå–å¯æ‰§è¡Œæ–‡ä»¶ç½®äºé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä»¥æˆ‘åç¼–è¯‘çš„é¡¹ç›®<code>replacer.exe</code>ä¸ºä¾‹ï¼Œè¿è¡Œ<code>python python_exe_unpack.py -i replacer.exe</code>ã€‚</p><p>è¿è¡Œåæ ¹ç›®å½•ä¸‹ä¼šå‡ºç°<code>unpacked</code>ç›®å½•ï¼Œå…¶ä¸­ä¸ºæŠ½å–å‡ºçš„<code>pyc</code>æ–‡ä»¶ã€‚æ‰¾åˆ°å…¶ä¸­çš„ç¨‹åºå…¥å£æ–‡ä»¶ï¼Œé€šå¸¸ä¸å¯æ‰§è¡Œæ–‡ä»¶åå­—ç›¸åŒï¼Œæˆ–ä¸º<code>main</code>ç­‰ï¼Œä½†ä¹Ÿå¾ˆå¯èƒ½ä¸ç¬¦åˆè¿™ä¸€è§„å¾‹ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œç¡®å®šï¼Œè¿™é‡Œæˆ‘çš„ç¨‹åºå…¥å£å°±æ˜¯<code>replace</code>ã€‚ä¿®æ”¹æŠ½å–å‡ºçš„å…¥å£æ–‡ä»¶åï¼Œå¢åŠ åç¼€ä¸º <code>replace.pyc</code>ã€‚</p><p>ç„¶åæ‰§è¡Œ<code>uncompyle6 replacer.pyc&gt;replacer.py</code>ï¼Œåç¼–è¯‘<code>pyc</code>æ–‡ä»¶ä¸ºæºä»£ç ã€‚è¿™ä¸€æ­¥ä½ å¾ˆå¯èƒ½åœ¨åç¼–è¯‘å‡ºçš„æ–‡ä»¶ä¸­å‘ç°ç±»ä¼¼<code>Unknown magic number 227 in replacer.pyc</code>çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºä¸åŒPythonç‰ˆæœ¬çš„<code>pyc</code>æ–‡ä»¶å‰ç¼€<code>Magic Number</code>ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„<code>Magic Number</code>ã€‚ä¸€ç§ç®€å•çš„åŠæ³•æ˜¯æŠŠæŠ½å–å‡ºçš„<code>struct</code>æ–‡ä»¶ï¼Œä¹Ÿä¿®æ”¹ä¸º<code>struct.pyc</code>å¹¶å¯¹å…¶è¿›è¡Œåç¼–è¯‘ï¼Œå¦‚æœèƒ½åç¼–è¯‘æˆåŠŸï¼Œåˆ™å°†å…¶æ–‡ä»¶å‰ç¼€åº”ç”¨åˆ°<code>replace.pyc</code>ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">od -c struct.pyc</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">0000000    3  \r  \r  \n   p   y   i   0 001 001  \0  \0 343  \0  \0  \0</span><br><span class="line">0000020   \0  \0  \0  \0  \0  \0  \0  \0  \0  \b  \0  \0  \0   @  \0  \0</span><br><span class="line">0000040   \0   s   8  \0  \0  \0   d  \0   d 001   d 002   d 003   d 004</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å†åè§‚<code>replacer.pyc</code>ï¼Œæ˜æ˜¾ç¼ºå°‘å‰ç¼€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">od -c replacer.pyc</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">0000000  343  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000020   \0 004  \0  \0  \0   @  \0  \0  \0   s 350  \0  \0  \0   d  \0</span><br><span class="line">0000040    d 001   l  \0   Z  \0   d  \0   d 001   l 001   Z 001   d  \0</span><br></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬ç»™<code>replacer.pyc</code>åŠ ä¸Šåˆé€‚çš„<code>Magic Number</code>æ–‡ä»¶å‰ç¼€ï¼Œåœ¨è¿™é‡Œæ˜¯<code>3  \r  \r  \n   p   y   i   0 001 001  \0  \0</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim -b replacer.pyc</span><br><span class="line"><span class="comment"># å‘½ä»¤æ¨¡å¼è¾“å…¥</span></span><br><span class="line">:%!xxd</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå·¦ä¾§æ˜¯16è¿›åˆ¶ï¼Œå³ä¾§æ˜¯åŸæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># VIMæŠŠè¿™äº›å½“åšæ™®é€šçš„å­—ç¬¦ä¸²å¯¹å¾…ï¼Œæ‰€ä»¥ï¼Œä¿®æ”¹äº†å·¦ä¾§çš„16è¿›åˆ¶çš„å­—ç¬¦åå³ä¾§çš„å­—ç¬¦å¹¶ä¸ä¼šè·Ÿç€æ”¹å˜ï¼Œåä¹‹äº¦ç„¶ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä¿®æ”¹å®Œæˆå,ä¸è¦ä¿å­˜,è¦å†ç”¨ </span></span><br><span class="line">:%!xxd -r</span><br><span class="line"><span class="comment"># åˆ‡æ¢æˆæ–‡æœ¬çŠ¶æ€æ ¼å¼å†ä¿å­˜.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–¹å¼ï¼š</span></span><br><span class="line"><span class="comment"># æ‰¾åˆ°èµ·å§‹ä½ç½®ï¼Œä¾‹å¦‚è¿™é‡Œæ˜¯e300</span></span><br><span class="line"><span class="comment"># ç„¶ååŒæ ·æ–¹å¼æ‰“å¼€ xxx.pycï¼ŒæŠŠèµ·å§‹ä½ç½®ä¹‹å‰çš„å†…å®¹å¤åˆ¶åˆ°replacer.pycä¸­å·¦ä¾§ã€‚</span></span><br><span class="line"><span class="comment"># ç„¶å :%!xxd -r åwqä¿å­˜ã€‚</span></span><br></pre></td></tr></table></figure><p>ä½†ç¬”è€…çš„MacOS13è¿›è¡Œå¦‚ä¸Šæ“ä½œåä¾ç„¶æ— æ³•è§£æï¼ŒæŠ¥é”™<code>struct.error: unpack requires a buffer of 2 bytes</code>ï¼Œæ¢ç”¨Windowsåè§£å†³ï¼ŒæˆåŠŸåç¼–è¯‘å‡ºäº†<code>replacer</code>çš„æºç ã€‚</p><p>PSï¼šæ·»åŠ å‰ç¼€åæŠ¥é”™ï¼š<code>Ill-formed bytecode file replacer.pyc &lt;class &#39;ValueError&#39;&gt;; bad marshal data (unknown type code)</code>é€šå¸¸ä¹Ÿæ˜¯ç”±äº<code>Magic Number</code>ä¸å¯¹ï¼Œå¯¹äºpython3.8åŠä»¥ä¸Šç‰ˆæœ¬æ‰“åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶åç¼–è¯‘ä¼¼ä¹éœ€è¦ä½¿ç”¨pycdcï¼Œè¿˜æ²¡éªŒè¯ã€‚ç¬”è€…æµ‹è¯•äº†3.6ã€3.8å’Œ3.9æ‰“åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ3.8å’Œ3.9å‡æ— æ³•é€šè¿‡ä¸Šè¿°æ–¹æ³•åç¼–è¯‘ï¼ŒçŒœæµ‹æ˜¯3.8åç»­æ›´æ–°å¯¼è‡´ã€‚</p><p>PPSï¼šä¸Šè¿°<code>.pyc</code>åç¼–è¯‘å·¥å…·çš„ä½œè€…ä¹Ÿæœ‰ç‚¹éš¾é¡¶å•Š<a href="https://github.com/rocky/python-uncompyle6/issues/316">ğŸ˜†</a>ï¼Œå¦å¤–Pyinstallerçš„<a href="https://pyinstaller.org/en/stable/advanced-topics.html#inspecting-executables">å®˜æ–¹æ–‡æ¡£</a>æœ‰æ—¶é—´ä¹Ÿåº”è¯¥è¯»ä¸€ä¸‹ã€‚</p><h2 id="åœ¨æ‰“åŒ…æ—¶åŠ å¯†ç¨‹åº"><a href="#åœ¨æ‰“åŒ…æ—¶åŠ å¯†ç¨‹åº" class="headerlink" title="åœ¨æ‰“åŒ…æ—¶åŠ å¯†ç¨‹åº"></a>åœ¨æ‰“åŒ…æ—¶åŠ å¯†ç¨‹åº</h2><p>åœ¨<code>pyinstaller</code>æ‰“åŒ…æ—¶è¿›è¡ŒåŠ å¯†ï¼Œåªéœ€è¦æ·»åŠ å‚æ•°<code>--key</code>å³å¯ï¼Œä¾‹å¦‚<code>pyinstaller -F --noconsole --key 12345 xxx.py</code>ã€‚</p><p>Windowsä¸Šä½¿ç”¨è¿™ä¸ªå‚æ•°éœ€è¦å®‰è£…<code>tinyaes</code>ï¼ˆæˆ–<code>pycrypto</code>ï¼‰ï¼Œè¿™ä¸ªåº“éœ€è¦<code>Microsoft Visual C++</code>ï¼Œè¿˜è¦å»å®‰è£…<code>Microsoft Visual C++ Build Tools</code>ã€‚</p><h2 id="åç¼–è¯‘åŠ å¯†çš„ç¨‹åºï¼ˆæœªå®è·µï¼‰"><a href="#åç¼–è¯‘åŠ å¯†çš„ç¨‹åºï¼ˆæœªå®è·µï¼‰" class="headerlink" title="åç¼–è¯‘åŠ å¯†çš„ç¨‹åºï¼ˆæœªå®è·µï¼‰"></a>åç¼–è¯‘åŠ å¯†çš„ç¨‹åºï¼ˆæœªå®è·µï¼‰</h2><p>ç”¨ä¸Šé¢çš„æ–¹æ³•åŠ å¯†åï¼Œ<code>PYZ-00.pyz_extracted</code>ä¸­çš„æ–‡ä»¶å°±è¢«åŠ å¯†äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä»…èƒ½åç¼–è¯‘å‡ºç¨‹åºå…¥å£çš„æºç ã€‚</p><h2 id="ç”¨CythonåŠ å¯†ç¨‹åº"><a href="#ç”¨CythonåŠ å¯†ç¨‹åº" class="headerlink" title="ç”¨CythonåŠ å¯†ç¨‹åº"></a>ç”¨CythonåŠ å¯†ç¨‹åº</h2><p>å¾…è¡¥å……ï¼Œç”¨Macç£•ç£•ç»Šç»Šï¼Œä¸§å¤±å…´è¶£äº†ï½</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://zhuanlan.zhihu.com/p/109266820">https://zhuanlan.zhihu.com/p/109266820</a><br>[2] <a href="https://blog.csdn.net/as604049322/article/details/119834495">https://blog.csdn.net/as604049322/article/details/119834495</a><br>[3] <a href="https://pyinstaller.org/en/stable/advanced-topics.html#inspecting-archives">https://pyinstaller.org/en/stable/advanced-topics.html#inspecting-archives</a><br>[4] <a href="https://pyinstaller.org/en/stable/advanced-topics.html#inspecting-executables">https://pyinstaller.org/en/stable/advanced-topics.html#inspecting-executables</a><br>[5] <a href="https://github.com/WithSecureLabs/python-exe-unpacker">https://github.com/WithSecureLabs/python-exe-unpacker</a><br>[6] <a href="https://blog.csdn.net/qq_15969343/article/details/120001351">https://blog.csdn.net/qq_15969343/article/details/120001351</a><br>[7] <a href="https://github.com/rocky/python-decompile3">https://github.com/rocky/python-decompile3</a><br>[8] <a href="https://github.com/rocky/python-uncompyle6/">https://github.com/rocky/python-uncompyle6/</a><br>[9] <a href="https://blog.csdn.net/Zheng__Huang/article/details/112380221">https://blog.csdn.net/Zheng__Huang/article/details/112380221</a><br>[10] <a href="https://blog.csdn.net/weixin_44222568/article/details/111672799">https://blog.csdn.net/weixin_44222568/article/details/111672799</a><br>[11] <a href="https://www.cnblogs.com/Here-is-SG/p/15885799.html">https://www.cnblogs.com/Here-is-SG/p/15885799.html</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å†™äº†ä¸ªPythonå°å·¥å…·ï¼Œçªç„¶æƒ³åˆ°é˜²é€†å‘çš„é—®é¢˜ï¼Œå†™ç¯‡å°æ–‡å®è·µä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="http://silencezheng.top/tags/Python/"/>
    
    <category term="é€†å‘" scheme="http://silencezheng.top/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>EqualsAndHashCodeæ³¨è§£ä½¿ç”¨æ³¨æ„</title>
    <link href="http://silencezheng.top/2023/08/06/article113/"/>
    <id>http://silencezheng.top/2023/08/06/article113/</id>
    <published>2023-08-06T11:16:30.000Z</published>
    <updated>2023-08-06T11:18:43.342Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ´¾ç”Ÿç±»ä¸­@EqualsAndHashCodeæ³¨è§£ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ã€‚</p><p>å…¶å®å°±æ˜¯æ´¾ç”Ÿç±»ä»€ä¹ˆæ—¶å€™éœ€è¦æ˜¾ç¤ºæŒ‡å®š<code>@EqualsAndHashCode(callSuper = true)</code>çš„é—®é¢˜ã€‚<br><span id="more"></span></p><h2 id="é‡å†™equalsè¦é‡å†™hashCode"><a href="#é‡å†™equalsè¦é‡å†™hashCode" class="headerlink" title="é‡å†™equalsè¦é‡å†™hashCode"></a>é‡å†™equalsè¦é‡å†™hashCode</h2><p>åœ¨ Java ä¸­ï¼Œ<code>hashCode()</code> æ–¹æ³•ç”¨äºè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç ï¼Œè€Œå“ˆå¸Œç åœ¨æ•£åˆ—æ•°æ®ç»“æ„ä¸­ç”¨äºç¡®å®šå¯¹è±¡çš„å­˜å‚¨ä½ç½®ã€‚å½“ä½¿ç”¨æ•£åˆ—æ•°æ®ç»“æ„å­˜å‚¨å¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®å¯¹è±¡çš„å“ˆå¸Œç æ¥ç¡®å®šå­˜å‚¨ä½ç½®ï¼Œç„¶åä½¿ç”¨ <code>equals()</code> æ–¹æ³•æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç¢°æ’ï¼ˆå³ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡æœ‰ç›¸åŒçš„å“ˆå¸Œç ï¼‰ã€‚å¦‚æœ <code>hashCode()</code> å’Œ <code>equals()</code> æ–¹æ³•ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><p>åœ¨æ•£åˆ—æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾å¯¹è±¡æ—¶ï¼Œå¯èƒ½æ— æ³•æ‰¾åˆ°é¢„æœŸçš„å¯¹è±¡ï¼Œå› ä¸º <code>hashCode()</code> ä¸åŒå¯¼è‡´å¯¹è±¡å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ã€‚</p></li><li><p>å½“ä½¿ç”¨å¯¹è±¡ä½œä¸ºé”®ï¼ˆkeyï¼‰å­˜å‚¨åœ¨ <code>HashMap</code> æˆ– <code>Hashtable</code> ä¸­æ—¶ï¼Œç”±äºå“ˆå¸Œç ä¸ä¸€è‡´ï¼Œå¯èƒ½æ— æ³•æ­£ç¡®åœ°æŸ¥æ‰¾æˆ–åˆ é™¤å¯¹åº”çš„å€¼ï¼ˆvalueï¼‰ã€‚</p></li><li><p>åœ¨ä½¿ç”¨ <code>HashSet</code> å­˜å‚¨å¯¹è±¡æ—¶ï¼Œå¯èƒ½ä¼šå…è®¸é‡å¤çš„å¯¹è±¡è¿›å…¥é›†åˆï¼Œå› ä¸º <code>HashSet</code> ä½¿ç”¨å“ˆå¸Œç æ¥æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œè€Œå“ˆå¸Œç ä¸åŒæ„å‘³ç€å¯¹è±¡ä¸åŒï¼Œå³ä½¿å®ƒä»¬çš„ <code>equals()</code> æ–¹æ³•è¿”å› <code>true</code>ã€‚</p></li></ol><p>ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œåœ¨é‡å†™ <code>equals()</code> æ–¹æ³•æ—¶åŒæ—¶é‡å†™ <code>hashCode()</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¦ç¡®ä¿ä¸¤ä¸ªæ–¹æ³•åœ¨æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¶ä¸€è‡´ã€‚åœ¨é‡å†™ <code>hashCode()</code> æ–¹æ³•æ—¶ï¼Œåº”è¯¥ç¡®ä¿ç›¸ç­‰çš„å¯¹è±¡è¿”å›ç›¸åŒçš„å“ˆå¸Œç ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å¯¹è±¡åœ¨æ•£åˆ—æ•°æ®ç»“æ„ä¸­èƒ½å¤Ÿæ­£ç¡®å­˜å‚¨å’Œæ£€ç´¢ã€‚</p><h2 id="EqualsAndHashCodeæ³¨è§£çš„callSuperå±æ€§"><a href="#EqualsAndHashCodeæ³¨è§£çš„callSuperå±æ€§" class="headerlink" title="@EqualsAndHashCodeæ³¨è§£çš„callSuperå±æ€§"></a>@EqualsAndHashCodeæ³¨è§£çš„callSuperå±æ€§</h2><p><code>@EqualsAndHashCode</code> æ˜¯ Lombok æ³¨è§£ä¸­çš„ä¸€ä¸ªï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ã€‚å…¶ä¸­ï¼Œ<code>callSuper</code> å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦åœ¨ç”Ÿæˆçš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ–¹æ³•ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>callSuper</code> å±æ€§çš„å€¼ä¸º <code>false</code>ï¼Œå³ä¸è°ƒç”¨çˆ¶ç±»çš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ªå¦ä¸€ä¸ªç±»å¹¶ä½¿ç”¨ <code>@EqualsAndHashCode</code> æ³¨è§£æ¥ç”Ÿæˆæ–¹æ³•ï¼Œå®ƒåªä¼šè€ƒè™‘è‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘ä»çˆ¶ç±»ç»§æ‰¿çš„æˆå‘˜å˜é‡ã€‚</p><p>å½“ <code>callSuper</code> å±æ€§çš„å€¼ä¸º <code>true</code> æ—¶ï¼ŒLombok ä¼šåœ¨ç”Ÿæˆçš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œé™¤äº†è€ƒè™‘å­ç±»è‡ªå·±çš„æˆå‘˜å˜é‡å¤–ï¼Œè¿˜ä¼šè€ƒè™‘çˆ¶ç±»çš„æˆå‘˜å˜é‡ã€‚è¿™å¯¹äºåŒ…å«ç»§æ‰¿å…³ç³»çš„ç±»ç»“æ„æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä¿è¯äº†åœ¨æ¯”è¾ƒå¯¹è±¡æ—¶è€ƒè™‘äº†æ‰€æœ‰ç»§æ‰¿é“¾ä¸Šçš„æˆå‘˜å˜é‡ã€‚</p><h2 id="æ´¾ç”Ÿç±»éœ€è¦æ˜¾ç¤ºæŒ‡å®š-EqualsAndHashCode-callSuper-true"><a href="#æ´¾ç”Ÿç±»éœ€è¦æ˜¾ç¤ºæŒ‡å®š-EqualsAndHashCode-callSuper-true" class="headerlink" title="æ´¾ç”Ÿç±»éœ€è¦æ˜¾ç¤ºæŒ‡å®š@EqualsAndHashCode(callSuper = true)"></a>æ´¾ç”Ÿç±»éœ€è¦æ˜¾ç¤ºæŒ‡å®š@EqualsAndHashCode(callSuper = true)</h2><p>ç°åœ¨æ¥è§£é‡Šä¸ºä»€ä¹ˆåœ¨æ´¾ç”Ÿç±»ä¸Šå·²ç»æœ‰ <code>@Data</code> æ³¨è§£æ—¶ï¼Œä»ç„¶éœ€è¦åŠ å…¥ <code>@EqualsAndHashCode(callSuper = true)</code> æ³¨è§£ï¼š</p><ol><li><p>å¦‚æœåœ¨æ´¾ç”Ÿç±»ä¸Šä»…ä½¿ç”¨ <code>@Data</code> æ³¨è§£è€Œæ²¡æœ‰ <code>@EqualsAndHashCode</code> æ³¨è§£ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•åªä¼šè€ƒè™‘æ´¾ç”Ÿç±»è‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œè€Œä¸ä¼šè€ƒè™‘ä»çˆ¶ç±»ç»§æ‰¿çš„æˆå‘˜å˜é‡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´åœ¨æ¯”è¾ƒå¯¹è±¡æ—¶å¿½ç•¥äº†æ‰€åŒ…å«çš„çˆ¶ç±»å±æ€§ï¼Œä»è€Œå‡ºç°é”™è¯¯çš„ç»“æœã€‚</p></li><li><p>å¦‚æœåœ¨æ´¾ç”Ÿç±»ä¸ŠåŒæ—¶ä½¿ç”¨ <code>@Data</code> å’Œ <code>@EqualsAndHashCode(callSuper = true)</code> æ³¨è§£ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ä¼šè€ƒè™‘æ´¾ç”Ÿç±»è‡ªå·±çš„æˆå‘˜å˜é‡ï¼ŒåŒæ—¶ä¹Ÿä¼šè°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ–¹æ³•ï¼Œç¡®ä¿äº†ç»§æ‰¿é“¾ä¸Šæ‰€æœ‰æˆå‘˜å˜é‡éƒ½ä¼šè¢«è€ƒè™‘åœ¨å†…ã€‚</p></li></ol><p>ç»¼ä¸Šï¼Œå½“æ´¾ç”Ÿç±»éœ€è¦è€ƒè™‘ç»§æ‰¿è‡ªçˆ¶ç±»çš„æˆå‘˜å˜é‡æ—¶ï¼Œåº”è¯¥åœ¨æ´¾ç”Ÿç±»ä¸Šä½¿ç”¨ <code>@EqualsAndHashCode(callSuper = true)</code> æ³¨è§£ã€‚è€Œå¦‚æœæ´¾ç”Ÿç±»åªéœ€è¦è€ƒè™‘è‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œä¸æ¶‰åŠç»§æ‰¿å…³ç³»ï¼Œé‚£ä¹ˆå¯ä»¥ä»…ä½¿ç”¨ <code>@Data</code> æ³¨è§£è€Œä¸æ·»åŠ  <code>@EqualsAndHashCode</code> æ³¨è§£ã€‚</p><h2 id="Lombokå…¨å±€é…ç½®callSuper"><a href="#Lombokå…¨å±€é…ç½®callSuper" class="headerlink" title="Lombokå…¨å±€é…ç½®callSuper"></a>Lombokå…¨å±€é…ç½®callSuper</h2><p>åœ¨ Lombok ä¸­ï¼Œå…¨å±€é…ç½® <code>callSuper</code> å±æ€§å¯ä»¥é€šè¿‡ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–åœ¨æ³¨è§£å¤„ç†å™¨çš„å‘½ä»¤è¡Œå‚æ•°ä¸­è®¾ç½®ã€‚è¿™æ ·å¯ä»¥ä¸ºæ•´ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰ç±»ç»Ÿä¸€é…ç½® <code>callSuper</code> å±æ€§çš„é»˜è®¤å€¼ã€‚</p><p>åœ¨é¡¹ç›®ä¸­é…ç½® Lombok çš„å…¨å±€å±æ€§æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>ä½¿ç”¨ <code>lombok.config</code> æ–‡ä»¶ï¼š</li></ol><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆé€šå¸¸å¯ä»¥æ”¾åœ¨<code>src/main/java</code>ä¸‹ï¼‰ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>lombok.config</code> çš„æ–‡ä»¶ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜è¯¥é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªæ ¹é…ç½®æ–‡ä»¶ï¼Œä»è¯¥é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å¼€å§‹æ‰«æ</span></span><br><span class="line"><span class="attr">config.stopBubbling</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># å…¨å±€é…ç½® equalsAndHashCode çš„ callSuper å±æ€§ä¸ºtrue</span></span><br><span class="line"><span class="attr">lombok.equalsAndHashCode.callSuper</span>=call</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæ‰€æœ‰ä½¿ç”¨ <code>@EqualsAndHashCode</code> æ³¨è§£çš„ç±»éƒ½ä¼šè‡ªåŠ¨è®¾ç½® <code>callSuper</code> å±æ€§ä¸º <code>true</code>ï¼Œå³åœ¨ç”Ÿæˆçš„ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ–¹æ³•ã€‚</p><ol><li>ä½¿ç”¨æ³¨è§£å¤„ç†å™¨çš„å‘½ä»¤è¡Œå‚æ•°ï¼š</li></ol><p>åœ¨æ„å»ºå·¥å…·ä¸­é…ç½®æ³¨è§£å¤„ç†å™¨çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå°† <code>lombok.equalsAndHashCode.callSuper</code> è®¾ç½®ä¸º <code>true</code>ã€‚å…·ä½“æ–¹æ³•æ ¹æ®ä½¿ç”¨çš„æ„å»ºå·¥å…·æœ‰æ‰€ä¸åŒï¼š</p><ul><li>å¯¹äº Mavenï¼Œå¯ä»¥åœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">compilerArg</span>&gt;</span>-Alombok.equalsAndHashCode.callSuper=true<span class="tag">&lt;/<span class="name">compilerArg</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ›¿æ¢ <code>$&#123;lombok.version&#125;</code> ä¸ºä½ ä½¿ç”¨çš„ Lombok ç‰ˆæœ¬ã€‚</p><ul><li>å¯¹äº Gradleï¼Œå¯ä»¥åœ¨ <code>build.gradle</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆä¸ä¸€å®šå¯¹ï¼‰ï¼š</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    annotationProcessor <span class="string">&quot;org.projectlombok:lombok:$&#123;lombokVersion&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123;</span><br><span class="line">    <span class="keyword">options</span>.compilerArgs &lt;&lt; <span class="string">&quot;-Alombok.equalsAndHashCode.callSuper=true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ›¿æ¢ <code>lombokVersion</code> ä¸ºä½ ä½¿ç”¨çš„ Lombok ç‰ˆæœ¬ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://zhuanlan.zhihu.com/p/460297314">https://zhuanlan.zhihu.com/p/460297314</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ´¾ç”Ÿç±»ä¸­@EqualsAndHashCodeæ³¨è§£ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®å°±æ˜¯æ´¾ç”Ÿç±»ä»€ä¹ˆæ—¶å€™éœ€è¦æ˜¾ç¤ºæŒ‡å®š&lt;code&gt;@EqualsAndHashCode(callSuper = true)&lt;/code&gt;çš„é—®é¢˜ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Lombok" scheme="http://silencezheng.top/tags/Lombok/"/>
    
  </entry>
  
  <entry>
    <title>RestTemplate--SpringBootæ¥å£è°ƒç”¨æ•´åˆ</title>
    <link href="http://silencezheng.top/2023/08/06/article112/"/>
    <id>http://silencezheng.top/2023/08/06/article112/</id>
    <published>2023-08-06T10:48:12.000Z</published>
    <updated>2023-08-06T10:56:05.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Spring Bootæ•´åˆRestTemplateå®ç°æ¥å£è°ƒç”¨å…¥é—¨ã€‚</p><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯RestTemplate"><a href="#ä»€ä¹ˆæ˜¯RestTemplate" class="headerlink" title="ä»€ä¹ˆæ˜¯RestTemplate"></a>ä»€ä¹ˆæ˜¯RestTemplate</h2><p><code>RestTemplate</code>æ˜¯Springæ¡†æ¶ä¸­æä¾›çš„ç”¨äºä»¥åŒæ­¥æ–¹å¼å‘é€HTTPè¯·æ±‚å’Œå¤„ç†HTTPå“åº”çš„ç±»ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨äºè®¿é—®RESTfulæœåŠ¡çš„æ¨¡æ¿ç±»ï¼Œç®€åŒ–äº†åœ¨Javaåº”ç”¨ç¨‹åºä¸­è¿›è¡ŒHTTPé€šä¿¡çš„è¿‡ç¨‹ã€‚</p><p><code>RestTemplate</code>æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œä¾‹å¦‚GETã€POSTã€PUTã€DELETEç­‰ï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨å°†HTTPå“åº”è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼ˆå¦‚JSONè½¬æ¢ä¸ºPOJOï¼‰ã€‚å®ƒæ”¯æŒå„ç§HTTPåè®®ï¼Œå¦‚HTTPã€HTTPSï¼Œå¹¶ä¸”å¯ä»¥ä¸å…¶ä»–Springæ¡†æ¶ç»„ä»¶ï¼ˆå¦‚Spring MVCå’ŒSpring Bootï¼‰æ— ç¼é›†æˆã€‚</p><p>åº•å±‚å®ç°ä¸Šï¼Œ<code>RestTemplate</code>é»˜è®¤æ„é€ å‡½æ•°ä½¿ç”¨<code>java.net.HttpURLConnection</code>æ‰§è¡Œè¯·æ±‚ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å®ç°<code>ClientHttpRequestFactory</code>æ¥å£æ¥åˆ‡æ¢åˆ°ä¸åŒçš„HTTPåº“ã€‚å†…ç½®æ”¯æŒä»¥ä¸‹åº“ï¼š</p><ul><li>Apache HttpComponents</li><li>Netty</li><li>OkHttp</li></ul><h2 id="RestTemplateæä¾›çš„æ–¹æ³•"><a href="#RestTemplateæä¾›çš„æ–¹æ³•" class="headerlink" title="RestTemplateæä¾›çš„æ–¹æ³•"></a>RestTemplateæä¾›çš„æ–¹æ³•</h2><p>RestTemplate æä¾›é«˜åº¦å°è£…çš„æ¥å£ã€‚</p><div class="table-container"><table><thead><tr><th>æ–¹æ³•å</th><th>æè¿°</th></tr></thead><tbody><tr><td>getForObject</td><td>é€šè¿‡GETè¯·æ±‚è·å–èµ„æºçš„è¡¨ç¤ºã€‚</td></tr><tr><td>getForEntity</td><td>é€šè¿‡GETè¯·æ±‚è·å–èµ„æºçš„<code>ResponseEntity</code>ï¼ˆåŒ…å«çŠ¶æ€ã€å“åº”å¤´å’Œå“åº”ä½“ï¼‰ã€‚</td></tr><tr><td>headForHeaders</td><td>é€šè¿‡HEADè¯·æ±‚è·å–èµ„æºçš„æ‰€æœ‰å¤´ä¿¡æ¯ã€‚</td></tr><tr><td>postForLocation</td><td>é€šè¿‡POSTè¯·æ±‚åˆ›å»ºæ–°èµ„æºï¼Œå¹¶ä»å“åº”ä¸­è¿”å›Locationå¤´ä¿¡æ¯ã€‚</td></tr><tr><td>postForObject</td><td>é€šè¿‡POSTè¯·æ±‚åˆ›å»ºæ–°èµ„æºï¼Œå¹¶ä»å“åº”ä¸­è¿”å›èµ„æºçš„è¡¨ç¤ºã€‚</td></tr><tr><td>postForEntity</td><td>é€šè¿‡POSTè¯·æ±‚åˆ›å»ºæ–°èµ„æºï¼Œå¹¶ä»å“åº”ä¸­è¿”å›èµ„æºçš„<code>ResponseEntity</code>ï¼ˆåŒ…å«çŠ¶æ€ã€å“åº”å¤´å’Œå“åº”ä½“ï¼‰ã€‚</td></tr><tr><td>put</td><td>é€šè¿‡PUTè¯·æ±‚åˆ›å»ºæˆ–æ›´æ–°èµ„æºã€‚</td></tr><tr><td>patchForObject</td><td>é€šè¿‡PATCHè¯·æ±‚æ›´æ–°èµ„æºï¼Œå¹¶ä»å“åº”ä¸­è¿”å›èµ„æºçš„è¡¨ç¤ºã€‚è¯·æ³¨æ„ï¼ŒJDK HttpURLConnectionä¸æ”¯æŒPATCHï¼Œä½†Apache HttpComponentså’Œå…¶ä»–åº“æ”¯æŒã€‚</td></tr><tr><td>delete</td><td>é€šè¿‡DELETEè¯·æ±‚åˆ é™¤æŒ‡å®šURIçš„èµ„æºã€‚</td></tr><tr><td>optionsForAllow</td><td>é€šè¿‡OPTIONSè¯·æ±‚è·å–èµ„æºå…è®¸çš„HTTPæ–¹æ³•ã€‚</td></tr><tr><td>exchange</td><td>é€šç”¨çš„ï¼ˆçµæ´»ä½†ä¸å±€é™äºç‰¹å®šç”¨é€”ï¼‰è¯·æ±‚æ–¹æ³•ï¼Œæä¾›é¢å¤–çš„çµæ´»æ€§ã€‚å®ƒæ¥å—<code>RequestEntity</code>ä½œä¸ºè¾“å…¥ï¼Œå…¶ä¸­åŒ…å«HTTPæ–¹æ³•ã€URLã€å¤´ä¿¡æ¯å’Œè¯·æ±‚ä½“ï¼Œå¹¶è¿”å›<code>ResponseEntity</code>ã€‚</td></tr><tr><td>execute</td><td>æœ€é€šç”¨çš„æ‰§è¡Œè¯·æ±‚çš„æ–¹å¼ï¼Œå®Œå…¨æ§åˆ¶è¯·æ±‚å‡†å¤‡å’Œå“åº”æå–ï¼Œé€šè¿‡å›è°ƒæ¥å£å®ç°ã€‚</td></tr></tbody></table></div><h2 id="Springbootæ•´åˆRestTemplate"><a href="#Springbootæ•´åˆRestTemplate" class="headerlink" title="Springbootæ•´åˆRestTemplate"></a>Springbootæ•´åˆRestTemplate</h2><p>åˆ†åˆ«é‡‡ç”¨é»˜è®¤æ–¹å¼å’ŒApache HttpComponentsè¿›è¡Œå®è·µã€‚</p><h3 id="é»˜è®¤æ–¹å¼"><a href="#é»˜è®¤æ–¹å¼" class="headerlink" title="é»˜è®¤æ–¹å¼"></a>é»˜è®¤æ–¹å¼</h3><p>ä»…éœ€è¦ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- author: SilenceZheng66 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ·»åŠ é…ç½®ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨æ§åˆ¶å™¨ä¸­åŠ å…¥<code>restTemplate</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br></pre></td></tr></table></figure></p><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨Serviceä¸­åŠ å…¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ServiceImpl</span><span class="params">(RestTemplate restTemplate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.restTemplate = restTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–å†™ç®€å•çš„æ¥å£è®¿é—®ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeHttpGetRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String url = <span class="string">&quot;https://api.example.com/data&quot;</span>;</span><br><span class="line">    ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(url, String.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (response.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        String responseBody = response.getBody();</span><br><span class="line">        <span class="comment">// å¤„ç†å“åº”æ•°æ®</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†é”™è¯¯å“åº”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="Apache-HttpComponentså‘é€è¯·æ±‚"><a href="#Apache-HttpComponentså‘é€è¯·æ±‚" class="headerlink" title="Apache HttpComponentså‘é€è¯·æ±‚"></a>Apache HttpComponentså‘é€è¯·æ±‚</h3><p>Apache HttpComponentsæ˜¯ä¸€ä¸ªå¼€æºçš„Java HTTPåº“ï¼Œç”¨äºå¤„ç†HTTPè¯·æ±‚å’Œå“åº”ã€‚å®ƒæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šä¸‹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œæä¾›äº†ä¸€ç»„å¯é‡ç”¨çš„ç»„ä»¶ï¼Œå¯ä»¥è½»æ¾åœ°åœ¨Javaåº”ç”¨ç¨‹åºä¸­è¿›è¡ŒHTTPé€šä¿¡ã€‚</p><p>Apache HttpComponentsç”±ä¸¤ä¸ªå­é¡¹ç›®ç»„æˆï¼š</p><ol><li><p>HttpClientï¼šè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„HTTPå®¢æˆ·ç«¯åº“ï¼Œç”¨äºå‘é€HTTPè¯·æ±‚å’Œå¤„ç†HTTPå“åº”ã€‚å®ƒæä¾›äº†ä¸€ç»„ç®€å•è€Œå¼ºå¤§çš„APIï¼Œå¯ä»¥æ‰§è¡Œå„ç§HTTPæ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEç­‰ï¼‰ï¼Œè®¾ç½®è¯·æ±‚å¤´ï¼Œå¤„ç†å“åº”ï¼Œå¤„ç†Cookiesç­‰ã€‚</p></li><li><p>HttpCoreï¼šè¿™æ˜¯ä¸€ä¸ªæ ¸å¿ƒHTTPå¤„ç†åº“ï¼Œä¸ºHTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æä¾›äº†ä½çº§åˆ«çš„HTTPæ”¯æŒã€‚å®ƒå®šä¹‰äº†HTTPåè®®çš„åŸºæœ¬å…ƒç´ ï¼Œå¦‚è¯·æ±‚ã€å“åº”ã€å¤´éƒ¨ã€å®ä½“ç­‰ï¼Œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°æä¾›äº†åŸºç¡€åŠŸèƒ½ã€‚</p></li></ol><p>æ·»åŠ HttpClientä¾èµ–ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- author: SilenceZheng66 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å†™å…¥å‚æ•°ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http_pool:</span></span><br><span class="line">  <span class="attr">max_total:</span> <span class="number">200</span></span><br><span class="line">  <span class="attr">default_max_per_route:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">connect_timeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="attr">connection_request_timeout:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">socket_timeout:</span> <span class="number">65000</span></span><br><span class="line">  <span class="attr">validate_after_inactivity:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure></p><p>åˆ›å»ºHTTPå‚æ•°ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpValues</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.max_total&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxTotal;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.default_max_per_route&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPerRoute;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.connect_timeout&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> connTimeOut;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.connection_request_timeout&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> connReqTimeOut;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.socket_timeout&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> socketTimeout;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;http_pool.validate_after_inactivity&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> inactivity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ›å»ºé…ç½®ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> HttpValues appValues;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate(httpRequestFactory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ ClientHttpRequestFactory Beanã€‚</span></span><br><span class="line"><span class="comment">     * ClientHttpRequestFactory æ˜¯ Spring æä¾›çš„ç”¨äºåˆ›å»º ClientHttpRequest çš„å·¥å‚æ¥å£ã€‚</span></span><br><span class="line"><span class="comment">     * è¿™é‡Œä½¿ç”¨äº†åŸºäº Apache HttpComponents çš„ HttpComponentsClientHttpRequestFactory å®ç°ã€‚</span></span><br><span class="line"><span class="comment">     * HttpComponentsClientHttpRequestFactory ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ HttpClient å¯¹è±¡æ¥å‘é€ HTTP è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ª ClientHttpRequestFactory å¯¹è±¡ï¼Œç”¨äºåˆ›å»º ClientHttpRequestã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpRequestFactory <span class="title">httpRequestFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ HttpComponentsClientHttpRequestFactory å¯¹è±¡ï¼Œå¹¶ä¼ å…¥è‡ªå®šä¹‰çš„ HttpClientã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ HttpClient Beanã€‚</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº†è¿æ¥æ± æ¥ç®¡ç† HTTP è¿æ¥ï¼Œæé«˜äº†æ€§èƒ½å’Œæ•ˆç‡ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ä¸€ä¸ª HttpClient å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºå‘é€ HTTP è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpClient <span class="title">httpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª Registryï¼Œç”¨äºç®¡ç†ä¸åŒåè®®çš„è¿æ¥å·¥å‚ã€‚</span></span><br><span class="line">        Registry&lt;ConnectionSocketFactory&gt; registry = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">                <span class="comment">// æ³¨å†Œ HTTP åè®®çš„è¿æ¥å·¥å‚ï¼Œä½¿ç”¨é»˜è®¤çš„ PlainConnectionSocketFactoryã€‚</span></span><br><span class="line">                .register(<span class="string">&quot;http&quot;</span>, PlainConnectionSocketFactory.getSocketFactory())</span><br><span class="line">                <span class="comment">// æ³¨å†Œ HTTPS åè®®çš„è¿æ¥å·¥å‚ï¼Œä½¿ç”¨é»˜è®¤çš„ SSLConnectionSocketFactoryã€‚</span></span><br><span class="line">                .register(<span class="string">&quot;https&quot;</span>, SSLConnectionSocketFactory.getSocketFactory())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥æ± ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†è¿æ¥çš„å¤ç”¨å’Œå›æ”¶ã€‚</span></span><br><span class="line">        PoolingHttpClientConnectionManager connectionManager = <span class="keyword">new</span> PoolingHttpClientConnectionManager(registry);</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ã€‚</span></span><br><span class="line">        connectionManager.setMaxTotal(appValues.getMaxTotal());</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¯ä¸ªè·¯ç”±çš„æœ€å¤§è¿æ¥æ•°ã€‚</span></span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(appValues.getMaxPerRoute());</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿æ¥ç©ºé—²å¤šé•¿æ—¶é—´åè¿›è¡ŒéªŒè¯ï¼Œé¿å…ç©ºé—²è¿æ¥è¿‡å¤šå ç”¨èµ„æºã€‚</span></span><br><span class="line">        connectionManager.setValidateAfterInactivity(appValues.getInactivity());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¯·æ±‚é…ç½®å¯¹è±¡ï¼Œç”¨äºè®¾ç½®è¿æ¥è¶…æ—¶å’Œè¯»å†™è¶…æ—¶ç­‰å‚æ•°ã€‚</span></span><br><span class="line">        RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">                <span class="comment">// æœåŠ¡å™¨è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´å°†æŠ›å‡º read timeout å¼‚å¸¸ã€‚</span></span><br><span class="line">                .setSocketTimeout(appValues.getSocketTimeout())</span><br><span class="line">                <span class="comment">// è¿æ¥ä¸ŠæœåŠ¡å™¨çš„æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´å°†æŠ›å‡º connect timeout å¼‚å¸¸ã€‚</span></span><br><span class="line">                .setConnectTimeout(appValues.getConnTimeOut())</span><br><span class="line">                <span class="comment">// ä»è¿æ¥æ± ä¸­è·å–è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´å°†æŠ›å‡º ConnectionPoolTimeoutException å¼‚å¸¸ã€‚</span></span><br><span class="line">                .setConnectionRequestTimeout(appValues.getConnReqTimeOut())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª HttpClient å¯¹è±¡ï¼Œå¹¶è®¾ç½®è¿æ¥æ± ç®¡ç†å™¨å’Œè¯·æ±‚é…ç½®ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> HttpClientBuilder.create()</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .setConnectionManager(connectionManager)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/students/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Students&gt; <span class="title">getStudentById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">    Students student = studentsService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (student != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°å­¦ç”Ÿï¼Œè¿”å›çŠ¶æ€ç 200 OKå’Œå­¦ç”Ÿå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(student);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœªæ‰¾åˆ°å­¦ç”Ÿï¼Œè¿”å›çŠ¶æ€ç 404 NOT FOUND</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/rest/get/students+1/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">restGetTest</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span>&#123;</span><br><span class="line">    String url = <span class="string">&quot;http://localhost:48081/students/&quot;</span> + String.valueOf(id+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// è¿™é‡Œåº”è¯¥åŠ å…¥å¼‚å¸¸å¤„ç†</span></span><br><span class="line">    ResponseEntity&lt;Students&gt; response = restTemplate.getForEntity(url, Students.class);</span><br><span class="line">    <span class="comment">// è·å–å“åº”</span></span><br><span class="line">    <span class="keyword">if</span> (response.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        Students responseBody = response.getBody();</span><br><span class="line">        <span class="keyword">if</span> (responseBody!=<span class="keyword">null</span>) <span class="keyword">return</span> ResponseEntity.ok(responseBody.toString());</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND).body(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="comment">// å¤„ç†å“åº”æ•°æ®</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†é”™è¯¯å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(<span class="string">&quot;Bad Request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯¹äºå¸¦è·¯å¾„å‚æ•°çš„URLï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹å¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line">String url = <span class="string">&quot;http://localhost:48081/students/&#123;1&#125;&quot;</span>;</span><br><span class="line">ResponseEntity&lt;Students&gt; response = restTemplate.getForEntity(url, Students.class, id+<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p><p>å¯¹äºæ·»åŠ è¯·æ±‚å¤´ã€Cookieã€æ–‡ä»¶ä¸Šä¼ ç­‰ç­‰æ›´å¤šç”¨æ³•ï¼Œåœ¨ä½¿ç”¨æ—¶æŸ¥é˜…ã€ç§¯ç´¯å³å¯ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://docs.spring.io/spring-framework/docs/5.1.9.RELEASE/spring-framework-reference/integration.html#rest-resttemplate">https://docs.spring.io/spring-framework/docs/5.1.9.RELEASE/spring-framework-reference/integration.html#rest-resttemplate</a><br>[2] <a href="https://zhuanlan.zhihu.com/p/258121569">https://zhuanlan.zhihu.com/p/258121569</a><br>[3] <a href="https://www.cnblogs.com/javazhiyin/p/9851775.html">https://www.cnblogs.com/javazhiyin/p/9851775.html</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Spring Bootæ•´åˆRestTemplateå®ç°æ¥å£è°ƒç”¨å…¥é—¨ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Spring" scheme="http://silencezheng.top/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>MinIOéƒ¨ç½²--SpringBootæ–‡ä»¶å­˜å‚¨æ•´åˆ</title>
    <link href="http://silencezheng.top/2023/07/23/article111/"/>
    <id>http://silencezheng.top/2023/07/23/article111/</id>
    <published>2023-07-23T14:36:32.000Z</published>
    <updated>2023-08-06T10:56:18.244Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>MinIOå¯¹è±¡å­˜å‚¨æœåŠ¡å¼€å‘æœºéƒ¨ç½²ä¸Spring Booté¡¹ç›®æ•´åˆå…¥é—¨ã€‚<br><span id="more"></span></p><h2 id="MinIO"><a href="#MinIO" class="headerlink" title="MinIO"></a>MinIO</h2><blockquote><p>MinIO æ˜¯ä¸€ä¸ªåŸºäº Go å®ç°çš„é«˜æ€§èƒ½ã€å…¼å®¹ S3 åè®®çš„å¯¹è±¡å­˜å‚¨ã€‚å®ƒé‡‡ç”¨ GNU AGPL v3 å¼€æºåè®®ï¼Œé¡¹ç›®åœ°å€æ˜¯ <a href="https://github.com/minio/minioï¼Œå®˜ç½‘æ˜¯">https://github.com/minio/minioï¼Œå®˜ç½‘æ˜¯</a> <a href="https://min.ioã€‚">https://min.ioã€‚</a></p><p>å®ƒé€‚åˆå­˜å‚¨æµ·é‡çš„éç»“æ„åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚è¯´å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¸¸è§æ–‡ä»¶ï¼Œå¤‡ä»½æ•°æ®ã€å®¹å™¨ã€è™šæ‹Ÿæœºé•œåƒç­‰ç­‰ï¼Œå°åˆ° 1 KBï¼Œå¤§åˆ° 5 TB éƒ½å¯ä»¥æ”¯æŒã€‚</p></blockquote><h2 id="MinIOçš„è¿è¡Œæ¨¡å¼"><a href="#MinIOçš„è¿è¡Œæ¨¡å¼" class="headerlink" title="MinIOçš„è¿è¡Œæ¨¡å¼"></a>MinIOçš„è¿è¡Œæ¨¡å¼</h2><p>MinIO æ”¯æŒä¸‰ç§éƒ¨ç½²æ‹“æ‰‘ç»“æ„ï¼š</p><ol><li><p>å•èŠ‚ç‚¹å•é©±åŠ¨<br>Single-Node Single-Driveï¼Œä¹Ÿå¯ç§°ä¸ºSNSD æˆ– â€œStandaloneâ€ã€‚</p><p>æŒ‡å…·æœ‰å•ä¸ªå­˜å‚¨å·æˆ–æ–‡ä»¶å¤¹çš„å•ä¸ª MinIO æœåŠ¡å™¨ã€‚ SNSDéƒ¨ç½²æä¾›æ•…éšœè½¬ç§»ä¿æŠ¤ã€‚é©±åŠ¨å™¨çº§å¯é æ€§å’Œæ•…éšœè½¬ç§»å–å†³äºåº•å±‚å­˜å‚¨å·ã€‚SNSDéƒ¨ç½²æœ€é€‚åˆä½¿ç”¨ MinIO è¿›è¡Œå¯¹è±¡å­˜å‚¨çš„åº”ç”¨ç¨‹åºçš„è¯„ä¼°å’Œåˆå§‹å¼€å‘ã€‚</p></li><li><p>å•èŠ‚ç‚¹å¤šé©±åŠ¨<br>Single-Node Multi-Driveï¼Œä¹Ÿå¯ç§°ä¸ºSNMD æˆ– â€œStandalone Multi-Driveâ€ã€‚</p><p>æŒ‡å…·æœ‰å››ä¸ªæˆ–æ›´å¤šå­˜å‚¨å·çš„å•ä¸ª MinIO æœåŠ¡å™¨ã€‚ SNMDéƒ¨ç½²ä»…æä¾›é©±åŠ¨å™¨çº§å¯é æ€§å’Œæ•…éšœè½¬ç§»ã€‚</p></li><li><p>å¤šèŠ‚ç‚¹å¤šé©±åŠ¨<br>Multi-Node Multi-Driveï¼Œä¹Ÿå¯ç§°ä¸ºMNMD æˆ– â€œDistributedâ€ã€‚</p><p>æŒ‡åˆ†å¸ƒå¼ MinIO æœåŠ¡å™¨ï¼Œæ‰€æœ‰æœåŠ¡å™¨ä¸Šè‡³å°‘æœ‰å››ä¸ªé©±åŠ¨å™¨ã€‚åˆ†å¸ƒå¼MNMDæ‹“æ‰‘æ”¯æŒå…·æœ‰é©±åŠ¨å™¨å’ŒèŠ‚ç‚¹çº§å¯ç”¨æ€§å’Œå¼¹æ€§çš„ç”Ÿäº§çº§å¯¹è±¡å­˜å‚¨ã€‚</p></li></ol><p>ä½œä¸ºå…¥é—¨éƒ¨ç½²ï¼Œä¸‹é¢ä»…å±•ç¤ºSNSDéƒ¨ç½²ã€‚</p><h2 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h2><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://min.io/download">https://min.io/download</a></p><p>ä»…è€ƒè™‘å¼€å‘ç¯å¢ƒï¼Œç”¨Dockeréƒ¨ç½²æ˜¯æœ€æ–¹ä¾¿çš„ï¼Œä¸‹é¢æ˜¯éƒ¨ç½²è¿‡ç¨‹ã€‚</p><p>Dockeréƒ¨ç½²ï¼ˆMacOS arm64ï¼‰ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹minioé•œåƒ</span></span><br><span class="line">docker search minio</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull minio/minio</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæœ¬åœ°è·¯å¾„</span></span><br><span class="line">mkdir myminio myminio/config myminio/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶</span></span><br><span class="line">touch myminio/config/config.env</span><br><span class="line"></span><br><span class="line"><span class="comment"># config.envå†™å…¥å†…å®¹å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># è®¾ç½® MinIO æœåŠ¡å™¨çš„rootè´¦å·ï¼Œæ­¤ç”¨æˆ·å…·æœ‰å¯¹éƒ¨ç½²ä¸­çš„ä»»ä½•èµ„æºæ‰§è¡Œ S3 å’Œç®¡ç† API æ“ä½œçš„ä¸å—é™åˆ¶çš„æƒé™ã€‚</span></span><br><span class="line">MINIO_ROOT_USER=myminioadmin</span><br><span class="line"><span class="comment"># è‡³å°‘8ä½</span></span><br><span class="line">MINIO_ROOT_PASSWORD=minio-secret-key-change-me</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨äº MinIO æœåŠ¡å™¨çš„å­˜å‚¨è·¯å¾„ã€‚</span></span><br><span class="line">MINIO_VOLUMES=<span class="string">&quot;/mnt/data&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MINIO_SERVER_URLè®¾ç½®æœ¬åœ°æœºå™¨çš„ä¸»æœºåä»¥ç”¨äº MinIO æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼Œå¹¶å°†è¯¥å€¼æ›¿æ¢ä¸ºæœ¬åœ°æœºå™¨çš„æ­£ç¡®ä¸»æœºåå’Œ MinIO æœåŠ¡å™¨çš„ç«¯å£ï¼ˆé»˜è®¤ä¸º 9000ï¼‰</span></span><br><span class="line"><span class="comment">#MINIO_SERVER_URL=&quot;http://minio.example.net:9000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -dt                                  \</span><br><span class="line">  -p 9000:9000 -p 9090:9090                     \</span><br><span class="line">  -v /path/to/myminio/data:/mnt/data            \</span><br><span class="line">  -v /path/to/myminio/config:/etc               \</span><br><span class="line">  -e <span class="string">&quot;MINIO_CONFIG_ENV_FILE=/etc/config.env&quot;</span>    \</span><br><span class="line">  --name <span class="string">&quot;myminio&quot;</span>                              \</span><br><span class="line">  minio/minio server --console-address <span class="string">&quot;:9090&quot;</span></span><br></pre></td></tr></table></figure></p><p>MinIOä¸­é»˜è®¤é…ç½®9000ç«¯å£æ˜¯ç”¨äºè®¿é—®MinIOçš„å¯¹è±¡å­˜å‚¨æœåŠ¡çš„APIç«¯å£ï¼Œé€šè¿‡è¯¥ç«¯å£å¯ä»¥æ‰§è¡Œå„ç§å¯¹è±¡å­˜å‚¨ç›¸å…³çš„æ“ä½œã€‚è€Œ9090ç«¯å£æ˜¯ç”¨äºè®¿é—®MinIOçš„ç®¡ç†ç•Œé¢ï¼Œé€šè¿‡è¯¥ç«¯å£å¯ä»¥ç™»å½•å¹¶æ‰§è¡ŒMinIOå®ä¾‹çš„ç®¡ç†æ“ä½œã€‚</p><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><p>è¿è¡Œå®¹å™¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡MinIOçš„ç®¡ç†ç•Œé¢è¿›è¡Œç®€å•é…ç½®ï¼Œè®¿é—® <a href="http://localhost:9090">http://localhost:9090</a> è¿›å…¥ç®¡ç†ç•Œé¢ã€‚</p><p><img src="/assets/post_img/article111/shouye.png" alt="é¦–é¡µ"></p><p>ç„¶åæ–°å»ºå­˜å‚¨æ¡¶ï¼Œç”¨äºæ–‡ä»¶ä¸Šä¼ ã€‚ç‚¹å‡»æ¡¶ï¼Œé€‰æ‹©<code>Anonymoous</code>åˆ›å»ºä¸€æ¡Prefixä¸º<code>/</code>ï¼ŒAccessä¸º<code>readonly</code>çš„åŒ¿åè®¿é—®è§„åˆ™ã€‚</p><p><img src="/assets/post_img/article111/mybucket.png" alt="è§„åˆ™"></p><p>è¿™æ ·é…ç½®ä»¥åï¼Œæ–‡ä»¶è®¿é—®åœ°å€çš„æ ¼å¼ä¸º<code>http://localhost:9000/mybucket/&#123;filename&#125;</code>ã€‚</p><p>å¦å¤–ï¼ŒMinIO Client (mc) æ˜¯ MinIO æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè®¿é—® MinIO Serverã€‚å®ƒçš„å‘½ä»¤è®¾è®¡çš„éå¸¸æ£’ï¼Œå’Œæˆ‘ä»¬åœ¨ä½¿ç”¨ lsã€catã€cpã€mirrorã€diffã€find ç­‰ Unix å‘½ä»¤åŸºæœ¬æ¥è¿‘ï¼Œä¸»è¦å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span>       åˆ—å‡ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span><br><span class="line">mb       åˆ›å»ºä¸€ä¸ªå­˜å‚¨æ¡¶æˆ–ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br><span class="line"><span class="built_in">cat</span>      æ˜¾ç¤ºæ–‡ä»¶å’Œå¯¹è±¡å†…å®¹</span><br><span class="line">pipe     å°†ä¸€ä¸ª STDIN é‡å®šå‘åˆ°ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ–‡ä»¶æˆ–è€… STDOUT</span><br><span class="line">share    ç”Ÿæˆç”¨äºå…±äº«çš„ URL</span><br><span class="line"><span class="built_in">cp</span>       æ‹·è´æ–‡ä»¶å’Œå¯¹è±¡</span><br><span class="line">mirror   ç»™å­˜å‚¨æ¡¶å’Œæ–‡ä»¶å¤¹åšé•œåƒ</span><br><span class="line">find     åŸºäºå‚æ•°æŸ¥æ‰¾æ–‡ä»¶</span><br><span class="line"><span class="built_in">diff</span>     å¯¹ä¸¤ä¸ªæ–‡ä»¶å¤¹æˆ–è€…å­˜å‚¨æ¡¶æ¯”è¾ƒå·®å¼‚</span><br><span class="line"><span class="built_in">rm</span>       åˆ é™¤æ–‡ä»¶å’Œå¯¹è±¡</span><br><span class="line">events   ç®¡ç†å¯¹è±¡é€šçŸ¥</span><br><span class="line">watch    ç›‘å¬æ–‡ä»¶å’Œå¯¹è±¡çš„äº‹ä»¶</span><br><span class="line">policy   ç®¡ç†è®¿é—®ç­–ç•¥</span><br><span class="line">session  ä¸º <span class="built_in">cp</span> å‘½ä»¤ç®¡ç†ä¿å­˜çš„ä¼šè¯</span><br><span class="line">config   ç®¡ç† mc é…ç½®æ–‡ä»¶</span><br><span class="line">update   æ£€æŸ¥è½¯ä»¶æ›´æ–°</span><br><span class="line">version  è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸¾ä¾‹ï¼šåˆ—å‡ºæœ‰å“ªäº›å­˜å‚¨æ¡¶</span></span><br><span class="line">mc <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><h2 id="æ•´åˆSpring-Booté¡¹ç›®"><a href="#æ•´åˆSpring-Booté¡¹ç›®" class="headerlink" title="æ•´åˆSpring Booté¡¹ç›®"></a>æ•´åˆSpring Booté¡¹ç›®</h2><p>ä¸‹é¢åœ¨Spring Booté¡¹ç›®å¼•å…¥MinIOç›¸å…³ä¾èµ–å®ç°æ–‡ä»¶çš„ä¸Šä¼ ä¸åˆ é™¤çš„åŠŸèƒ½ã€‚</p><p>å¼•å…¥ä¾èµ–å¦‚ä¸‹ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MinIO å®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ–°å»º <code>MinIOConfiguration</code> é…ç½®ç±»ï¼Œåˆ›å»º <code>MinioClient Bean</code>ï¼Œå¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.minio.MinioClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinIOConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MinioClient <span class="title">minioClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Minio é…ç½®ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œå®šä¹‰åˆ° application.yml é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">        String endpoint = <span class="string">&quot;http://localhost:9000&quot;</span>;</span><br><span class="line">        String accessKey = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">        String secretKey = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»º MinioClient å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentials(accessKey, secretKey)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º <code>MinIOFileController</code> ç±»ï¼Œå®ç°æ–‡ä»¶ä¸Šä¼ ä¸åˆ é™¤çš„ RESTful API æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/minio&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;MinIOæ–‡ä»¶æ“ä½œæ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinIOFileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MinioClient minioClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Minio é…ç½®ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œå®šä¹‰åˆ° application.yml é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint = <span class="string">&quot;http://127.0.0.1:9000&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String bucket = <span class="string">&quot;mybucket&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸Šä¼ </span></span><br><span class="line">        String path = UUID.randomUUID().toString(); <span class="comment">// æ–‡ä»¶åï¼Œä½¿ç”¨ UUID éšæœº</span></span><br><span class="line">        minioClient.putObject(PutObjectArgs.builder()</span><br><span class="line">                .bucket(bucket) <span class="comment">// å­˜å‚¨æ¡¶</span></span><br><span class="line">                .object(path) <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">                .stream(file.getInputStream(), file.getSize(), -<span class="number">1</span>) <span class="comment">// æ–‡ä»¶å†…å®¹</span></span><br><span class="line">                .contentType(file.getContentType()) <span class="comment">// æ–‡ä»¶ç±»å‹</span></span><br><span class="line">                .build());</span><br><span class="line">        <span class="comment">// æ‹¼æ¥è·¯å¾„</span></span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s/%s/%s&quot;</span>, endpoint, bucket, path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;path&quot;)</span> String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        minioClient.removeObject(RemoveObjectArgs.builder()</span><br><span class="line">                .bucket(bucket) <span class="comment">// å­˜å‚¨æ¡¶</span></span><br><span class="line">                .object(path) <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€Swaggerç•Œé¢å°±å¯ä»¥è¿›è¡Œæ¥å£æµ‹è¯•äº†ï¼Œä¸Šä¼ è¿”å›ç»“æœç¤ºä¾‹å¦‚ä¸‹ã€‚<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">127.0.0.1:9000</span>/mybucket/a<span class="number">72</span>a<span class="number">02</span>c<span class="number">5</span>-<span class="number">4</span>dff-<span class="number">44</span>d<span class="number">8</span>-<span class="number">841</span>b-ad<span class="number">5</span>a<span class="number">3</span>b<span class="number">4</span>c<span class="number">5</span>b<span class="number">71</span></span><br></pre></td></tr></table></figure></p><p>ç›´æ¥æµè§ˆå™¨è¾“å…¥åœ°å€å°±å¯ä»¥çœ‹åˆ°ï¼Œæˆ–è€…åœ¨ç®¡ç†ç•Œé¢æŸ¥çœ‹ã€‚</p><p><img src="/assets/post_img/article111/upload.png" alt="ä¸Šä¼ "></p><p>åˆ é™¤æ—¶ï¼Œä»¥æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°è¾“å…¥å³å¯ï¼Œå¦‚<code>a72a02c5-4dff-44d8-841b-ad5a3b4c5b71</code>ã€‚</p><h2 id="ä¸Šä¼ å¤§æ–‡ä»¶"><a href="#ä¸Šä¼ å¤§æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ å¤§æ–‡ä»¶"></a>ä¸Šä¼ å¤§æ–‡ä»¶</h2><p>å¦‚æœæœ‰ä¸Šä¼ å¤§æ–‡ä»¶çš„éœ€æ±‚ï¼Œåœ¨æ²¡æœ‰é…ç½®ç±»çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">servlet:</span></span><br><span class="line">      <span class="attr">multipart:</span></span><br><span class="line">        <span class="attr">max-file-size:</span> <span class="string">500MB</span></span><br><span class="line">        <span class="attr">max-request-size:</span> <span class="string">500MB</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] <a href="https://min.io/docs/minio/container/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html">https://min.io/docs/minio/container/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html</a><br>[2] <a href="https://www.iocoder.cn/Spring-Boot/MinIO/?yudao">https://www.iocoder.cn/Spring-Boot/MinIO/?yudao</a><br>[3] <a href="https://blog.csdn.net/BThinker/article/details/125412751">https://blog.csdn.net/BThinker/article/details/125412751</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;MinIOå¯¹è±¡å­˜å‚¨æœåŠ¡å¼€å‘æœºéƒ¨ç½²ä¸Spring Booté¡¹ç›®æ•´åˆå…¥é—¨ã€‚&lt;br&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Spring" scheme="http://silencezheng.top/tags/Spring/"/>
    
    <category term="MinIO" scheme="http://silencezheng.top/tags/MinIO/"/>
    
  </entry>
  
  <entry>
    <title>Gitæ¢è¡Œç¬¦è­¦å‘Šæ’æŸ¥è®°å½•</title>
    <link href="http://silencezheng.top/2023/07/22/article110/"/>
    <id>http://silencezheng.top/2023/07/22/article110/</id>
    <published>2023-07-22T13:26:10.000Z</published>
    <updated>2023-07-22T13:28:10.348Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½¿ç”¨Gitä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™æç¤º<code>warning: in the working copy of &#39;xxx&#39;, CRLF will be replaced by LF the next time Git touches it</code><br><span id="more"></span></p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p><code>warning: in the working copy of &#39;xxx&#39;, CRLF will be replaced by LF the next time Git touches it</code>è¡¨ç¤ºGitæ£€æµ‹åˆ°åœ¨å½“å‰ä»£ç åº“ä¸­å­˜åœ¨ä¸åŒçš„æ¢è¡Œç¬¦é£æ ¼ï¼Œå®ƒæŒ‡å‡ºGitåœ¨ä¸‹æ¬¡å¤„ç†æ–‡ä»¶æ—¶å°†æ›¿æ¢CRLFï¼ˆå›è½¦+æ¢è¡Œï¼‰æ¢è¡Œç¬¦ä¸ºLFï¼ˆä»…æ¢è¡Œï¼‰æ¢è¡Œç¬¦ã€‚</p><p>æˆ‘æ˜¯åœ¨ä½¿ç”¨Hexoä¸Šä¼ æ—¶å‡ºç°è¯¥é—®é¢˜çš„ï¼Œç›¸å…³æ–‡ä»¶ä¸ºæ–‡ç« å¯¹åº”çš„index.htmlï¼Œå› æ­¤å¯èƒ½æ˜¯hexoç”Ÿæˆäº†CRLFæ¢è¡Œçš„htmlæ–‡ä»¶å¯¼è‡´ã€‚</p><h2 id="æ£€æŸ¥é—®é¢˜æ–‡ä»¶"><a href="#æ£€æŸ¥é—®é¢˜æ–‡ä»¶" class="headerlink" title="æ£€æŸ¥é—®é¢˜æ–‡ä»¶"></a>æ£€æŸ¥é—®é¢˜æ–‡ä»¶</h2><p><code>hexo clean</code> åé‡æ–°ç”Ÿæˆé¡µé¢ï¼Œæ£€æŸ¥é—®é¢˜é¡µé¢å¦‚ä¸‹ï¼Œæœªå‘ç°é—®é¢˜ï¼Œéƒ½æ˜¯LFæ¢è¡Œçš„æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% od -c index.html</span><br><span class="line"></span><br><span class="line">0000000    &lt;   !   D   O   C   T   Y   P   E       h   t   m   l   &gt;  \n</span><br><span class="line">0000020    &lt;   h   t   m   l   &gt;  \n   &lt;   h   e   a   d   &gt;  \n        </span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h2 id="æ£€æŸ¥Gité…ç½®"><a href="#æ£€æŸ¥Gité…ç½®" class="headerlink" title="æ£€æŸ¥Gité…ç½®"></a>æ£€æŸ¥Gité…ç½®</h2><p>å…ˆåœ¨égitç›®å½•ä¸‹æ£€æŸ¥äº†å…¨å±€é…ç½®<code>git config --list</code>å¦‚ä¸‹ï¼ŒæŒ‰é“ç†æ¥è¯´æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">core.autocrlf=input</span><br></pre></td></tr></table></figure><blockquote><p><code>core.autocrlf</code>æ˜¯Gitä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œç”¨äºå¤„ç†è·¨å¹³å°å¼€å‘æ—¶çš„æ¢è¡Œç¬¦é—®é¢˜ã€‚å®ƒç”¨äºæŒ‡å®šGitåœ¨æäº¤å’Œæ£€å‡ºæ–‡ä»¶æ—¶æ˜¯å¦è‡ªåŠ¨è½¬æ¢æ¢è¡Œç¬¦çš„è¡Œä¸ºã€‚å¯¹äºå¤šå¹³å°åä½œçš„é¡¹ç›®ï¼Œç‰¹åˆ«æ˜¯åœ¨Windowså’Œç±»Unixç³»ç»Ÿï¼ˆå¦‚MacOSå’ŒLinuxï¼‰ä¹‹é—´è¿›è¡Œå¼€å‘æ—¶ï¼Œé…ç½®<code>core.autocrlf</code>å¯ä»¥ç¡®ä¿æ¢è¡Œç¬¦çš„ä¸€è‡´æ€§ï¼Œé¿å…åœ¨ç‰ˆæœ¬æ§åˆ¶æ—¶é¢‘ç¹æ›´æ”¹æ¢è¡Œç¬¦å¯¼è‡´çš„å†²çªã€‚</p><p><code>core.autocrlf</code>æœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p><ol><li><code>true</code>ï¼šè¡¨ç¤ºGitä¼šåœ¨æäº¤æ—¶å°†CRLFï¼ˆå›è½¦+æ¢è¡Œï¼‰è½¬æ¢ä¸ºLFï¼ˆä»…æ¢è¡Œï¼‰ï¼Œåœ¨æ£€å‡ºæ—¶å°†LFè½¬æ¢ä¸ºCRLFã€‚é€‚ç”¨äºWindowså¼€å‘è€…åœ¨ä¸ç±»Unixç³»ç»Ÿçš„å¼€å‘è€…åˆä½œæ—¶ä½¿ç”¨ã€‚</li><li><code>false</code>ï¼šè¡¨ç¤ºGitä¸ä¼šè‡ªåŠ¨è½¬æ¢æ¢è¡Œç¬¦ã€‚é€‚ç”¨äºåœ¨Unixç±»ç³»ç»Ÿä¸Šå¼€å‘ï¼Œæˆ–è€…ç¡®ä¿æ–‡ä»¶çš„æ¢è¡Œç¬¦ä¿æŒä¸å˜æ—¶ä½¿ç”¨ã€‚</li><li><code>input</code>ï¼šè¡¨ç¤ºGitä¼šåœ¨æäº¤æ—¶å°†CRLFè½¬æ¢ä¸ºLFï¼Œåœ¨æ£€å‡ºæ—¶ä¸åšä»»ä½•è½¬æ¢ã€‚é€‚ç”¨äºåœ¨Windowsä¸Šå¼€å‘ï¼Œä½†åœ¨ç‰ˆæœ¬åº“ä¸­ä¿ç•™LFæ¢è¡Œç¬¦çš„é¡¹ç›®ã€‚</li></ol></blockquote><p>åˆåˆ°hexoæ ¹ç›®å½•ä¸‹çš„<code>.deploy_git</code>æŸ¥çœ‹äº†ï¼Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¿™ä¸ªé…ç½®åº”è¯¥ä¸ä¼šå‡ºä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="æ£€æŸ¥Gitå†å²æäº¤"><a href="#æ£€æŸ¥Gitå†å²æäº¤" class="headerlink" title="æ£€æŸ¥Gitå†å²æäº¤"></a>æ£€æŸ¥Gitå†å²æäº¤</h2><p>åˆç»§ç»­äº†è§£äº†ä¸€ä¸‹ï¼Œä¼¼ä¹å†å²æäº¤ä¸­å‡ºç°è¿‡CRLFæ¢è¡Œçš„æ–‡ä»¶ä¹Ÿä¼šæ˜¾ç¤ºè¯¥è­¦å‘Šï¼Œäºæ˜¯å»æŸ¥çœ‹å†å²æäº¤è®°å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -p -- filename</span><br></pre></td></tr></table></figure><p>ç¿»çœ‹è®°å½•ï¼Œå‡ºç°çº¢è‰²<code>^M</code>åˆ™æ˜¯åŒ…å«CRLFçš„åœ°æ–¹ï¼Œçœ‹åˆ°ä¹‹å‰åœ¨Windowsç”µè„‘ä¸Šé…ç½®çš„Gitalkæ’ä»¶æ˜¯CRLFæ ¼å¼çš„ã€‚</p><p>é‚ä¿®æ”¹ï¼Œè§£å†³ã€‚å…¶å®ç¬¬ä¸€æ­¥å°±èƒ½è§£å†³äº†ï¼ŒæŸ¥æ‰¾çš„æ—¶å€™å¿˜è®°ç›´æ¥æœ<code>\r</code>äº†â€¦</p><h2 id="CRå’ŒLF"><a href="#CRå’ŒLF" class="headerlink" title="CRå’ŒLF"></a>CRå’ŒLF</h2><p>CRï¼ˆCarriage Returnï¼‰å’ŒLFï¼ˆLine Feedï¼‰æ˜¯ä¸¤ä¸ªæ§åˆ¶å­—ç¬¦ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºæ–‡æœ¬æ–‡ä»¶ä¸­çš„è¡Œå°¾ã€‚</p><ol><li><p><strong>CRï¼ˆCarriage Returnï¼‰</strong>ï¼š</p><ul><li>åœ¨ASCIIç ä¸­ï¼ŒCRçš„å€¼ä¸ºåè¿›åˆ¶13æˆ–åå…­è¿›åˆ¶0x0Dã€‚</li><li>CRé€šå¸¸è¡¨ç¤ºä¸º<code>\r</code>ã€‚</li><li>åœ¨æ—©æœŸçš„æ‰“å­—æœºå’Œç»ˆç«¯è®¾å¤‡ä¸­ï¼ŒCRç”¨äºå°†æ‰“å°å¤´æˆ–å…‰æ ‡ç§»åŠ¨åˆ°è¡Œçš„å¼€å¤´ï¼Œä»¥ä¾¿åœ¨æ–°çš„æ–‡æœ¬è¾“å…¥å¼€å§‹æ—¶è¦†ç›–ä¹‹å‰çš„å†…å®¹ã€‚</li><li>åœ¨è®¡ç®—æœºæ–‡æœ¬ä¸­ï¼ŒCRé€šå¸¸ç”¨äºè¡¨ç¤ºè¡Œå°¾ï¼Œå³åœ¨CRä¹‹åçš„å†…å®¹å°†ä»æ–°çš„ä¸€è¡Œå¼€å§‹ã€‚åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸­ï¼ˆå¦‚Mac OS 9åŠä¹‹å‰ç‰ˆæœ¬ï¼‰ï¼ŒCRè¢«ç”¨ä½œè¡Œå°¾ç¬¦ã€‚</li></ul></li><li><p><strong>LFï¼ˆLine Feedï¼‰</strong>ï¼š</p><ul><li>åœ¨ASCIIç ä¸­ï¼ŒLFçš„å€¼ä¸ºåè¿›åˆ¶10æˆ–åå…­è¿›åˆ¶0x0Aã€‚</li><li>LFé€šå¸¸è¡¨ç¤ºä¸º<code>\n</code>ã€‚</li><li>LFåœ¨è®¡ç®—æœºæ–‡æœ¬ä¸­å¹¿æ³›ç”¨äºè¡¨ç¤ºè¡Œå°¾ï¼Œå³åœ¨LFä¹‹åçš„å†…å®¹å°†ä»æ–°çš„ä¸€è¡Œå¼€å§‹ã€‚åœ¨Unixã€Linuxå’Œç°ä»£Mac OSç­‰æ“ä½œç³»ç»Ÿä¸­ï¼ŒLFé€šå¸¸è¢«ç”¨ä½œè¡Œå°¾ç¬¦ã€‚</li></ul></li></ol><p>åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ï¼Œå¯¹äºæ–‡æœ¬æ–‡ä»¶çš„è¡Œå°¾è¡¨ç¤ºæ–¹å¼å¯èƒ½ä¸åŒï¼š</p><ul><li>Unix/Linux/MacOSä½¿ç”¨LFï¼ˆ<code>\n</code>ï¼‰ä½œä¸ºè¡Œå°¾ç¬¦ã€‚</li><li>Windowsä½¿ç”¨CRLFï¼ˆ<code>\r\n</code>   ï¼‰ä½œä¸ºè¡Œå°¾ç¬¦ã€‚</li></ul><p>åœ¨è·¨å¹³å°å¼€å‘æˆ–å¤„ç†æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œæ³¨æ„è¡Œå°¾ç¬¦çš„å·®å¼‚å¯èƒ½æ˜¯å¾ˆé‡è¦çš„ã€‚ç°ä»£çš„æ–‡æœ¬ç¼–è¾‘å™¨å’Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé€šå¸¸èƒ½å¤Ÿè¯†åˆ«å’Œå¤„ç†ä¸åŒè¡Œå°¾ç¬¦çš„æ–‡ä»¶ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨Gitä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™æç¤º&lt;code&gt;warning: in the working copy of &amp;#39;xxx&amp;#39;, CRLF will be replaced by LF the next time Git touches it&lt;/code&gt;&lt;br&gt;</summary>
    
    
    
    
    <category term="Git" scheme="http://silencezheng.top/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Lombokå¸¸ç”¨æ³¨è§£</title>
    <link href="http://silencezheng.top/2023/07/22/article109/"/>
    <id>http://silencezheng.top/2023/07/22/article109/</id>
    <published>2023-07-22T11:24:40.000Z</published>
    <updated>2023-07-22T11:25:51.378Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•´ç†ä¸€äº›Lombokçš„å¸¸ç”¨æ³¨è§£å’Œæ³¨æ„äº‹é¡¹ï¼ˆå‡ ä¹åŒ…å«æ‰€æœ‰ä¸»æµæ³¨è§£äº†ï¼‰ã€‚</p><span id="more"></span><blockquote><p>Lombokæ˜¯é€šè¿‡åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œå­—èŠ‚ç å¢å¼ºå®ç°çš„ï¼Œå®ƒåˆ©ç”¨Javaçš„æ³¨è§£å¤„ç†å™¨æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£ç”Ÿæˆç›¸åº”çš„ä»£ç ï¼Œå¯ä»¥å¤§å¹…å‡å°‘ Java ä»£ç çš„å†—ä½™å’Œé‡å¤ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p></blockquote><h2 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h2><p><code>@Data</code> æ˜¯ Lombok æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼ŒåŒ…å«äº†ä»¥ä¸‹æ³¨è§£çš„åŠŸèƒ½ï¼š</p><ol><li><code>@Getter</code>ï¼šç”Ÿæˆå±æ€§çš„ getter æ–¹æ³•ã€‚</li><li><code>@Setter</code>ï¼šç”Ÿæˆå±æ€§çš„ setter æ–¹æ³•ã€‚</li><li><code>@ToString</code>ï¼šç”Ÿæˆ toString æ–¹æ³•ï¼Œç”¨äºè¾“å‡ºå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li><li><code>@EqualsAndHashCode</code>ï¼šç”Ÿæˆ equals å’Œ hashCode æ–¹æ³•ï¼Œç”¨äºå¯¹è±¡çš„æ¯”è¾ƒå’Œå“ˆå¸Œè®¡ç®—ã€‚</li></ol><p>ä½¿ç”¨ <code>@Data</code> æ³¨è§£å¯ä»¥ç®€åŒ– POJO ç±»çš„ç¼–å†™ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@Data</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥è‡ªJavaç¼–è¯‘å™¨ï¼Œéšå¼æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥è‡ª @Getter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥è‡ª @Setter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥è‡ª @EqualsAndHashCode</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> LombokTest)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokTest other = (LombokTest)o;</span><br><span class="line">            <span class="keyword">if</span> (!other.canEqual(<span class="keyword">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.getId() != other.getId()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Object <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">                Object other$name = other.getName();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>$name == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (other$name != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canEqual</span><span class="params">(Object other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> other <span class="keyword">instanceof</span> LombokTest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> PRIME = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">        result = result * <span class="number">59</span> + <span class="keyword">this</span>.getId();</span><br><span class="line">        Object $name = <span class="keyword">this</span>.getName();</span><br><span class="line">        result = result * <span class="number">59</span> + ($name == <span class="keyword">null</span> ? <span class="number">43</span> : $name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥è‡ª @ToString</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokTest(id=&quot;</span> + <span class="keyword">this</span>.getId() + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.getName() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>@Data</code> æ³¨è§£ä¼šç”Ÿæˆæ‰€æœ‰å±æ€§çš„ getter å’Œ setter æ–¹æ³•ï¼Œå¦‚æœéœ€è¦å¯¹æŸäº›å±æ€§è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–æ³¨è§£ï¼Œå¯¹æŒ‡å®šçš„å±æ€§è¿›è¡Œå®šåˆ¶åŒ–é…ç½®ã€‚</p><h2 id="NoArgsConstructor"><a href="#NoArgsConstructor" class="headerlink" title="@NoArgsConstructor"></a>@NoArgsConstructor</h2><p><code>@NoArgsConstructor</code> æ˜¯ Lombok æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆæ— å‚æ„é€ å‡½æ•°ã€‚å®ƒå¯ä»¥ç”¨åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ã€‚å¦‚æœç±»å·²ç»åŒ…å«äº†å…¶ä»–æœ‰å‚æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ <code>@NoArgsConstructor</code> ä¸ä¼šè¦†ç›–å·²æœ‰çš„æ„é€ å‡½æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@NoArgsConstructor</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="AllArgsConstructor"><a href="#AllArgsConstructor" class="headerlink" title="@AllArgsConstructor"></a>@AllArgsConstructor</h2><p><code>@AllArgsConstructor</code> æ˜¯ Lombok æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨ç”ŸæˆåŒ…å«æ‰€æœ‰å±æ€§çš„æ„é€ å‡½æ•°ã€‚å®ƒå¯ä»¥ç”¨åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å±æ€§çš„æ„é€ å‡½æ•°ã€‚æ³¨æ„æ­¤æ—¶ç±»ä¸­ä¸å¯ä»¥åŒ…å«å…¨å‚æ„é€ å‡½æ•°ä»£ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@AllArgsConstructor</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h2><p><code>@Builder</code> æ˜¯ Lombok æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆæ„å»ºå™¨æ¨¡å¼ç›¸å…³çš„ä»£ç ã€‚å®ƒå¯ä»¥ç”¨åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªæ„å»ºå™¨ï¼Œç”¨äºç®€åŒ–åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥é¿å…è¿‡å¤šçš„æ„é€ å‡½æ•°é‡è½½ï¼Œå¹¶æä¾›æ›´çµæ´»çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@Builder</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lombokè‡ªåŠ¨äº§ç”Ÿ</span></span><br><span class="line">    LombokTest(<span class="keyword">int</span> id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LombokTestBuilder <span class="title">builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LombokTestBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTestBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        LombokTestBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LombokTestBuilder <span class="title">id</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LombokTestBuilder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LombokTest <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LombokTest(<span class="keyword">this</span>.id, <span class="keyword">this</span>.name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;LombokTest.LombokTestBuilder(id=&quot;</span> + <span class="keyword">this</span>.id + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ„é€ å™¨æ¨¡å¼åˆ›å»ºå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line">LombokTest lombokTest = LombokTest.builder().id(<span class="number">1</span>).name(<span class="string">&quot;lombok&quot;</span>).build(); <span class="comment">// åˆ›å»ºLombokTestå¯¹è±¡</span></span><br><span class="line">System.out.println(LombokTest.builder().id(<span class="number">1</span>).name(<span class="string">&quot;lombok&quot;</span>)); <span class="comment">// LombokTest.LombokTestBuilder(id=1, name=lombok)</span></span><br></pre></td></tr></table></figure><h2 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h2><p>å°†<code>@NonNull</code>æ³¨è§£æ”¾åœ¨å±æ€§ä¸Šï¼Œè¡¨ç¤ºè¯¥å±æ€§ä¸èƒ½ä¸º<code>null</code>ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º<code>NullPointerException</code>ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@NonNull</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NonNull</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ³¨æ„è¿™é‡Œå°† <code>@NonNull</code> æ³¨è§£ç”¨äº<code>primitive</code>æ˜¯æ— æ„ä¹‰çš„ï¼ŒåŸå§‹ç±»å‹æœ¬èº«å°±ä¸èƒ½æ˜¯<code>null</code>ã€‚</p><h2 id="RequiredArgsConstructor"><a href="#RequiredArgsConstructor" class="headerlink" title="@RequiredArgsConstructor"></a>@RequiredArgsConstructor</h2><p>å°†<code>@RequiredArgsConstructor</code>æ³¨è§£æ”¾åœ¨ç±»ä¸Šï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰æ ‡è®°äº†<code>@NonNull</code>æ³¨è§£çš„å±æ€§çš„æ„é€ å‡½æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@RequiredArgsConstructor</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String aString;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Double aDouble;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NonNull</span> String aString;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NonNull</span> Double aDouble;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokTest</span><span class="params">(<span class="meta">@NonNull</span> String aString, <span class="meta">@NonNull</span> Double aDouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (aString == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;aString is marked non-null but is null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (aDouble == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;aDouble is marked non-null but is null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.aString = aString;</span><br><span class="line">            <span class="keyword">this</span>.aDouble = aDouble;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h2><p>å°†<code>@SneakyThrows</code>æ³¨è§£æ”¾åœ¨æ–¹æ³•ä¸Šï¼Œå®ƒä¼šè‡ªåŠ¨å°†å—æ£€å¼‚å¸¸è½¬æ¢ä¸ºéå—æ£€å¼‚å¸¸æŠ›å‡ºï¼Œé¿å…åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å¤„ç†å—æ£€å¼‚å¸¸ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>@RequiredArgsConstructor</code> æ³¨è§£çš„ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå—æ£€å¼‚å¸¸ï¼Œä½†æ˜¯ä¸éœ€è¦æ˜¾å¼åœ°å¤„ç†å®ƒ</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;This is a checked exception&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Example</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;This is a checked exception&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¸ä½¿ç”¨è¯¥æ³¨è§£ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦å¦‚æ­¤å¤„ç†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author: SilenceZheng66</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå—æ£€å¼‚å¸¸ï¼Œéœ€è¦æ˜¾å¼åœ°å¤„ç†å®ƒ</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;This is a checked exception&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Example example = <span class="keyword">new</span> Example();</span><br><span class="line">        example.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…³äºå—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸ï¼š</p><blockquote><p><code>java.lang.Throwable</code>æ˜¯Javaä¸­æ‰€æœ‰é”™è¯¯å’Œå¼‚å¸¸çš„æ ¹ç±»ã€‚å®ƒæ˜¯ä¸€ä¸ªç±»å±‚æ¬¡ç»“æ„çš„é¡¶å±‚ç±»ï¼Œè¡¨ç¤ºå¯ä»¥è¢«æŠ›å‡ºçš„ä»»ä½•é—®é¢˜ï¼ŒåŒ…æ‹¬é”™è¯¯ï¼ˆ<code>Error</code>ï¼‰å’Œå¼‚å¸¸ï¼ˆ<code>Exception</code>ï¼‰ã€‚</p><p><code>Throwable</code>ç±»åŒ…å«ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å­ç±»ï¼š</p><ol><li><p><code>Error</code>: è¡¨ç¤ºä¸¥é‡çš„ç³»ç»Ÿé”™è¯¯ï¼Œé€šå¸¸ç”±Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æŠ¥å‘Šï¼Œä¾‹å¦‚<code>OutOfMemoryError</code>ã€<code>StackOverflowError</code>ç­‰ã€‚<code>Error</code>ç±»çš„å®ä¾‹é€šå¸¸è¡¨ç¤ºä¸å¯æ¢å¤çš„é”™è¯¯æƒ…å†µï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¸åº”è¯¥æ•è·å’Œå¤„ç†<code>Error</code>ã€‚</p></li><li><p><code>Exception</code>: è¡¨ç¤ºå¯è¢«æ•è·å’Œå¤„ç†çš„å¼‚å¸¸ã€‚<code>Exception</code>ç±»åˆåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p>å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼šç»§æ‰¿è‡ª<code>Exception</code>çš„å­ç±»ï¼Œä½†ä¸ç»§æ‰¿è‡ª<code>RuntimeException</code>çš„å¼‚å¸¸ã€‚å—æ£€å¼‚å¸¸åœ¨æ–¹æ³•ç­¾åä¸­å¿…é¡»æ˜¾å¼åœ°å£°æ˜ï¼Œæˆ–è€…åœ¨æ–¹æ³•å†…éƒ¨æ•è·å’Œå¤„ç†ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä¾‹å¦‚ï¼Œ<code>IOException</code>ã€<code>SQLException</code>ç­‰å±äºå—æ£€å¼‚å¸¸ã€‚</p></li><li><p>éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰ï¼šç»§æ‰¿è‡ª<code>RuntimeException</code>çš„å¼‚å¸¸ã€‚éå—æ£€å¼‚å¸¸ä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­æ˜¾å¼åœ°å£°æ˜ï¼Œä¹Ÿå¯ä»¥ä¸åœ¨æ–¹æ³•å†…éƒ¨æ•è·å’Œå¤„ç†ã€‚é€šå¸¸æ˜¯ç”±ç¨‹åºç¼–ç¨‹é”™è¯¯å¼•èµ·çš„ï¼Œä¾‹å¦‚<code>NullPointerException</code>ã€<code>ArrayIndexOutOfBoundsException</code>ç­‰ã€‚</p></li></ul></li></ol><p><code>Throwable</code>ç±»å®šä¹‰äº†ä»¥ä¸‹ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼š</p><ul><li><code>getMessage()</code>: è·å–å…³äºå¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li><code>toString()</code>: è¿”å›å¼‚å¸¸çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ŒåŒ…æ‹¬å¼‚å¸¸çš„ç±»åå’Œè¯¦ç»†ä¿¡æ¯ã€‚</li><li><code>printStackTrace()</code>: åœ¨æ§åˆ¶å°æ‰“å°å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œé”™è¯¯å®šä½ã€‚</li><li><code>getCause()</code>: è·å–å¯¼è‡´å½“å‰å¼‚å¸¸çš„åŸå› ï¼ˆå³å¯¼è‡´å½“å‰å¼‚å¸¸æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸ï¼‰ã€‚</li></ul><p><code>Throwable</code>ç±»çš„å­ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿å®ƒçš„æ–¹æ³•å’Œæ·»åŠ è‡ªå·±çš„æ–¹æ³•æ¥å®šä¹‰ç‰¹å®šç±»å‹çš„é”™è¯¯å’Œå¼‚å¸¸ã€‚</p></blockquote><h2 id="å…¶ä»–ä¸€äº›æ³¨è§£"><a href="#å…¶ä»–ä¸€äº›æ³¨è§£" class="headerlink" title="å…¶ä»–ä¸€äº›æ³¨è§£"></a>å…¶ä»–ä¸€äº›æ³¨è§£</h2><p><code>@Cleanup</code>ï¼šå°†<code>@Cleanup</code>æ³¨è§£æ”¾åœ¨éœ€è¦è¿›è¡Œèµ„æºå…³é—­çš„å±æ€§ä¸Šï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„å…³é—­ä»£ç ï¼Œç”¨äºç®€åŒ–èµ„æºç®¡ç†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå®ç°<code>java.io.Closeable</code>æ¥å£çš„èµ„æºã€‚</p><p><code>@Getter(lazy = true)</code>ï¼šå°†<code>@Getter(lazy = true)</code>æ³¨è§£æ”¾åœ¨å±æ€§ä¸Šï¼Œå®ƒä¼šç”Ÿæˆå±æ€§çš„æ‡’åŠ è½½ getter æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶æ‰ä¼šè®¡ç®—å¹¶è¿”å›å±æ€§çš„å€¼ã€‚</p><p>è¿˜æœ‰ä¸€äº›æ—¥å¿—ç›¸å…³çš„æ³¨è§£ï¼Œç­‰å†™Javaæ—¥å¿—æ¡†æ¶æ—¶å†ä¸€å¹¶å†™äº†å§ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ•´ç†ä¸€äº›Lombokçš„å¸¸ç”¨æ³¨è§£å’Œæ³¨æ„äº‹é¡¹ï¼ˆå‡ ä¹åŒ…å«æ‰€æœ‰ä¸»æµæ³¨è§£äº†ï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Java" scheme="http://silencezheng.top/tags/Java/"/>
    
    <category term="Lombok" scheme="http://silencezheng.top/tags/Lombok/"/>
    
  </entry>
  
  <entry>
    <title>Nginxä½¿ç”¨å…¥é—¨</title>
    <link href="http://silencezheng.top/2023/07/14/article108/"/>
    <id>http://silencezheng.top/2023/07/14/article108/</id>
    <published>2023-07-14T15:43:40.000Z</published>
    <updated>2023-07-23T02:40:55.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Nginxä½¿ç”¨å…¥é—¨ï¼Œè®©ä½ çš„é—²ç½®äº‘æœåŠ¡å™¨ç”¨èµ·æ¥ï½</p><span id="more"></span><h2 id="Nginxèƒ½å¹²ä»€ä¹ˆï¼Ÿ"><a href="#Nginxèƒ½å¹²ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Nginxèƒ½å¹²ä»€ä¹ˆï¼Ÿ"></a>Nginxèƒ½å¹²ä»€ä¹ˆï¼Ÿ</h2><p>Nginxæ˜¯ä¸€æ¬¾å¼€æºçš„é«˜æ€§èƒ½WebæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå…·æœ‰ä»¥ä¸‹ä¸»è¦åŠŸèƒ½ï¼š</p><ol><li><p><strong>WebæœåŠ¡å™¨</strong>ï¼šNginxå¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„WebæœåŠ¡å™¨æ¥æä¾›é™æ€å†…å®¹å’ŒåŠ¨æ€å†…å®¹çš„æœåŠ¡ã€‚å®ƒæ”¯æŒå¤„ç†HTTPã€HTTPSã€HTTP/2å’ŒWebSocketç­‰åè®®ï¼Œå…·æœ‰é«˜å¹¶å‘å¤„ç†èƒ½åŠ›å’Œä½èµ„æºæ¶ˆè€—ã€‚</p></li><li><p><strong>åå‘ä»£ç†</strong>ï¼šNginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†å…¶è½¬å‘åˆ°åç«¯çš„å¤šä¸ªæœåŠ¡å™¨ï¼Œèµ·åˆ°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§çš„ä½œç”¨ã€‚å®ƒèƒ½å¤Ÿæ™ºèƒ½åœ°åˆ†é…è¯·æ±‚è´Ÿè½½ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œå¯é æ€§ã€‚</p></li><li><p><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šNginxèƒ½å¤Ÿåœ¨å¤šä¸ªåç«¯æœåŠ¡å™¨ä¹‹é—´åˆ†å‘è¯·æ±‚ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚é€šè¿‡æ™ºèƒ½åœ°å°†è¯·æ±‚åˆ†é…ç»™ä¸åŒçš„æœåŠ¡å™¨ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p></li><li><p><strong>HTTPç¼“å­˜</strong>ï¼šNginxæ”¯æŒå¯¹é™æ€å’ŒåŠ¨æ€å†…å®¹è¿›è¡Œç¼“å­˜ï¼Œå‡å°‘å¯¹åç«¯æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œæé«˜å“åº”é€Ÿåº¦å’Œååé‡ã€‚å®ƒå¯ä»¥æ ¹æ®è®¾ç½®çš„ç¼“å­˜è§„åˆ™ï¼Œç¼“å­˜ç»å¸¸è®¿é—®çš„å†…å®¹ï¼Œå¹¶æä¾›å¿«é€Ÿçš„å“åº”ã€‚</p></li><li><p><strong>å®‰å…¨æ€§</strong>ï¼šNginxå…·æœ‰å†…ç½®çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚åå‘ä»£ç†é˜²å¾¡ï¼ˆReverse Proxy Defenseï¼‰å’Œè¯·æ±‚é™åˆ¶ï¼ˆRate Limitingï¼‰ï¼Œä»¥ä¿æŠ¤ç½‘ç«™å…å—æ¶æ„è¯·æ±‚å’ŒDDoSæ”»å‡»ã€‚</p></li><li><p><strong>SSL/TLSåŠ å¯†</strong>ï¼šNginxæ”¯æŒSSL/TLSåè®®ï¼Œå¯ä»¥è¿›è¡Œå®‰å…¨çš„åŠ å¯†é€šä¿¡ï¼Œå¹¶æä¾›HTTPSåè®®çš„æ”¯æŒã€‚å®ƒå¯ä»¥é…ç½®å’Œç®¡ç†è¯ä¹¦ï¼Œå®ç°å®‰å…¨çš„æ•°æ®ä¼ è¾“ã€‚</p></li><li><p><strong>åŠ¨æ€æ¨¡å—</strong>ï¼šNginxæ”¯æŒæ¨¡å—åŒ–çš„æ¶æ„ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ ç¬¬ä¸‰æ–¹æ¨¡å—æ‰©å±•å…¶åŠŸèƒ½ã€‚è¿™ä½¿å¾—Nginxå…·æœ‰æ›´å¤šçš„æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œå®šåˆ¶å’Œé…ç½®ã€‚</p></li></ol><p>æœ¬æ–‡å…ˆä»æœ€å¸¸ç”¨çš„WebæœåŠ¡å™¨å¼€å§‹ã€‚</p><h2 id="åŸºäºDockeréƒ¨ç½²Nginx"><a href="#åŸºäºDockeréƒ¨ç½²Nginx" class="headerlink" title="åŸºäºDockeréƒ¨ç½²Nginx"></a>åŸºäºDockeréƒ¨ç½²Nginx</h2><p>é€šè¿‡Dockeréƒ¨ç½²Nginxå¯¹äºæˆ‘ä»¬çš„å­¦ä¹ æ›´æ–¹ä¾¿ï¼Œä¹Ÿæä¾›äº†æ›´å¥½çš„éš”ç¦»æ€§ã€‚ä¸‹é¢æ˜¯é€šè¿‡dockerå¯åŠ¨Nginxçš„å¤§è‡´æ“ä½œæµç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir /path/to/mynginx/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">touch /path/to/mynginx/config/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥å†…å®¹</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -d --name mynginx -p local_port:container_port \</span><br><span class="line"><span class="comment"># æŒ‚è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">-v /path/to/mynginx/config/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line"><span class="comment"># æŒ‚è½½ç›®æ ‡ç›®å½•</span></span><br><span class="line">-v /path/to/projects:/usr/share/nginx/html \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://ip:port/target</span><br></pre></td></tr></table></figure><h2 id="WebæœåŠ¡å™¨åº”ç”¨ä¸¾ä¾‹"><a href="#WebæœåŠ¡å™¨åº”ç”¨ä¸¾ä¾‹" class="headerlink" title="WebæœåŠ¡å™¨åº”ç”¨ä¸¾ä¾‹"></a>WebæœåŠ¡å™¨åº”ç”¨ä¸¾ä¾‹</h2><p>ä¸‹é¢ï¼ŒåŸºäºä¸Šè¿°åŸºæœ¬æµç¨‹ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€äº›WebæœåŠ¡å™¨çš„å®ä¾‹ã€‚</p><p>çœç•¥æ‹‰å–é•œåƒï½</p><h3 id="1-å›¾åºŠ"><a href="#1-å›¾åºŠ" class="headerlink" title="1. å›¾åºŠ"></a>1. å›¾åºŠ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir /path/to/mynginx/img_host/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">touch /path/to/mynginx/img_host/config/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    worker_processes 1; <span class="comment"># åº”è¯¥ä½¿ç”¨å¤šå°‘ä¸ªworkerè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># äº‹ä»¶å¤„ç†å™¨é…ç½®</span></span><br><span class="line">    events &#123;</span><br><span class="line">        worker_connections 1024; <span class="comment"># æ¯ä¸ªworkerè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¨å±€HTTPæœåŠ¡å™¨é…ç½®</span></span><br><span class="line">    http &#123;</span><br><span class="line">        include mime.types;</span><br><span class="line">        default_type application/octet-stream; <span class="comment"># é»˜è®¤çš„MIMEç±»å‹</span></span><br><span class="line">        sendfile on; <span class="comment"># å¯ä»¥ç›´æ¥å°†æ–‡ä»¶ä»ç£ç›˜å¤åˆ¶åˆ°ç½‘ç»œå¥—æ¥å­—</span></span><br><span class="line">        keepalive_timeout  65; <span class="comment"># ç©ºé—²çš„æŒä¹…è¿æ¥å°†åœ¨65ç§’åå…³é—­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># images server</span></span><br><span class="line">        server &#123;</span><br><span class="line">            listen       82;</span><br><span class="line">            server_name  ip_or_domain;</span><br><span class="line"></span><br><span class="line">            location /images/ &#123;</span><br><span class="line">                <span class="built_in">alias</span> /home/images/; <span class="comment"># è¡¨ç¤ºå°†URLä¸­çš„ /images/æ›¿æ¢ä¸ºçš„å®é™…è·¯å¾„</span></span><br><span class="line">                expires max; <span class="comment"># å¯¹è¿™äº›å›¾ç‰‡æ–‡ä»¶çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸ºæœ€å¤§å€¼ï¼Œå³æ°¸ä¸è¿‡æœŸã€‚</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -d --name mynginx -p 82:82 \</span><br><span class="line">-v /path/to/mynginx/img_host/config/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /path/to/images/:/home/images/ \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://ip:82/images/pic.jpg</span><br></pre></td></tr></table></figure><h3 id="2-æ–‡ä»¶æœåŠ¡å™¨"><a href="#2-æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="2. æ–‡ä»¶æœåŠ¡å™¨"></a>2. æ–‡ä»¶æœåŠ¡å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir /path/to/mynginx/file_server/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">touch /path/to/mynginx/file_server/config/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    worker_processes 1; <span class="comment"># åº”è¯¥ä½¿ç”¨å¤šå°‘ä¸ªworkerè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># äº‹ä»¶å¤„ç†å™¨é…ç½®</span></span><br><span class="line">    events &#123;</span><br><span class="line">        worker_connections 1024; <span class="comment"># æ¯ä¸ªworkerè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¨å±€HTTPæœåŠ¡å™¨é…ç½®</span></span><br><span class="line">    http &#123;</span><br><span class="line">        server &#123;</span><br><span class="line">            listen 82;  <span class="comment"># ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">            server_name ip_or_domain;  <span class="comment"># æœåŠ¡å™¨åŸŸåæˆ–IPåœ°å€</span></span><br><span class="line"></span><br><span class="line">            location / &#123; <span class="comment"># è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåˆ†é…å…¶ä»–å‰ç¼€æ—¶ï¼Œé‡‡ç”¨rootçš„è·¯å¾„åè¦åŠ ä¸Šè¯¥å‰ç¼€ï¼Œå»ºè®®ç”¨alias</span></span><br><span class="line">                root /path/to/files/;  <span class="comment"># æ–‡ä»¶æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">                <span class="comment"># or alias /path/to/files/, ç›´æ¥ä» ip:82/ å¯è¿›å…¥</span></span><br><span class="line">                autoindex on;  <span class="comment"># å¯ç”¨ç›®å½•åˆ—è¡¨åŠŸèƒ½</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -d --name mynginx -p 82:82 \</span><br><span class="line">-v /path/to/mynginx/file_server/config/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /path/to/files/:/path/to/files/ \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®</span></span><br><span class="line">http://ip:82/path/to/files/</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>ä½¿ç”¨aliasæ—¶ç›®å½•ååé¢ä¸€å®šè¦åŠ <code>/</code>ã€‚</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨<code>location /</code>ä¸­é…ç½®rootï¼Œåœ¨<code>location /other</code>ä¸­é…ç½®aliasã€‚</li></ol><h3 id="3-Webåº”ç”¨éƒ¨ç½²"><a href="#3-Webåº”ç”¨éƒ¨ç½²" class="headerlink" title="3. Webåº”ç”¨éƒ¨ç½²"></a>3. Webåº”ç”¨éƒ¨ç½²</h3><p>ä¸€æ ·çš„é€»è¾‘ï¼Œè¿™é‡Œåªæä¾›ä¸€ä¸ªé…ç½®æ–‡ä»¶å‚è€ƒï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 1;</span><br><span class="line">error_log /var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># äº‹ä»¶å¤„ç†å™¨é…ç½®</span></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPæœåŠ¡å™¨é…ç½®</span></span><br><span class="line">http &#123;</span><br><span class="line">    include mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    sendfile on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length 1k;     <span class="comment"># è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°</span></span><br><span class="line">    gzip_buffers 4 16k;     <span class="comment"># ç”¨æ¥å­˜å‚¨ gzip çš„å‹ç¼©ç»“æœ</span></span><br><span class="line">    gzip_http_version 1.1;  <span class="comment"># è¯†åˆ« HTTP åè®®ç‰ˆæœ¬</span></span><br><span class="line">    gzip_comp_level 2;      <span class="comment"># è®¾ç½® gzip çš„å‹ç¼©æ¯” 1-9ã€‚1 å‹ç¼©æ¯”æœ€å°ä½†æœ€å¿«ï¼Œè€Œ 9 ç›¸å</span></span><br><span class="line">    gzip_types gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; <span class="comment"># æŒ‡å®šå‹ç¼©ç±»å‹</span></span><br><span class="line">    gzip_proxied any;       <span class="comment"># æ— è®ºåç«¯æœåŠ¡å™¨çš„ headers å¤´è¿”å›ä»€ä¹ˆä¿¡æ¯ï¼Œéƒ½æ— æ¡ä»¶å¯ç”¨å‹ç¼©</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡å™¨</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name example.com;</span><br><span class="line"></span><br><span class="line">        root /path/to/frontend/dist;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åç«¯APIä»£ç†</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name api.example.com;</span><br><span class="line"></span><br><span class="line">        location /api/ &#123;</span><br><span class="line">            proxy_pass http://ip:port/api/; <span class="comment">## proxy_pass éœ€è¦è®¾ç½®ä¸ºåç«¯é¡¹ç›®æ‰€åœ¨æœåŠ¡å™¨çš„ IP</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä»£ç†è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨è½¬å‘è¯·æ±‚æ—¶ä¼ é€’ç»™åç«¯æœåŠ¡å™¨</span></span><br><span class="line">            proxy_set_header Host <span class="variable">$http_host</span>; <span class="comment"># è®¾ç½®ä»£ç†è¯·æ±‚çš„Hostå¤´ï¼Œå°†å…¶è®¾ç½®ä¸ºä¸å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„Hostå¤´ä¸€è‡´</span></span><br><span class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>; <span class="comment"># å°†å®¢æˆ·ç«¯çœŸå®IPåœ°å€ä½œä¸ºX-Real-IPå¤´å‘é€ç»™åç«¯æœåŠ¡å™¨</span></span><br><span class="line">            proxy_set_header REMOTE-HOST <span class="variable">$remote_addr</span>; <span class="comment"># å°†å®¢æˆ·ç«¯IPåœ°å€ä½œä¸ºREMOTE-HOSTå¤´å‘é€ç»™åç«¯æœåŠ¡å™¨</span></span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; <span class="comment"># å°†å®¢æˆ·ç«¯IPåœ°å€æ·»åŠ åˆ°X-Forwarded-Forå¤´ä¸­ï¼Œä»¥ä¾¿åç«¯æœåŠ¡å™¨å¯ä»¥äº†è§£è¯·æ±‚çš„çœŸå®å®¢æˆ·ç«¯IPåœ°å€ã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>é¦–å‘äº <a href="https://silencezheng.top">silencezheng.top</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Nginxä½¿ç”¨å…¥é—¨ï¼Œè®©ä½ çš„é—²ç½®äº‘æœåŠ¡å™¨ç”¨èµ·æ¥ï½&lt;/p&gt;</summary>
    
    
    
    
    <category term="Nginx" scheme="http://silencezheng.top/tags/Nginx/"/>
    
  </entry>
  
</feed>
